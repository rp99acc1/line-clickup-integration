try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="797318bf-9b2f-44e6-9bc5-697bde0d6973",e._sentryDebugIdIdentifier="sentry-dbid-797318bf-9b2f-44e6-9bc5-697bde0d6973")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6054],{4262:(e,t,l)=>{l.d(t,{i:()=>d});var a=l(54568),r=l(7620),n=l(10369),s=l(23812),o=l(98304);let i=e=>{let{handleClose:t,title:l,description:r,inset:n,action:i}=e;return(0,a.jsxs)("div",{className:"border-border-300 shadow-sm w-[300px] max-w-full bg-bg-000 rounded-xl p-5 border relative",children:[(0,a.jsx)("div",{className:"text-left mb-2 font-medium text-sm",children:l}),(0,a.jsx)("p",{className:"mb-2 text-sm",children:r}),!!n&&(0,a.jsx)("div",{className:"flex flex-col rounded-md bg-text-000 bg-opacity-5 p-4 font-mono text-xs text-text-300",children:n}),i&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(s.$,{variant:"primary",className:"mt-4 text-sm",onClick:i.onClick,disabled:i.disabled,loading:i.loading,children:i.label})}),(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsx)(s.$,{variant:"ghost",onClick:t,className:"h-9 w-9 !min-w-9",children:(0,a.jsx)(o.X,{})})})]})},d=e=>{var t,l,s;let{error:o,handleClose:d,sendMessage:c,isStreaming:u}=e,[f,m]=(0,r.useState)(!1),p=(0,n.A)(),g=function(e,t){switch(e.type){case"UnsupportedImports":return{title:t?t.formatMessage({defaultMessage:"Artifact failed to load",id:"NcDXiSfIPe"}):"Artifact failed to load",description:t?t.formatMessage({defaultMessage:"The generated artifact uses libraries we don’t support:",id:"HG0Hu8xIQA"}):"The generated artifact uses libraries we don’t support:",inset:[...e.unsupportedModules,...e.nonExistentIcons.map(e=>"{ ".concat(e,' } from "lucide-react"'))],subtext:t?t.formatMessage({defaultMessage:"The code itself may still work. To use it, you’ll need a development setup with these libraries installed.",id:"Et/uvuRBba"}):"The code itself may still work. To use it, you’ll need a development setup with these libraries installed."};case"RuntimeError":return{title:t?t.formatMessage({defaultMessage:"Error running artifact",id:"JU2kK1J3jY"}):"Error running artifact",description:t?t.formatMessage({defaultMessage:"An error occurred while trying to run the generated artifact.",id:"3RpkNRAyPc"}):"An error occurred while trying to run the generated artifact.",inset:[e.message],insetStyle:"danger"};case"FileNotFound":return{title:t?t.formatMessage({defaultMessage:"File not found",id:"gcaJtRf4b0"}):"File not found",description:t?t.formatMessage({defaultMessage:"The file “{fileName}” could not be found.",id:"0kOCGtB3eN"},{fileName:e.fileName}):"The file “".concat(e.fileName,"” could not be found."),subtext:t?t.formatMessage({defaultMessage:"Please check the file name and try again.",id:"/fdYJU5SMC"}):"Please check the file name and try again."};case"ClaudeCompletionError":return{title:t?t.formatMessage({defaultMessage:"Error in Claude completion",id:"ya5HK9oB9T"}):"Error in Claude completion",description:e.message};case"ArtifactStorageError":return{title:t?t.formatMessage({defaultMessage:"Error accessing shared data",id:"hjqZygykww"}):"Error accessing shared data",description:e.message}}}(o.error,p),h="> ".concat(g.description,"\n  ").concat(null!=(s=null==(t=g.inset)?void 0:t.map(e=>"> `".concat(e,"`")).join("\n"))?s:"","\n  \n\n  Can you fix this error in `").concat(o.artifactId,"`?"),y=c?{label:p.formatMessage({defaultMessage:"Try fixing with Claude",id:"wrcoZ2Zo0b"}),onClick:()=>{m(!0),null==c||c({prompt:h,attachments:[],files:[],syncSources:[]})},disabled:u,loading:f}:void 0;return(0,a.jsx)("div",{className:"absolute bottom-5 left-5 right-5",children:(0,a.jsx)(i,{title:g.title,description:g.description,handleClose:d,inset:(null==(l=g.inset)?void 0:l.length)?g.inset?(0,a.jsx)("ul",{children:g.inset.map((e,t)=>(0,a.jsx)("li",{children:e},t))}):null:void 0,action:y})})}},46879:(e,t,l)=>{l.d(t,{A:()=>M});var a=l(54568),r=l(23812),n=l(3075),s=l(10369),o=l(59666);let i=e=>{let{isOpen:t=!1,filename:l,onClose:i,onConfirm:d}=e,c=(0,s.A)();return(0,a.jsxs)(n.aF,{title:c.formatMessage({defaultMessage:"Download file",id:"k9qHCCLPA5"}),isOpen:t,onClose:i,children:[(0,a.jsxs)("p",{className:"break-words flex flex-col gap-1 pt-3 text-sm",children:[(0,a.jsx)(o.A,{defaultMessage:"Artifacts are created by other users and aren’t verified by Anthropic. Only download files you trust.",id:"MDebIUeu03"}),(0,a.jsx)("pre",{className:"font-mono text-wrap text-sm p-2 my-2 rounded border border-border-400 bg-bg-000",children:l})]}),(0,a.jsxs)(n.vW,{children:[(0,a.jsx)(r.$,{variant:"secondary",onClick:i,children:(0,a.jsx)(o.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsx)(r.$,{onClick:d,children:(0,a.jsx)(o.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})]})]})};var d=l(19094),c=l(64328),u=l(13750),f=l(21266),m=l(68067),p=l(7620);let g=e=>{let{isOpen:t=!1,onClose:l,onConfirm:i}=e,d=(0,s.A)(),[g,h]=(0,p.useState)(!1),{value:y}=(0,m.fS)("claude_create_pebble_stone"),{activeOrganization:v}=(0,c.YL)();return(0,p.useEffect)(()=>{!t||y&&(null==v?void 0:v.uuid)||l()},[t,y,null==v?void 0:v.uuid,l]),(0,a.jsxs)(n.aF,{title:d.formatMessage({defaultMessage:"Access shared data",id:"BgSBBhOmOQ"}),isOpen:t,onClose:l,children:[(0,a.jsx)("p",{className:"break-words flex flex-col gap-1 pt-3 text-sm",children:(0,a.jsx)(f.YX,{id:"velvet_cupcake_spark"})}),(0,a.jsx)("div",{className:"mt-4 mb-2",children:(0,a.jsx)(u.Sc,{label:(0,a.jsx)("span",{className:"text-sm text-text-100",children:(0,a.jsx)(o.A,{defaultMessage:"Remember my choice for this session",id:"ihRWxb7Azt"})}),checked:g,onChange:h})}),(0,a.jsxs)(n.vW,{children:[(0,a.jsx)(r.$,{variant:"secondary",onClick:()=>l(g),children:(0,a.jsx)(o.A,{defaultMessage:"Deny",id:"htvX+Z11l+"})}),(0,a.jsx)(r.$,{onClick:()=>i(g),children:(0,a.jsx)(o.A,{defaultMessage:"Allow",id:"y/bmsG8rnv"})})]})]})};var h=l(44995),y=l(69287),v=l(72902),x=l(39109),b=l(61295),w=l(19354),C=l(16159),j=l(86667),k=l(97905);let M=(0,p.forwardRef)((e,t)=>{let{content:l,className:n,type:u,onSandboxConfirmation:f,onDOMContentLoaded:M,capabilities:S,onReportError:N,onSetContent:A,onRefresh:R,externalLinkBehavior:E,onOpenExternalLinkRequest:P,onTrackInteraction:T,showLoginModal:_,lazy:Z=!0,zoom:I=1,artifactContext:L,ArtifactMcpModal:O,isChatStreaming:D}=e,H=(0,s.A)(),{userContentRendererUrl:F}=(0,h._r)(),{value:U}=(0,m.fS)("claude_create_marble"),[q,B]=(0,p.useState)(!1),z=(0,p.useRef)(null),G="".concat(F).concat((null==L?void 0:L.uuid)&&"published_artifact"===L.type?"/artifact/"+L.uuid:"").concat(N?"?errorReportingMode=parent":"");(0,p.useEffect)(()=>{let e=z.current;if(e&&navigator.userAgent.toLowerCase().includes("firefox")){e.setAttribute("data-no-service-worker","true");let t=setTimeout(()=>{e.sandbox&&e.src&&(e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("referrerpolicy","no-referrer"))},0);return()=>clearTimeout(t)}},[]);let[$,K]=(0,p.useState)(null),[W,X]=(0,p.useState)(null),[J,Y]=(0,p.useState)(null),[Q,V]=(0,p.useState)(null),[ee,et]=(0,p.useState)(null),[el,ea]=(0,p.useState)([]),[er,en]=(0,p.useState)([]),{activeOrganization:es}=(0,c.YL)(),eo=(0,p.useCallback)((e,t,l)=>D?new Promise((a,r)=>{let n={method:e,data:t,executeOperation:l,resolve:a,reject:r,artifactUuid:null==L?void 0:L.uuid};en(e=>{var t;return(null==L?void 0:L.uuid)!==(e.length>0?null==(t=e[e.length-1])?void 0:t.artifactUuid:null)?[n]:[...e,n]})}):l(),[D,null==L?void 0:L.uuid,en]),{value:ei}=(0,m.fS)("apps_use_turmeric"),{value:ed}=(0,m.fS)("artifact_tailwind_styles"),[ec,eu]=(0,p.useState)(0),{sendRequest:ef,updatePermission:em}=function(e){let{iframeRef:t,allowedOrigin:l,onRateLimited:a=null,initialPermissions:r,onPermissionRequested:n,onCapabilityAction:s}=e,[o,i]=(0,p.useState)(null),d=(0,p.useRef)(r),[c,u]=(0,p.useState)(0);(0,p.useEffect)(()=>{if(!t.current&&c<20){let e=setTimeout(()=>{u(e=>e+1)},500);return()=>clearTimeout(e)}if(!t.current)return void console.warn("Max retries reached while waiting for iframe");let e=new k.x({iframe:t.current,allowedOrigin:l,onRateLimited:a,onPermissionRequested:async e=>{if(w.tH.includes(e)||"accepted"===d.current[e])return"accepted";let t=await n(e);return d.current={...d.current,[e]:t},t},onCapabilityAction:s});return i(e),()=>{e.cleanup()}},[t,l,d,a,n,s,c]);let f=(0,p.useCallback)(async(e,t)=>{if(o)return o.sendRequest(e,t);throw Error("Communicator not initialized")},[o]),m=(0,p.useCallback)(()=>{null==o||o.restartListening()},[o]),g=(0,p.useCallback)((e,t)=>{d.current={...d.current,[e]:t}},[]);return{sendRequest:null===o?void 0:f,restartListening:m,permissions:d.current,updatePermission:g}}({iframeRef:z,allowedOrigin:F,onCapabilityAction:(0,p.useCallback)(async(e,t)=>{var l,a,r,n;if(e.method===w.uZ.ReadyForContent)return B(!0),null==f||f(),Promise.resolve();if(e.method===w.uZ.GetFile)return S&&S.getFile?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse",value:await S.getFile(e.payload.key)}:Promise.reject();if(e.method===w.uZ.SendConversationMessage)return S&&S.sendMessage?(await S.sendMessage({prompt:e.payload.message,attachments:[],files:[],syncSources:[]}),Promise.resolve()):Promise.reject();if(e.method===w.uZ.ClaudeCompletion)return S&&S.claudeComplete?(eu(e=>e+1),{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse",completion:await S.claudeComplete(e.payload.prompt)}):Promise.reject();if(e.method===w.uZ.StorageGet){if(!(null==S||null==(l=S.storage)?void 0:l.get))return Promise.reject();let t=S.storage.get,a=async()=>{let l=await t(e.payload.key,e.payload.shared);return l?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageGetResponse",key:l.key,value:l.value,shared:l.shared}:null};return eo("get",e.payload,a)}else if(e.method===w.uZ.StorageSet){if(!(null==S||null==(a=S.storage)?void 0:a.set))return Promise.reject();let t=S.storage.set,l=async()=>{let l=await t(e.payload.key,e.payload.value,e.payload.shared);return l?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageSetResponse",key:l.key,value:l.value,shared:l.shared}:null},r=async()=>!0===e.payload.shared?"allow"===Q?l():"deny"===Q?Promise.reject():new Promise((e,t)=>{Y({onConfirm:async()=>{try{let t=await l();e(t)}catch(e){t(e)}Y(null)}})}):l();return eo("set",e.payload,r)}else if(e.method===w.uZ.StorageDelete){if(!(null==S||null==(r=S.storage)?void 0:r.delete))return Promise.reject();let t=S.storage.delete,l=async()=>{let l=await t(e.payload.key,e.payload.shared);return l?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageDeleteResponse",key:l.key,deleted:l.deleted,shared:l.shared}:null},a=async()=>!0===e.payload.shared?"allow"===Q?l():"deny"===Q?Promise.reject():new Promise((e,t)=>{Y({onConfirm:async()=>{try{let t=await l();e(t)}catch(e){t(e)}Y(null)}})}):l();return eo("delete",e.payload,a)}else if(e.method===w.uZ.StorageList){if(!(null==S||null==(n=S.storage)?void 0:n.list))return Promise.reject();let t=S.storage.list,l=async()=>{let l=await t(e.payload.prefix,e.payload.shared);return l?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageListResponse",keys:l.keys,prefix:l.prefix,shared:l.shared}:null};return eo("list",e.payload,l)}else if(e.method===w.uZ.BroadcastContentSize);else if(e.method===w.uZ.DOMContentLoaded)return null==M||M(),Promise.resolve();else if(e.method===w.uZ.OpenExternal){if("ask"===E)return K(e.payload.href),Promise.resolve();if("bubble"===E&&P)return P({href:e.payload.href}),Promise.resolve()}else if(e.method===w.uZ.DownloadFile)return X(e.payload),Promise.resolve();else if(e.method===w.uZ.ReportError)return null==N||N(e.payload.error),Promise.resolve();else if(e.method===w.uZ.TrackInteraction)return null==T||T(e.payload),Promise.resolve();else if(e.method===w.uZ.ProxyFetch)return(null==es?void 0:es.uuid)?D?new Promise((l,a)=>{let r={data:e.payload,sendRequest:t,resolve:l,reject:a,artifactUuid:null==L?void 0:L.uuid};ea(e=>{var t;return(null==L?void 0:L.uuid)!==(e.length>0?null==(t=e[e.length-1])?void 0:t.artifactUuid:null)?[r]:[...e,r]})}):(0,C._)(e.payload,t,null==es?void 0:es.uuid,L,U,et):(null==_||_(),Promise.reject());return Promise.reject()},[f,M,S,B,N,eu,E,P,T,_,null==es?void 0:es.uuid,L,U,D,Q,eo]),onPermissionRequested:(0,p.useCallback)(async e=>e===w.uZ.ClaudeCompletion&&ec>=100?"denied":Promise.resolve("accepted"),[ec]),initialPermissions:{}});(0,p.useEffect)(()=>{ec>=100&&(em(w.uZ.ClaudeCompletion,"denied"),(0,y.wd)("Claude completion request limit hit."))},[ec,em]),(0,p.useEffect)(()=>{(async()=>{!D&&el.length>0&&(null==es?void 0:es.uuid)&&(null==L?void 0:L.uuid)&&(await Promise.all(el.map(async e=>{let{data:t,sendRequest:l,resolve:a,reject:r}=e;try{let e=await (0,C._)(t,l,es.uuid,L,U,et);a(e)}catch(e){r(e)}})),ea([]))})()},[D,el,null==es?void 0:es.uuid,L,U]),(0,p.useEffect)(()=>{(async()=>{!D&&er.length>0&&(null==L?void 0:L.uuid)&&(await Promise.all(er.map(async e=>{let{executeOperation:t,resolve:l,reject:a}=e;try{let e=await t();l(e)}catch(e){a(e)}})),en([]))})()},[D,er,L]);let ep=(0,p.useCallback)(()=>{(0,y.wd)("Claude completion modal confirmed"),eu(0),em(w.uZ.ClaudeCompletion,"accepted")},[em]),eg=(0,p.useCallback)(async()=>{let e=await (null==ef?void 0:ef(w.uZ.GetScreenshot,j.qs));if(null==e?void 0:e.screenshot){if(e.screenshot.length>0xa00000)throw Error(H.formatMessage({defaultMessage:"Screenshot too large",id:"ifBuzEbIz2"}));if(!/^data:image\/(png|jpeg|gif);base64,/.test(e.screenshot))throw Error(H.formatMessage({defaultMessage:"Invalid screenshot format",id:"KCmGxpLNuq"}));return e.screenshot}},[H,ef]),eh=(0,p.useCallback)(async()=>{let e=await (null==ef?void 0:ef(w.uZ.CopyHtmlContent,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest"}));return null==e?void 0:e.reportHTMLContent},[ef]),ey=(0,p.useCallback)(async()=>{let e=await (null==ef?void 0:ef(w.uZ.GetDOMSnapshot,j.qs));return(null==e?void 0:e.domSnapshot)||void 0},[ef]);return(0,p.useEffect)(()=>{q&&l&&u&&(null==A||A(),null==ef||ef(w.uZ.SetContent,{content:l,type:u,tailwindStylesEnabled:ed,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}))},[l,ef,u,q,A,ed]),(0,p.useImperativeHandle)(t,()=>({refresh:()=>{null==R||R(),B(!1);let e=z.current;if(e){let t=e.parentNode;t?(t.removeChild(e),e.removeAttribute("src"),e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("data-no-service-worker","true"),e.setAttribute("referrerpolicy","no-referrer"),e.src=G,t.appendChild(e)):e.src=G}},getScreenshot:eg,copyHtmlContent:eh,getDOMSnapshot:ey})),(0,a.jsxs)("div",{className:(0,v.A)("relative",n),children:[(0,a.jsx)("iframe",{ref:z,className:"h-full w-full",style:{zoom:I},sandbox:"allow-scripts allow-same-origin",title:H.formatMessage({defaultMessage:"Claude content",id:"/Ma3teJf9/"}),loading:Z?"lazy":void 0,src:G,allow:"fullscreen; clipboard-write",referrerPolicy:"no-referrer"}),(0,a.jsx)(x.N,{children:!q&&(0,a.jsx)(b.P.div,{className:"bg-bg-100 absolute inset-0 z-10",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"}})}),$?(0,a.jsx)(d.v,{isOpen:!!$,url:$,onClose:()=>K(null),onConfirm:()=>{$&&window.open($,"_blank"),K(null)}}):null,W?(0,a.jsx)(i,{isOpen:!!W,filename:W.filename,onClose:()=>X(null),onConfirm:()=>{if(W){let e=new Blob([W.data],{type:W.mimeType}),t=URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download=W.filename,l.click(),URL.revokeObjectURL(t)}X(null)}}):null,J?(0,a.jsx)(g,{isOpen:!!J,onClose:e=>{e&&V("deny"),Y(null)},onConfirm:async e=>{J&&(e&&V("allow"),await J.onConfirm())}}):null,ee&&O&&L?(0,a.jsx)(O,{isOpen:!!ee,requestedServers:ee.requestedServers,onClose:()=>{ee.onClose(),et(null)},artifactContext:L}):null,ei&&ec>=100&&(0,a.jsx)("div",{className:"fixed inset-0 bg-always-black bg-opacity-50 flex items-center justify-center z-modal",children:(0,a.jsxs)("div",{className:"bg-bg-100 p-4 rounded shadow-lg",children:[(0,a.jsx)("p",{className:"text-fg-100 mb-4",children:(0,a.jsx)(o.A,{defaultMessage:"Many requests made. Acknowledge that you’re still here to continue.",id:"kmh/1AmVcl"})}),(0,a.jsx)(r.$,{onClick:ep,variant:"primary",children:(0,a.jsx)(o.A,{defaultMessage:"I’m still here",id:"NwhjMfjigc"})})]})})]})});M.displayName="RichSandbox"},49953:(e,t,l)=>{l.d(t,{Z:()=>n});var a=l(54568),r=l(7620);let n=(0,r.forwardRef)((e,t)=>{let{className:l,children:n,disabled:s,noDefaultScroll:o}=e,i=(0,r.useRef)(0),d=(0,r.useRef)(!0),c=(0,r.useRef)(null),u=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if(c.current&&d.current&&!(c.current.scrollHeight-c.current.clientHeight<c.current.scrollTop)&&c.current&&"function"==typeof c.current.scrollTo){var t,l,a;null==(a=c.current)||a.scrollTo({top:(null==(t=c.current)?void 0:t.scrollHeight)-(null==(l=c.current)?void 0:l.clientHeight)+5,behavior:e})}},[]),f=(0,r.useCallback)(e=>{if(c.current&&c.current&&"function"==typeof c.current.scrollTo){var t,l,a;c.current.style.overflow="hidden",null==(a=c.current)||a.scrollTo({top:(null==(t=c.current)?void 0:t.scrollHeight)*e-(null==(l=c.current)?void 0:l.clientHeight)/2,behavior:"auto"})}},[]),m=(0,r.useCallback)(()=>{c.current&&(c.current.style.overflow="")},[]);return(0,r.useImperativeHandle)(t,()=>({reset(){i.current=0,d.current=!0,o||u()},scrollToBottomIfPinned:u,scrollToPercentage:f,enableScrolling:m,getScrollContainer:()=>c.current}),[u,f,m,o]),(0,r.useLayoutEffect)(()=>{s||!n||o||u()},[n,s,u,o]),(0,a.jsx)("div",{className:l,onScroll:e=>{if(s)return;let t=e.currentTarget.scrollTop,l=function(e,t){if(!e)return!1;{let l=e.scrollHeight-8;return Math.ceil(t+e.offsetHeight)>=Math.floor(l)}}(c.current,t),a=t>i.current;l&&a?d.current=!0:l||a||(d.current=!1),i.current=t},ref:c,children:n})});n.displayName="AutoScroll"},56054:(e,t,l)=>{l.d(t,{CodeRenderer:()=>A,k:()=>N,MarkdownRenderer:()=>R});var a=l(54568),r=l(11727),n=l(79383),s=l(69604),o=l(57820),i=l(49953),d=l(57291),c=l(49982),u=l(72902),f=l(7620),m=l(29820),p=l(74813),g=l(14691),h=l(23812),y=l(47592),v=l(39109),x=l(61295),b=l(10369),w=l(59666);let C=e=>{let{isStreaming:t,children:l,...r}=e;return t?l:(0,a.jsx)(j,{...r,children:l})},j=e=>{let{children:t,sendMessage:l,contentType:r="text",isOpen:n}=e,s=(0,b.A)(),o=(0,p.st)(),i=void 0!==l,[d,c]=(0,f.useState)([]),[m,C]=(0,f.useState)({top:0,left:0,width:0}),[j,k]=(0,f.useState)(!1),[M,S]=(0,f.useState)(!1),[N,A]=(0,f.useState)(""),[R,E]=(0,f.useState)(""),[P,T]=(0,f.useState)(!1),_=(0,f.useRef)(null),Z=(0,f.useRef)(null),I=(0,f.useCallback)((e,t)=>{var l;let a=function(e,t){let l=[];for(let a=0;a<e.rangeCount;a++){let r=e.getRangeAt(a);if(r.startContainer===r.endContainer&&r.startContainer.nodeType===Node.TEXT_NODE){let e=r.startContainer,t=document.createRange();for(let a=r.startOffset;a<r.endOffset;a++){t.setStart(e,a),t.setEnd(e,a+1);let r=Array.from(t.getClientRects());l.push(...r)}t.detach()}else{let e=function(e){let t,l=[],a=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=a.nextNode();)l.push(t);return l}(r);e.forEach((a,n)=>{let s=document.createRange(),o="length"in a?a.length:0,i=0===n,d=n===e.length-1,c=i?r.startOffset:0,u=d&&!t?r.endOffset:o;s.setStart(a,c),s.setEnd(a,u);let f=Array.from(s.getClientRects());l.push(...f),s.detach()})}}return l}(e,t),r=null==(l=_.current)?void 0:l.getBoundingClientRect();return Array.from(a).map(e=>({top:e.top-((null==r?void 0:r.top)||0)-2.5,left:e.left-((null==r?void 0:r.left)||0),width:e.width,height:e.height+5.5}))},[]),L=(0,f.useCallback)(e=>{var t;let l=e.getRangeAt(0);return null==(t=_.current)?void 0:t.contains(l.commonAncestorContainer)},[]);(0,f.useEffect)(()=>{function e(e){var t,l,a,r;let n,s,{selection:o,isSelectAll:i}=e,d=I(o,i);if(d.every((e,t,l)=>0===t||5>Math.abs(e.top-l[0].top))){let e=Math.max(...d.map(e=>e.left+e.width));n=d[0].top-9,s=e+10}else{let e=Math.max(...d.map(e=>e.top+e.height));s=Math.min(...d.map(e=>e.left)),n=Math.min((null!=(a=null==(l=_.current)?void 0:l.scrollHeight)?a:0)-50,e)}let u=((null!=(r=null==(t=_.current)?void 0:t.scrollWidth)?r:1e3)-s)/3*2;c(d),k(!0),S(!1),C({top:n,left:s,width:u}),E(o.toString())}let t=()=>{T(!0)},l=t=>{"Escape"===t.key&&(S(!1),k(!1),A(""),c([]));let l=((0,y.cX)()?t.metaKey:t.ctrlKey)&&"a"===t.key,a=_.current;if(a&&n&&l){let l=document.activeElement&&(document.activeElement===a||(null==a?void 0:a.contains(document.activeElement))),r=window.getSelection();if(l&&r){t.preventDefault();let l=document.createRange();l.selectNodeContents(a),r.removeAllRanges(),r.addRange(l),e({selection:r,isSelectAll:!0})}}},a=t=>{if(Z.current&&Z.current.contains(t.target))return;let l=window.getSelection();l&&!l.isCollapsed&&L(l)?e({selection:l}):(c([]),k(!1),S(!1),E(""),A("")),T(!1)};return i&&(document.addEventListener("mousedown",t),document.addEventListener("mouseup",a),document.addEventListener("keydown",l)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mouseup",a),document.removeEventListener("keydown",l)}},[I,L,i,n]);let O=e=>{i&&(l(e),A(""),S(!1),k(!1),c([]))},D=()=>"text"===r?R.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===r?"```\n".concat(R,"\n```"):void 0,H=()=>{O({prompt:"".concat(D(),"\n\n").concat(N),attachments:[],files:[],syncSources:[]})};return(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)("div",{ref:_,tabIndex:0,className:(0,u.$)("w-full h-full relative",i?P?"[&_:not(input)::selection]:bg-secondary-000/10":"[&_*::selection]:bg-secondary-000/10":""),children:t}),d.map((e,t)=>(0,a.jsx)("div",{className:"absolute pointer-events-none bg-accent-secondary-000/10",style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,a.jsx)(v.N,{children:j&&!M&&(0,a.jsx)(x.P.div,{className:"absolute z-10",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:m.top+5,left:m.left},children:(0,a.jsx)("div",{className:"border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition bg-bg-000 text-text-400 border-border-300",children:(0,a.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,a.jsx)(h.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"improve"}),S(!0)},prepend:(0,a.jsx)(g.XG,{}),children:(0,a.jsx)(w.A,{defaultMessage:"Improve",id:"BATKcMm/a2"})}),(0,a.jsx)(h.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"explain"}),O({prompt:"".concat(s.formatMessage({defaultMessage:"Can you explain this section to me in more detail?",id:"LMDbiRxyDQ"}),"\n\n").concat(D()),attachments:[],files:[],syncSources:[]})},prepend:(0,a.jsx)(g.g5,{}),children:(0,a.jsx)(w.A,{defaultMessage:"Explain",id:"HGdgPPM2Ry"})})]})})})}),(0,a.jsx)(v.N,{children:M&&(0,a.jsxs)(x.P.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:"z-10 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl",style:{top:m.top+5,left:m.left,width:m.width},ref:Z,onSubmit:e=>{e.preventDefault(),H()},children:[(0,a.jsx)("input",{type:"text",value:N,onChange:e=>A(e.target.value),placeholder:s.formatMessage({defaultMessage:"Describe what you would like to update...",id:"smio7jldoW"}),className:"py-0.5 px-0 border-0 bg-transparent text-sm grow !shadow-none text-text-200 placeholder-text-500 hide-focus-ring",autoFocus:!0}),(0,a.jsx)(v.N,{children:N.trim().length>0?(0,a.jsx)(x.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,a.jsx)(h.$,{onClick:()=>H(),"aria-label":s.formatMessage({defaultMessage:"Send Message",id:"yJAKR0Ngpn"}),type:"submit",children:(0,a.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,a.jsx)(w.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})}):null})]})})]})};var k=l(4262),M=l(46879);let S="opacity-30 blur-[2px]",N=e=>{let{isOpen:t,content:l,language:r,citations:n,type:s,showRaw:o,richSandboxRef:c,isCurrentStreaming:m,isChatStreaming:p,onSandboxConfirmation:g,onDOMContentLoaded:h,sendMessage:y,richSandboxCapabilities:v,isLatestVersion:x,artifactId:b,artifactContext:w,artifactVersion:C,onArtifactRuntimeError:j,artifact:N,hasMenuOpen:P,zoom:T,onTrackInteraction:_,showLoginModal:Z,ArtifactMcpModal:I}=e,L=void 0!==s&&void 0!==l&&s!==d.vU.Code&&s!==d.vU.Markdown,O=(0,f.useRef)(null),D=L&&!o,[H,F]=(0,f.useState)(null),U=(0,f.useCallback)(e=>{void 0!==b&&void 0!==C&&(void 0!==j&&j(e),F({error:e,artifactId:b,artifactVersion:C}))},[b,C,j]);(0,f.useEffect)(()=>{var e;if(!N||!m)return;let t=N.versions[N.versions.length-1],l=N.versions[N.versions.length-2];if(!l||!t||"update"!==t.command)return;let a=E(l.resultState,t.resultState);-1!==a&&(null==(e=O.current)||e.scrollToPercentage(a/100))},[l,N,m]),(0,f.useEffect)(()=>{!m&&O.current&&O.current.enableScrolling()},[m]);let q=(0,f.useCallback)(()=>{F(e=>e&&(e.artifactId!==b||e.artifactVersion!==C)?null:e)},[b,C]),B=(0,f.useCallback)(()=>{F(null)},[]);return(0,a.jsxs)(a.Fragment,{children:[L&&(0,a.jsxs)("div",{className:(0,u.A)("ease-out duration-200",D?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",P&&S),children:[(0,a.jsx)(M.A,{ref:c,className:D?"h-full w-full border-none bg-bg-100":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:D?l:void 0,type:D?s:void 0,onSandboxConfirmation:g,onDOMContentLoaded:h,capabilities:v,onReportError:U,onSetContent:q,onRefresh:B,externalLinkBehavior:"ask",zoom:T,onTrackInteraction:_,showLoginModal:Z,artifactContext:w,ArtifactMcpModal:I,isChatStreaming:p}),D&&H&&(0,a.jsx)(k.i,{error:H,handleClose:()=>F(null),sendMessage:x?y:void 0,isStreaming:p})]}),void 0===l||void 0===s?null:s===d.vU.Code||o?(0,a.jsx)(i.Z,{noDefaultScroll:!m,ref:O,className:(0,u.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",P&&S),children:(0,a.jsx)(A,{content:l,isStreaming:p,language:r,sendMessage:y,isOpen:t},"code-".concat(b,"-").concat(C,"-").concat(m))}):s===d.vU.Markdown?(0,a.jsx)(i.Z,{noDefaultScroll:!m,ref:O,className:(0,u.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",P&&S),children:(0,a.jsx)(R,{content:l,citations:n,isStreaming:p,sendMessage:y,isOpen:t},"markdown-".concat(b,"-").concat(C,"-").concat(m))}):null]})},A=e=>{let{content:t,isStreaming:l,language:n,sendMessage:s,isOpen:i}=e,{codeStyle:d}=(0,o.V)();return(0,a.jsx)(C,{isStreaming:l,sendMessage:s,contentType:"code",isOpen:i,children:(0,a.jsx)(m.A,{className:"code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed",language:n,PreTag:"div",style:d,renderer:r.G,children:t})})},R=e=>{let{content:t,citations:l,isStreaming:r,sendMessage:o,isOpen:i}=e,d=(0,c.n)(),u=(0,f.useMemo)(()=>d&&l&&l.length>0?(0,s.k0)(l,t):t,[t,l,d]);return(0,a.jsx)(C,{isStreaming:r,sendMessage:o,isOpen:i,children:(0,a.jsxs)("div",{tabIndex:0,id:"markdown-artifact",className:"font-claude-response mx-auto w-full max-w-3xl leading-[1.65rem] px-6 pt-4 md:pt-6 md:px-11",children:[(0,a.jsx)(n.fP,{text:u,blockCitations:l,className:"!gap-3.5",isStreaming:r}),(0,a.jsx)("div",{className:"h-8"})]})})},E=(e,t)=>{if(!e||!t)return -1;let l=e.replace(/\\n/g,"\n"),a=t.replace(/\\n/g,"\n"),r=[...l].findIndex((e,t)=>e!==a[t]);if(-1===r&&l.length===a.length)return -1;let n=(l.slice(0,-1===r?l.length:r).match(/\n/g)||[]).length,s=(l.match(/\n/g)||[]).length;return s?Math.round(n/s*100):-1}}}]);
try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="501e4bbe-8638-4f14-a03f-741ebf1e8483",e._sentryDebugIdIdentifier="sentry-dbid-501e4bbe-8638-4f14-a03f-741ebf1e8483")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8324],{787:(e,t,s)=>{s.d(t,{l:()=>a});var a=function(e){return e.Standard="Standard",e.TimelineGroup="TimelineGroup",e}({})},4887:(e,t,s)=>{async function a(e){let t=n(e),s=await fetch(t);if(!s.ok)throw Error("Failed to fetch file: ".concat(s.status," ").concat(s.statusText));return s}function n(e){let{organizationUuid:t,filePath:s}=e;return e.isShared?"/api/organizations/".concat(t,"/snapshots/").concat(e.snapshotUuid,"/wiggle/download-file?path=").concat(encodeURIComponent(s)):"/api/organizations/".concat(t,"/conversations/").concat(e.conversationUuid,"/wiggle/download-file?path=").concat(encodeURIComponent(s))}s.d(t,{T:()=>n,e:()=>a})},4899:(e,t,s)=>{s.d(t,{d:()=>b,L:()=>j});var a=s(54568),n=s(64328),i=s(9679),l=s(7620),r=s(10369),o=s(59666),d=s(45271),c=s(35580),u=s(40304),m=s(99411),p=s(23812),f=s(52157),h=s(72902);function g(e){let{symbol:t,variant:s}=e;return(0,a.jsx)("div",{className:(0,h.$)("inline-flex items-center justify-center rounded px-1 py-0.5 text-xs ml-1","secondary"===s&&"bg-bg-300 text-text-400","primary"===s&&"bg-bg-100 bg-opacity-20 text-bg-100"),children:t})}function x(e){let{disabled:t,submitToolApproval:s,showAlwaysAllowed:n,setIsExpanded:i}=e,l=e=>{s(e),i(!1)};return(0,f.W)("keydown",e=>{if("Escape"===e.key){e.preventDefault(),l("deny");return}if("Enter"===e.key){let t=e.metaKey||e.ctrlKey;t&&n?(e.preventDefault(),l("always")):t||(e.preventDefault(),l("once"))}}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-0",children:[(0,a.jsx)("div",{className:"flex flex-col justify-center items-start p-3 bg-bg-200 border-0.5 border-border-400/15 rounded-md min-h-[41px]",children:(0,a.jsx)("p",{className:"text-xs",children:(0,a.jsx)(o.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})}),(0,a.jsxs)("div",{className:"self-end flex gap-2",children:[(0,a.jsx)(p.$,{variant:"secondary",onClick:()=>l("deny"),append:(0,a.jsx)(g,{symbol:"esc",variant:"secondary"}),children:(0,a.jsx)(o.A,{defaultMessage:"Deny",id:"htvX+Z11l+"})}),n&&(0,a.jsx)(p.$,{variant:"secondary",disabled:t,onClick:()=>l("always"),append:(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(g,{symbol:"⌘",variant:"secondary"}),(0,a.jsx)(g,{symbol:"⏎",variant:"secondary"})]}),children:(0,a.jsx)(o.A,{defaultMessage:"Always allow",id:"lr3QX/nctD"})}),(0,a.jsx)(p.$,{variant:"primary",disabled:t,onClick:()=>l("once"),append:(0,a.jsx)(g,{symbol:"⏎",variant:"primary"}),children:(0,a.jsx)(o.A,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]})]})}var v=s(72253);let j=e=>{let{input:t,toolResult:s}=e,i=(0,r.A)(),{activeOrganization:l}=(0,n.YL)(),o=null==l?void 0:l.uuid,d="";if(void 0!==t){try{d=JSON.stringify(t,null,2)}catch(e){d=String(t)}d=(d=d.replace(/\\n/g,"\n").replace(/\\t/g,"	")).replace(RegExp('(?<!\\\\)"',"g"),"`")}return(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:[(0,a.jsx)(u.z,{title:i.formatMessage({defaultMessage:"Request",id:"p1P+hQq6tY"}),language:"javascript",code:d}),null==s?void 0:s.content.map((e,t)=>"text"===e.type?(0,a.jsx)(u.z,{title:i.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),language:"json",code:e.text},t):"image"===e.type?(0,a.jsx)("img",{src:"/api/".concat(o,"/files/").concat(e.file_uuid,"/preview"),alt:i.formatMessage({defaultMessage:"Tool result",id:"OJmR+3dTK6"}),className:"max-w-md max-h-md h-auto rounded-md"},t):void 0)]})},b=e=>{var t,s;let{toolName:n,integrationName:r,integrationIcon:u,approvalData:p,...f}=e,{input:h,toolResult:g,groupItemKey:b,autoscrollRef:y}=f,w=(0,i.q)(),_=(0,l.useRef)(!1),C=!!(null==p?void 0:p.approvalRequired),{isExpanded:k,setIsExpanded:M,snappyTransition:N}=(0,v.a)(!1,b,C),S=(0,c.pK)(n),A=(null==S||null==(t=S.tool)?void 0:t.displayName)||n.split(":").pop()||n,E=C?r?(0,a.jsx)(o.A,{defaultMessage:"Claude wants to use {toolName} from {integrationName}",id:"wPBSjwhfE4",values:{toolName:A,integrationName:r}}):(0,a.jsx)(o.A,{defaultMessage:"Claude wants to use {toolName}",id:"ZNLjFNb5bD",values:{toolName:A}}):A,z=null==g||null==(s=g.content)?void 0:s[0];return(0,a.jsx)(m.sH,{isExpanded:w&&k,setIsExpanded:M,isExpandingDisabled:C,text:E,isError:null==g?void 0:g.is_error,errorMessage:(null==z?void 0:z.type)==="text"?z.text:void 0,icon:(0,a.jsx)(d.z,{size:16,type:S?S.server.iconType:"favicon",src:S?S.server.iconSrc:u,name:r||A}),...f,children:(0,a.jsx)(m.NG,{isExpanded:w&&k,snappyTransition:N,onAnimationComplete:()=>{if(C&&!_.current){var e;null==y||null==(e=y.current)||e.scrollToBottomIfPinned("smooth"),_.current=!0}},isScrollable:!0,footer:C?(0,a.jsx)(x,{...p,setIsExpanded:M}):null,children:(0,a.jsx)(j,{input:h,toolResult:g})})})}},7881:(e,t,s)=>{s.d(t,{$:()=>r,Q:()=>l});var a=s(54568),n=s(7620);let i=n.createContext({renderToolUseCell:void 0}),l=()=>n.useContext(i),r=e=>{let{renderToolUseCell:t,children:s}=e,l=(0,n.useMemo)(()=>({renderToolUseCell:t}),[t]);return(0,a.jsx)(i.Provider,{value:l,children:s})}},8564:(e,t,s)=>{s.d(t,{CV:()=>ea,ke:()=>er});var a=s(2348),n=s(54568),i=s(94295),l=s(6542),r=s(56054),o=s(37380),d=s(74813),c=s(64328),u=s(45054),m=s(13750),p=s(59922),f=s(21266),h=s(14691),g=s(23812),x=s(87483),v=s(1720),j=s(3075),b=s(67453),y=s(64371),w=s(57291),_=s(37541),C=s(28044),k=s(92291),M=s(72902),N=s(39109),S=s(61295),A=s(43906),E=s.n(A),z=s(19664),T=s.n(z),I=s(7620),U=s(59666),L=s(10369),R=s(85028),O=s(34385),F=s(45538),D=s(58841),P=s(87017),B=s(84617),G=s(70352),W=s(81535),J=s(34037);function V(){let e=(0,a._)(["\n  border\n  border-border-400\n  bg-bg-100\n  w-96\n  rounded-xl\n  font-medium\n  text-text-300\n  text-sm\n"]);return V=function(){return e},e}function H(e){let t,{onClose:s,onSubmitRating:a,onSubmitNotes:i}=e,l=(0,L.A)(),[r,o]=(0,I.useState)(!1),[d,c]=(0,I.useState)(""),u=e=>{a(e),o(!0)},p=()=>{s()};return t=r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,n.jsx)("div",{className:"ml-1",children:(0,n.jsx)(U.A,{defaultMessage:"What were you trying to accomplish when this artifact was created?",id:"CrrumB/FnI"})}),(0,n.jsx)("div",{className:"pt-1",children:(0,n.jsx)("button",{onClick:p,children:(0,n.jsx)(G.X,{size:20})})})]}),(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault(),i(d),p()},children:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("div",{className:"grow",children:(0,n.jsx)(m.ks,{className:"w-full",placeholder:l.formatMessage({defaultMessage:"e.g. make a graph",id:"g1RrFC72N+"}),value:d,onChange:e=>c(e.target.value)})}),(0,n.jsx)("div",{children:(0,n.jsx)(g.$,{variant:"primary",type:"submit",children:(0,n.jsx)(U.A,{defaultMessage:"Send",id:"9WRlF4R2gm"})})})]})})]}):(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(U.A,{defaultMessage:"Is this artifact useful?",id:"RxVIwIW9vn"})}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(g.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!0),"aria-label":l.formatMessage({defaultMessage:"Thumbs up",id:"0HnZ1ci6be"}),children:(0,n.jsx)(W.t,{size:20})}),(0,n.jsx)(g.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!1),"aria-label":l.formatMessage({defaultMessage:"Thumbs down",id:"go4L4rFJNq"}),children:(0,n.jsx)(J.S,{size:20})}),(0,n.jsx)(g.$,{variant:"ghost",size:"icon_sm",onClick:p,"aria-label":l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:(0,n.jsx)(G.X,{size:20})})]})]}),(0,n.jsxs)(q,{children:[(0,n.jsx)("div",{className:"p-3",children:t}),(0,n.jsx)("div",{className:"p-3 border-t border-border-400 w-full font-normal text-xs text-text-500",children:(0,n.jsx)(B.Y,{href:"https://support.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback",target:"_blank",children:(0,n.jsx)(U.A,{defaultMessage:"Learn more about how Anthropic uses feedback",id:"NBSES31K7c"})})})]})}let q=p.J.div(V());var Y=s(91558),K=s(94882),X=s(24423);let $=e=>{let{currentArtifact:t,hasMenuOpen:s,setHasMenuOpen:a}=e,i=(0,I.useCallback)(()=>{a(!1)},[a]),l=(0,X.dd)(),{dispatchChatResource:r}=(0,D.i)(),o=Object.values(l).reverse().sort((e,t)=>{let s=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(s.created_at).getTime()}),d=(0,I.useRef)(t),c=(0,I.useRef)(!1),u=(0,I.useCallback)(e=>{queueMicrotask(()=>{r({type:"SELECT_ARTIFACT",id:e.id,versionUuid:e.versions[e.versions.length-1].uuid})})},[r]);(0,I.useEffect)(()=>{let e=d.current;return()=>{e&&!c.current&&(null==t?void 0:t.id)!==e.id&&u(e),c.current=!1}},[]);let m=(0,Y.w)(),p=(0,L.A)();return o.length<2?null:(0,n.jsxs)(K.bL,{open:s,onOpenChange:e=>a(e),children:[(0,n.jsx)(K.l9,{asChild:!0,children:(0,n.jsx)(g.$,{variant:"ghost",size:"icon_sm",className:"-mx-1",children:(0,n.jsx)(b.Tooltip,{side:"right",className:"ml-2",tooltipContent:s?"":p.formatMessage({defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),delayDuration:800,children:(0,n.jsx)(h.S0,{size:20})})})}),(0,n.jsx)(K.UC,{align:"start",asChild:!0,children:(0,n.jsx)("ul",{className:"\n            relative\n            z-dropdown\n            overflow-y-auto\n            max-h-[min(var(--radix-dropdown-menu-content-available-height),var(--dropdown-max-height))]\n            flex flex-col gap-1\n            py-2 pr-3\n          ",onMouseLeave:()=>d.current&&u(d.current),children:o.map((e,t)=>{var s;let a=e.type?m[e.type]:null,l=(null==(s=d.current)?void 0:s.id)===e.id,r=p.formatMessage({defaultMessage:"versions",id:"bhuRmwJBaN"}),f=e.versions.length>1?"".concat(e.versions.length):"",h=e.versions.length>1&&a?" \xb7 ":"";return(0,n.jsx)(S.P.li,{initial:{y:-12,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0,transition:{ease:"easeOut",duration:.1,delay:0}},transition:{delay:.035*t,type:"spring",stiffness:285,damping:25,mass:1},role:"none",children:(0,n.jsxs)(K.q7,{className:(0,M.A)("bg-bg-000 border-0.5 cursor-pointer can-focus","flex flex-col py-2 pl-3 pr-4 w-full max-w-72 mb-px rounded-lg overflow-hidden","text-sm text-left transition duration-300 drop-shadow-[0_2px_8px_hsl(var(--always-black)/5%)]",l?"border-accent-secondary-100 shadow-[0_0_0_1px_hsl(var(--accent-secondary-100))]":"text-text-300 hover:text-text-100 border-border-200 hover:border-accent-secondary-100 focus-within:border-accent-secondary-100 focus-within:text-text-100"),onClick:()=>(e=>{c.current=!0,i();let t=o[e];d.current=t,u(t)})(t),onMouseEnter:()=>{u(e)},"aria-label":"".concat(e.title).concat(a?", ".concat(a):"").concat(f?", ".concat(f," ").concat(r):""),children:[(0,n.jsx)("div",{className:"line-clamp-2",children:e.title}),(0,n.jsxs)("span",{className:"text-text-300",children:[e.versions.length>1?(0,n.jsxs)(n.Fragment,{children:[f," ",r]}):null,h?(0,n.jsx)(n.Fragment,{children:h}):null,a]})]},e.id)},e.id)})})})]})};var Z=s(19757),Q=s(68616),ee=s(78671);function et(){let e=(0,a._)(["\n  flex\n  flex-none\n  items-center\n  justify-between\n  text-sm\n  text-text-500\n  py-2\n  px-2\n  border-t\n  border-border-400\n"]);return et=function(){return e},e}function es(){let e=(0,a._)(["\n  border-border-400\n  sticky\n  flex\n  items-center\n  gap-1\n  border-b\n  px-2\n  py-2\n"]);return es=function(){return e},e}let ea=e=>{var t,s,a,u,m,p,f,h,g,x;let{onClose:v,artifact:j,isStreaming:b,selectedArtifactMessageUuid:y,selectedArtifactVersionUuid:_,setSelectedArtifactVersionUuid:C,projectUuid:A,selectDoc:E,disablePublishing:z,sendMessage:T,richSandboxCapabilities:U,isOpen:L,isTemporary:O=!1}=e,{account:P}=(0,c.YL)(),B=(0,d.st)(),[G,W]=(0,I.useState)("normal"),J=(0,I.useRef)(null),[V,q]=(0,I.useState)(!1),Y=(0,c.mV)(),[K,X]=(0,I.useState)(!0),{data:$}=(0,F.fo)(A),{data:ee}=(0,R.mt)({entityId:_,artifactEntityType:"artifact_version"}),et=(0,I.useMemo)(()=>(null==ee?void 0:ee.mcp_servers)||[],[ee]),es=!z&&!Y,[ea,{open:ei,close:er}]=(0,k.j)(!1),ed=(0,I.useCallback)(()=>{X(!1)},[]),{data:ec}=(0,l.rC)({includeDeletedArtifacts:!0}),eu=null==j?void 0:j.versions[j.versions.length-1],em=b&&!(null==eu?void 0:eu.isClosed),ep=(0,I.useMemo)(()=>{if(!j)return 0;if(!em&&_&&!(null==y?void 0:y.startsWith(o.B6))){let e=j.versions.findIndex(e=>e.uuid===_);if(-1!==e)return e}return em||!y||y.startsWith(o.B6)?j.versions.length-1:j.versions.findIndex(e=>e.message===y)},[y,_,em,j]),ef=null==j||null==(t=j.versions[ep])?void 0:t.uuid;(0,I.useEffect)(()=>{ef&&ef!==_&&C(ef),W("normal")},[null==j?void 0:j.id,ef,C,_]);let eh=Y&&!O,[eg,{open:ex,close:ev}]=(0,k.j)(!1),ej=j&&(null==ec||null==(s=ec.find(e=>{let{artifact_identifier:t,message_uuid:s}=e;return t===j.id&&s===j.versions[ep].message}))?void 0:s.published_artifact_uuid),eb=null!=(f=null==ec?void 0:ec.some(e=>{let{published_artifact_uuid:t,deleted:s}=e;return t===ej&&s}))&&f,ey=null==j||null==(a=j.versions[ep])?void 0:a.message,[ew,e_]=(0,I.useState)(!1);(0,I.useEffect)(()=>e_(ew||b),[ew,b]);let[eC,ek]=(0,I.useState)(!1);(0,I.useEffect)(()=>ek(!1),[y,ey]);let[eM,eN]=(0,I.useState)(!1),{data:eS}=(0,l.SN)(),{mutate:eA}=(0,i.Jy)(),{track:eE}=(0,d.st)(),ez=null!=(h=(0,D.i)().chatResourceState.conversationUuid)?h:"",{data:eT}=(0,R.Ns)({entityId:_,artifactEntityType:"artifact_version",conversationUuid:ez},{enabled:!b}),[eI,{open:eU,close:eL}]=(0,k.j)(!1),{mutateAsync:eR}=(0,l.cH)(ez),eO=(0,I.useCallback)(async()=>{if(!_)try{var e;let{artifactVersionUUID:t}=await eR({version_index:ep,artifact_identifier:null!=(e=null==j?void 0:j.id)?e:""});C(t)}catch(e){console.error("Error getting artifact UUID: ".concat(e));return}eE({event_key:"artifact.share_button_clicked",message_uuid:ey,artifact_type:null==j?void 0:j.type,artifact_language:null==j?void 0:j.language}),ex()},[_,ex,eR,ep,null==j?void 0:j.id,C,eE,ey,null==j?void 0:j.type,null==j?void 0:j.language]),eF=(0,I.useCallback)(()=>{eE({event_key:"artifact.publish_button_clicked",message_uuid:ey,artifact_type:null==j?void 0:j.type,artifact_language:null==j?void 0:j.language}),ei()},[ei,eE,ey,null==j?void 0:j.type,null==j?void 0:j.language]),eD=(null==j?void 0:j.type)===w.vU.Text,eP=(null==j?void 0:j.type)===w.vU.Markdown||(null==j?void 0:j.type)===w.vU.Code,eB=(null==j?void 0:j.type)===w.vU.Html||(null==j?void 0:j.type)===w.vU.React,eG=(null==j?void 0:j.type)!==w.vU.Text&&!(em&&((null==j?void 0:j.type)===w.vU.Svg||(null==j?void 0:j.type)===w.vU.Mermaid||(null==j?void 0:j.type)===w.vU.React||(null==j?void 0:j.type)===w.vU.Html)),eW=!eG||"raw"===G,eJ=eC||ew&&!b&&!eM&&!(null==P?void 0:P.settings.dismissed_artifact_feedback_form)&&eS,eV=null!=(g=null==j?void 0:j.versions.length)?g:0,[eH,eq]=(0,I.useState)(!1),eY=A&&j?{show:!em&&!(null==$?void 0:$.is_starter_project),artifact:j,projectUuid:A,selectedVersion:ep,selectDoc:E}:void 0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,M.A)(j?"bg-bg-000 flex h-full flex-col relative":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none"),onClick:()=>eH&&eq(!1),children:[(0,n.jsx)(en,{versionCount:eV,selectedVersion:ep,artifact:j,canRenderNormal:eG,canOnlyRenderRaw:eD,canOnlyRenderNormal:eP,viewing:G,setViewing:W,showRaw:eW,canRefresh:eB,isSandboxLoading:K,handleRefresh:()=>{X(!0),J.current&&J.current.refresh()},canShare:eh,handleOpenShareModal:eO,isStreaming:b,onClose:v,hasMenuOpen:eH,setHasMenuOpen:eq,canPublish:es,wasUnpublished:eb,publishedArtifactUuid:ej,openPublishModal:eF,projectParams:eY,richSandboxRef:J,hasArtifactToolConfig:!!(null==ee||null==(u=ee.mcp_servers)?void 0:u.length),setShowArtifactMcpModal:q,storageInfo:eT,openResetStorageModal:eU,handleVersionSelect:e=>{let t=null==j?void 0:j.versions[e].uuid;t&&C(t)}}),(0,n.jsx)(r.k,{isOpen:L,content:null!=(x=null==j||null==(m=j.versions[ep])?void 0:m.resultState)?x:"",type:null==j?void 0:j.type,citations:null==j||null==(p=j.versions[ep])?void 0:p.citations,language:void 0===j?void 0:j.language||w.K5[j.type].syntaxName,showRaw:eW,richSandboxRef:J,isCurrentStreaming:em,isChatStreaming:b,onSandboxConfirmation:ed,sendMessage:T,richSandboxCapabilities:U,isLatestVersion:!!j&&ep===j.versions.length-1,artifactId:null==j?void 0:j.id,artifactContext:_?{uuid:_,type:"artifact_version",id:null==j?void 0:j.id}:void 0,artifactVersion:ep,onArtifactRuntimeError:e=>{B.track({event_key:"claudeai.artifacts.execution.error",artifact_version_uuid:null==_?void 0:_.toString(),error_type:e.type,source:null==j?void 0:j.versions[ep].source})},artifact:j,hasMenuOpen:eH,ArtifactMcpModal:Z.I}),(0,n.jsx)(N.N,{children:eJ&&(0,n.jsx)(S.P.div,{initial:{opacity:0,y:20,x:"-50%"},animate:{opacity:1,y:0,x:"-50%"},transition:{duration:.3,delay:.8,ease:"easeOut"},exit:{opacity:0,y:20,x:"-50%",transition:{duration:.3,ease:"easeOut"}},className:"absolute bottom-20 left-1/2",children:(0,n.jsx)("div",{children:(0,n.jsx)(H,{onSubmitNotes:e=>{eE({event_key:"artifact.feedback.note",note:e,message_uuid:ey,artifact_type:null==j?void 0:j.type,artifact_language:null==j?void 0:j.language}),ek(!1)},onSubmitRating:e=>{eE({event_key:"artifact.feedback.sentiment",type:e?"thumbs_up":"thumbs_down",message_uuid:ey,artifact_type:null==j?void 0:j.type,artifact_language:null==j?void 0:j.language}),eA({...null==P?void 0:P.settings,dismissed_artifact_feedback_form:!0}),ek(!0)},onClose:()=>{eN(!0),eA({...null==P?void 0:P.settings,dismissed_artifact_feedback_form:!0}),ek(!1)}})})})})]}),(null==j?void 0:j.versions[ep])&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Q.Dr,{messageUuid:j.versions[ep].message,isOpen:ea&&!eb,onClose:er,artifact:j,selectedVersion:ep,publishedArtifactUuid:ej,richSandboxRef:J}),eh&&_&&(0,n.jsx)(el,{isOpen:eg,onClose:ev,artifactVersionUuid:_,artifact:j,messageUuid:j.versions[ep].message,isProjectArtifact:!!(null==$?void 0:$.is_private)})]}),V&&_&&(0,n.jsx)(Z.I,{isOpen:V,requestedServers:et,onClose:()=>q(!1),artifactContext:{uuid:_,type:"artifact_version",id:null==j?void 0:j.id}}),_&&(0,n.jsx)(eo,{isOpen:eI,onClose:eL,artifactVersionUuid:_,conversationUuid:ez})]})};function en(e){var t;let{versionCount:s,selectedVersion:a,artifact:i,canRenderNormal:l,canOnlyRenderRaw:r,canOnlyRenderNormal:o,viewing:d,setViewing:c,showRaw:p,canRefresh:j,isSandboxLoading:k,handleRefresh:N,canShare:S,handleOpenShareModal:A,isStreaming:z,canPublish:T,wasUnpublished:R,publishedArtifactUuid:F,projectParams:D,onClose:B,openPublishModal:G,handleVersionSelect:W,hasMenuOpen:J,setHasMenuOpen:V,richSandboxRef:H,hasArtifactToolConfig:q,setShowArtifactMcpModal:Y,storageInfo:K,openResetStorageModal:X}=e,Z=(0,L.A)(),Q=(0,C.V)(_.E_),{copyToClipboard:et,didCopy:es}=(0,y.C)(),{copyToProject:ea,isCopiedToProject:en}=function(e){let{projectUuid:t,artifact:s,selectedVersion:a}=e,[i,l]=(0,I.useState)(!1),{mutateAsync:r,data:o}=(0,O.fh)(null!=t?t:""),{addError:d}=(0,u.Y)();return(0,I.useEffect)(()=>{if(null==o?void 0:o.uuid){l(!0);let e=setTimeout(()=>{l(!1)},12e3);return()=>clearTimeout(e)}},[o]),{copyToProject:async()=>{if(s)try{var e;await r({file_name:"".concat(s.title,".").concat(w.K5[s.type].extension()),content:null!=(e=s.versions[a].resultState)?e:""})}catch(e){d((0,n.jsx)(U.A,{defaultMessage:"Error adding artifact to project: {error}",id:"sSg3OiDDja",values:{error:e}}),{error:e})}},isCopiedToProject:i}}({artifact:i,projectUuid:null!=(t=null==D?void 0:D.projectUuid)?t:"",selectedVersion:a});async function el(){var e,t;if(!i)return;let s=i.type===w.vU.Markdown,n=i.type===w.vU.React,l=null!=(e=i.versions[a].resultState)?e:"";if(n&&H.current){let e=await (null==(t=H.current)?void 0:t.copyHtmlContent());e?await et({text:e,html:e}):await et(l)}else if(s)try{let e=(0,P.u)(l);await et({text:l,html:e})}catch(e){await et(l)}else await et(l)}let{ref:er,width:eo}=function(){let e=(0,I.useRef)(null),[t,s]=(0,I.useState)(()=>{var t,s;return null!=(s=null==(t=e.current)?void 0:t.offsetWidth)?s:null});return(0,I.useEffect)(()=>{let t=E()(()=>{e.current&&s(e.current.offsetWidth)},20,{leading:!0,trailing:!0}),a=new ResizeObserver(t);if(e.current){let s=e.current;return t(),a.observe(s),()=>a.disconnect()}},[]),{ref:e,width:t}}(),ed=eo&&eo<480,ec=!p&&j,{addError:eu}=(0,u.Y)(),em=(null==i?void 0:i.type)===w.vU.Markdown&&"raw"!==d?(0,n.jsx)(x.tJ,{onSelect:async()=>{try{await (0,ee.M9)(i)}catch(e){eu((0,n.jsx)(U.A,{defaultMessage:"Error downloading PDF",id:"fes7nfwp3b"}),{error:e})}},children:(0,n.jsx)(U.A,{defaultMessage:"Download as PDF",id:"camH0DLf91"})},"saveAsPdf"):null,ep=i?(0,n.jsx)(x.tJ,{asChild:!0,"data-testid":"export-download",children:(0,n.jsx)(ei,{artifact:i,selectedVersion:a})},"download"):null;return(0,n.jsxs)("div",{ref:er,className:(0,M.A)("pr-2 pl-3 flex items-center justify-between gap-2 select-none",Q?[_.X_,_.zo,"draggable"]:"py-2"),children:[i&&(0,n.jsx)($,{currentArtifact:i,hasMenuOpen:J,setHasMenuOpen:V}),J?(0,n.jsxs)("div",{className:"flex justify-between items-center flex-1 text-sm text-text-300 pl-1",children:[(0,n.jsx)(U.A,{defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),!p&&ec&&k?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(v.Loading,{size:"sm"})}):null]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,M.A)("flex items-center flex-1 gap-2"),children:[!(!l||r||o)&&(0,n.jsx)(m.Iz,{options:[{key:"normal",label:(0,n.jsx)(h.kU,{size:16}),ariaLabel:Z.formatMessage({defaultMessage:"Preview",id:"TJo5E6JuIN"})},{key:"code",label:(0,n.jsx)(h.Cy,{size:16}),ariaLabel:Z.formatMessage({defaultMessage:"Code",id:"h2vipunVVd"})}],initialKey:"normal"===d?"normal":"code",onSelect:e=>{c("normal"===e?"normal":"raw")},itemClassName:"!px-1"},"normal"===d?"normal":"code"),s>1?(0,n.jsx)(x.ms,{align:"start",trigger:(0,n.jsxs)(g.$,{variant:"ghost",size:"sm",className:"group !text-text-000 gap-1 justify-between !pl-1.5 !pr-1 !text-sm","data-testid":"artifact-version-trigger",children:["v",a+1,ed||a!==s-1?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"∙"}),(0,n.jsx)(U.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}),(0,n.jsx)(h.bi,{size:16,className:"opacity-0 group-hover:opacity-100 group-[&[data-state=open]]:opacity-100"})]}),children:Array.from({length:s}).map((e,t)=>s-t).map(e=>(0,n.jsxs)(x.tJ,{"data-testid":"version-dropdown",className:"flex justify-between",onSelect:()=>W(e-1),children:[(0,n.jsx)(U.A,{defaultMessage:"Version {versionNum}",id:"iMMX+ZCJ/I",values:{versionNum:e}}),e===s?(0,n.jsxs)(n.Fragment,{children:[" - ",(0,n.jsx)(U.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}):null,e-1===a?(0,n.jsx)(h.Jl,{className:"text-accent-secondary-100",size:16}):null]},e))}):null]}),(0,n.jsxs)("div",{className:(0,M.A)("flex gap-2 items-center text-sm"),children:[ed?(0,n.jsxs)(x.ms,{align:"end",trigger:(0,n.jsx)(g.$,{variant:"ghost",size:"unset",className:"!text-text-000 !shrink gap-1 !px-1 !py-0.5 text-sm","data-testid":"artifact-menu-trigger","aria-label":Z.formatMessage({defaultMessage:"More options for artifact",id:"O91Ji7GVP2"}),children:(0,n.jsx)(h.tx,{size:16})}),children:[ec&&(0,n.jsx)(x.tJ,{disabled:k,onSelect:N,children:(0,n.jsx)(U.A,{defaultMessage:"Refresh",id:"rELDbByu8U"})},"refresh"),K&&K.total_size_bytes>0&&!p&&(0,n.jsx)(x.tJ,{onSelect:X,children:(0,n.jsx)(f.YX,{id:"silver_apple_jungle"})},"reset-storage"),q&&!p&&(0,n.jsx)(x.tJ,{onSelect:()=>Y(!0),children:(0,n.jsx)(U.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"})},"manage-connectors"),(0,n.jsx)(x.tJ,{onSelect:el,children:(0,n.jsx)(U.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},"copy"),S?(0,n.jsx)(x.tJ,{onSelect:A,children:(0,n.jsx)(U.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})},"share"):null,R?(0,n.jsx)(x.tJ,{disabled:!0,onSelect:G,children:(0,n.jsx)(U.A,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"})},"unpublished"):T?(0,n.jsx)(x.tJ,{onSelect:G,children:(0,n.jsx)(U.A,{defaultMessage:"Publish",id:"syEQFEKfku"})},"publish"):null,ep,em]}):(()=>{let e=!p&&ec&&(k?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(v.Loading,{size:"sm"})}):(0,n.jsx)(g.$,{variant:"ghost",size:"icon_sm",onClick:N,children:(0,n.jsx)(h.Mv,{size:16})})),t=S&&(0,n.jsx)(g.$,{onClick:A,variant:"primary",size:"sm",disabled:z,prepend:(0,n.jsx)(h.SY,{size:16,className:"mr-0.5"}),children:(0,n.jsx)("span",{className:"text-sm",children:(0,n.jsx)(U.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})}),s=T&&(0,n.jsx)(b.Tooltip,{open:!!R&&void 0,tooltipContent:(0,n.jsx)(U.A,{defaultMessage:"This artifact was previously unpublished. Create a new artifact to publish again.",id:"173M62fqu+"}),children:(0,n.jsx)(g.$,{onClick:G,variant:"primary",size:"sm",disabled:R||z,className:(0,M.A)(R&&"!pointer-events-auto"),children:(0,n.jsx)("span",{className:"text-sm",children:void 0===F||R?(0,n.jsx)(U.A,{defaultMessage:"Publish",id:"syEQFEKfku"}):(0,n.jsx)(U.A,{defaultMessage:"Published",id:"w7tf2zwi6+"})})})}),a=(0,n.jsxs)(x.AM,{mainButtonText:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:(0,M.A)(es?"invisible":""),children:(0,n.jsx)(U.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})}),es?(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(h.Jl,{size:16})}):null]}),onClickMainButton:el,children:[(null==D?void 0:D.show)?en?(0,n.jsx)(x.tJ,{disabled:!0,children:(0,n.jsx)(U.A,{defaultMessage:"Copied to project",id:"KYVs6Ta+VU"})},"added-to-project"):(0,n.jsx)(x.tJ,{onSelect:ea,children:(0,n.jsx)(U.A,{defaultMessage:"Copy to project",id:"Xmf/Sp7n9T"})},"add-to-project"):null,ep,em]}),i=K&&K.total_size_bytes>0&&!p&&(0,n.jsx)(b.Tooltip,{tooltipContent:(0,n.jsx)(f.YX,{id:"silver_apple_jungle"}),children:(0,n.jsx)(g.$,{variant:"ghost",size:"icon_sm",onClick:X,children:(0,n.jsx)(h.E9,{size:16})})}),l=q&&!p&&(0,n.jsx)(b.Tooltip,{tooltipContent:(0,n.jsx)(U.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"}),children:(0,n.jsx)(g.$,{variant:"ghost",size:"icon_sm",onClick:()=>Y(!0),children:(0,n.jsx)(h.wB,{size:16})})});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex gap-1 items-center",children:[e,i,l]}),a,t,s]})})(),(0,n.jsx)(g.$,{variant:"ghost",size:"icon_sm",onClick:B,children:(0,n.jsx)(h.X,{size:16})})]})]})]})}function ei(e){let{artifact:t,selectedVersion:s}=e,{downloadUrl:a,filename:i}=((e,t)=>{let[s,a]=(0,I.useState)(""),[n,i]=(0,I.useState)("");return(0,I.useEffect)(()=>{var s;let n=null!=(s=e.versions[t].resultState)?s:"",l=(0,w.eg)(e),r=new Blob([n],{type:"text/plain"}),o=URL.createObjectURL(r);return a(o),i("".concat(e.id,".").concat(l)),()=>{URL.revokeObjectURL(o)}},[e,t]),{downloadUrl:s,filename:n}})(t,s),l=function(e){switch(e.type){case w.vU.Markdown:return"Markdown";case w.vU.Html:return"HTML";case w.vU.React:return"TSX";case w.vU.Svg:return"SVG";case w.vU.Text:return"TXT";case w.vU.Mermaid:return"Mermaid";case w.vU.Code:var t;return null!=(t=w.K5[e.type].extension(e))?t:null;default:return null}}(t);return(0,n.jsx)("a",{href:a,download:i,className:"py-1 px-2 rounded-md cursor-pointer whitespace-nowrap overflow-hidden grid grid-cols-[minmax(0,_1fr)_auto] gap-2 hover:bg-bg-200 hover:text-text-000 text-sm",children:l?(0,n.jsx)(U.A,{defaultMessage:"Download as {fileType}",values:{fileType:l},id:"PJh4v0uaV6"}):(0,n.jsx)(U.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})}p.J.div(et()),p.J.div(es());let el=e=>{let{onClose:t,isOpen:s,artifactVersionUuid:a,artifact:i,messageUuid:r,isProjectArtifact:o}=e,c=(0,L.A)(),{track:u}=(0,d.st)(),{mutateAsync:m,isPending:p}=(0,l.yE)(a),{data:f,isLoading:h}=(0,l.EC)(a),g=(null==f?void 0:f.visibility)==="shared",x=p||h,[v,j]=(0,I.useState)("");(0,I.useEffect)(()=>{if(""===v)return;let e=setTimeout(()=>j(""),5e3);return()=>clearTimeout(e)},[v]);let b="".concat(window.location.origin,"/artifacts/").concat(a),{copyToClipboard:w}=(0,y.C)(),_=x?"loading":g?"shared":"private",C=(0,I.useRef)(_);C.current!==_&&("loading"!==C.current&&"private"===_&&j(c.formatMessage({defaultMessage:"Artifact no longer shared",id:"5AFOwOoFPe"})),C.current=_);let k=e=>{"private"===e&&g&&m({visibility:"private"}).then(()=>t()),"shared"!==e||g||m({visibility:"shared"}).then(()=>w(b))};return(0,n.jsx)(er,{isOpen:s,onClose:t,isLoading:x,isShared:g,isProjectArtifact:o,sharedLink:b,updateSharedState:k,handleClickShareButton:()=>{k("shared"),u({event_key:"artifact.share.modal.share_button_clicked",message_uuid:r,artifact_type:i.type,artifact_language:i.language})}})};function er(e){let{isOpen:t,onClose:s,isShared:a,isProjectArtifact:i,sharedLink:l,isLoading:r,updateSharedState:o,handleClickShareButton:d}=e,{copyToClipboard:c,didCopy:u}=(0,y.C)();return(0,n.jsx)(j.aF,{title:(0,n.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:a?(0,n.jsx)(U.A,{defaultMessage:"Artifact shared",id:"0TqmonlxQo"}):(0,n.jsx)(U.A,{defaultMessage:"Share artifact",id:"FeSSOL+/49"})}),isOpen:t,onClose:s,modalSize:"lg",hasCloseButton:!0,children:(0,n.jsx)("div",{className:"mt-1 flex flex-col gap-2.5",children:a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,n.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)("div",{children:(0,n.jsx)(h.qz,{className:"mt-1",size:16})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)(U.A,{defaultMessage:"Shared",id:"kWI6zXRaHY"})}),(0,n.jsx)("p",{className:"text-text-300",children:i?(0,n.jsx)(U.A,{defaultMessage:"Anyone who has access to this project can view this artifact and its associated attachments and files.",id:"fxjJJNetIb"}):(0,n.jsx)(U.A,{defaultMessage:"Anyone in your organization can view this artifact and its associated attachments and files.",id:"P+skcC6AMa"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)(T(),{className:"text-text-300 truncate text-sm",href:l,children:l}),(0,n.jsx)(g.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{c(l)},prepend:u?(0,n.jsx)(h.rA,{size:16}):(0,n.jsx)(h.Xq,{size:16}),children:u?(0,n.jsx)(U.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,n.jsx)(U.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(g.$,{size:"lg",variant:"secondary",loading:r,onClick:()=>o("private"),children:(0,n.jsx)(U.A,{defaultMessage:"Unshare",id:"bEq+NWNIXF"})})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:i?(0,n.jsxs)("p",{className:"bg-bg-300 text-text-300 flex gap-2 rounded-xl p-3 text-sm",children:[(0,n.jsx)(h.R2,{size:16,className:"mt-0.5 shrink-0"}),(0,n.jsx)(U.A,{defaultMessage:"This artifact was created in a private project. Anyone in your organization who has access to this project will be able to view this artifact.",id:"g6r4HATHuW"})]}):(0,n.jsx)("p",{children:(0,n.jsx)(U.A,{defaultMessage:"Anyone in your organization can view this artifact. It also has access to attachments and files in the conversation.",id:"AnqiBApCMX"})})}),(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex gap-3 rounded-xl py-3 pl-3 pr-5",children:[(0,n.jsx)(h.c_,{className:"mt-0.5",size:16}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)(U.A,{defaultMessage:"Unshared",id:"0r/9ANkloS"})}),(0,n.jsx)("p",{className:"text-text-300",children:(0,n.jsx)(U.A,{defaultMessage:"Only you have access",id:"U+7IIlpC6m"})})]})]}),(0,n.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,n.jsx)(g.$,{size:"lg",loading:r,onClick:d,children:(0,n.jsx)(U.A,{defaultMessage:"Share & copy link",id:"E7GQdF/HSA"})})})]})})})}let eo=e=>{let{isOpen:t,onClose:s,artifactVersionUuid:a,conversationUuid:i}=e,{addError:l}=(0,u.Y)(),{mutateAsync:r,isPending:o}=(0,R.rz)({entityId:a,artifactEntityType:"artifact_version",conversationUuid:i}),d=async()=>{try{await r(void 0),s()}catch(e){l((0,n.jsx)(f.YX,{id:"cotton_camel_pyramid"}),{error:e})}};return(0,n.jsx)(j.aF,{title:(0,n.jsx)(f.YX,{id:"silver_apple_jungle"}),isOpen:t,onClose:s,modalSize:"md",hasCloseButton:!0,children:(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsx)("p",{className:"text-text-400",children:(0,n.jsx)(f.YX,{id:"golden_pear_forest"})}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(g.$,{variant:"secondary",onClick:s,disabled:o,children:(0,n.jsx)(U.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,n.jsx)(g.$,{variant:"primary",onClick:d,loading:o,children:(0,n.jsx)(f.YX,{id:"silver_apple_jungle"})})]})]})})}},9317:(e,t,s)=>{s.d(t,{K:()=>C,r:()=>M});var a=s(54568),n=s(19298),i=s(14691),l=s(2e3),r=s(72902),o=s(61295),d=s(10369),c=s(45271),u=s(17300),m=s(90215),p=s(39109),f=s(7620),h=s(56995),g=s(14333),x=s(65891),v=s(81478);let j=e=>{let{title:t,subtitles:s,url:l,disabled:o,isError:d,icon:c,isInSelectionMode:m=!1,isSelected:p=!1,onSelect:h,onSelectForBulk:g}=e,x=(0,f.useCallback)(()=>{h&&m&&h(!p,!1)},[m,h,p]),v=(0,f.useCallback)(()=>{h&&(!m&&g?g():h(!p,!1))},[m,h,p,g]);return(0,a.jsxs)("div",{className:"group/row relative flex items-center pl-1",onClick:x,style:{cursor:m?"pointer":void 0},children:[h&&(0,a.jsxs)("div",{className:"shrink-0 w-5 h-5 flex items-center justify-center",onClick:e=>{e.stopPropagation(),v()},children:[(0,a.jsx)("div",{className:(0,r.A)("absolute transition-all duration-200",m||p?"opacity-100 scale-100":"opacity-0 scale-75 group-hover/row:opacity-100 group-hover/row:scale-100"),children:(0,a.jsx)(u.S,{disabled:o,checked:p,onChange:e=>{h(e,!1)},label:"Select ".concat(t),hideLabel:!0,onClick:e=>e.stopPropagation()})}),(0,a.jsx)(i.ry,{vectorSizeOverride:18,className:(0,r.A)("transition-all duration-200 text-text-400 pointer-events-none",m||p?"opacity-0 scale-75":"opacity-100 scale-100 group-hover/row:opacity-0 group-hover/row:scale-75")})]}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsx)(n.$,{icon:c,title:t,subtitles:s,url:l,disabled:o,isError:d})})]})},b=e=>{let{results:t,disabled:s}=e,[n,i]=(0,f.useState)(!1),[l,r]=(0,f.useState)(!1),d=(0,f.useMemo)(()=>t.map(e=>({uuid:e.conversationUuid,type:"conversation"})),[t]),{selectedItems:c,handleSelect:u,selectAllItems:b,isInSelectionMode:y,toggleSelectMode:w}=(0,x.m)(d,s),_=(0,f.useCallback)(e=>{w(!0),u({uuid:e,type:"conversation"},!0,!1)},[w,u]),C=(0,f.useCallback)(()=>{r(!1),w(!1)},[w]),k=(0,f.useCallback)(()=>{i(!1),w(!1)},[w]),M=(0,f.useMemo)(()=>c.map(e=>{let{uuid:t}=e;return t}),[c]),N=t.length>0;return(0,a.jsxs)(m.o,{children:[(0,a.jsxs)("div",{className:"relative flex flex-col h-full",children:[(0,a.jsx)(o.P.div,{variants:{initial:{opacity:0},animate:{opacity:1}},initial:"initial",animate:"animate",className:"flex flex-col flex-nowrap p-2 pt-0 overflow-y-auto flex-1",children:t.map(e=>{let t=c.some(t=>t.uuid===e.conversationUuid);return(0,a.jsx)(j,{title:e.title,subtitles:e.subtitles,url:e.url,disabled:s,icon:e.icon,isInSelectionMode:y,isSelected:t,onSelect:(t,s)=>{u({uuid:e.conversationUuid,type:"conversation"},t,s)},onSelectForBulk:()=>_(e.conversationUuid)},e.conversationUuid)})}),(0,a.jsx)(p.N,{children:y&&N&&(0,a.jsx)(o.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"sticky bottom-0 bg-bg-000/[98%] border-t-0.5 border-border-300 rounded-b-lg",children:(0,a.jsx)("div",{className:"ml-[0.875rem] mr-2 pt-1 pb-1.5",children:(0,a.jsx)(v.g,{numSelected:c.length,totalNumItems:t.length,handleSelectAll:b,handleCancel:()=>w(!1),handleDeleteSelected:()=>i(!0),handleMoveToProject:()=>r(!0)})})})})]}),c.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Z,{isOpen:n,onClose:k,conversationUuids:M}),(0,a.jsx)(g.h,{conversationUuids:M,isOpen:l,onClose:C})]})]})};var y=s(40304),w=s(99411),_=s(72253);function C(e){var t,s,n;let i,{integrationName:l,icon:r,integrationIcon:o,message:c,result:u,isStreaming:m,isError:p,isExpandingDisabled:f,isFirstBlockOfMessage:h,isLastBlockOfMessage:g,wrapperClassName:x,contentClassName:v,defaultExpanded:j=!1,toolName:b,renderMode:y,groupItemKey:C,isFirstItemInGroup:k,isLastItemInGroup:E}=e,z=(0,d.A)(),{isExpanded:T,setIsExpanded:I}=(0,_.a)(j,C),U=!!u&&!f&&!m&&("rich_content"!==u.type||(null==(t=u.content)?void 0:t.length)>0);return i=u?"rich_content"===u.type?z.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(n=null==(s=u.content)?void 0:s.length)?n:0}):"JSON":void 0,(0,a.jsx)(w.sH,{isError:p,isExpandingDisabled:!U,isExpanded:T,setIsExpanded:I,isStreaming:!!m,text:null!=c?c:m?z.formatMessage({defaultMessage:"Searching",id:"IfE0if3ytt"}):z.formatMessage({defaultMessage:"Searched",id:"0ZuuhwjU4n"}),secondaryText:m?void 0:i,icon:r||(0,a.jsx)(M,{integrationName:l,iconUrl:o,canShowLetterIcon:!0}),isFirstBlockOfMessage:h,isLastBlockOfMessage:g,wrapperClassName:x,renderMode:y,isFirstItemInGroup:k,isLastItemInGroup:E,children:(0,a.jsxs)(w.NG,{isExpanded:T,snappyTransition:!0,isScrollable:!0,className:v,children:[U&&(null==u?void 0:u.type)==="rich_content"&&(0,a.jsx)(N,{disabled:!T||m,result:u,integrationName:l,toolName:b}),U&&(null==u?void 0:u.type)==="table"&&(0,a.jsx)(S,{result:u}),U&&(null==u?void 0:u.type)==="json_block"&&(0,a.jsx)(A,{result:u})]})})}let k=["Google Calendar","Gmail","Google Drive","Search Project Knowledge","Search Past Conversations"],M=e=>{let t,{canShowLetterIcon:s,integrationName:n,toolName:r,iconUrl:o,size:d=16}=e;switch(n){case"Search Project Knowledge":return(0,a.jsx)(i.Jt,{vectorSizeOverride:d});case"Memory":case"Search Past Conversations":return(0,a.jsx)(i.ce,{vectorSizeOverride:d});case"Google Drive":t=l.v8.GDRIVE;break;case"Google Calendar":t=l.v8.GCAL;break;case"Gmail":t=l.v8.GMAIL}let u=n||r;return(0,a.jsx)(c.z,{size:d,name:u,...t?{type:"syncSource",src:t}:{type:"favicon",src:o,fallbackToGlobe:!(u&&s)}})},N=e=>{let{disabled:t,integrationName:s,result:i,toolName:l}=e,r=l?l.split("").reduce((e,t)=>e+t.charCodeAt(0),0):0,d=!!s&&k.includes(s)&&2039!==r&&2010!==r;if("Search Past Conversations"===s){let e=i.content.map(e=>{let{title:t,subtitles:n,url:i,icon_url:l}=e;if(i){let e=i.match(/\/chat\/([a-f0-9-]+)/);if(e)return{conversationUuid:e[1],title:t,subtitles:n,url:i,icon:d?void 0:(0,a.jsx)(M,{integrationName:s,iconUrl:l})}}return null}).filter(e=>null!==e);return(0,a.jsx)(b,{results:e,disabled:t,integrationName:s,hideIcons:d})}return(0,a.jsx)(o.P.div,{variants:{initial:{opacity:0},animate:{opacity:1,transition:{staggerChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col flex-nowrap p-2 pt-0",children:i.content.map((e,i)=>{let{title:l,subtitles:r,url:o,resource_type:c,icon_url:u}=e;return(0,a.jsx)(n.$,{disabled:t,icon:d?void 0:(0,a.jsx)(M,{integrationName:s,iconUrl:u}),title:l,subtitles:r,url:o,tag:c},i)})})},S=e=>{let{result:t}=e;return(0,a.jsx)(E,{table:t.table})},A=e=>{let{result:t}=e,s=(0,d.A)();return(0,a.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:(0,a.jsx)(y.z,{title:s.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),code:t.json_block})})},E=e=>{let{table:t}=e;return(0,a.jsx)("div",{className:"grid p-2 pt-0",style:{gridTemplateColumns:"1fr 2fr"},children:t.map((e,s)=>{let[n,i]=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,r.A)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,a.jsx)("p",{className:"font-medium text-text-300 text-xs",children:n})}),(0,a.jsx)("div",{className:(0,r.A)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,a.jsx)("p",{className:"text-text-500 text-xs",children:i})})]})})})}},10304:(e,t,s)=>{s.d(t,{x:()=>a});function a(e,t,s){return"share"===e?"".concat(window.location.origin,"/artifacts/").concat(t.artifact_version_uuid):"publish"===e&&t.published_artifact_uuid?"".concat(s,"/public/artifacts/").concat(t.published_artifact_uuid):void 0}},14493:(e,t,s)=>{s.d(t,{b:()=>z});var a=s(54568),n=s(49953),i=s(44e3),l=s(18727),r=s(72902),o=s(7620),d=s(44036),c=s(29493),u=s(19736),m=s(34003),p=s(14691),f=s(37670),h=s(23812),g=s(37541),x=s(28044),v=s(66365),j=s(19664),b=s.n(j),y=s(59666),w=s(45538),_=s(22624),C=s(15912),k=s(19455),M=s(45318),N=s(19150);let S=(0,o.memo)(function(e){var t;let{conversationUuid:s,name:n,isInteractive:i=!0,sharedBy:l,project:d,controlsSidebarIsOpen:c,openControlsSidebar:j,closeControlsSidebar:S,isStreaming:A,isLoading:E}=e,z=!!l,{data:T}=(0,u.Bq)(s,{enabled:!z}),I=(0,m.u9)(),U=!!d&&!d.is_harmony_project,L=(0,x.V)(g.E_),R=(0,o.useRef)(null),O=(0,_.K)(),{value:F}=(0,v.useFeatureGate)("move_conversation_to_projects"),{data:D}=(0,w.PL)(),P=!!(O&&F&&T&&!T.is_temporary&&!T.project_uuid&&!z&&(null!=(t=null==D?void 0:D.count)?t:0)>=2&&n.length>0);return i&&T&&T.is_temporary?null:(0,a.jsxs)(M.z,{className:(0,r.A)("h-12",!L&&"-mb-3"),contentClassName:(0,r.A)("gap-6",L?"pl-0":"p-3 lg:pl-4 lg:pr-3"),"data-testid":"chat-header",sticky:!0,children:[(0,a.jsxs)("div",{className:"flex min-w-0 flex-1 shrink md:items-center font-base-bold pr-[100px]",children:[U&&(0,a.jsxs)("div",{className:"text-text-300 hover:text-text-100 inline-flex min-w-0 shrink-[4] items-center max-md:pl-1 gap-1",children:[(0,a.jsx)(b(),{href:"/project/".concat(d.uuid),className:"truncate",children:d.name}),(0,a.jsx)("span",{className:"opacity-50 px-0.5",children:"/"})]}),(0,a.jsx)("div",{className:"flex min-w-0 shrink-1 items-center group",children:E?(0,a.jsx)("div",{className:"animate-pulse h-5 w-32 rounded-lg bg-bg-300"}):i&&T?T.is_temporary?(0,a.jsxs)("div",{className:"flex flex-row items-center text-text-300 gap-2 cursor-default",children:[(0,a.jsx)(f.X3,{}),(0,a.jsx)(y.A,{defaultMessage:"Incognito chat",id:"MZWV60Fq3N"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.p,{conversation:T,initialName:n,trigger:(0,a.jsx)(h.$,{ref:R,variant:"ghost",size:"default",className:(0,r.A)(0===n.length?"!text-text-500":"!text-text-300 hover:!text-text-100","!shrink gap-1 !px-1 !py-0 !scale-100 !h-7"),append:(0,a.jsx)(p.bi,{size:16}),"data-testid":"chat-menu-trigger",children:(0,a.jsx)("div",{className:"min-w-0 flex-1",children:(0,a.jsx)("div",{className:"truncate font-base-bold",children:n.length>0?n:(0,a.jsx)(y.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})})}),(0,a.jsx)(C.V,{anchorRef:R,canShowNux:P,text:(0,a.jsx)(y.A,{defaultMessage:"You can now add existing conversations to projects",id:"7aTXzVESIs"}),id:"move-chat-to-project-nux",nuxItem:{dateAdded:"2025-09-15"},side:"bottom",align:"start"})]}):(0,a.jsx)("div",{className:"truncate text-text-300",children:n.length>0?n:(0,a.jsx)(y.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})]}),(0,a.jsxs)("div",{className:"right-3 flex gap-2",children:[z&&(0,a.jsx)("div",{className:"bg-bg-300 text-text-300 rounded-full px-3 py-1.5 font-base-bold",children:(0,a.jsx)(y.A,{defaultMessage:"Shared by {sharedBy}",id:"UMLOHo6H9c",values:{sharedBy:l}})}),s&&!z&&!I&&(0,a.jsx)(N.O,{conversationUuid:s,controlsSidebarIsOpen:c,openControlsSidebar:j,closeControlsSidebar:S,isStreaming:A,isTemporary:null==T?void 0:T.is_temporary})]})]})});var A=s(55188),E=s(18849);function z(e){let{headerProps:t,mainElement:s,drawerElement:u,auxilaryElement:m,isDrawerOpen:p,autoscrollRef:f,autoscrollDisabled:h,rightSidebarElement:g}=e,[x,v]=(0,o.useState)(!1),j=(0,o.useRef)(null),b=(0,o.useRef)(null),y=(0,o.useRef)(null),w=(0,o.useRef)({interacted:!1}),{setIsDrawerExpanded:_}=(0,E.x)(),{incognitoModeEnabled:C}=(0,A.S)(),k=(0,i.F)("md");(0,o.useEffect)(function(){let e=!0;if(!b.current||!j.current||!M.current||!y.current)return;let t=j.current,s=b.current,a=y.current;if(k){let e=p?window.innerWidth/2-d.r:s.getBoundingClientRect().width;a.style.width="".concat(e,"px")}let n=k&&!!g,i=M.current.getBoundingClientRect().width,l=n?384/i*100:0,r=Date.now(),o=p?l:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=parseFloat(e);return isNaN(s)?t:s}(s.style.flexGrow,50);return p&&(requestAnimationFrame(function n(){if(!e)return;let i=(Date.now()-r)/220,o=l+i*(50-l);if(i>=1||!k){t.style.flex=String(50),s.style.flex=String(50),a.style.width="auto";return}t.style.flex=String(100-o),s.style.flex=String(o),requestAnimationFrame(n)}),w.current.interacted=!0),!p&&w.current.interacted&&requestAnimationFrame(function n(){if(!e)return;let i=(Date.now()-r)/220,l=o-i*o;if(i>=1||!k){t.style.flex=String(100),s.style.flex=String(0),a.style.width="auto";return}t.style.flex=String(100-l),s.style.flex=String(l),requestAnimationFrame(n)}),()=>{e=!1}},[p]);let[M,N]=(0,l.w)();return(0,o.useEffect)(()=>{if(!b.current||!j.current||!M.current)return;let e=M.current.getBoundingClientRect(),t=j.current.getBoundingClientRect();if(window.innerWidth<c.g||t.width>c.D)return;let s=c.D/e.width*100;j.current.style.flex=String(s),b.current.style.flex=String(100-s)},[N.width,N.height,M]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,r.A)("flex flex-1 h-full w-full overflow-hidden relative",x&&"select-none"),ref:M,onMouseUp:function(){v(!1),document.body.style.removeProperty("cursor")},onMouseMove:e=>{var t,s;if(!x||!b.current||!j.current||!M.current)return;let a=M.current.getBoundingClientRect(),n=j.current.getBoundingClientRect(),i=(t=e.clientX-n.left,s=c.D,Math.min(Math.max(t,s),a.width-240)/a.width*100);j.current.style.flex=String(i),b.current.style.flex=String(100-i)},children:[(0,a.jsxs)("div",{ref:j,className:"h-full flex flex-col overflow-hidden",style:{flex:"".concat(100," 0")},children:[(0,a.jsx)(S,{...t}),(0,a.jsx)(n.Z,{ref:f,disabled:h,className:"relative h-full flex-1 flex overflow-x-hidden overflow-y-scroll pt-6",children:s})]}),(0,a.jsxs)("div",{className:(0,r.A)("max-md:hidden group w-2 relative h-full cursor-col-resize -mr-1 z-30 grid place-items-center",!p&&"hidden"),onMouseDown:function(){v(!0),document.body.style.setProperty("cursor","col-resize")},children:[(0,a.jsx)("div",{className:(0,r.A)("absolute top-0 bottom-0 right-1 w-[0.5px] bg-border-300","transition-all group-hover:delay-75 group-hover:bg-accent-secondary-100 group-hover:w-px group-hover:translate-x-[0.5px]",x&&"!bg-accent-secondary-000")}),(0,a.jsx)("div",{className:(0,r.A)("h-6 w-2 relative","rounded-full border-0.5 bg-bg-100 shadow border-border-300","transition duration-200 group-hover:delay-75 group-hover:border-accent-secondary-900 group-hover:bg-accent-secondary-900","cursor-col-resize",x&&"!bg-accent-secondary-000 !border-accent-secondary-000")})]}),(0,a.jsx)("div",{ref:b,className:(0,r.A)("max-md:absolute top-0 right-0 bottom-0 left-0 z-20","md:flex-grow-0 md:flex-shrink-0 md:basis-0","overflow-hidden h-screen",p?"max-md:flex-1":"max-md:hidden",x&&"pointer-events-none"),style:{flex:"0 0"},children:(0,a.jsxs)("div",{ref:y,className:"flex flex-col h-full overflow-hidden",children:[!C&&(0,a.jsx)("div",{className:"h-12 md:hidden bg-bg-000/30 backdrop-blur border-b-0.5 border-border-300",onClick:()=>{_(!1)}}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden h-full bg-bg-100",children:u})]})}),g]}),null!=m?m:null]})}},19150:(e,t,s)=>{s.d(t,{O:()=>h,_:()=>g});var a=s(54568),n=s(19736),i=s(74813),l=s(14691),r=s(23812),o=s(37541),d=s(28044),c=s(72902),u=s(96442),m=s(7620),p=s(59666);let f=(0,u.default)(()=>Promise.all([s.e(9883),s.e(3510),s.e(8059),s.e(4484)]).then(s.bind(s,44484)).then(e=>e.ShareModal),{loadableGenerated:{webpack:()=>[44484]},ssr:!1});function h(e){var t;let{controlsSidebarIsOpen:s,closeControlsSidebar:n,openControlsSidebar:i,conversationUuid:u,isStreaming:m,isTemporary:h}=e,x=(0,d.V)(o.E_),v=g({conversationUuid:u,isStreaming:m}),j=!!i&&!!n&&!s;return(0,a.jsxs)("div",{className:(0,c.A)("flex items-center gap-1","transition-opacity duration-300",s?"md:opacity-0 pointer-events-none user-select-none":"md:opacity-100",!j&&"hidden"),"data-testid":"chat-actions",children:[v.showShareFlow&&!h&&(0,a.jsx)(r.$,{tooltip:null!=(t=v.disabled_reason)?t:x&&(0,a.jsx)(p.A,{defaultMessage:"Share chat",id:"bXa+lJhlYV"}),variant:x?"ghost":"secondary",size:x?"icon_sm":"sm",onClick:v.openShareModal,disabled:v.disabled||!j,prepend:x&&(0,a.jsx)(l.SY,{}),children:!x&&(0,a.jsx)(p.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})}),x&&(0,a.jsx)(r.$,{tooltip:(0,a.jsx)(p.A,{defaultMessage:"New chat",id:"ATDyLPIoxz"}),href:"/new",size:"icon_sm",variant:"flat",disabled:!j,className:"ml-1",children:(0,a.jsx)(l.OM,{size:16})}),v.showShareFlow&&(0,a.jsx)(f,{...v})]})}function g(e){let{track:t}=(0,i.st)(),{data:s}=(0,n.O2)(e.conversationUuid),[a,l]=(0,m.useState)(!1),r=(0,m.useCallback)(()=>{t({event_key:"chat.share.button.clicked",conversation_uuid:e.conversationUuid}),l(!0)},[t,e.conversationUuid]),o=!!(null==s?void 0:s.snapshot),d=o||!!(null==s?void 0:s.shareable)||!!(null==s?void 0:s.disabled_reason),c=e.isStreaming||!o&&!(null==s?void 0:s.shareable);return{conversationUuid:e.conversationUuid,showShareModal:a,openShareModal:r,closeShareModal:()=>l(!1),isShared:o,showShareFlow:d,disabled:c,...s}}},20804:(e,t,s)=>{s.d(t,{DT:()=>v,i1:()=>j,Ih:()=>p,h4:()=>f,D8:()=>g});var a=s(54568),n=s(16256),i=s(68067),l=s(72902),r=s(61295),o=s(39109),d=s(7620),c=s(14691),u=s(59666);let m=(0,d.memo)(e=>{let{collapsedCount:t,isExpanded:s,onToggle:n}=e;if(0===t)return null;let i=s?(0,a.jsx)(u.A,{defaultMessage:"Hide steps",id:"Iufn28MeR1"}):(0,a.jsx)(u.A,{defaultMessage:"{collapsedCount, plural, one {# step} other {# steps}}",id:"dS6ebV+vpY",values:{collapsedCount:t}});return(0,a.jsxs)("button",{onClick:n,type:"button",className:(0,l.A)("group/collapse-indicator flex flex-row min-h-[2.125rem] shrink-0 w-full","hover:bg-bg-200 cursor-pointer transition-colors duration-200"),children:[(0,a.jsxs)("div",{className:"flex flex-col items-center pl-3 box-border pointer-events-none",children:[(0,a.jsx)("div",{className:(0,l.A)("transition-all grow w-[1px] bg-border-300",s&&"opacity-0"),style:{minHeight:"calc((2.125rem - 16px) / 2)"}}),(0,a.jsx)("div",{className:"transition-all flex items-center justify-center my-0.5 shrink-0 w-[16px] h-[16px]",children:(0,a.jsx)("span",{className:(0,l.A)("inline-flex transition-transform duration-400 ease-snappy-out",s?"rotate-180":"rotate-0"),children:(0,a.jsx)(c.IJ,{className:"text-text-500 group-hover/collapse-indicator:text-text-300",size:16})})}),(0,a.jsx)("div",{className:"transition-all grow w-[1px] bg-border-300",style:{minHeight:"calc((2.125rem - 16px) / 2)"}})]}),(0,a.jsx)("div",{className:"flex items-center px-3 py-2 flex-1 text-sm pointer-events-none",children:(0,a.jsx)("span",{className:"text-text-500 group-hover/collapse-indicator:text-text-300",children:i})})]})});m.displayName="CollapsedToolsIndicator";let p=(e,t)=>!(!["thinking","tool_use","tool_result","token_budget"].includes(e.type)||"tool_use"===e.type&&["prism","end_conversation","dolphin","launch_extended_search_task"].includes(e.name))&&(!!t.get("timeline_artifacts_enabled",!1)||("tool_use"!==e.type||"artifacts"!==e.name)&&("tool_result"!==e.type||"artifacts"!==e.name))&&(!!t.get("timeline_gsuite_enabled",!1)||"tool_use"!==e.type||!e.integration_name),f=e=>"tool_result"!==e.type,h=d.createContext({}),g=()=>(0,d.useContext)(h),x=e=>{let[t,s]=(0,d.useState)(void 0),n=(0,d.useMemo)(()=>({expandedItemKey:t,setExpandedItemKey:s}),[t,s]);return(0,a.jsx)(h.Provider,{value:n,children:e.children})},v=e=>{let{children:t,isFirstBlockOfMessage:s,isLastBlockOfMessage:c,isStreaming:u}=e,{value:p}=(0,i.fS)("claudeai_collapse_timeline_groups"),[f,h]=(0,d.useState)(!1),g=(0,d.useCallback)(e=>{e.stopPropagation(),h(e=>!e)},[]),v=d.Children.toArray(t),j=Math.max(0,v.length-2),b=p&&!f?v.slice(-2):v;return(0,a.jsx)(r.P.div,{initial:{opacity:+!u},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,l.A)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-ui leading-normal my-3 border-border-300 min-h-[2.625rem] overflow-hidden",s?"mt-2":"mt-3",c?"mb-2":"mb-3"),children:(0,a.jsxs)(x,{children:[p&&j>0&&(0,a.jsx)(m,{collapsedCount:j,isExpanded:f,onToggle:g}),(0,a.jsx)(o.N,{initial:!1,mode:"sync",children:b.map((e,t)=>(0,a.jsx)(r.P.div,{className:"overflow-hidden shrink-0",layout:"position",initial:{opacity:0,height:0},animate:"expanded",exit:"collapsed",variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},transition:{layout:{duration:0},ease:n.A.snappyOut,duration:.2},children:e},d.isValidElement(e)&&null!==e.key?e.key:t))})]})})},j=e=>{let{icon:t,isExpanded:s,isFirstItem:n,isLastItem:i,isActive:r,children:o}=e,d={minHeight:"calc((2.125rem - ".concat(t?"16px":"6px",") / 2)")};return(0,a.jsxs)("div",{className:(0,l.A)("flex flex-row min-h-[2.125rem] shrink-0",{"bg-bg-000":s},{"hover:bg-bg-200":!s}),children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pl-3 box-border",children:[(0,a.jsx)("div",{className:(0,l.A)("transition-all w-[1px]",{"bg-border-300":!n}),style:d}),(0,a.jsx)("div",{className:(0,l.A)("transition-all flex items-center justify-center my-1 shrink-0 w-[16px]",{"h-[16px]":!!t}),children:null!=t?t:(0,a.jsx)("div",{className:(0,l.A)("size-[6px] rounded-full",r?"bg-accent-main-200":"bg-border-300")})}),(0,a.jsx)("div",{className:(0,l.A)("transition-all grow w-[1px]",{"bg-border-300":!i}),style:d})]}),(0,a.jsx)("div",{className:"w-full flex flex-col min-w-0",children:o})]})}},24423:(e,t,s)=>{s.d(t,{Ci:()=>B,Gu:()=>O,HF:()=>M,JX:()=>w,P8:()=>A,Po:()=>g,Q3:()=>G,QS:()=>S,RR:()=>P,ST:()=>N,SY:()=>x,U4:()=>U,dd:()=>k,gq:()=>D,n5:()=>z,ot:()=>j,oz:()=>h,so:()=>J,uO:()=>I,uQ:()=>F,w0:()=>E,xJ:()=>L,xw:()=>_,zg:()=>R});var a=s(19736),n=s(57291),i=s(20795),l=s.n(i),r=s(4211),o=s(50848),d=s(42469),c=s(97345),u=s(26761);let m={uuid:"",sender:"assistant",content:[],created_at:"",updated_at:"",attachments:[],files:[],files_v2:[],sync_sources:[],index:0,parent_message_uuid:void 0},p=e=>{let t={};return e.forEach(e=>{if("assistant"!==e.sender)return;let[s]=f(t,e);Object.keys(s).forEach(e=>{t[e]={...t[e],...s[e]}})}),t},f=(e,t)=>{let s=(0,n.Xz)(t),a=null,i={};return s.forEach(t=>{var s,l,r;let{id:o,currentVersion:d,type:c,title:u,language:m}=t,p=null==(r=((null==(s=i[o])?void 0:s.versions)||(null==(l=e[o])?void 0:l.versions)||[]).slice(-1)[0])?void 0:r.resultState,f=(0,n.zI)(d,p),h={...d,resultState:f};i[o]?i[o]={...i[o],versions:[...i[o].versions,h]}:e[o]?i[o]={...e[o],versions:[...e[o].versions,h]}:i[o]={id:o,type:c||"document",title:u||"Untitled",language:m||void 0,versions:[h]},a=o}),[i,a]},h=(0,r.v)()((0,o.eh)((e,t)=>({selectedMessageUuid:null,messageByUuid:{},pathUuidsByConversation:{},conversationSettings:null,artifacts:{},allFiles:[],allAttachments:[],allSyncSources:[],hasArtifacts:!1,fullText:"",lastStreamingArtifactId:null,streamingArtifacts:{},setSelectedMessage:t=>e({selectedMessageUuid:t}),setMessages:(t,s)=>{e(e=>{let n={},i=[];s.forEach(e=>{n[e.uuid]=e,i.push(e.uuid)});let l=p(s),r=s.flatMap(e=>e.files),o=s.flatMap(e=>e.attachments),d=s.flatMap(e=>e.sync_sources),c=Object.keys(l).length>0,u=s.map(e=>(0,a.Rs)(e)).join(" ");return{messageByUuid:n,pathUuidsByConversation:{...e.pathUuidsByConversation,[t]:i},artifacts:l,streamingArtifacts:{},allFiles:r,allAttachments:o,allSyncSources:d,hasArtifacts:c,fullText:u,lastStreamingArtifactId:null}})},appendMessages:(e,s)=>{let a=t(),n=[...(a.pathUuidsByConversation[e]||[]).map(e=>a.messageByUuid[e]).filter(Boolean),...s];a.setMessages(e,n)},updateMessage:(s,n)=>{let{messageByUuid:i}=t(),l={...i,[s]:n},r=Object.values(l),o=p(r),d=r.flatMap(e=>e.files),c=r.flatMap(e=>e.attachments),u=r.flatMap(e=>e.sync_sources),m=Object.keys(o).length>0;e({messageByUuid:l,artifacts:o,allFiles:d,allAttachments:c,allSyncSources:u,hasArtifacts:m,fullText:r.map(e=>(0,a.Rs)(e)).join(" "),lastStreamingArtifactId:null})},setArtifacts:t=>e({artifacts:t,hasArtifacts:Object.keys(t).length>0}),setConversationSettings:t=>e({conversationSettings:t}),setPathUuids:(t,s)=>e(e=>({pathUuidsByConversation:{...e.pathUuidsByConversation,[t]:s}})),updateStreamingMessage:(s,a,n)=>{let{messageByUuid:i,pathUuidsByConversation:l,artifacts:r}=t(),o=l[s]||[],d=o[o.length-1],c=i[d];if(!c)return;let u={...c,content:n},[m,p]=f(r,u);e({messageByUuid:{...i,[d]:u},lastStreamingArtifactId:p,streamingArtifacts:m})},getConversationMessages:e=>{let s=t();return(s.pathUuidsByConversation[e]||[]).map(e=>s.messageByUuid[e]).filter(Boolean)}}))),g=()=>h(e=>e.setArtifacts),x=()=>h(e=>e.lastStreamingArtifactId),v=[],j=e=>h((0,d.k)(t=>{let s=t.pathUuidsByConversation[e];return s&&0!==s.length?s.map(e=>t.messageByUuid[e]).filter(Boolean):v})),b=new Map,y=[],w=e=>h(t=>{let s=t.messageByUuid[e];return s||(b.has(e)||b.set(e,{...m,uuid:e}),b.get(e))}),_=e=>h(t=>t.pathUuidsByConversation[e]||y),C=e=>h((0,d.k)(e)),k=()=>C(e=>e.artifacts),M=()=>(0,c.n)(h,e=>({...e.artifacts,...e.streamingArtifacts}),l()),N=e=>(0,c.n)(h,t=>t.artifacts[e],l()),S=()=>C(e=>e.allFiles),A=()=>C(e=>e.allAttachments),E=()=>C(e=>e.allSyncSources),z=e=>h(t=>{let s=(t.pathUuidsByConversation[e]||[])[0];return s?t.messageByUuid[s]:void 0}),T=e=>h(t=>{let s=(t.pathUuidsByConversation[e]||[])[1];return s?t.messageByUuid[s]:void 0}),I=e=>{var t;let s=T(e);return(null==s||null==(t=s.content)?void 0:t.length)||0},U=e=>{let t=T(e);return null==t?void 0:t.sender},L=e=>h(t=>{let s=t.pathUuidsByConversation[e]||[],a=s[s.length-1];return a?t.messageByUuid[a]:m}),R=e=>h(t=>(t.pathUuidsByConversation[e]||[]).map(e=>t.messageByUuid[e]).filter(Boolean).some(e=>(0,u.OC)(e))),O=()=>h(e=>e.setMessages),F=()=>h(e=>e.appendMessages),D=()=>h(e=>e.updateStreamingMessage),P=()=>h(e=>e.getConversationMessages),B=(e,t)=>(0,c.n)(h,s=>{let a=s.pathUuidsByConversation[e]||[],n=a[a.length-1],i=n?s.messageByUuid[n]:void 0;if(i){if(t){var l;return{...i,content:(null==(l=i.content)?void 0:l.map(e=>{let t={type:e.type};return("tool_use"===e.type||"tool_result"===e.type)&&(t.name=e.name),t}))||[]}}return i}},(e,s)=>{var a,n,i,l;return e&&s&&t?e.uuid===s.uuid&&(null==(a=e.content)?void 0:a.length)===(null==(n=s.content)?void 0:n.length)&&e.attachments.length===s.attachments.length&&e.files.length===s.files.length&&(null==(i=e.files_v2)?void 0:i.length)===(null==(l=s.files_v2)?void 0:l.length):e===s}),G=e=>h(t=>{let s=t.pathUuidsByConversation[e]||[];for(let e=s.length-1;e>=0;e--){let a=t.messageByUuid[s[e]];if(a&&"human"===a.sender)return a}}),W=new Set(["bash","bash_tool","create_file","str_replace"]),J=e=>h(t=>{let s=t.pathUuidsByConversation[e]||[];for(let e=s.length-1;e>=0;e--){let a=t.messageByUuid[s[e]];if(!a)continue;let n=a.content;if(n)for(let e=n.length-1;e>=0;e--){let t=n[e];if("tool_result"===t.type&&W.has(t.name))return[t.name,a.uuid,e].join("-")}}})},26434:(e,t,s)=>{s.d(t,{W:()=>a,m:()=>n});let a=e=>(e.split("/").pop()||e).replace(/\.[^/.]+$/,"").split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),n=(e,t)=>{if(!t)return!0;let s=e.replace("computer://","");if("org_scoped"===t)return s.startsWith("/mnt/user-data/");if("public"===t)return!1;throw Error("Unknown share type: ".concat(t))}},26761:(e,t,s)=>{s.d(t,{OC:()=>n,eb:()=>i,nb:()=>l});var a=s(57958);function n(e){var t;return!!l(e)&&!!(null==(t=e.content)?void 0:t.some(e=>"tool_result"===e.type&&"artifacts"===e.name))}function i(e){let t=l(e);if(!t)return;let s=t.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:n}=a.z7.safeParse(s);return null==n?void 0:n.task_id}function l(e){var t;return null==(t=e.content)?void 0:t.find(e=>"tool_result"===e.type&&"launch_extended_search_task"===e.name)}},26786:(e,t,s)=>{s.d(t,{f:()=>c});var a=s(54568),n=s(20453),i=s(60967),l=s(23812),r=s(39500),o=s(98304),d=s(7620);let c=e=>{let{attachment:t,goBack:s,onClose:c}=e,u=(0,d.useMemo)(()=>(0,i.E)(t),[t]);return(0,a.jsxs)("div",{className:"flex h-full flex-col pb-1 pl-5 pt-3",children:[(0,a.jsxs)("div",{className:"sticky flex items-center gap-1 pr-5",children:[s&&(0,a.jsx)(l.$,{onClick:s,variant:"ghost",size:"icon",className:"-ml-2 shrink-0",children:(0,a.jsx)(r.n,{size:20})}),(0,a.jsx)("h2",{className:"font-ui flex-1 truncate text-lg font-medium",children:u.title}),(0,a.jsx)(l.$,{variant:"ghost",size:"icon",className:"-mr-2",onClick:c,"data-testid":"close-file-preview",children:(0,a.jsx)(o.X,{size:20})})]}),(0,a.jsxs)("div",{className:"mb-1 flex flex-col pb-3 pr-5 min-h-0 flex-1",children:[(0,a.jsx)(n.G,{metaData:u.metaData}),(0,a.jsx)("div",{className:"-m-1 mt-0 min-h-0 flex-1 whitespace-pre-wrap break-all text-xs p-4 bg-bg-000 rounded-lg border-0.5 border-border-300  overflow-y-auto font-mono shadow-sm",children:t.extracted_content})]})]})}},27769:(e,t,s)=>{s.d(t,{FT:()=>l,Ud:()=>r,Xp:()=>o});var a=s(57291),n=s(14935),i=s.n(n);function l(e){var t;let s=e.name.split("."),a=s.slice(0,-1).join("."),n=s.length>1?null!=(t=s.at(-1))?t:"":null,l=a.replaceAll(/[_-]/g," ");return{displayName:i()(l),displayExt:n?n.toUpperCase():null}}function r(e){var t;let s=null==(t=e.split(".").pop())?void 0:t.toLowerCase();return s?["csv","tsv"].includes(s)?"table":["xls","xlsx"].includes(s)?"spreadsheet":["pptx"].includes(s)?"preso":["pdf","md","docx"].includes(s)?"doc":["mermaid","mmd"].includes(s)?"diagram":["jsx","tsx"].includes(s)?"code":["svg"].includes(s)||a._o.includes(s)?"image":a.Uv.includes(s)?"code":null:null}function o(e){let{displayExt:t}=l(e),s=r(e.name),a={code:{label:"Code",isPreviewable:!0},table:{label:"Table",isPreviewable:!0},spreadsheet:{label:"Spreadsheet",isPreviewable:!0},doc:{label:"Document",isPreviewable:!0},image:{label:"Image",isPreviewable:!0},diagram:{label:"Diagram",isPreviewable:!0},preso:{label:"Presentation",isPreviewable:!1}},{label:n}=s&&a[s]?a[s]:{label:null},i=n&&t?" \xb7 ":"";return"".concat(null!=n?n:"").concat(i).concat(null!=t?t:"")}},29493:(e,t,s)=>{s.d(t,{D:()=>n,g:()=>a});let a=768,n=420},32027:(e,t,s)=>{s.d(t,{O:()=>r,f:()=>l});var a=s(1613),n=s(64328),i=s(90458);let l=e=>{let{conversationUuid:t,source:s}=e,{activeOrganization:l}=(0,n.YL)(),r=null==l?void 0:l.uuid,o=!!t&&(0,i.O)(t),d=new URLSearchParams;s&&d.append("source",s);let c=d.toString()?"?".concat(d.toString()):"";return(0,a.Sk)("/api/organizations/".concat(r,"/artifacts/").concat(t,"/versions").concat(c),{queryKey:["conversation_artifacts_query_key",{organizationUuid:r,conversationUuid:t}],enabled:!!r&&!!t&&!o,meta:{noToast:!0}})},r=e=>{let{conversationUuid:t}=e,{activeOrganization:s}=(0,n.YL)(),i=null==s?void 0:s.uuid;return(0,a.L2)("/api/organizations/".concat(i,"/conversations/").concat(t,"/wiggle/convert-file-to-artifact"),"POST",{enabled:!!i&&!!t})}},34898:(e,t,s)=>{s.d(t,{Q:()=>p,k:()=>m});var a=s(1613),n=s(64328),i=s(42759),l=s(67632),r=s(27541),o=s(7620),d=s(99427),c=s(60956);let u=null,m=e=>{u={payload:e,received:new Date}};function p(e){let{chatId:t,chatName:s,onSend:m,hasFirstMessage:p}=e,{activeOrganization:f}=(0,n.YL)(),h=(0,a.mn)(),g=(0,o.useRef)(!1),x=(0,r.useSearchParams)(),v=(0,c.j)(),j=(0,o.useCallback)(e=>e.chatId===t&&!g.current&&!!f&&(g.current=!0,(async()=>{try{let t=[];if("images"in e)for(let s of e.images)try{t.push(...await (0,d.bl)(s.base64,s.mimeType,f.uuid,h))}catch(e){}else if(e.imageBase64&&e.imageMimeType)try{t.push(...await (0,d.bl)(e.imageBase64,e.imageMimeType,f.uuid,h))}catch(e){}return await m({prompt:e.text,files:t}),!0}catch(e){return!1}finally{g.current=!1}})(),!0),[f,t,m,h]);return(0,o.useEffect)(()=>{if(!p)return;let e=u;u=null;let s="1"===x.get("desktop_quick_entry");s&&v("desktop_quick_entry",null),e&&Date.now()-e.received.getTime()<=6e4&&e.payload.chatId&&e.payload.chatId===t&&s&&setTimeout(()=>j(e.payload),1)},[p,t,j,x,v]),(0,i._v)(l.A.ChatInfo,{getCurrentChatInfo:()=>Promise.resolve({chatId:t,chatName:s}),sendToChatWithPayload:j},[t,s,f,h,m]),null}},37080:(e,t,s)=>{s.d(t,{CH:()=>b,GT:()=>N,IK:()=>j,Nw:()=>C,OQ:()=>w,Ui:()=>y,YE:()=>M,mk:()=>v,mq:()=>x});var a=s(54568),n=s(19736),i=s(71700),l=s(79383),r=s(1613),o=s(95617),d=s(66365),c=s(72902),u=s(61295),m=s(45312),p=s(7620),f=s(10369),h=s(24407),g=s(88775);function x(e){let{hrefs:t}=e,s=t.map((e,t)=>(0,a.jsx)(u.P.div,{className:(0,c.A)("shadow-xs h-5 w-5 rounded-full overflow-hidden border-0.5 border-border-300 bg-bg-100 flex items-stretch justify-stretch","z-".concat(t+1)),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.1+.05*t,duration:.3},children:(0,a.jsx)(i.d,{url:e,shouldFillBackground:!0,size:14})},t));return(0,a.jsx)("div",{className:"flex items-center -space-x-2",children:s})}function v(e){let{agents:t,n:s=5}=e,a=new Set;for(let e of t)for(let t of e.annotated_snippets)for(let e of t.tool_calls){var n;if("web_search"===e.tool_name&&(null==(n=e.output)?void 0:n.type)==="rich_content"&&e.output.content.length){for(let t of e.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean))if("string"==typeof t)try{let e=new URL(t);if(a.add(e.origin),a.size>=s)return Array.from(a).slice(0,s)}catch(e){}}}return Array.from(a)}function j(e,t){let s=!t||t===o.zu.Completed,a=(0,p.useRef)(s),{mutate:i}=(0,n.HF)(e,{refetchOnSettled:!0});(0,p.useEffect)(()=>{s&&!a.current&&i({settings:{compass_mode:null}}),a.current=s},[i,s,e])}function b(e){var t,s;let{organizationUuid:a,conversationUuid:i,taskId:l,isShared:c,enabled:u}=e,[f,h]=(0,p.useState)(!0),[,x]=(0,p.useState)(0),v=(0,d.useDynamicConfig)("use_confused_carousel_sounds").get("polling",[{intervalSeconds:30}]),j=null!=(s=null==(t=v[0])?void 0:t.intervalSeconds)?s:30,[b,y]=(0,p.useState)(j),w=(0,n._W)(i),_=(0,g.Tc)(e=>e.setCurrentCompassTask,"useCompassStatus"),C=c?"/api/organizations/".concat(a,"/chat_snapshots/").concat(i,"/task/").concat(l,"/status"):"/api/organizations/".concat(a,"/chat_conversations/").concat(i,"/task/").concat(l,"/status"),{data:k,isLoading:M,error:N}=(0,r.Sk)(C,{refetchInterval:!!f&&1e3*b,enabled:!!(u&&i&&a&&l),meta:{noToast:!0}}),S=(null==k?void 0:k.status)!==void 0&&!(0,o.i3)(null==k?void 0:k.status);return(0,p.useEffect)(()=>{if(u&&i&&a&&l)if(S)h(!1),_(void 0),w(),x(0);else if(N){if(!(null==k?void 0:k.started_at))return void h(!1);x(e=>{let t=e+1,s=m.c9.fromISO(k.started_at).plus({hours:3}),a=m.c9.now();return h(t<3&&a<s),t})}else k&&!S&&(x(0),_(l))},[u,l,S,N,w,a,i,k,_]),(0,p.useEffect)(()=>{if(!(null==k?void 0:k.started_at)||!f)return;let e=setInterval(()=>{let e=function(e,t){let s=m.c9.fromISO(e),a=m.c9.now().diff(s,"seconds").seconds;for(let e of t)if(!e.durationSeconds||a<e.durationSeconds)return e.intervalSeconds;return 30}(k.started_at,v);e!==b&&y(e)},1e3*b);return()=>clearInterval(e)},[null==k?void 0:k.started_at,f,v,b]),{compassStatus:k,isLoading:M,error:N,completed:S}}let y=e=>{var t,s;return null==e||null==(s=e.agents)||null==(t=s[0])?void 0:t.name};function w(e){let t=(0,f.A)(),s=y(e);return s||(e.status!==o.zu.Completed?t.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}):t.formatMessage({defaultMessage:"Done researching",id:"/ONMTL4lXm"}))}let _=h.z.object({thought:h.z.string()});function C(e){let t=null==e?void 0:e.agents[0];return(0,p.useMemo)(()=>{var e,s,a;let n=null==t||null==(e=t.annotated_snippets[0])?void 0:e.thinking_blocks,i=n&&n.length>0?n[0]:void 0;if(i)return i.thinking;let l=null==t||null==(a=t.annotated_snippets[0])||null==(s=a.tool_calls)?void 0:s.find(e=>"think"===e.tool_name);if(null==l?void 0:l.tool_input)try{let e=JSON.parse(l.tool_input),{data:t}=_.safeParse(e);return null==t?void 0:t.thought}catch(e){return}},[null==t?void 0:t.annotated_snippets])}function k(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),a=Math.floor(s/60);return a>0?"".concat(a,"h ").concat(s%60,"m"):s>0?"".concat(s,"m ").concat(t%60,"s"):t>0?"".concat(t,"s"):"0s"}function M(e){let{startedAt:t,completedAt:s}=e,[n,i]=(0,p.useState)(()=>m.c9.now());if((0,p.useEffect)(()=>{if(!t||s)return;let e=setInterval(()=>{i(m.c9.now())},1e3);return()=>clearInterval(e)},[t,s,i]),!t)return"Starting";let l=m.c9.fromISO(t);if(s){let e=m.c9.fromISO(s).diff(l,"milliseconds").milliseconds;return e<=0?"Starting":(0,a.jsx)(a.Fragment,{children:k(e)})}let r=n.diff(l,"milliseconds").milliseconds;return r<=1e3?"Starting":(0,a.jsx)(a.Fragment,{children:k(r)})}function N(e){let{thought:t,className:s}=e;return t?(0,a.jsx)("div",{className:(0,c.A)("text-text-100 font-claude-response-body",s),children:(0,a.jsx)(l.fP,{text:t})}):null}},39510:(e,t,s)=>{s.d(t,{qO:()=>d});var a=s(54568),n=s(72902),i=s(7620),l=s(79383);class r{isInsideStructure(){return this.inCodeBlock||this.inList||this.inTable||this.inBlockquote}processLine(e){let t=e.trim(),s=this.isInsideStructure();(t.startsWith("```")||t.startsWith("~~~"))&&(this.inCodeBlock?t.startsWith(this.codeBlockDelimiter)&&(this.inCodeBlock=!1,this.codeBlockDelimiter=""):(this.inCodeBlock=!0,this.codeBlockDelimiter=t.substring(0,3))),/^[-*+]|\d+\./.test(t)&&!this.inCodeBlock?this.inList=!0:this.inList&&""===t&&(this.inList=!1),t.includes("|")&&!this.inCodeBlock?this.inTable=!0:this.inTable&&""===t&&(this.inTable=!1);let a=t.startsWith(">");a&&!this.inCodeBlock?this.inBlockquote=!0:this.inBlockquote&&""===t&&!a&&(this.inBlockquote=!1);let n=this.lastLineWasEmpty;this.lastLineWasEmpty=""===t;let i=s&&!this.isInsideStructure();return{insideStructure:this.isInsideStructure(),structureJustClosed:i,previousLineWasEmpty:n}}reset(){this.inCodeBlock=!1,this.codeBlockDelimiter="",this.inList=!1,this.inTable=!1,this.inBlockquote=!1,this.lastLineWasEmpty=!0}constructor(){this.inCodeBlock=!1,this.codeBlockDelimiter="",this.inList=!1,this.inTable=!1,this.inBlockquote=!1,this.lastLineWasEmpty=!0}}let o=(0,i.memo)(e=>{let{text:t,blockCitations:s=[],onLinkDetected:n,onCodeDetected:i,hasLinkRef:r,hasCodeRef:o,className:d,linkTarget:c="_blank",flagShowCodeHeader:u,unsafeAllowNavigationWithoutConfirmation:m,onOpenArtifact:p,isLastMessage:f,publishedArtifacts:h,messageUuid:g,onLinkClick:x}=e;return(0,a.jsx)(l.fP,{text:t,blockCitations:s,onLinkDetected:n,onCodeDetected:i,hasLinkRef:r,hasCodeRef:o,className:d,linkTarget:c,isStreaming:!1,flagShowCodeHeader:u,unsafeAllowNavigationWithoutConfirmation:m,onOpenArtifact:p,isLastMessage:f,publishedArtifacts:h,messageUuid:g,onLinkClick:x})},(e,t)=>e.text===t.text);o.displayName="MemoizedMarkdownChunk";let d=(0,i.memo)(e=>{let{text:t,blockCitations:s=[],onLinkDetected:d,onCodeDetected:c,hasLinkRef:u,hasCodeRef:m,className:p,linkTarget:f="_blank",isStreaming:h=!1,flagShowCodeHeader:g,unsafeAllowNavigationWithoutConfirmation:x,onOpenArtifact:v,isLastMessage:j,publishedArtifacts:b,messageUuid:y,onLinkClick:w}=e,{completedChunks:_,streamingChunk:C}=((e,t)=>{let[s,a]=(0,i.useState)([]),[n,l]=(0,i.useState)(""),o=(0,i.useRef)(new r);return(0,i.useEffect)(()=>{if(!e){a([]),l("");return}if(!t){a([e]),l(""),o.current.reset();return}let s=e.split("\n"),n=[],i=[],r=-1;o.current.reset();for(let e=0;e<s.length;e++){let t=s[e],{insideStructure:a,structureJustClosed:l,previousLineWasEmpty:d}=o.current.processLine(t);if(i.push(t),l||!a&&""===t.trim()&&i.length>1&&!d){for(;i.length>0&&""===i[i.length-1].trim();)i.pop();i.length>0&&(n.push(i.join("\n")),r=e,i=[])}}let d=s.slice(r+1).join("\n");a(n),l(d)},[e,t]),{completedChunks:s,streamingChunk:n}})(t,h);return(0,a.jsxs)("div",{className:(0,n.A)("grid-cols-1 grid gap-2.5 [&_>_*]:min-w-0",p),children:[_.map((e,t)=>(0,a.jsx)(o,{text:t>0?"\n\n"+e:e,blockCitations:s,onLinkDetected:d,onCodeDetected:c,hasLinkRef:u,hasCodeRef:m,className:"",linkTarget:f,flagShowCodeHeader:g,unsafeAllowNavigationWithoutConfirmation:x,onOpenArtifact:v,isLastMessage:j,publishedArtifacts:b,messageUuid:y,onLinkClick:w},t)),C&&(0,a.jsx)(l.fP,{text:_.length>0?"\n\n"+C:C,blockCitations:s,onLinkDetected:d,onCodeDetected:c,hasLinkRef:u,hasCodeRef:m,className:"",linkTarget:f,isStreaming:!0,flagShowCodeHeader:g,unsafeAllowNavigationWithoutConfirmation:x,onOpenArtifact:v,isLastMessage:j,publishedArtifacts:b,messageUuid:y,onLinkClick:w})]})});d.displayName="ProgressiveStandardMarkDown"},40304:(e,t,s)=>{s.d(t,{z:()=>o});var a=s(54568),n=s(11727),i=s(57820),l=s(72902),r=s(29820);let o=e=>{let{className:t,code:s,codeTagProps:o,language:c,title:u}=e,{codeStyle:m}=(0,i.V)();return(0,a.jsxs)("div",{className:(0,l.A)("flex flex-col gap-3 p-3 bg-bg-100 rounded-md",t),children:[(0,a.jsx)(d,{language:c,title:u}),(0,a.jsx)(r.A,{className:"code-block__code !my-0 !p-0 !rounded-none !text-sm !leading-relaxed",codeTagProps:o,language:c,PreTag:"div",style:m,renderer:n.G,wrapLongLines:!0,children:s})]})},d=e=>{let{language:t,title:s}=e;return(0,a.jsx)("div",{className:"flex justify-between items-center h-3",children:(0,a.jsx)("p",{className:(0,l.A)("text-text-300 text-[0.6875rem]",s?"font-ui font-medium":"font-mono font-[450]"),children:s||t})})}},41005:(e,t,s)=>{s.d(t,{yL:()=>en,XO:()=>ea});var a=s(54568),n=s(15393),i=s(74813),l=s(44995),r=s(64328),o=s(45054),d=s(13750),c=s(14691),u=s(23812),m=s(87483),p=s(1720),f=s(3075),h=s(67453),g=s(64371),x=s(57291),v=s(31779),j=s(72352),b=s(72902),y=s(39109),w=s(61295),_=s(45312),C=s(32536),k=s(7620),M=s(59666),N=s(10369),S=s(32027),A=s(45538),E=s(4887),z=s(47831),T=s(8564),I=s(68616),U=s(78671),L=s(48321),R=s(78418),O=s(79901),F=s(27769);function D(e){let{width:t=61,height:s=82,...n}=e;return(0,a.jsxs)("svg",{width:t,height:s,viewBox:"0 0 61 82",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n,children:[(0,a.jsx)("path",{d:"M40.2344 2.97998L41.4401 18.5435C41.4401 18.5435 60.4289 19.3192 59.1368 17.9675C57.8427 16.6158 40.2363 2.97998 40.2363 2.97998H40.2344Z",className:"fill-[#E8E6DC] dark:fill-[#3D3D3A]"}),(0,a.jsx)("path",{d:"M1.27976 14.1874C1.39304 11.3016 1.4372 9.85778 1.48328 8.41202C1.50632 7.6901 1.52128 6.96626 1.57352 6.06194C1.59656 5.60882 1.62344 5.11154 1.65224 4.54514C1.66952 4.26098 1.68872 3.95954 1.70984 3.6389C1.72136 3.47762 1.7348 3.31058 1.74632 3.1397C1.7636 2.94578 1.78088 2.7461 1.79816 2.54066C1.83464 2.18546 1.87496 1.83794 1.94408 1.6037C2.02664 1.37906 2.10344 1.25234 2.1092 1.23122C2.14184 1.18322 2.1764 1.13714 2.21672 1.09298L2.23208 1.0757C2.23208 1.0757 2.2244 1.06226 2.24552 1.08146L2.25704 1.06994L2.2916 1.0373L2.3588 0.975856C2.45096 0.902896 2.55464 0.852976 2.66792 0.812656C2.89064 0.730096 3.14792 0.705136 3.39944 0.691696C3.52616 0.684016 3.65288 0.680176 3.77768 0.680176C3.88136 0.680176 3.98312 0.680176 4.08296 0.680176C4.21928 0.682096 4.35176 0.684016 4.4804 0.685936C4.98536 0.699376 5.43656 0.710896 5.85128 0.722416C6.67304 0.745456 7.35656 0.766576 8.0516 0.785776C9.43785 0.824176 10.8682 0.862576 13.5486 0.937456C16.4247 1.01426 17.8647 1.03154 19.3028 1.05266C20.7428 1.06994 22.1809 1.08722 25.0609 1.0949C27.939 1.09874 29.379 1.11794 30.819 1.14098C32.259 1.16018 33.699 1.1813 36.5809 1.1333C37.4007 1.11986 38.1034 1.10066 38.7198 1.07954C39.0462 1.06802 39.3476 1.0565 39.6318 1.04498C40.1214 1.00274 40.5706 1.17362 40.8913 1.46354C41.0276 1.57298 41.1601 1.6805 41.2887 1.78418C41.402 1.87442 41.5134 1.96274 41.6209 2.04914C41.8378 2.22002 42.0471 2.38322 42.2526 2.5445C42.6634 2.86706 43.0628 3.18002 43.5025 3.52562C44.3799 4.22066 45.409 5.05586 46.9796 6.39602C51.3706 10.1381 51.2362 10.2975 55.6273 14.0395C56.7255 14.9746 57.5569 15.6696 58.2519 16.2418C58.6014 16.5259 58.9162 16.7832 59.2138 17.0251C59.306 17.1 59.3982 17.1749 59.4884 17.2479C59.6266 17.3573 59.7534 17.4725 59.8532 17.605C60.0567 17.8699 60.1834 18.1944 60.2007 18.5247C60.2218 18.6859 60.193 18.8683 60.1911 19.0277C60.1873 19.1179 60.1834 19.2082 60.1796 19.2984C60.1719 19.4808 60.1642 19.6651 60.1585 19.8571C60.1431 20.2392 60.1258 20.6424 60.1066 21.0917C60.0606 21.9903 60.0068 23.0674 59.9338 24.5055C59.7783 27.3778 59.6823 28.8139 59.5882 30.2482C59.4961 31.6824 59.402 33.1205 59.3444 35.9909C59.2926 38.8613 59.3079 40.2936 59.2964 41.7355C59.2964 43.1755 59.2964 44.6155 59.3482 47.4994C59.4634 53.2671 59.713 53.2613 59.857 59.029C60.0106 64.7967 59.9377 64.7986 60.1066 70.5643C60.1124 70.7506 60.1182 70.9311 60.122 71.1058C60.1239 71.2075 60.1278 71.3266 60.1278 71.4111C60.1278 71.4936 60.1239 71.5743 60.122 71.653C60.1143 71.9698 60.1086 72.2693 60.1028 72.5496C60.0874 73.1122 60.0759 73.6056 60.0644 74.0549C60.0356 74.9535 60.0106 75.6735 59.9876 76.3915C59.9626 77.1307 59.9396 77.8699 59.9089 78.7954C59.9012 79.0027 59.9089 79.2235 59.8724 79.4309C59.8359 79.6363 59.7745 79.8264 59.6631 80.0146C59.4519 80.3851 59.0602 80.6962 58.5975 80.7999C58.369 80.8594 58.0926 80.8498 57.818 80.8421C57.6394 80.8383 57.4532 80.8325 57.2631 80.8287C56.9444 80.8191 56.6046 80.8095 56.2436 80.7999C53.3617 80.7058 51.9198 80.6597 50.4778 80.6117C49.0378 80.5618 47.5978 80.5138 44.7198 80.4792C41.8398 80.4466 40.3998 80.4927 38.9617 80.5349C37.5236 80.5829 36.0836 80.629 33.2094 80.6866C31.7732 80.7231 30.6961 80.7499 29.7994 80.7883C28.9028 80.8229 28.1847 80.8479 27.4666 80.8882C26.7466 80.9247 26.0286 80.9592 25.13 81.0034C24.2142 81.0495 23.1255 81.0821 21.674 81.109C18.7748 81.1551 17.329 81.1224 15.8833 81.0975C14.4375 81.0706 12.9918 81.0399 10.1022 81.0149C8.30696 80.9957 7.07048 80.9823 6.00296 80.9707C5.4692 80.9631 4.97768 80.9573 4.4804 80.9496C3.85256 80.9381 3.21896 80.9266 2.51624 80.9131C2.3588 80.8632 2.18792 80.8075 2.00552 80.748C1.91336 80.7115 1.81352 80.7077 1.73672 80.6213C1.65608 80.5483 1.5908 80.4677 1.53128 80.3736C1.41224 80.1874 1.32584 79.9416 1.274 79.6555C1.24712 79.5135 1.226 79.3618 1.20872 79.2043C1.20104 79.1256 1.19336 79.045 1.18568 78.9643C1.17992 78.901 1.17608 78.8376 1.17032 78.7723C1.11656 78.0101 1.09736 77.1096 1.09928 75.9979C1.06856 70.2379 1.17416 70.2283 1.14152 64.4587C1.10696 58.6853 0.863124 58.6853 0.826644 52.9119C0.801044 49.0655 0.774804 45.2184 0.747924 41.3707C0.713364 35.5954 0.847764 35.5954 0.811284 29.82C0.801684 26.9304 0.795924 25.4847 0.792084 24.0408C0.792084 23.6799 0.792084 23.3189 0.792084 22.9349C0.792084 22.7371 0.792084 22.5336 0.792084 22.3205C0.805524 22.0959 0.817044 21.8635 0.830484 21.6178C0.880404 20.7173 0.939924 19.6363 1.02056 18.1944C1.3316 12.4287 1.39112 12.4325 1.70216 6.66674C1.94216 2.21618 2.3396 2.08754 2.93672 2.12018C3.53384 2.15282 4.10216 2.33138 3.86216 6.79154C3.55112 12.5592 3.46856 12.5535 3.1556 18.3211C3.07688 19.7631 3.00968 20.8421 2.94632 21.7426C2.93864 21.8559 2.93096 21.9653 2.92328 22.0728C2.91944 22.1266 2.9156 22.1803 2.91176 22.2322L2.906 22.3109V22.3493L2.90216 22.3685C2.98856 22.3762 2.1476 22.3147 2.5028 22.3416V22.3493C2.68136 22.3493 2.10536 22.3493 2.90216 22.3493V22.4626C2.90216 22.5125 2.90024 22.5624 2.89832 22.6123C2.89832 22.7122 2.89448 22.8082 2.89448 22.9042C2.8868 23.2863 2.88104 23.6472 2.87336 24.0082C2.84456 25.4501 2.81576 26.892 2.83304 29.7759C2.8676 35.5474 2.98856 35.5455 3.02504 41.317C3.0596 47.0866 3.12488 47.0866 3.15944 52.8543C3.17736 56.7007 3.19528 60.5477 3.2132 64.3954C3.23112 68.2431 3.24264 72.092 3.24776 75.9423C3.24392 76.9599 3.25736 77.7931 3.29 78.4728C3.29384 78.5477 3.29768 78.6187 3.30152 78.6898V78.7186C3.30152 78.7378 3.30152 78.757 3.30152 78.7762C3.30344 78.7915 3.30152 78.8223 3.32072 78.8223C3.33608 78.8261 3.35144 78.828 3.3668 78.8319C3.38408 78.8357 3.39944 78.8376 3.4148 78.8395H3.43592L3.52808 78.8453C3.58952 78.8472 3.64904 78.8511 3.71048 78.853C3.95048 78.8626 4.18664 78.8722 4.4228 78.8818C4.89512 78.8991 5.36936 78.9163 5.89544 78.9355C6.9476 78.9701 8.20328 79.0008 10.0522 79.0181C12.9342 79.0431 14.3742 79.0258 15.8142 79.0047C17.2522 78.9835 18.6903 78.9643 21.5665 78.9221C23.0007 78.8933 24.0759 78.8568 24.963 78.7992C25.8519 78.7474 26.5854 78.6917 27.3054 78.6399C28.0292 78.5842 28.7511 78.54 29.6554 78.4939C30.5598 78.444 31.6465 78.4075 33.0942 78.3711C35.9914 78.3115 37.441 78.3634 38.8887 78.4114C40.3364 78.4671 41.7841 78.517 44.6775 78.5496C47.569 78.5842 49.0167 78.5592 50.4625 78.5343C51.9082 78.5074 53.3578 78.492 56.2398 78.5746C56.5988 78.5861 56.9367 78.5957 57.2535 78.6053C57.3994 78.6091 57.5396 78.613 57.6778 78.6187L57.6817 78.6226C57.6817 78.6226 57.7047 78.6303 57.7143 78.6168C57.7604 77.7682 57.7988 77.0885 57.8353 76.4088C57.8775 75.6869 57.9198 74.9631 57.9601 74.0607C57.9754 73.6095 57.9946 73.1122 58.0138 72.5477C58.0215 72.2655 58.0292 71.9659 58.0388 71.6472C58.0522 71.292 58.0388 71.0904 58.0273 70.693C57.8564 64.9215 57.7566 64.9234 57.603 59.1499C57.459 53.3746 57.3303 53.3784 57.2151 47.6011C57.1614 44.7135 57.2074 43.2658 57.2516 41.82C57.3092 40.3743 57.338 38.9227 57.3879 36.0235C57.4436 33.1282 57.4705 31.6786 57.4993 30.2309C57.5281 28.7832 57.555 27.3355 57.7124 24.4459C57.8602 21.6485 57.9351 20.2488 58.01 18.8511C58.01 18.8376 58.0023 18.8261 57.9927 18.8165C57.987 18.8127 57.9812 18.8088 57.9754 18.8069L57.9678 18.8031L57.8602 18.7147C57.5665 18.469 57.2535 18.2098 56.9079 17.9218C56.2186 17.34 55.393 16.6411 54.291 15.7099C49.898 11.9659 49.9767 11.8738 45.5838 8.12978C44.0036 6.78194 42.9994 5.91026 42.1527 5.16914C41.3233 4.43954 40.6455 3.84434 39.7182 3.02834C39.6874 2.98994 39.6375 2.9669 39.5818 2.97266C39.3342 2.9765 39.0692 2.97842 38.785 2.98226C38.1745 2.99186 37.4775 3.00338 36.6673 3.01682C33.7796 3.06482 32.3338 3.1397 30.89 3.2165C29.4462 3.28946 28.0004 3.36434 25.1089 3.36242C22.2154 3.35666 20.7678 3.32786 19.3201 3.29714C17.8724 3.26258 16.4247 3.22802 13.5294 3.1589C10.8241 3.08402 9.38216 3.01298 7.98824 2.94386C7.2932 2.9093 6.60776 2.87474 5.78216 2.83442C5.37128 2.81522 4.92584 2.79602 4.43432 2.78066C4.28072 2.77682 4.11944 2.77298 3.94664 2.76914C3.9332 2.76914 3.91976 2.76914 3.90632 2.76914C3.89288 2.76914 3.87368 2.76914 3.87368 2.78834C3.87368 2.78834 3.866 2.82482 3.86408 2.8613C3.8372 3.18194 3.81416 3.48338 3.79112 3.76754C3.77 4.08242 3.74888 4.3781 3.72968 4.6565C3.6932 5.21714 3.66248 5.70866 3.63368 6.15602C3.578 7.05458 3.53192 7.77266 3.48776 8.49266C3.39944 9.93266 3.31496 11.3727 3.20168 14.2565C3.03272 18.7109 2.63336 18.9951 2.0324 18.9759C1.4372 18.9567 1.1108 18.6456 1.27976 14.1835V14.1874Z",className:"fill-[#141413] dark:fill-[#FAF9F5]"}),(0,a.jsx)("path",{d:"M57.9159 19.4885C56.1246 19.5269 56.1226 19.3771 54.3313 19.4155C52.5399 19.4539 52.538 19.4021 50.7466 19.4405C48.9553 19.4789 48.9591 19.6325 47.1678 19.6709C45.3764 19.7093 45.3783 19.7727 43.587 19.8111C42.6903 19.8303 42.241 19.7823 41.7918 19.7323L41.7495 19.7285C41.7342 19.7285 41.7265 19.7247 41.6958 19.7247C41.642 19.7227 41.5902 19.7189 41.5364 19.717C41.4308 19.7112 41.3233 19.7112 41.2158 19.6997C40.9988 19.6805 40.7953 19.6287 40.5822 19.525C40.1674 19.3176 39.699 18.8607 39.6721 18.0715C39.6606 17.7797 39.6529 17.5263 39.6433 17.2978C39.6337 17.1231 39.626 16.9695 39.6202 16.8293C39.601 16.549 39.5857 16.3263 39.5722 16.1035C39.5396 15.6562 39.507 15.2088 39.4782 14.3141C39.4308 13.1199 39.3834 11.9256 39.3361 10.7314C39.2785 8.9381 39.3706 8.93426 39.313 7.1429C39.2554 5.35154 39.1575 5.35346 39.0999 3.56018C39.0577 2.23538 39.4839 2.04338 40.0446 2.0261C40.6052 2.00882 40.9662 2.17394 41.0103 3.49874C41.0679 5.28818 41.2599 5.28242 41.3175 7.07186C41.3751 8.86322 41.1601 8.86898 41.2196 10.6603C41.2791 12.4517 41.2388 12.4517 41.2983 14.2431C41.3271 15.1378 41.4001 15.5851 41.473 16.0306C41.5095 16.2533 41.546 16.476 41.5767 16.7563C41.5921 16.8965 41.6055 17.0501 41.619 17.2248C41.6305 17.3746 41.6439 17.6914 41.642 17.6127C41.642 17.628 41.6362 17.6491 41.642 17.6703C41.6458 17.6818 41.6516 17.6895 41.6593 17.701C41.6631 17.7067 41.667 17.7106 41.6727 17.7163C41.6823 17.7221 41.665 17.7279 41.7418 17.7317C42.1911 17.7663 42.6404 17.8008 43.5351 17.7816C44.7294 17.7624 45.9236 17.7426 47.1178 17.7221C48.3121 17.7016 49.507 17.6677 50.7025 17.6203C52.4958 17.5819 52.4919 17.4187 54.2871 17.3803C56.0804 17.3419 56.0804 17.2959 57.8737 17.2555C59.1985 17.2267 59.1294 17.7989 59.1409 18.3576C59.1524 18.9163 59.2446 19.4635 57.9217 19.4923L57.9159 19.4885Z",className:"fill-[#141413] dark:fill-[#FAF9F5]"})]})}var P=s(85239),B=s(78458),G=s(4262),W=s(46879),J=s(11727),V=s(79383),H=s(57820),q=s(49953),Y=s(29820);let K=e=>{let{artifactType:t}=e;return t===x.qK.Excel||t===x.qK.ExcelLegacy?(0,a.jsxs)("div",{className:"absolute inset-0 z-20 text-xs p-2 inline-flex items-center gap-2 bg-accent-secondary-900 text-accent-secondary-200 max-h-12 w-full",children:[(0,a.jsx)(c.R2,{className:"inline flex-shrink-0 mx-2"}),(0,a.jsx)("span",{className:"line-clamp-2",children:(0,a.jsx)(M.A,{defaultMessage:"Some formatting is not supported by the preview and may not be displayed. Download the file to view all formatting.",id:"pkwiJU5tFY"})})]}):null},X=e=>{let{content:t,language:s,type:n,showRaw:i=!1,richSandboxRef:l,onSandboxConfirmation:r,richSandboxCapabilities:o,fileName:d,onRefresh:c,mimeType:u}=e,[m,f]=(0,k.useState)(null),[h,g]=(0,k.useState)(!0),[v,j]=(0,k.useState)(!1);k.useEffect(()=>{t&&"rich"===n&&!v&&g(!0)},[t,n,v]);let b=(0,k.useCallback)((e,t)=>{if("json"===t&&e)try{let t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(e){}return e},[]),y=(0,k.useCallback)(e=>{f({error:e,artifactId:d||"file",artifactVersion:0})},[d]),w=(0,k.useCallback)(()=>{f(null)},[]),_=(0,k.useCallback)(()=>{f(null),null==c||c()},[c]),C=(0,k.useRef)(null),M=u||("rich"===n?x.vU.Html:void 0),N="rich"===n&&!i&&void 0!==t&&void 0!==M;return(0,a.jsxs)(a.Fragment,{children:[N&&(0,a.jsxs)("div",{className:"h-full w-full relative border-none",children:[h&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-bg-100 z-20",children:(0,a.jsx)(p.Loading,{size:"md"})}),(0,a.jsx)(W.A,{ref:l,className:"h-full w-full border-none bg-bg-100",content:t,type:M,onSandboxConfirmation:()=>{g(!1),j(!0),null==r||r()},capabilities:o,onReportError:y,onSetContent:w,onRefresh:_,externalLinkBehavior:"ask"}),!h&&(0,a.jsx)(K,{artifactType:M}),m&&(0,a.jsx)(G.i,{error:m,handleClose:()=>f(null),isStreaming:!1})]}),void 0!==t&&"string"==typeof t&&("code"===n||i)&&(0,a.jsx)(q.Z,{ref:C,className:"relative flex w-full flex-1 overflow-x-auto overflow-y-scroll min-h-full",children:(0,a.jsx)("div",{tabIndex:0,id:"wiggle-file-content",className:"markdown"!==s&&"plaintext"!==s||i?"":"mx-auto w-full max-w-3xl leading-[1.65rem] px-6 py-4 md:py-6 md:px-11",children:"markdown"!==s||i?(0,a.jsx)($,{content:b(t,s),language:s,showLineNumbers:"plaintext"!==s,wrapLongLines:"plaintext"===s}):(0,a.jsx)(V.fP,{text:t,className:"font-claude-response"})})})]})},$=e=>{let{content:t,language:s,showLineNumbers:n,wrapLongLines:i}=e,{codeStyle:l}=(0,H.V)();return(0,a.jsx)(Y.A,{className:"code-block__code !my-0 flex-1 w-fit min-w-full !rounded-none !text-sm !leading-relaxed [&_.linenumber]:!not-italic",language:s,PreTag:"div",style:l,renderer:J.G,showLineNumbers:n,wrapLongLines:i,lineNumberStyle:{opacity:.667,minWidth:"2.5rem"},children:t})};var Z=s(10304);let Q=()=>(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(p.Loading,{size:"md"})}),ee=e=>{let{error:t,onRetry:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-text-300 gap-4",children:[(0,a.jsx)("div",{children:t}),(0,a.jsx)(u.$,{variant:"secondary",size:"sm",onClick:s,children:(0,a.jsx)(M.A,{defaultMessage:"Try again",id:"FazwRldA7z"})})]})},et=e=>{let{onLoad:t}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-text-300 gap-4",children:[(0,a.jsx)(M.A,{defaultMessage:"No file content available",id:"H8DU08sy24"}),(0,a.jsx)(u.$,{variant:"secondary",size:"sm",onClick:t,children:(0,a.jsx)(M.A,{defaultMessage:"Load file",id:"xvpw6mFG1S"})})]})},es=e=>{let{imageUrl:t,fileName:s}=e;return(0,a.jsx)("div",{className:"h-full p-5",children:(0,a.jsx)("div",{className:"flex items-center justify-center h-full relative w-full",children:(0,a.jsx)(C.default,{src:t,alt:s,fill:!0,className:"object-contain"})})})},ea=2500,en=e=>{var t,s,p,C,D,G;let{file:W,goBack:J,onClose:V,isShared:H,projectUuid:q,isTemporary:Y,isStreaming:K,showBackButton:$,streamingFile:en,artifactVersions:el,cacheBuster:er}=e,eo=H?e.snapshotUuid:e.conversationUuid,[ed,ec]=(0,k.useState)(""),[eu,em]=(0,k.useState)(!1),[ep,ef]=(0,k.useState)(!1),[eh,eg]=(0,k.useState)(null),[ex,ev]=(0,k.useState)(!1),[ej,eb]=(0,k.useState)(!1),[ey,ew]=(0,k.useState)(null),[e_,eC]=(0,k.useState)(null),[ek,eM]=(0,k.useState)("normal"),{activeOrganization:eN}=(0,r.YL)(),{copyToClipboard:eS}=(0,g.C)(),{addSuccess:eA,addError:eE}=(0,o.Y)(),ez=(0,i.st)(),eT=(0,k.useRef)(null),eI=(0,N.A)(),eU=W.path.split("/").pop()||W.path,eL=(null==en?void 0:en.renderAs)===x.vU.Markdown?"markdown":(0,O.S)(W.path),eR=(0,n.f)(),eO=(0,k.useMemo)(()=>({claudeComplete:eR,storage:{}}),[eR]),[eF,eD]=(0,k.useState)(!1),[eP,eB]=(0,k.useState)(!1),[eG,eW]=(0,k.useState)(!1),eJ=(0,r.mV)(),eV=(0,A.fo)(q),eH=(0,k.useMemo)(()=>eu?new Blob([ed]).size<1e6:null,[eu,ed]),eq=(0,k.useMemo)(()=>{if(ed&&eu&&"string"==typeof ed)return null==el?void 0:el.find(e=>e.result_state===ed)},[el,ed,eu]),eY=!Y&&"conversationUuid"in e&&e.conversationUuid&&ed&&!K&&eu&&eH,eK=(0,S.O)({conversationUuid:"conversationUuid"in e?e.conversationUuid:void 0}),eX=Y||H?null:eJ?"share":"publish",{publishedArtifactsBaseUrl:e$,publishedArtifactsEmbedBaseUrl:eZ}=(0,l._r)(),eQ=(null==(t=eK.data)?void 0:t.published_artifact_uuid)?"".concat(eZ,"/public/artifacts/").concat(null==(s=eK.data)?void 0:s.published_artifact_uuid,"/embed"):null,e0=(null==(p=eK.data)?void 0:p.published_artifact_uuid)||(null==eq||null==(C=eq.published_artifact_uuid)?void 0:C.toString()),e1=(0,k.useMemo)(()=>eX?eK.data?(0,Z.x)(eX,eK.data,e$):eq?(0,Z.x)(eX,{artifact_uuid:eq.artifact_uuid,artifact_version_uuid:eq.uuid,message_uuid:eq.message_uuid,published_artifact_uuid:eq.published_artifact_uuid},e$):void 0:null,[eX,eK.data,e$,eq]),{handleProjectFileUpload:e2}=(0,z.IE)({projectUuid:q,onError:()=>{eE(eI.formatMessage({defaultMessage:"Error adding file to project",id:"807qgLdlHv"}))},onSuccess:()=>{eA(eI.formatMessage({defaultMessage:"File added to project",id:"aXguBORPUO"}))}}),e3=(0,z.ED)(q),{maxKbTokens:e4}=(0,z.AO)(),e6=(0,x.mL)(W.path,eL),e5=/\.(png|jpg|jpeg|gif|bmp|webp)$/i.test(W.path),e8=e6===x.vU.Svg,e7=e6===x.vU.Html,e9=e6===x.vU.React,te=e6===x.vU.Mermaid,tt=e6===x.qK.Pdf,ts=e6===x.vU.Markdown,ta=e6===x.qK.Csv,tn=e6===x.qK.Tsv,ti=!!e6&&(0,x.EJ)(e6),tl=!!e6&&(0,x.$1)(e6),tr=(0,k.useMemo)(()=>null!==e_&&!eu&&!eh&&!(0,x.IO)(W.path),[e_,eu,eh,W.path]),to=e7||e8||e9||te||tt||ti||tl||ta||tn,td=eu&&(ts||e7||e8||e9||te||ta||tn),tc=(0,P.z)(W.path),tu=("markdown"===eL||"plaintext"===eL)&&eu,tm=ed&&eu,tp=(e=>{let[t,s]=(0,k.useState)("");return(0,k.useEffect)(()=>{if(!e)return void s("");let t=()=>{let t=_.c9.fromJSDate(e).toISO();if(!t)return void s("");s((0,v.d)(t)||"")};t();let a=setInterval(t,6e4);return()=>clearInterval(a)},[e]),t})(e_),tf=(0,k.useMemo)(()=>(0,B.k)({filePath:W.path,isShared:H,conversationUuid:H?void 0:eo,snapshotUuid:H?eo:void 0,source:"file_detail_view"}),[W.path,H,eo]),th=(0,k.useCallback)(async()=>{if(!(null==eN?void 0:eN.uuid))return void ew(eI.formatMessage({defaultMessage:"Unable to load file content",id:"0IswH+G61x"}));if(!(0,x.IO)(W.path)){ec(""),em(!1),eg(null),eb(!1),ef(!1),ew(null),eC(new Date);return}eb(!0),ew(null);try{let e=W.path.replace("computer://",""),t=await (0,E.e)(H?{organizationUuid:eN.uuid,snapshotUuid:eo,filePath:e,isShared:!0}:{organizationUuid:eN.uuid,conversationUuid:eo,filePath:e,isShared:!1});if(e5){let e=await t.blob(),s=URL.createObjectURL(e);eg(s),ec(""),em(!1)}else if(tt||ti||tl){let e=await t.blob(),s=await e.arrayBuffer();ec(s),em(!1),eg(null)}else{let e=await t.text();ec(e),em(!0),eg(null)}ew(null),eC(new Date)}catch(e){ew(eI.formatMessage({defaultMessage:"Failed to load file content",id:"6u3/Jh2Vzp"}))}finally{ef(!1),eb(!1)}},[null==eN?void 0:eN.uuid,W.path,eI,e5,tt,ti,tl,H,eo]);(0,k.useEffect)(()=>{eM("normal")},[W.path]),(0,k.useEffect)(()=>{(null==en?void 0:en.content)!==void 0?(ec(en.content),em(!0),eb(!1),ew(null),eC(new Date)):th()},[th,null==en?void 0:en.content,W.path]);let tg=(0,j.Y)(th,{leading:!1,delay:ea});(0,k.useEffect)(()=>{(0,x.IO)(W.path)&&ef(!0),tg()},[tg,er,null==en?void 0:en.content,W.path]),(0,k.useEffect)(()=>()=>{eh&&URL.revokeObjectURL(eh)},[eh]);let tx=()=>{(null==eN?void 0:eN.uuid)&&(0,L.J)(H?{filepath:W.path,orgUuid:eN.uuid,snapshotUuid:eo,isShared:!0,source:"file_detail_view_header_button"}:{filepath:W.path,orgUuid:eN.uuid,conversationUuid:eo,isShared:!1,source:"file_detail_view_header_button"},ez)},tv=async()=>{e5||"string"!=typeof ed||(ez.track({event_key:"wiggle.file.copy_to_clipboard",...tf}),await eS(ed),ev(!0),setTimeout(()=>ev(!1),2e3))},tj=async t=>{let{operation:s}=t;if(e.isShared)return;let a=await eK.mutateAsync({path:W.path,operation:s}),n=(0,Z.x)(s,a,e$);n&&await eS(n)},tb=(0,k.useCallback)(async()=>{ez.track({event_key:"wiggle.file.add_to_project",...tf}),eW(!0);try{let e=new File([ed],eU);await e2([e],e4-(null!=e3?e3:0))}finally{eW(!1)}},[ed,eU,e2,e4,e3,ez,tf]),{displayName:ty,displayExt:tw}=(0,F.FT)(W);return(0,a.jsxs)("div",{className:"flex h-full flex-col relative",children:[(0,a.jsx)(a.Fragment,{children:"share"===eX?(0,a.jsx)(T.ke,{isOpen:eF,isProjectArtifact:!!(null==(D=eV.data)?void 0:D.is_private),isLoading:eK.isPending,sharedLink:e1||"",isShared:!!eK.data||(null==eq?void 0:eq.visibility)==="shared",onClose:()=>eD(!1),handleClickShareButton:()=>void tj({operation:"share"}),updateSharedState:()=>void 0}):"publish"===eX?(0,a.jsxs)(f.aF,{hasCloseButton:!0,modalSize:"lg",isOpen:eF,onClose:()=>{eD(!1),eB(!1)},title:(0,a.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:(0,a.jsx)(M.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"})}),children:[(0,a.jsx)("div",{className:"mt-2 flex flex-col gap-2.5",children:eP&&e0&&eQ?(0,a.jsx)(I.Hz,{artifactUuid:e0,closeEmbedSettings:()=>eB(!1),embedLink:eQ}):e0?(0,a.jsx)(I.L_,{artifactUuid:e0,publishedLink:e1||"",onClose:()=>eD(!1)}):(0,a.jsx)(I._L,{title:eU,isLoading:eK.isPending,fetchScreenshot:()=>Promise.resolve(),setScreenshot:()=>void 0,handlePublishArtifact:()=>{tj({operation:"publish"})}})}),(0,a.jsx)(I.gy,{isPublished:!!(null==(G=eK.data)?void 0:G.published_artifact_uuid),isEmbedSettingsOpen:eP,onOpen:()=>eB(!0)})]}):null}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-2 py-2 bg-bg-000 gap-2",children:[$?(0,a.jsx)(u.$,{variant:"ghost",size:"icon",onClick:J,disabled:!!en,"aria-label":eI.formatMessage({defaultMessage:"Go back",id:"orvpWhO3rI"}),className:"!rounded-lg",children:(0,a.jsx)(c.ZK,{})}):(0,a.jsx)("div",{className:"w-2",children:"\xa0"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1 overflow-hidden",children:[td&&(0,a.jsx)(d.Iz,{options:[{key:"normal",label:(0,a.jsx)(c.kU,{size:20}),ariaLabel:eI.formatMessage({defaultMessage:"Preview",id:"TJo5E6JuIN"})},{key:"raw",label:(0,a.jsx)(c.Cy,{size:20}),ariaLabel:eI.formatMessage({defaultMessage:"Code",id:"h2vipunVVd"})}],initialKey:ek,onSelect:e=>{eM("normal"===e?"normal":"raw")},itemClassName:"!px-1"},ek),(0,a.jsxs)("h2",{className:(0,b.A)("text-sm font-normal text-text-200 truncate flex-1 min-w-0"),title:ty,children:[ty,tw?(0,a.jsx)("span",{className:"text-text-400 opacity-50",children:" \xb7 "}):"",tw&&(0,a.jsx)("span",{className:"text-text-400",children:tw})]}),(0,a.jsx)(y.N,{children:ex&&(0,a.jsxs)(w.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{enter:{duration:.4,ease:"easeOut"},exit:{duration:.3,ease:"easeIn"}},className:"flex items-center gap-1 text-sm text-success-200 ml-2 mr-3 flex-shrink-0",children:[(0,a.jsx)(c.rA,{size:16,className:"text-success-200"}),(0,a.jsx)("span",{className:"text-success-200",children:(0,a.jsx)(M.A,{defaultMessage:"Copied",id:"p556q3uvbn"})})]})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[tc&&!H&&e.conversationUuid&&(0,a.jsx)(R.M,{file:W,conversationUuid:e.conversationUuid,source:"file_detail_view",variant:"secondary",size:"icon_sm",className:"!rounded-lg"}),eu||q||tu||tm?(0,a.jsx)("div",{className:"[&_button]:!text-xs [&>div]:!rounded-lg",children:(0,a.jsxs)(m.AM,{mainButtonText:(0,a.jsx)(M.A,{defaultMessage:"Download",id:"5q3qC0sC3r"}),onClickMainButton:tx,children:[eu&&(0,a.jsx)(m.tJ,{onSelect:tv,children:(0,a.jsx)(M.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},"copy"),q&&(0,a.jsx)(m.tJ,{onSelect:tb,disabled:eG||!ed,children:(0,a.jsx)(M.A,{defaultMessage:"Add to project",id:"+mqxxzVczn"})},"addToProject"),tu&&(0,a.jsx)(m.tJ,{onSelect:async()=>{ez.track({event_key:"wiggle.file.download_as_pdf",...tf});try{await (0,U.NX)(W)}catch(e){ew(eI.formatMessage({defaultMessage:"Error downloading PDF",id:"fes7nfwp3b"}))}},children:(0,a.jsx)(M.A,{defaultMessage:"Download as PDF",id:"camH0DLf91"})},"downloadAsPdf"),tm&&(0,a.jsx)(m.tJ,{disabled:!eY,onSelect:()=>{ez.track({event_key:"share"===eX?"wiggle.file.share_artifact":"wiggle.file.publish_artifact",...tf}),eD(!0)},children:(0,a.jsxs)("div",{className:"flex flex-col",children:["share"===eX?(0,a.jsx)(M.A,{defaultMessage:"Share artifact",id:"FeSSOL+/49"}):(0,a.jsx)(M.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"}),(0,a.jsxs)("span",{className:"text-text-300 text-xs",children:[eq&&eX&&("share"===eX?(0,a.jsx)(M.A,{defaultMessage:"Content already shared",id:"nTW7eXdjH7"}):(0,a.jsx)(M.A,{defaultMessage:"Content already published",id:"h9MXOgEjET"})),!(eq&&eX)&&!eH&&(0,a.jsx)(M.A,{defaultMessage:"File is too large",id:"uFwMw7Ndmt"})]})]})},(null!=eX?eX:"")+"-"+W.path)]})}):(0,a.jsx)(u.$,{variant:"secondary",onClick:tx,size:"sm",className:"!rounded-lg",children:(0,a.jsx)(M.A,{defaultMessage:"Download",id:"5q3qC0sC3r"})}),(0,a.jsx)(h.Tooltip,{tooltipContent:ep||ej?eI.formatMessage({defaultMessage:"Refreshing",id:"crQQNCV/SV"}):tp?eI.formatMessage({defaultMessage:"Last refreshed {time}",id:"qVxqSOlF4R"},{time:tp}):void 0,delayDuration:50,children:(0,a.jsx)(u.$,{variant:"ghost",size:"icon",onClick:th,disabled:ej||tr,children:(0,a.jsx)(c.Mv,{size:20,className:(0,b.A)((ep||ej)&&"animate-spin")})})}),(0,a.jsx)(u.$,{variant:"ghost",size:"icon",onClick:V,children:(0,a.jsx)(c.X,{size:20})})]})]}),(0,a.jsx)("div",{className:"flex-1 min-h-0 bg-bg-000 overflow-auto",children:!ej||ed||eh?ey?(0,a.jsx)(ee,{error:ey,onRetry:th}):tr?(0,a.jsx)(ei,{file:W}):ed||eh?e5&&eh?(0,a.jsx)(es,{imageUrl:eh,fileName:eU}):(0,a.jsx)("div",{className:"h-full",children:(0,a.jsx)(X,{content:ed,type:to?"rich":"code",language:eL,showRaw:"raw"===ek,richSandboxRef:eT,richSandboxCapabilities:eO,fileName:eU,onRefresh:th,mimeType:e6})}):(0,a.jsx)(et,{onLoad:th}):(0,a.jsx)(Q,{})})]})},ei=e=>{let{file:t}=e,{displayName:s}=(0,F.FT)(t),n=(0,F.Xp)(t);return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(D,{})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-text-100 font-medium text-lg",children:s}),(0,a.jsx)("div",{className:"text-text-300 text-sm",children:n})]}),(0,a.jsx)("div",{className:"text-text-300",children:(0,a.jsx)(M.A,{defaultMessage:"No preview available",id:"vYALkaFo+6"})})]})}},44e3:(e,t,s)=>{s.d(t,{F:()=>i});var a=s(87087);let n={sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)",xl:"(min-width: 1280px)","2xl":"(min-width: 1536px)"};function i(e){return(0,a.U)(n[e])}},45318:(e,t,s)=>{s.d(t,{z:()=>m});var a=s(2348),n=s(54568),i=s(59922),l=s(37541),r=s(28044),o=s(72902),d=s(91755);function c(){let e=(0,a._)(["\n  from-bg-100\n  via-bg-100\n  via-65%\n  to-bg-100/0\n  pointer-events-none\n  absolute\n  inset-0\n  -bottom-5\n  z-[-1]\n  bg-gradient-to-b\n  blur-sm\n"]);return c=function(){return e},e}let u=i.J.div(c());function m(e){let{children:t,className:s,contentClassName:a,sticky:i,fixed:c,mdTitle:m,large:p,narrow:f}=e,{isMobile:h,isExpanded:g}=(0,d.V)(),x=(0,r.V)(l.E_),v=!t&&!m,j=p&&!x;return(0,n.jsxs)("header",{className:(0,o.A)("flex w-full bg-bg-100",i&&"sticky top-0 z-header",c&&"fixed top-0 z-header",x?l.X_:"h-12",x&&[!g&&"pl-[133px]",!v&&l.zo],j&&["mx-auto md:h-24 md:items-end",f?"max-w-4xl":"max-w-7xl"],s),"aria-hidden":v,"data-testid":"page-header",children:[!x&&(i||c)&&(0,n.jsx)(u,{}),(0,n.jsx)("div",{className:(0,o.A)("flex w-full items-center justify-between gap-4",x&&g&&"lg:px-4",!x&&"pl-11 lg:px-8",x&&!(h&&g)&&"draggable","",a,j?"px-4 md:px-8":"pr-3"),children:m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{className:(0,o.A)("text-text-200 flex items-center gap-2 text-center max-md:hidden min-w-0",x?"font-medium leading-tight":"font-heading",!x&&(j?"text-2xl":"text-lg")),children:(0,n.jsx)("span",{className:"truncate",children:m})}),(0,n.jsx)("div",{}),t]}):t})]})}},48321:(e,t,s)=>{s.d(t,{J:()=>n,y:()=>i});var a=s(78458);function n(e,t){let{filepath:s,orgUuid:n,source:i}=e,l=s.replace("computer://","");t.track({event_key:"wiggle.file.downloaded",...(0,a.k)({filePath:s,isShared:e.isShared,conversationUuid:e.isShared?void 0:e.conversationUuid,snapshotUuid:e.isShared?e.snapshotUuid:void 0,source:i})});let r=document.createElement("form");r.method="GET",r.action=e.isShared?"/api/organizations/".concat(n,"/snapshots/").concat(e.snapshotUuid,"/wiggle/download-file"):"/api/organizations/".concat(n,"/conversations/").concat(e.conversationUuid,"/wiggle/download-file"),r.style.display="none";let o=document.createElement("input");o.type="hidden",o.name="path",o.value=l,r.appendChild(o),document.body.appendChild(r),r.submit(),document.body.removeChild(r)}function i(e,t){let{filepaths:s,orgUuid:a,source:n}=e,i=s.map(e=>e.replace("computer://","")).filter(t=>!e.isShared||t.startsWith("/mnt/user-data/"));t.track({event_key:"wiggle.file.downloaded_all",file_count:i.length,is_snapshot:e.isShared,source:n,conversation_uuid:e.isShared?null:e.conversationUuid,snapshot_uuid:e.isShared?e.snapshotUuid:null});let l=document.createElement("form");l.method="GET",l.action=e.isShared?"/api/organizations/".concat(a,"/snapshots/").concat(e.snapshotUuid,"/wiggle/download-files"):"/api/organizations/".concat(a,"/conversations/").concat(e.conversationUuid,"/wiggle/download-files"),l.style.display="none",i.forEach(e=>{let t=document.createElement("input");t.type="hidden",t.name="paths",t.value=e,l.appendChild(t)}),document.body.appendChild(l),l.submit(),document.body.removeChild(l)}},48730:(e,t,s)=>{s.d(t,{A:()=>e_});var a=s(54568),n=s(68067),i=s(2e3),l=s(7620),r=s(79052),o=s(35391),d=s(98372),c=s(59666);let u=()=>(0,a.jsxs)("div",{className:"items-top flex w-full bg-bg-200 mt-5 p-3 rounded-xl items-center text-text-300",children:[(0,a.jsx)(d.R,{size:24}),(0,a.jsx)("p",{className:"font-base ml-3",children:(0,a.jsx)(c.A,{defaultMessage:"Claude has ended this chat.",id:"xJ+abA4nue"})})]});var m=s(19094),p=s(47592),f=s(95617),h=s(23132),g=s(24407),x=s(45271),v=s(99411);let j=g.z.object({url:g.z.string()}),b=e=>{let t,{input:s,toolResult:n,isStreaming:i}=e,r=null==n?void 0:n.is_error,[o,d]=(0,l.useState)(!1),u=(0,l.useMemo)(()=>{if(r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"knowledge"===e.type)){let t=[];for(let s of e.content)"knowledge"===s.type&&t.push(s);return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=f.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),g=(0,l.useMemo)(()=>{if(!r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"text"===e.type)){let t=[];for(let s of e.content)if("text"===s.type){let e=function(e){try{return JSON.parse(e)}catch(e){return null}}(s.text);if(null===e)t.push({error_type:"UNKNOWN_ERROR",error_message:s.text});else{let s=f.kS.safeParse(e);s.success&&t.push(s.data)}}return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=f.tD.safeParse(e);if(!t.success)return null;{let e=f.kS.safeParse(JSON.parse(t.data.text));return e.success?e.data:null}}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),b=function(e){switch(e){case"INVALID_URL":return(0,a.jsx)(c.A,{defaultMessage:"The URL provided is invalid",id:"EXjAXf5Pbi"});case"URL_NOT_FOUND":return(0,a.jsx)(c.A,{defaultMessage:"Could not find this URL",id:"stDgCXJO7F"});case"RATE_LIMIT_EXCEEDED":return(0,a.jsx)(c.A,{defaultMessage:"Access to this website has been restricted due to rate limits",id:"VhUxwIo+O2"});case"ROBOTS_DISALLOWED":return(0,a.jsx)(c.A,{defaultMessage:"This website has blocked Claude via robots.txt rules",id:"dHtmXRJ647"});case"URL_TOO_LONG":return(0,a.jsx)(c.A,{defaultMessage:"The URL provided is too long",id:"K2DBYJqbtF"});case"SITE_BLOCKED":return(0,a.jsx)(c.A,{defaultMessage:"Access to this website is blocked",id:"WI6DZStAoi"});case"PERMISSIONS_ERROR":return(0,a.jsx)(c.A,{defaultMessage:"The URL was not provided by the user nor was it contained in any web search/fetch results",id:"aXYLYDjU6L"});case"UNKNOWN_ERROR":case"SERVER_ERROR":case"CLIENT_ERROR":return(0,a.jsx)(c.A,{defaultMessage:"An unknown error occurred",id:"3VG8rbxa4v"});case void 0:return null}}(null==g?void 0:g.error_type),{data:y}=j.safeParse(s);if(!y)return;let w=y.url,_=(null==u?void 0:u.title)||w,C=(0,p.Nj)(w);return t=i?C?(0,a.jsx)(c.A,{defaultMessage:"Fetching from {hostname}",id:"5qKeNV67+8",values:{hostname:C}}):(0,a.jsx)(c.A,{defaultMessage:"Fetching from site",id:"TSZq9sKvY7"}):r?(0,a.jsx)(c.A,{defaultMessage:"Failed to fetch <b>{title}</b>",id:"8JHipUo6K+",values:{title:_,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}):(0,a.jsx)(c.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:_,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.aX,{isError:r,errorMessage:b,text:t,secondaryText:i?void 0:C,handleClick:()=>d(!0),icon:(0,a.jsx)(x.z,{size:16,type:"favicon",src:w,name:C||"Fetch",fallbackToGlobe:!0}),secondaryIcon:(0,a.jsx)(h.B,{size:16,className:"text-text-300"}),...e}),(0,a.jsx)(m.v,{isOpen:o,url:w,onClose:()=>d(!1),onConfirm:()=>{window.open(w,"_blank"),d(!1)}})]})};var y=s(71700),w=s(19298),_=s(9398),C=s(76579),k=s(61295),M=s(67149),N=s.n(M),S=s(10369),A=s(50571),E=s(22167),z=s(46868),T=s(72253);function I(e){return"webpage_metadata"===e.metadata.type?e.url||"":e.metadata.doc_uuid}let U=e=>{let{isExpanded:t,toolName:s,results:n}=e;return(null==n?void 0:n.length)?(0,a.jsx)("div",{className:"flex flex-nowrap p-2 pt-0 flex-col",tabIndex:-1,children:"web_search"===s?(0,a.jsx)(R,{results:n,isExpanded:t}):(0,a.jsx)(O,{results:n,isExpanded:t})}):null},L={initial:{opacity:0,scale:.7},animate:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:30,mass:1}}},R=e=>{let{isExpanded:t,results:s}=e;return(0,a.jsx)(a.Fragment,{children:s.map(e=>{var s;return e.knowledge&&"webpage_metadata"===e.knowledge.metadata.type?(0,a.jsx)(k.P.div,{variants:L,children:(0,a.jsx)(w.$,{disabled:!t,icon:(0,a.jsx)(y.d,{url:e.knowledge.metadata.favicon_url,size:16}),title:e.knowledge.title,subtitles:[e.knowledge.metadata.site_domain],url:null!=(s=e.knowledge.url)?s:void 0})},e.knowledge.url):null})})},O=e=>{let{isExpanded:t,results:s}=e;return(0,a.jsx)(a.Fragment,{children:s.map(e=>(0,a.jsx)(k.P.div,{variants:L,children:(0,a.jsx)(F,{disabled:!t,knowledge:e.knowledge})},e.uuid))})},F=e=>{let{disabled:t,knowledge:s}=e,{value:l}=(0,n.fS)("mcp_gdrive"),o=(e=>{let{isError:t}=e,s=(0,E.Cg)(i.v8.GDRIVE),a=s.isAuthenticated;return(0,A.v_)(s.server_uuid)?a?t?i.I5.ACCESS_DENIED:i.I5.READY:i.I5.UNAUTHENTICATED:i.I5.DISABLED})({isError:!s}),d=(e=>{let{isError:t}=e,{isDriveAuthenticated:s}=(0,r.cI)();return(0,r.yy)()?s?t?i.I5.ACCESS_DENIED:i.I5.READY:i.I5.UNAUTHENTICATED:i.I5.DISABLED})({isError:!s});return(0,a.jsx)(z.Tc,{syncSourceType:i.v8.GDRIVE,syncStatus:l?o:d,disabled:t,title:(null==s?void 0:s.title)||"Untitled document",subtitles:(null==s?void 0:s.metadata.type)==="google_doc_metadata"&&s.metadata.owner?[s.metadata.owner]:void 0,url:(null==s?void 0:s.url)||void 0})},D=g.z.object({query:g.z.string(),n:g.z.number().int().optional()}),P=e=>{var t;let{toolName:s,syncSourceType:n,...i}=e,{input:l,toolResult:r,isStreaming:o,groupItemKey:d}=i,{isExpanded:c,setIsExpanded:u,snappyTransition:m}=(0,T.a)(!1,d),p=(0,S.A)(),h=null==r?void 0:r.is_error,g=h?null:function(e){if(!e)return null;if(e.content.some(e=>"knowledge"===e.type||"rag_reference"===e.type)){let t=[];for(let s of e.content)if("knowledge"===s.type)t.push({uuid:I(s),knowledge:s});else if("rag_reference"===s.type){let e=s.doc_uuid;t.push({uuid:e})}return N()(t,e=>e.uuid)}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text),a=(Array.isArray(s)?s.map(e=>{let t=f.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]).map(e=>({uuid:I(e),knowledge:e}));return N()(a,e=>e.uuid)}catch(e){return[]}}(r),{data:x}=D.safeParse(l),j="web_search"===s?p.formatMessage({defaultMessage:"Searching the web",id:"5KajyzHSXj"}):p.formatMessage({defaultMessage:"Searching Google Drive",id:"V/QOi0yNF0"});if(!x)return;let b=p.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(t=null==g?void 0:g.length)?t:0}),y=!g&&o?j:x.query;return(0,a.jsx)(v.sH,{isExpandingDisabled:!!o,isExpanded:c,setIsExpanded:u,isError:h,text:y,secondaryText:o?void 0:b,icon:"web_search"===s?(0,a.jsx)(C.q,{size:16}):!!n&&(0,a.jsx)(_.A9,{type:n,size:14}),...i,children:(0,a.jsx)(v.NG,{isExpanded:c,snappyTransition:m,isScrollable:!0,children:!h&&!!(null==g?void 0:g.length)&&(0,a.jsx)(U,{isExpanded:c,toolName:s,results:g})})})};var B=s(57958),G=s(64328);g.z.object({prompt:g.z.string()});var W=s(787),J=s(69104),V=s(57291),H=s(72902),q=s(24423);function Y(e){var t,s,n,i;let{input:r,toolResult:o,isStreaming:d,isLastMessage:c,onOpenArtifact:u,message:m,artifactCellType:p,selectedArtifactId:f,selectedArtifactVersion:h,isFirstBlockOfMessage:g,isLastBlockOfMessage:x}=e,v=(0,l.useMemo)(()=>V.oE.parse(r),[r]),{versions:j,...b}=null!=(n=(0,q.ST)(null!=(s=v.id)?s:""))?n:{},y=(0,l.useMemo)(()=>{let e=null==j?void 0:j.findIndex(e=>e.uuid===v.version_uuid);if(-1!==e)return e},[j,v.version_uuid]),w=null==(t=null!=(i=v.content)?i:v.new_str)?void 0:t.slice(0,250),_=(0,l.useCallback)(e=>{u&&u(e,m.uuid,v.version_uuid)},[u,m.uuid,v.version_uuid]),C=(0,l.useMemo)(()=>({isClosed:void 0!==o,...b,...v}),[o,b,v]),k=f===C.id&&h===v.version_uuid,M="individual_cell_create"===p||"multi_edit_not_last"!==p;return(0,a.jsx)("div",{className:(0,H.A)(M&&(g?"pt-2":"pt-3"),M&&(x?"pb-2":"pb-3"),"multi_edit_not_last"===p&&"h-0"),children:(0,a.jsx)(J.d,{versionNum:y?y+1:void 0,preview:w,versionCount:null==j?void 0:j.length,properties:C,isStreaming:d,isEdit:"individual_cell_create"!==p,isNotLastEdit:"multi_edit_not_last"===p,isLastMessage:c,onOpenArtifact:_,isExpanded:k})})}var K=s(9317);s(23812);var X=s(4899),$=s(68480),Z=s(69287),Q=s(40304);let ee=g.z.object({code:g.z.string().nullish().transform(e=>(null==e?void 0:e.charAt(0))==="\n"?e.slice(1):null!=e?e:void 0)}),et=e=>{var t;let{input:s,toolResult:n,isStreaming:i,groupItemKey:r}=e,o=(0,S.A)(),{isExpanded:d,setIsExpanded:c,snappyTransition:u}=(0,T.a)(i,r),m=null!=(t=ee.parse(s).code)?t:"",{toolResultLogs:p,toolResultErrors:f}=(0,l.useMemo)(()=>n?(e=>{let t;if(!e.content||0===e.content.length||!e.content[0])return{toolResultLogs:"",toolResultErrors:"Error: Missing content data"};if("text"!==e.content[0].type)return{toolResultLogs:"",toolResultErrors:""};try{t=JSON.parse(e.content[0].text)}catch(e){return(0,Z.Cp)(e,{tags:{source:"repl-tool-result"}}),{toolResultLogs:"",toolResultErrors:"Error: failed to parse Analysis tool result"}}let s=t.logs?"Result\n\n"+t.logs.join("\n"):"";return"error"===t.status?{toolResultLogs:s,toolResultErrors:"Error\n\n"+t.error}:{toolResultLogs:s,toolResultErrors:""}})(n):{toolResultLogs:"",toolResultErrors:""},[n]);return(0,a.jsx)(v.sH,{isExpanded:d,setIsExpanded:c,icon:(0,a.jsx)($.N,{size:16}),text:i?o.formatMessage({defaultMessage:"Analyzing data",id:"UkajfL/9Yh"}):o.formatMessage({defaultMessage:"Analyzed data",id:"NbwDtG2acW"}),secondaryText:i?void 0:o.formatMessage({defaultMessage:"View analysis",id:"fL+Q/8QHAy"}),...e,children:(0,a.jsx)(v.NG,{isExpanded:d,snappyTransition:u,isScrollable:!0,children:(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,a.jsx)(Q.z,{language:"javascript",code:m}),(0,a.jsx)(Q.z,{title:o.formatMessage({defaultMessage:"Output",id:"fio5opLcOZ"}),language:"javascript",code:p}),!!f&&(0,a.jsx)(Q.z,{title:o.formatMessage({defaultMessage:"Error",id:"KN7zKn8z4F"}),code:f,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})]})})})};var es=s(57969),ea=s(48252);let en=e=>{let{streamingAction:t,errorAction:s,successAction:n,target:i,isStreaming:l=!1,isError:r=!1,description:o}=e;return o&&!r?l?(0,a.jsx)(ea.N,{children:o}):(0,a.jsx)("span",{className:"text-text-200",children:o}):(0,a.jsxs)("span",{className:"flex items-center min-w-0 text-text-200",children:[(0,a.jsx)("span",{className:"whitespace-nowrap mr-1 text-text-200",children:l?t:r?s:n}),(0,a.jsx)("span",{className:"bg-gradient-to-b from-bg-300 via-bg-300/80 to-bg-300 shadow-xs rounded px-1 py-0.5 font-mono truncate overflow-hidden text-ellipsis min-w-0 text-text-200",title:i,children:i})]})},ei=g.z.object({returncode:g.z.number().int(),stdout:g.z.string(),stderr:g.z.string()});function el(e){if(!e.content||0===e.content.length)return null;let t=e.content[0];return(null==t?void 0:t.type)==="text"?t.text:null}let er=e=>{let{input:t,toolResult:s,isStreaming:n,isFirstBlockOfMessage:i,isLastBlockOfMessage:r,renderMode:o,groupItemKey:d,isFirstItemInGroup:c,isLastItemInGroup:u}=e,m=(0,S.A)(),{isExpanded:p,setIsExpanded:f,snappyTransition:h}=(0,T.a)(!1,d),g=(null==t?void 0:t.command)||"",x=(null==s?void 0:s.is_error)||!1,j=(0,l.useMemo)(()=>(function(e,t,s){if(!e)return;if(t)return{type:"error",rawContent:el(e)||JSON.stringify(e,null,2)};let a=el(e);if(!a)return{type:"empty"};try{let e=ei.parse(JSON.parse(a));return{type:"success",data:e}}catch(e){try{let e=JSON.parse(a);if(Array.isArray(e)&&e.length>0&&"text"===e[0].type&&e[0].text){let t=ei.parse(JSON.parse(e[0].text));return{type:"success",data:t}}}catch(e){}return s?void 0:{type:"parse-error",rawContent:a}}})(s,x,n),[s,x,n]),b=null==t?void 0:t.description;return(0,a.jsx)(v.sH,{isExpanded:p,setIsExpanded:f,isStreaming:!!n,icon:(0,a.jsx)(es.b,{size:16}),text:(0,a.jsx)(en,{streamingAction:m.formatMessage({defaultMessage:"Running",description:"Status header for a bash command",id:"ScRq37Oq7S"}),errorAction:m.formatMessage({defaultMessage:"Failed to run",description:"Status header for a bash command",id:"O15lx6IwMb"}),successAction:m.formatMessage({defaultMessage:"Ran",description:"Status header for a bash command",id:"JUMXBud/d6"}),target:g,isStreaming:n,isError:x,description:b}),isFirstBlockOfMessage:i,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:c,isLastItemInGroup:u,children:(0,a.jsx)(v.NG,{isExpanded:p,snappyTransition:h,isScrollable:!0,children:(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,a.jsx)(Q.z,{language:"bash",code:g}),(()=>{if(!j)return null;switch(j.type){case"success":{let{data:e}=j;return(0,a.jsxs)(a.Fragment,{children:[e.stdout&&(0,a.jsx)(Q.z,{title:m.formatMessage({defaultMessage:"Output",description:"Title for the result of a bash command",id:"98/B4gW/HL"}),language:"bash",code:e.stdout}),e.stderr&&(0,a.jsx)(Q.z,{title:m.formatMessage({defaultMessage:"Error",description:"Title for the result of a bash command",id:"96iMiC11cz"}),code:e.stderr,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"}),!e.stdout&&!e.stderr&&(0,a.jsx)(Q.z,{title:m.formatMessage({defaultMessage:"Output",description:"Title for the result of a bash command",id:"98/B4gW/HL"}),code:m.formatMessage({defaultMessage:"exit code {returncode}",description:"The result of a bash command",id:"Uoe/PEvNYN"},{returncode:e.returncode})})]})}case"error":return(0,a.jsx)(Q.z,{title:m.formatMessage({defaultMessage:"Command failed",description:"Title for the result of a bash command",id:"REMG+p+ZiU"}),code:j.rawContent,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"});case"parse-error":return(0,a.jsx)(Q.z,{title:m.formatMessage({defaultMessage:"Output",description:"Title for the result of a bash command",id:"98/B4gW/HL"}),code:j.rawContent,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"});case"empty":return(0,a.jsx)(Q.z,{title:m.formatMessage({defaultMessage:"No output",description:"Title for the result of a bash command",id:"DyoXiEr2fN"}),code:m.formatMessage({defaultMessage:"Command completed with no output",description:"The result of a bash command",id:"TRBc7KuuG+"})});default:return null}})()]})})})};var eo=s(39510),ed=s(79383),ec=s(49953),eu=s(18849),em=s(58841),ep=s(79901),ef=s(26434);let eh=e=>{var t,s;let{input:n,toolResult:i,isStreaming:l,isFirstBlockOfMessage:r,isLastBlockOfMessage:o,renderMode:d,groupItemKey:c,isFirstItemInGroup:u,isLastItemInGroup:m,message:p,shareType:f}=e,{chatResourceState:h,dispatchChatResource:g}=(0,em.i)(),{setIsDrawerExpanded:x}=(0,eu.x)(),j=null==i?void 0:i.is_error,b=null!=(t=null==n?void 0:n.path)?t:"",y=h.streamingFiles.get(b),w=(null==y?void 0:y.showingInRightPane)&&(null==y?void 0:y.renderAs)===V.vU.Markdown,{isExpanded:_,setIsExpanded:C,snappyTransition:k}=(0,T.a)(!w&&l,c),M=null!=(s=null==n?void 0:n.file_text)?s:"",N=(0,ep.S)(b),S="markdown"===N,A=(0,ef.W)(b),E=b.split("/").pop()||b,z=null==n?void 0:n.description,I=!j&&b&&(null==p?void 0:p.uuid)&&(0,ef.m)(b,f),U=I&&!f;return!(w&&l)&&(l||_||!k)?(0,a.jsx)(v.sH,{isExpanded:_,setIsExpanded:C,isExpandingDisabled:l,isStreaming:!!l,icon:(0,a.jsx)(ep.o,{path:(null==n?void 0:n.path)||"",size:16}),text:(0,a.jsx)(en,{streamingAction:"Creating",errorAction:"Failed to create",successAction:"Created",target:A,isStreaming:l,isError:j,description:z}),secondaryIcon:U?(0,a.jsx)("span",{className:"text-xs text-text-300 max-w-64 truncate shrink-0 min-w-0",children:E}):void 0,isFirstBlockOfMessage:r,isLastBlockOfMessage:o,renderMode:d,isFirstItemInGroup:u,isLastItemInGroup:m,children:(0,a.jsx)(v.NG,{isExpanded:_,snappyTransition:k,children:(0,a.jsx)(ec.Z,{noDefaultScroll:!l,className:"flex flex-col gap-3 p-3 pt-1 max-h-[238px] overflow-y-scroll",disabled:!1,children:(0,a.jsx)("div",{"data-testid":"repl-output",children:M&&(S&&!w?(0,a.jsx)("div",{className:"markdown-wrapper",children:l?(0,a.jsx)(eo.qO,{text:M,className:"font-claude-response prose prose-sm max-w-none",isStreaming:!0}):(0,a.jsx)(ed.fP,{text:M,className:"font-claude-response prose prose-sm max-w-none"})}):(0,a.jsx)(Q.z,{title:b,language:N,code:M}))})})})}):(0,a.jsx)(v.aX,{isStreaming:!!l,handleClick:I?()=>{b&&(null==p?void 0:p.uuid)&&(g({type:"SELECT_FILE",path:b,toolType:"create_file",messageId:p.uuid}),x(!0))}:void 0,icon:(0,a.jsx)(ep.o,{path:(null==n?void 0:n.path)||"",size:16}),text:(0,a.jsx)(en,{streamingAction:"Creating",errorAction:"Failed to create",successAction:"Created",target:A,isStreaming:l,isError:j,description:z}),secondaryIcon:U?(0,a.jsx)("span",{className:"text-xs text-text-300 max-w-64 truncate shrink-0 min-w-0",children:E}):void 0,isFirstBlockOfMessage:r,isLastBlockOfMessage:o,renderMode:d,isFirstItemInGroup:u,isLastItemInGroup:m})};var eg=s(58509),ex=s(67453);let ev=l.memo(e=>{let{oldStr:t="",newStr:s="",isStreaming:n=!1}=e,{linesAdded:i,linesRemoved:r}=(0,l.useMemo)(()=>{let e=t?t.split("\n").length:0;return{linesAdded:s?s.split("\n").length:0,linesRemoved:e}},[t,s]),o=(0,l.useMemo)(()=>{let e=[];return i>0&&e.push("".concat(i," ").concat(1===i?"line":"lines"," added")),r>0&&e.push("".concat(r," ").concat(1===r?"line":"lines"," removed")),e.join(", ")},[i,r]);if(0===i&&0===r)return null;let d=(0,a.jsxs)("span",{className:"flex items-center gap-1.5 text-xs font-mono mr-2 border-0.5 border-border-300 rounded px-1 py-0.5",children:[i>0&&(0,a.jsx)("span",{className:"text-forest-green",children:"+".concat(i)}),r>0&&(0,a.jsx)("span",{className:"text-danger-000",children:"-".concat(r)})]}),c=n?(0,a.jsx)(ea.N,{children:d}):d;return(0,a.jsx)(ex.Tooltip,{tooltipContent:o,align:"center",children:(0,a.jsx)("span",{className:"inline-flex",children:c})})});ev.displayName="LineDiffCounter";let ej=e=>{var t;let{input:s,toolResult:n,isStreaming:i,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:d,isLastItemInGroup:c,message:u,shareType:m}=e,{dispatchChatResource:p}=(0,em.i)(),{setIsDrawerExpanded:f}=(0,eu.x)(),h=null==n?void 0:n.is_error,g=null!=(t=null==s?void 0:s.path)?t:"",x=(0,ef.W)(g),j=null==s?void 0:s.description,b=g.split("/").pop()||g,y=!h&&g&&(null==u?void 0:u.uuid)&&(0,ef.m)(g,m);return(0,a.jsx)(v.aX,{isStreaming:!!i,handleClick:y?()=>{g&&(null==u?void 0:u.uuid)&&(p({type:"SELECT_FILE",path:g,toolType:"str_replace",messageId:u.uuid}),f(!0))}:void 0,icon:(0,a.jsx)(eg.I,{size:16}),text:(0,a.jsx)(en,{streamingAction:"Editing",errorAction:"Failed to edit",successAction:"Edited",target:x,isStreaming:i,isError:h,description:j}),secondaryIcon:(0,a.jsxs)(a.Fragment,{children:[!h&&(0,a.jsx)(ev,{oldStr:null==s?void 0:s.old_str,newStr:null==s?void 0:s.new_str,isStreaming:i}),y&&!m&&(0,a.jsx)("span",{className:"text-xs text-text-300 max-w-64 truncate shrink-0 min-w-0",children:b})]}),isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:d,isLastItemInGroup:c})};function eb(e){let{toolResult:t,fileSyntax:s}=e,{activeOrganization:n}=(0,G.YL)(),i=null==n?void 0:n.uuid;try{var l;if(t.content&&t.content.length>0&&(null==(l=t.content[0])?void 0:l.type)==="text"){let e=t.content[0].text;try{let s=JSON.parse(e);Array.isArray(s)&&(t.content=s)}catch(e){}}if(!t.content||0===t.content.length||!t.content[0])return(0,a.jsx)(a.Fragment,{});return(0,a.jsx)(a.Fragment,{children:t.content.map((e,t)=>"text"===e.type?(0,a.jsx)(Q.z,{language:s,code:e.text},t):"image"===e.type?(0,a.jsx)("img",{alt:"",src:"/api/".concat(i,"/files/").concat(e.file_uuid,"/preview"),className:"max-w-md max-h-md h-auto rounded-md"},t):null)})}catch(e){return(0,a.jsx)(Q.z,{title:"Error displaying content - Raw result:",code:JSON.stringify(t,null,2),codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})}}let ey=e=>{let{path:t}=e,s=t.split("/"),n=s.indexOf("skills"),i=s[n+1]||"";return(0,a.jsx)("span",{className:"flex items-center min-w-0 text-text-200 overflow-hidden",children:(0,a.jsx)("span",{className:"whitespace-nowrap text-text-200",children:(0,a.jsx)(c.A,{defaultMessage:"Loading {skill} skill",id:"b2eRiWSxS0",values:{skill:i}})})})},ew=e=>{var t;let{input:s,toolResult:n,isStreaming:i,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,groupItemKey:d,isFirstItemInGroup:u,isLastItemInGroup:m,message:p,shareType:f}=e,{isExpanded:h,setIsExpanded:g,snappyTransition:x}=(0,T.a)(!1,d),{dispatchChatResource:j}=(0,em.i)(),{setIsDrawerExpanded:b}=(0,eu.x)(),y=null==n?void 0:n.is_error,w=null!=(t=null==s?void 0:s.path)?t:"",_=(0,ep.S)(w),C=/\.[^/]+$/.test(w),k=w.includes("/mnt/skills/"),M=(0,ef.W)(w),N=null==s?void 0:s.description,S=w.split("/").pop()||w,A=!y&&w&&(null==p?void 0:p.uuid)&&(0,ef.m)(w,f),E=A&&!f&&!k;return C?(0,a.jsx)(v.aX,{isStreaming:!!i,handleClick:A&&!k?()=>{w&&(null==p?void 0:p.uuid)&&(j({type:"SELECT_FILE",path:w,toolType:"view",messageId:p.uuid}),b(!0))}:void 0,isDisabled:k,icon:(0,a.jsx)(ep.o,{path:(null==s?void 0:s.path)||"",size:16}),text:k&&!N?(0,a.jsx)(ey,{path:w}):(0,a.jsx)(en,{streamingAction:"Viewing",errorAction:"Failed to view",successAction:"Viewed",target:M,isStreaming:i,isError:y,description:N}),secondaryIcon:E?(0,a.jsx)("span",{className:"text-xs text-text-300 max-w-64 truncate shrink-0 min-w-0",children:i?S:(0,a.jsx)(c.A,{defaultMessage:"Show working file",id:"qucjoSGi3N"})}):void 0,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:u,isLastItemInGroup:m}):(0,a.jsx)(v.sH,{isExpanded:h,setIsExpanded:g,isStreaming:!!i,icon:(0,a.jsx)(ep.o,{path:(null==s?void 0:s.path)||"",size:16}),text:k&&!N?(0,a.jsx)(ey,{path:w}):(0,a.jsx)(en,{streamingAction:"Viewing",errorAction:"Failed to view",successAction:"Viewed",target:M,isStreaming:i,isError:y,description:N}),isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:u,isLastItemInGroup:m,isExpandingDisabled:!n,children:(0,a.jsx)(v.NG,{isExpanded:h,snappyTransition:x,isScrollable:!0,children:(0,a.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:n&&(0,a.jsx)(eb,{toolResult:n,fileSyntax:_,isStreaming:i})})})})},e_=l.memo(e=>{let{toolUseId:t,isLastMessage:s,isStreaming:l,toolName:d,input:c,message:m,onOpenArtifact:p,publishedArtifacts:f,toolResult:h,onAllow:g,artifactCellType:x,isFirstBlockOfMessage:v,isLastBlockOfMessage:j,conversationUuid:y,selectedDrawerItem:w,shareType:_,displayData:C,approvalData:k,context:M,renderMode:N=W.l.Standard,groupItemKey:S,isFirstItemInGroup:A,isLastItemInGroup:E,autoscrollRef:z}=e,T=(0,r.fb)(),I=(0,o.be)(),{value:U}=(0,n.fS)("prism_enabled"),L={input:c,toolResult:h,isStreaming:l,isFirstBlockOfMessage:v,isLastBlockOfMessage:j,renderMode:N,groupItemKey:S,isFirstItemInGroup:A,isLastItemInGroup:E,message:m,shareType:_,autoscrollRef:z},R={bash_tool:er,create_file:eh,view:ew,str_replace:ej}[d];if(R)return(0,a.jsx)(R,{...L});if("end_conversation"===d)return(0,a.jsx)(u,{});let O=(null==w?void 0:w.type)==="artifact"?w:void 0,F=!!h&&!!w&&"compass"===w.type&&w.data.toolUseId===h.tool_use_id;switch(d){case"artifacts":return(0,a.jsx)(Y,{input:c,toolResult:h,isLastMessage:s,isStreaming:l,onOpenArtifact:p,publishedArtifacts:f,message:m,artifactCellType:x,selectedArtifactId:null==O?void 0:O.id,selectedArtifactVersion:null==O?void 0:O.versionUuid,isFirstBlockOfMessage:v,isLastBlockOfMessage:j});case"dolphin":return(0,a.jsx)(a.Fragment,{});case"repl":return(0,a.jsx)(et,{...L});case"drive_search":if(!T)break;return(0,a.jsx)(P,{syncSourceType:i.v8.GDRIVE,toolName:d,...L});case"web_search":if(!I)break;return(0,a.jsx)(P,{toolName:d,...L});case"web_fetch":return(0,a.jsx)(b,{...L});case"launch_extended_search_task":return(0,a.jsx)(B.wD,{toolUseId:t,isFirstBlockOfMessage:v,isLastBlockOfMessage:j,conversationUuid:y,toolResult:h,isShared:!!_,isExpanded:F,isStreaming:l,context:M})}return!d.includes(":")&&(null==C?void 0:C.integrationName)?(0,a.jsx)(K.K,{...C,toolName:d,isError:null==h?void 0:h.is_error,isStreaming:l,isFirstBlockOfMessage:v,isLastBlockOfMessage:j,renderMode:N,groupItemKey:S,isFirstItemInGroup:A,isLastItemInGroup:E}):(0,a.jsx)(X.d,{toolName:d,integrationName:null==C?void 0:C.integrationName,integrationIcon:null==C?void 0:C.integrationIcon,approvalData:k,...L})});e_.displayName="ToolUseCell"},53270:(e,t,s)=>{s.d(t,{_:()=>A});var a=s(54568),n=s(69104),i=s(74813),l=s(64328),r=s(45054),o=s(14691),d=s(23812),c=s(17321),u=s(28044),m=s(77795),p=s(94229),f=s(51944),h=s(69841),g=s(5231),x=s(90448),v=s(56641),j=s(66365),b=s(72902),y=s(7620),w=s(10369),_=s(59666),C=s(4887),k=s(27769),M=s(85239),N=s(48321),S=s(78418);function A(e){let{file:t,conversationUuid:s,onOpen:A,isInSidebar:E=!1,isShared:z}=e,{activeOrganization:T}=(0,l.YL)(),I=(0,i.st)(),U=(0,w.A)(),[L,R]=(0,y.useState)(null),[O,F]=(0,y.useState)(!1),D=(0,u.V)(),P=(0,j.useFeatureGate)("wiggle_desktop_integration");(0,y.useEffect)(()=>{let e=!0;if(D&&c.Q2&&P.value)return c.Q2.whichApplication(t.path).then(t=>{e&&R(t)}),()=>{e=!1}},[P.value,t.path,D]);let{addError:B}=(0,r.Y)(),G=(0,k.Ud)(t.name),W={code:{IconComponent:p.l,label:(0,a.jsx)(_.A,{defaultMessage:"Code",id:"G8PgU8iXdR",description:"A label for a category of filetypes"}),isPreviewable:!0},table:{IconComponent:f.K,label:(0,a.jsx)(_.A,{defaultMessage:"Table",id:"o1Bm9Seua1",description:"A label for a category of filetypes"}),isPreviewable:!0},spreadsheet:{IconComponent:f.K,label:(0,a.jsx)(_.A,{defaultMessage:"Spreadsheet",id:"WeEn8OTS2e",description:"A label for a category of filetypes"}),isPreviewable:!0},doc:{IconComponent:h.d,label:(0,a.jsx)(_.A,{defaultMessage:"Document",id:"86Gv/DR1uA",description:"A label for a category of filetypes"}),isPreviewable:!0},image:{IconComponent:g.x,label:(0,a.jsx)(_.A,{defaultMessage:"Image",id:"8mG9Cg7ges",description:"A label for a category of filetypes"}),isPreviewable:!0},diagram:{IconComponent:v.n,label:(0,a.jsx)(_.A,{defaultMessage:"Diagram",id:"HDIA+OJNvT",description:"A label for a category of filetypes"}),isPreviewable:!0},preso:{IconComponent:x.Z,label:(0,a.jsx)(_.A,{defaultMessage:"Presentation",id:"KUNdHQwOKr",description:"A label for a category of filetypes"}),isPreviewable:!1}},{IconComponent:J,label:V}=G?W[G]:{IconComponent:m.o,label:null},{displayName:H,displayExt:q}=(0,k.FT)(t),Y=(0,a.jsxs)(a.Fragment,{children:[V,V&&q&&(0,a.jsx)("span",{className:"opacity-50",children:" \xb7 "}),q]}),K=!E&&!z&&(0,M.z)(t.path);return(0,a.jsx)(n.d,{icon:(0,a.jsx)(J,{size:20,weight:"light",className:"text-text-500"}),properties:{id:t.path,title:H||t.name},isStreaming:!1,className:(0,b.A)(E&&"!m-0"),displayType:Y,actions:(0,a.jsxs)("div",{className:"flex min-w-0 items-center justify-center gap-2 shrink-0",children:[K&&(0,a.jsx)(S.M,{file:t,conversationUuid:s,source:"wiggle_card",variant:"secondary",size:"icon",className:"!rounded-lg"}),D&&c.Q2&&P.value?(0,a.jsx)(d.$,{"aria-label":U.formatMessage({id:"JfG49wNHKP",defaultMessage:"Open"}),variant:E?"ghost":"secondary",loading:O,onClick:e=>{if(e.preventDefault(),e.stopPropagation(),!(null==T?void 0:T.uuid))return;let a=t.path.split("/");F(!0);let n=(0,C.T)(z?{organizationUuid:T.uuid,snapshotUuid:s,filePath:t.path.replace(/^computer:\/\//,""),isShared:!0}:{organizationUuid:T.uuid,conversationUuid:s,filePath:t.path.replace(/^computer:\/\//,""),isShared:!1});null===c.Q2||void 0===c.Q2||c.Q2.writeFileDownloadAndOpen(a[a.length-1],new URL(n,window.location.href).href).catch(()=>{B(U.formatMessage({defaultMessage:"Failed to download and open file",id:"cxAbUvhHjJ"}))}).then(()=>{F(!1)})},size:E?"icon":"default",children:E?(0,a.jsx)(o.vd,{size:16,className:"text-text-400"}):L?(0,a.jsxs)("div",{className:"flex gap-2",children:[L.appIconBase64?(0,a.jsx)("img",{src:L.appIconBase64,height:20,width:20,alt:U.formatMessage({defaultMessage:"Open file on desktop",id:"7tjfei6CPJ"})}):null,(0,a.jsx)(_.A,{id:"AsiqC3lr7Z",defaultMessage:"Open in {appName}",values:{appName:L.appName}})]}):(0,a.jsx)(_.A,{id:"JfG49wNHKP",defaultMessage:"Open"})}):(0,a.jsx)(d.$,{"aria-label":U.formatMessage({id:"5q3qC0sC3r",defaultMessage:"Download"}),variant:E?"ghost":"secondary",onClick:e=>{e.preventDefault(),e.stopPropagation(),(null==T?void 0:T.uuid)&&(0,N.J)(z?{filepath:t.path,orgUuid:T.uuid,snapshotUuid:s,isShared:!0,source:"wiggle_card_download_button"}:{filepath:t.path,orgUuid:T.uuid,conversationUuid:s,isShared:!1,source:"wiggle_card_download_button"},I)},size:E?"icon":"default",children:E?(0,a.jsx)(o.f5,{size:16,className:"text-text-400"}):(0,a.jsx)(_.A,{id:"5q3qC0sC3r",defaultMessage:"Download"})})]}),onOpenArtifact:A},t.path)}},57958:(e,t,s)=>{s.d(t,{wD:()=>R,z7:()=>L});var a=s(54568),n=s(91640),i=s.n(n),l=s(1613),r=s(64328),o=s(48252),d=s(16256),c=s(68067),u=s(95617),m=s(18868),p=s(90361),f=s(72902),h=s(61295),g=s(39109),x=s(7620),v=s(10369),j=s(59666),b=s(24407),y=s(23812),w=s(3075),_=s(84617),C=s(61970),k=s(85705),M=s(19920),N=s(54671),S=s(94629),A=s(3424);function E(e){let{onCancel:t,onConfirm:s}=e,n=(0,x.useRef)(null),{menuOptions:i,getEnabledRemoteTools:l}=(0,S.$3)(),r=(0,A.Cn)({setMcpDirectoryModalIsOpen:z,setStyleModalOpenWithScreen:z,setCreateProjectModalIsOpen:z,setGithubModalIsOpen:z,setGmailAuthModalIsOpen:z,setCreatePromptArgumentModalIsOpen:z}),o=(0,N._9)({actions:r,inputMenuIsOpen:!0,setInputMenuIsOpen:()=>void 0,rootItems:i,menuType:"research"});return(0,x.useEffect)(()=>{setTimeout(()=>{n.current&&n.current.focus()})},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(w.aF,{isOpen:!0,modalSize:"2lg",onClose:t,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:(0,a.jsx)(j.A,{defaultMessage:"Enable connectors for Claude to use in research",id:"bnGGwdCceV"})}),(0,a.jsx)("div",{className:"border border-border-300 rounded-lg",children:(0,a.jsxs)("div",{className:"p-2",children:[o.path&&(0,a.jsx)(M.s,{path:o.path,inputMenuSearchQuery:o.inputMenuSearchQuery,setInputMenuSearchQuery:o.setInputMenuSearchQuery,handleBack:o.handleBack}),(0,a.jsx)("div",{className:"space-y-1",children:o.menuView.currentItems.filter(e=>{let{menuItemHidden:t}=e;return!t}).map(e=>(0,a.jsx)(k.$,{item:e,onClick:()=>o.handleClickItem(e),isHighlighted:o.highlightedItemKey===e.key},e.key))})]})}),(0,a.jsx)("div",{className:"bg-bg-300 border-border-400 border px-4 py-3 rounded-lg text-sm text-text-300",children:(0,a.jsx)(j.A,{defaultMessage:"Ensure you have appropriate permissions and trust third-party tools before continuing. <link>Learn more</link> about safely using research with connected apps.",id:"VU67M+9esK",values:{link:e=>(0,a.jsx)(_.Y,{href:"https://support.anthropic.com/",target:"_blank",rel:"noreferrer noopener",children:e})}})}),(0,a.jsxs)("div",{className:"flex flex-row justify-end gap-2",children:[(0,a.jsx)(y.$,{variant:"outline",onClick:t,children:(0,a.jsx)(j.A,{defaultMessage:"Cancel Research",id:"GuxgLirKvY"})}),(0,a.jsxs)(y.$,{ref:n,onClick:function(){s({tools:l()})},children:[(0,a.jsx)(j.A,{defaultMessage:"Confirm",id:"N2IrpMDHDB"}),(0,a.jsx)("span",{className:"inline-block ml-2 p-1 bg-bg-000/20 rounded-sm",children:(0,a.jsx)(C.y,{size:12})})]})]})]})})})}function z(){}var T=s(18849),I=s(58841),U=s(37080);let L=b.z.preprocess(e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},b.z.object({task_id:b.z.string()}));function R(e){let{toolUseId:t,isFirstBlockOfMessage:s=!1,isLastBlockOfMessage:n=!1,conversationUuid:i,toolResult:o,isShared:d,isExpanded:m=!1,isStreaming:p=!1,context:h}=e,{value:g}=(0,c.fS)("papi_mcp"),{activeOrganization:j}=(0,r.YL)(),{dispatchChatResource:b}=(0,I.i)(),{setIsDrawerExpanded:y}=(0,T.x)(),{decisionState:w,approveTool:_,denyTool:C}=function(e,t,s,a){let[n,i]=(0,x.useState)("pending"),r=!!(e&&t&&a),{isPending:o}=(0,l.Sk)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval_state/").concat(s),{enabled:r}),d=(0,l.L2)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval"),"POST",{enabled:!!(t&&!o),onSuccess(e,t){i(t.is_approved?"approved":"denied")}}).mutate;return{decisionState:n,isStatePending:o,approveTool:(0,x.useCallback)(e=>{let{tools:t}=e;d({tool_use_id:s,is_approved:!0,params:{tools:t}})},[d,s]),denyTool:(0,x.useCallback)(()=>{d({tool_use_id:s,is_approved:!1,params:{disapproval_reason:"user_canceled"}})},[d,s])}}(null==j?void 0:j.uuid,i,t,p),k=p?"approved"===w:o&&!(null==o?void 0:o.is_error),M=g&&(null==h?void 0:h.tools.length)&&p&&"pending"===w,N=(0,x.useMemo)(()=>{if(!(null==o?void 0:o.content))return;let e=o.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:t}=L.safeParse(e);return null==t?void 0:t.task_id},[null==o?void 0:o.content]),{compassStatus:S,isLoading:A,error:z}=(0,U.CH)({organizationUuid:null==j?void 0:j.uuid,conversationUuid:i,taskId:N,isShared:d,enabled:k});(0,U.IK)(i,null==S?void 0:S.status);let R=!S,O=(0,x.useCallback)(()=>{R||(y(!0),b({type:"OPEN_COMPASS_STATUS",data:{conversationUuid:i,organizationUuid:null==j?void 0:j.uuid,isShared:d,toolUseId:null==o?void 0:o.tool_use_id,taskId:N}}))},[R,b,i,null==j?void 0:j.uuid,y,d,o,N]),P=(null==S?void 0:S.status)||u.zu.Starting,B=!!z||!!(null==o?void 0:o.is_error),G=(0,v.A)(),{title:W,subtitle:J}=(0,x.useMemo)(()=>{let e,t;if(B){var s,a;return(null==o?void 0:o.is_error)&&((null==o?void 0:o.message)==="user_canceled"||(null==o||null==(s=o.content)?void 0:s.some(e=>(null==e?void 0:e.type)==="text"&&(null==e?void 0:e.text)==="Denied.")))?{title:G.formatMessage({defaultMessage:"Stopped",id:"1LBny5MvRa"}),subtitle:G.formatMessage({defaultMessage:"At your request",id:"2n0LtR1+bC"})}:(null==o?void 0:o.is_error)&&((null==o?void 0:o.message)==="approval_timeout"||(null==o||null==(a=o.content)?void 0:a.some(e=>(null==e?void 0:e.type)==="text"&&(null==e?void 0:e.text)==="No approval received.")))?{title:G.formatMessage({defaultMessage:"Stopped",id:"1LBny5MvRa"}),subtitle:G.formatMessage({defaultMessage:"No response on which connectors to enable during research",id:"HZp4wEGqGR"})}:{title:G.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})}}let n=(null==S?void 0:S.total_sources)||0,i=0===n?G.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):G.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}} and counting...",id:"wfqjY4cYXF"},{count:n}),l=G.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}}",id:"WrpI57Uej/"},{count:n}),r=(0,U.Ui)(S),d=r||G.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}),c=r||G.formatMessage({defaultMessage:"Research complete",id:"9Tbl1w5GjC"});switch(P){case u.zu.Starting:{let t=[G.formatMessage({defaultMessage:"Getting everything ready...",id:"5nJVpwt8gP"}),G.formatMessage({defaultMessage:"Preparing your research assistant...",id:"vxRKHhLIWM"}),G.formatMessage({defaultMessage:"Initializing research tools...",id:"Lm6wYLrJ1Q"}),G.formatMessage({defaultMessage:"Setting up my research space...",id:"EGN8CB7IRt"}),G.formatMessage({defaultMessage:"Configuring research parameters...",id:"eYoO3vRQgY"}),G.formatMessage({defaultMessage:"Loading research capabilities...",id:"GHM/w3WPnr"}),G.formatMessage({defaultMessage:"Preparing to dive in...",id:"EW22N+F8aq"}),G.formatMessage({defaultMessage:"Setting the stage for discovery...",id:"l8a+mVgI7N"}),G.formatMessage({defaultMessage:"Getting your assistant ready...",id:"GLpbkAPwDC"}),G.formatMessage({defaultMessage:"Activating research mode...",id:"SPBnT2clve"}),G.formatMessage({defaultMessage:"Warming up the engines...",id:"biUnCTBtnQ"})],s=Math.floor(Math.random()*t.length);e=t[s];break}case u.zu.Planning:e=d,t=G.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"});break;case u.zu.InitiatingAgents:e=d,t=G.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"});break;case u.zu.Searching:e=d,t=i;break;case u.zu.CreatingArtifact:e=d,t=G.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"});break;case u.zu.Completed:t=l,e=c;break;case u.zu.Cancelled:e=d,t=G.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"});break;case u.zu.TimedOut:case u.zu.Failed:e=G.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})}return{title:e,subtitle:t}},[G,P,S,B,null==o?void 0:o.is_error,null==o?void 0:o.message,null==o?void 0:o.content]);return M?(0,a.jsx)(E,{onCancel:C,onConfirm:e=>{let{tools:t}=e;_({tools:t})}}):(0,a.jsx)("div",{className:(0,f.A)("my-3",s?"mt-2":"mt-3",n?"mb-2":"mb-3"),children:A?(0,a.jsxs)("div",{className:"w-full p-4 text-text-000 font-ui rounded-xl border border-border-300 shadow-xs",children:[(0,a.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-3/4"}),(0,a.jsx)("div",{className:"flex text-text-300 text-xs items-center mt-2",children:(0,a.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-24"})})]}):(0,a.jsxs)("button",{className:(0,f.A)("transition-[border] duration-300 w-full p-4 !pt-0 text-text-000 font-ui rounded-xl border shadow-xs overflow-hidden",!R&&"cursor-pointer hover:shadow-sm hover:bg-bg-000/50 hover:border-border-200",m?"!border-accent-secondary-200":"border-border-300"),disabled:R,onClick:O,children:[(0,a.jsx)(F,{title:W,compassStatus:S,useShimmer:P===u.zu.Starting,isError:B||P===u.zu.Failed||P===u.zu.TimedOut,isExpanded:m}),(0,a.jsx)(D,{subtitle:J,compassStatus:S,isError:P===u.zu.Cancelled,useShimmer:!m&&!!S&&![u.zu.CreatingArtifact,u.zu.Completed,u.zu.Cancelled,u.zu.TimedOut,u.zu.Failed].includes(S.status)})]})})}function O(e){let{className:t,text:s,useShimmer:n}=e,[l,r]=(0,x.useState)(s),[d,c]=(0,x.useState)(!1),[u,m]=(0,x.useState)("");return(0,x.useEffect)(()=>{if(s!==l){m(l),r(s),c(!0);let e=setTimeout(()=>{c(!1)},300);return()=>clearTimeout(e)}},[s,l]),(0,a.jsxs)("div",{title:l,className:"jsx-34e91f3cef6c43c9 "+((0,f.A)("relative overflow-hidden",t)||""),children:[(0,a.jsx)(i(),{id:"34e91f3cef6c43c9",children:"@keyframes slideUpFadeOut{0%{transform:translatey(0);opacity:1}100%{transform:translatey(-100%);opacity:0}}@keyframes slideUpFadeIn{0%{transform:translatey(100%);opacity:0}100%{transform:translatey(0);opacity:1}}"}),d&&(0,a.jsx)("div",{style:{animation:"slideUpFadeOut 300ms forwards"},className:"jsx-34e91f3cef6c43c9 absolute w-full text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,a.jsx)(o.N,{children:u}):u}),(0,a.jsx)("div",{style:d?{animation:"slideUpFadeIn 300ms forwards"}:void 0,className:"jsx-34e91f3cef6c43c9 w-full relative text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,a.jsx)(o.N,{children:l}):l})]})}function F(e){let{title:t,isError:s,compassStatus:n,useShimmer:i,isExpanded:l}=e,[r,o]=(0,x.useState)(!1),c=(0,U.Nw)(n),u=(0,x.useRef)(c);(0,x.useEffect)(()=>{c&&!u.current&&(o(!0),setTimeout(()=>{o(!1)},3.5*c.length+.5),u.current=c)},[c]);let v=!l&&r;return(0,a.jsxs)("div",{className:"flex flex-row justify-between items-center h-9 gap-4 relative",children:[(0,a.jsxs)("div",{className:"h-9 min-w-0 w-full",children:[v&&!!c&&(0,a.jsx)(h.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:(0,a.jsx)(P,{thought:c})}),(0,a.jsx)(g.N,{initial:!1,children:!(v&&c)&&(0,a.jsxs)(h.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5,ease:d.A.inOutQuart},className:(0,f.A)("absolute w-[calc(100%-1.75rem)] top-0 left-0 flex items-center rounded-lg text-sm min-w-0 mt-4",s?"text-danger-000":""),children:[s&&(0,a.jsx)(m.N,{className:"text-danger-000 mr-1 flex-shrink-0",size:16}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden text-left text-ellipsis break-words text-nowrap",children:(0,a.jsx)(O,{text:t,useShimmer:!!i&&!s})})]})})]}),!!n&&(0,a.jsx)(p.K,{size:12,className:"text-text-500 mt-4"})]})}function D(e){var t,s;let{subtitle:n,isError:i,compassStatus:l,useShimmer:r}=e,o=(0,x.useMemo)(()=>(null==l?void 0:l.agents)&&!(l.agents.length<1)?(0,U.mk)({agents:l.agents,n:3}):[],[null==l?void 0:l.agents]);return n?(0,a.jsxs)("div",{className:"flex text-text-300 text-xs items-center mt-2 tabular-nums h-5",children:[!!o.length&&(0,a.jsx)("div",{className:"flex-shrink-0 mr-1",children:(0,a.jsx)(U.mq,{hrefs:o})}),(null==l?void 0:l.status)===u.zu.Completed&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.A,{defaultMessage:"Research complete",id:"9Tbl1w5GjC"}),(0,a.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"})]}),(0,a.jsx)(O,{text:n,useShimmer:r,className:i?"text-danger-000":""}),!!(null==l?void 0:l.started_at)&&l.status!==u.zu.Cancelled&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"}),(0,a.jsx)("div",{className:"text-text-500",children:(0,a.jsx)(U.YE,{startedAt:null!=(t=null==l?void 0:l.started_at)?t:null,completedAt:null!=(s=null==l?void 0:l.finished_at)?s:null})})]})]}):null}function P(e){let{thought:t}=e;return(0,a.jsx)("div",{className:"h-9 w-full",children:(0,a.jsx)("div",{className:"blur-[2px] h-11 px-1 -mx-1 -mb-2 w-full relative overflow-y-hidden overflow-x-visible [mask-image:linear-gradient(to_top,_hsl(var(--always-black)/0%)_0%,hsl(var(--always-black)/100%)_75%,_hsl(var(--always-black)/0%)_100%)]",children:(0,a.jsx)(h.P.div,{className:"absolute top-0 left-1 right-0 text-left",initial:{y:40},animate:{y:"calc(-100%)"},transition:{delay:.5,duration:3.5*t.length/1e3,ease:d.A.inOutBase},children:(0,a.jsx)(U.GT,{thought:t})})})})}},60516:(e,t,s)=>{s.d(t,{E:()=>u,Hg:()=>o,gT:()=>d,vn:()=>c,zZ:()=>r});var a=s(1613),n=s(64328),i=s(4869);let l="notificationPreferences";var r=function(e){return e.FCM="FCM",e.APNS="APNS",e}({});let o=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid;return(0,a.Sk)("/api/organizations/".concat(t,"/notification/preferences"),{queryKey:[l,{orgUuid:t}],enabled:!!t})},d=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/preferences"),"PUT",{onSuccess:()=>{s.invalidateQueries({queryKey:[l,{orgUuid:t}]})}})},c=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/preferences"),"PATCH",{onSuccess:()=>{s.invalidateQueries({queryKey:[l,{orgUuid:t}]})}})},u=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/channels"),"POST",{onSuccess:()=>{s.invalidateQueries({queryKey:["notificationChannels",{orgUuid:t}]})},meta:{noToast:!0}})}},65018:(e,t,s)=>{s.d(t,{I:()=>n,q:()=>i});var a=s(7620);let n=(0,a.createContext)(null),i=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useReplExecutionSandbox must be used within a ReplExecutionSandboxContextProvider");return e}},68616:(e,t,s)=>{s.d(t,{Dr:()=>E,Hz:()=>A,L_:()=>N,_L:()=>M,gy:()=>z});var a=s(54568),n=s(6542),i=s(74813),l=s(44995),r=s(13750),o=s(14691),d=s(23812),c=s(3075),u=s(84617),m=s(67453),p=s(64371),f=s(47592),h=s(68067),g=s(72902),x=s(20795),v=s.n(x),j=s(32536),b=s(19664),y=s.n(b),w=s(7620),_=s(59666),C=s(10369);let k=e=>{let{artifact:t,selectedVersion:s,messageUuid:r,isOpen:o,richSandboxRef:d,copyToClipboard:c}=e,{track:u}=(0,i.st)(),{publishedArtifactsBaseUrl:m}=(0,l._r)(),{mutateAsync:p,isPending:f}=(0,n.yx)(),[h,g]=(0,w.useState)(),x=(0,w.useCallback)(async()=>{var e;let t=await (null==(e=d.current)?void 0:e.getScreenshot());t&&g(t)},[d]);return(0,w.useEffect)(()=>{o&&d.current&&x()},[d,o,x]),(0,a.jsx)(M,{canScreenshot:!0,title:t.title,isLoading:f,screenshot:h,fetchScreenshot:x,setScreenshot:g,handlePublishArtifact:()=>{var e;p({title:t.title,artifact_type:t.type,code_language:t.language,message_uuid:r,artifact_identifier:t.id,content:null!=(e=t.versions[s].resultState)?e:"",screenshot:h,artifact_version_uuid:t.versions[s].uuid}).then(e=>{let{published_artifact_uuid:t}=e;return c("".concat(m,"/public/artifacts/").concat(t))}),u({event_key:"artifact.publish.modal.publish_button_clicked",message_uuid:r,artifact_type:null==t?void 0:t.type,artifact_language:null==t?void 0:t.language})}})};function M(e){let{canScreenshot:t,title:s,isLoading:n,screenshot:i,fetchScreenshot:l,setScreenshot:r,handlePublishArtifact:c}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:(0,a.jsx)("p",{children:(0,a.jsx)(_.A,{defaultMessage:"Publishing this Artifact will make it accessible to anyone on the internet and potentially visible in search engine results. Your chat will remain private.",id:"zG4O5rdNXZ"})})}),(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col sm:flex-row gap-4 rounded-xl py-3 pl-3 pr-5 items-center",children:[t?(0,a.jsxs)("div",{className:"relative group w-[160px] h-[84px]",children:[(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden shrink-0 relative w-full h-full",children:[i?(0,a.jsx)("img",{src:i,alt:s,className:"w-full h-auto bg-always-white"}):(0,a.jsx)(j.default,{src:"/images/claude_ogimage.png",alt:s,className:"w-full h-auto",width:1138,height:640}),!i&&(0,a.jsx)(I,{handleCapture:()=>void l()})]}),i&&(0,a.jsx)("div",{className:"absolute top-0 right-0 translate-x-1/4 -translate-y-1/4 hidden group-hover:block",children:(0,a.jsx)(T,{handleRemove:()=>r(void 0)})})]}):null,(0,a.jsx)("div",{children:null!=s?s:(0,a.jsx)(_.A,{defaultMessage:"Claude Artifact",id:"l6aMQuX1m4"})})]}),(0,a.jsxs)("div",{className:"bg-bg-300 text-text-300 mt-3 flex gap-3 rounded-xl px-4 py-3 text-sm leading-normal",children:[(0,a.jsx)(o.R2,{size:16,className:"mt-0.5 shrink-0"}),(0,a.jsx)("span",{children:(0,a.jsx)(_.A,{defaultMessage:"Anthropic’s <link>Usage Policy</link> prohibits use of Claude for harmful use cases like producing violent, abusive, or deceptive content. Don’t share personal information or third-party content without permission.",id:"3BDMxIIlWR",values:{link:e=>(0,a.jsx)(u.Y,{href:"https://www.anthropic.com/legal/aup",target:"_blank",children:e})}})})]}),(0,a.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,a.jsx)(d.$,{size:"lg",loading:n,onClick:c,children:(0,a.jsx)(_.A,{defaultMessage:"Publish & copy link",id:"q8Svey6avC"})})})]})}let N=e=>{let{artifactUuid:t,publishedLink:s,onClose:i,onUnpublish:l}=e,{copyToClipboard:r,didCopy:c}=(0,p.C)(),{mutateAsync:u,isPending:m}=(0,n.lT)(t),f=async()=>{await u({}),null==l||l(),i()};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl my-3",children:[(0,a.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)("div",{children:(0,a.jsx)(o.qz,{className:"mt-1",size:16})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h6",{className:"font-medium",children:(0,a.jsx)(_.A,{defaultMessage:"Published (Public)",id:"7G+T0FbG5h"})}),(0,a.jsx)("p",{className:"text-text-300",children:(0,a.jsx)(_.A,{defaultMessage:"Anyone on the web with the link can view the Artifact only. Your chat will remain private.",id:"lJBHtZSUCz"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)(y(),{className:"text-text-300 truncate text-sm",href:s,children:s}),(0,a.jsx)("div",{children:(0,a.jsx)(d.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{r(s)},prepend:c?(0,a.jsx)(o.rA,{size:16}):(0,a.jsx)(o.Xq,{size:16}),children:c?(0,a.jsx)(_.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,a.jsx)(_.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(d.$,{size:"lg",variant:"secondary",loading:m,onClick:f,children:(0,a.jsx)(_.A,{defaultMessage:"Unpublish",id:"VjZ6FKc+ZZ"})}),(0,a.jsxs)("p",{className:"text-text-400 text-xs",children:[(0,a.jsx)(_.A,{defaultMessage:"Once Artifact is unpublished, it cannot be republished.",id:"HKGP87Xpbb"}),(0,a.jsx)("br",{}),(0,a.jsx)(_.A,{defaultMessage:"A new Artifact must be created.",id:"vWfM4LMkFW"})]})]})]})},S=e=>e.split(",").map(e=>e.trim().toLowerCase()).filter(e=>e.length>0);function A(e){let{artifactUuid:t,closeEmbedSettings:s,embedLink:i}=e,l=(0,C.A)(),{mutateAsync:c}=(0,n.eH)(t),{data:u,isSuccess:m}=(0,n.gY)(t),{copyToClipboard:f,didCopy:h}=(0,p.C)(),g='<iframe src="'.concat(i,'" title="Claude Artifact" width="100%" height="600" frameborder="0" allow="clipboard-write" allowfullscreen></iframe>'),[x,j]=(0,w.useState)(""),[b,y]=(0,w.useState)(!1),[k,M]=(0,w.useState)(!1),N=/^(?:(\*\.)?)(?:[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,24}[a-z0-9]$/,A=S(x),E=A.filter(e=>!N.test(e)),[z,T]=(0,w.useState)([]),I=!v()(A.toSorted(),z.toSorted());(0,w.useEffect)(()=>{if(u){var e,t;let s=null!=(t=null==(e=u.embed_whitelist)?void 0:e.join(", "))?t:"";j(s),T(S(s))}},[m,u]);let U=async()=>{t&&(await c({embed_whitelist:A}),T(A),M(!0))};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-text-100 font-base-bold",children:(0,a.jsx)(_.A,{defaultMessage:"Allowed domains",id:"J1MOf/PGed"})}),(0,a.jsx)("p",{className:"text-text-300 font-small mb-2",children:(0,a.jsx)(_.A,{defaultMessage:"Only these domains can embed this artifact. Separate with commas.",id:"mySCaN71No"})}),(0,a.jsx)(r.fs,{value:x,onValueChange:e=>{j(null!=e?e:""),y(!0),M(!1)},onBlur:()=>{y(!1),I&&0===E.length&&U()},placeholder:"www.example.com, www.myblog.com",minRows:1,className:"text-sm"}),(0,a.jsx)("div",{className:"font-base mt-2 text-danger-000",children:E.length>0&&!b?1===E.length?l.formatMessage({defaultMessage:"{invalidDomain} is not a valid domain",id:"4BVWTznQQj"},{invalidDomain:E[0]}):l.formatMessage({defaultMessage:"{invalidDomains} are not valid domains",id:"woDBbyq+SX"},{invalidDomains:"".concat(E.slice(0,E.length-1).join(", ")," and ").concat(E[E.length-1])}):void 0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-text-100 font-base-bold mb-2",children:(0,a.jsx)(_.A,{defaultMessage:"Embed code",id:"O4prKQr/hN"})}),(0,a.jsx)(r.fs,{value:g,readOnly:!0,className:"text-sm read-only:text-text-200 read-only:!opacity-100",rows:5}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 mt-4",children:[k&&(0,a.jsxs)("div",{className:"text-xs flex-grow flex items-center gap-1",children:[(0,a.jsx)(o.Jl,{size:12,className:"inline"}),(0,a.jsx)(_.A,{defaultMessage:"Saved",id:"fsB/4pdUqN"})]}),(0,a.jsx)(d.$,{size:"default",variant:"secondary",onClick:s,children:(0,a.jsx)(_.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsx)(d.$,{size:"default",variant:"primary",prepend:h?(0,a.jsx)(o.rA,{size:14}):(0,a.jsx)(o.QR,{size:14}),onClick:()=>f(g),className:"w-28",children:(0,a.jsx)(_.A,{defaultMessage:"Copy code",id:"CNXQN5zp9z"})})]})]})]})}let E=e=>{let t,s,{onClose:n,isOpen:i,artifact:r,selectedVersion:u,messageUuid:m,publishedArtifactUuid:f,richSandboxRef:h}=e,x=(0,C.A)(),{publishedArtifactsBaseUrl:v,publishedArtifactsEmbedBaseUrl:j}=(0,l._r)(),b=!!f,[y,M]=(0,w.useState)(!1),S="".concat(v,"/public/artifacts/").concat(f),E="".concat(j,"/public/artifacts/").concat(f,"/embed"),[T,I]=(0,w.useState)("");(0,w.useEffect)(()=>{if(""===T)return;let e=setTimeout(()=>I(""),5e3);return()=>clearTimeout(e)},[T]);let{copyToClipboard:U}=(0,p.C)(),L=b?"shared":"private",R=(0,w.useRef)(L);R.current!==L&&("private"===L&&I(x.formatMessage({defaultMessage:"Artifact no longer published",id:"2ERgiFTuIj"})),R.current=L);let O=()=>{I(""),M(!1),n()};return y?(t=(0,a.jsxs)("div",{className:"flex items-center justify-start gap-2",children:[(0,a.jsx)(d.$,{variant:"unstyled",size:"unset",className:"-mt-1",onClick:()=>M(!1),children:(0,a.jsx)(o.ZK,{})}),(0,a.jsx)(_.A,{defaultMessage:"Get embed code",id:"3TjDDwZ836"})]}),s=(0,a.jsx)(A,{artifactUuid:null!=f?f:"",closeEmbedSettings:()=>M(!1),embedLink:E})):b?(t=(0,a.jsx)(_.A,{defaultMessage:"Artifact published",id:"ykyvCB8a6W"}),s=(0,a.jsx)(N,{artifactUuid:null!=f?f:"",publishedLink:S,onClose:O})):(t=(0,a.jsx)(_.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"}),s=(0,a.jsx)(k,{artifact:r,selectedVersion:u,messageUuid:m,isOpen:i,richSandboxRef:h,copyToClipboard:U})),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(c.aF,{title:(0,a.jsx)("span",{className:"text-text-200 font-heading  font-medium",children:t}),isOpen:i,onClose:O,modalSize:"lg",hasCloseButton:!0,className:(0,g.A)(!y&&"-mt-20","!p-8 !rounded-2xl"),children:[(0,a.jsxs)("div",{className:"mt-2 flex flex-col gap-2.5",children:[T&&(0,a.jsx)("div",{className:"bg-accent-secondary-900 text-accent-secondary-000 rounded-2xl px-3 py-2 text-sm",children:T}),s]}),(0,a.jsx)(z,{isPublished:b,onOpen:()=>{M(!0)}})]})})};function z(e){let{isPublished:t=!0,isEmbedSettingsOpen:s=!1,onOpen:n}=e,{value:i}=(0,h.fS)("embed_artifacts");return i&&t&&!s?(0,a.jsx)("div",{className:"absolute top-full left-0 right-0 mt-3",children:(0,a.jsx)("div",{className:"bg-bg-100 border-0.5 border-border-300 rounded-2xl shadow-lg p-3",onClick:n,children:(0,a.jsxs)(d.$,{variant:"ghost",className:"flex items-center justify-between py-3 pl-3 pr-3 cursor-pointer hover:bg-bg-200/50 transition-colors rounded-xl w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-md flex items-center justify-center",children:(0,a.jsx)(o.NG,{size:16,className:"text-text-300"})}),(0,a.jsx)("span",{className:"text-text-100",children:(0,a.jsx)(_.A,{defaultMessage:"Get embed code",id:"3TjDDwZ836"})})]}),(0,a.jsx)(o.K3,{size:16,className:"text-text-300"})]})})}):null}let T=e=>{let{handleRemove:t}=e;return(0,a.jsx)(m.Tooltip,{tooltipContent:(0,a.jsx)(_.A,{defaultMessage:"Remove",id:"G/yZLul6P1"}),side:"bottom",children:(0,a.jsx)("button",{className:(0,g.A)("transition-all hover:bg-bg-000/50 text-text-500 hover:text-text-200 w-5 h-5 rounded-full border-0.5 border-border-300/25 bg-bg-000/90 backdrop-blur-sm flex items-center justify-center",(0,f.Fr)()&&"!opacity-100 !bg-bg-000/50"),onClick:e=>{e.stopPropagation(),e.preventDefault(),t()},children:(0,a.jsx)(o.X,{size:12})})})},I=e=>{let{handleCapture:t}=e;return(0,a.jsx)("div",{className:"absolute inset-0 items-center justify-center bg-accent-main-900/20 hidden group-hover:flex",children:(0,a.jsx)(m.Tooltip,{tooltipContent:(0,a.jsx)(_.A,{defaultMessage:"Capture screenshot",id:"4aPgLNzYUy"}),side:"right",children:(0,a.jsx)(d.$,{variant:"secondary",size:"icon",onClick:t,className:"!bg-bg-100",children:(0,a.jsx)(o.i7,{})})})})}},69351:(e,t,s)=>{s.d(t,{n:()=>w,M:()=>y});var a=s(19736),n=s(65018),i=s(32049),l=s(65315),r=s(69287),o=s(7620),d=s(44007),c=s(47831),u=s(44894),m=s(74813),p=s(45054),f=s(8019),h=s(23670),g=s(35580);function x(e){let{mimeType:t,base64Data:s}=e;if(!u._F[t])throw(0,r.Cp)(Error("Unsupported image type"),{extra:{mimeType:t}}),Error("The tool returned an image in an unsupported format.");let a=u._F[t];return{type:"image",file_name:"".concat((0,f.b)(),".").concat(a),source:{media_type:t,type:"base64",data:s}}}var v=s(19354);async function j(e,t){let s=v.zN.safeParse(e);if(s.success)try{let e=await t(s.data.code);return{content:[{type:"text",text:JSON.stringify(e)}]}}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}throw Error("Error parsing input: ".concat(s.error.message))}var b=s(73648);function y(){let{mutateAsync:e}=(0,a.Pt)(),t=function(){let{executeReplCode:e}=(0,n.q)(),t=function(){let{track:e}=(0,m.st)(),{addError:t}=(0,p.Y)();return(0,o.useCallback)(async(s,a,n)=>{let i;try{let t=await (0,g.KU)(n).callTool({name:a.name,arguments:s},h.zo,{timeout:24e4});e({event_key:"mcp.tools.called",result:"success",argument_count:Object.keys(s).length}),i="content"in t?t:{content:[{type:"text",text:JSON.stringify(t.toolResult,null,2)}],isError:!1}}catch(i){throw(0,r.Cp)(i,{tags:{serverUuid:n}}),t("Failed to call tool ".concat(a.name),{error:i}),e({event_key:"mcp.tools.called",result:"failure",argument_count:Object.keys(s||{}).length}),Error("Tool execution failed")}return{is_error:i.isError,content:i.content.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return x({mimeType:e.mimeType,base64Data:e.data});case"resource":{let t=e.resource;if("text"in t)return{type:"text",text:t.text};if("blob"in t){if(!t.mimeType)throw(0,r.Cp)(Error("Missing MIME type for resource"),{tags:{serverUuid:n}}),Error("The tool returned a resource without a valid format.");return x({mimeType:t.mimeType,base64Data:t.blob})}}}throw(0,r.Cp)(Error("Unsupported content type"),{tags:{serverUuid:n},extra:{mimeType:e.type}}),Error("The tool returned content in an unsupported format.")})}},[e,t])}();return(0,o.useCallback)(async(s,a)=>{let n=(0,b.p)(a);if("repl"===s)return await j(n,e);{let e=(0,g.pK)(s);if((null==e?void 0:e.tool)&&(null==e?void 0:e.server))return await t(n,e.tool,e.server.uuid)}},[e,t])}();return(0,o.useCallback)(async function(s,a,n,i){let{overriddenResult:l}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{let o=null!=l?l:await t(a,i);if(void 0===o){(0,g.qT)(a)&&(0,r.Cp)(Error("Tool not found"),{tags:{conversationUuid:s,toolId:n},level:"warning"});return}await e({conversation_uuid:s,type:"tool_result",tool_use_id:n,...o})}catch(a){(0,r.Cp)(a,{tags:{conversationUuid:s,toolId:n}});let t=a instanceof Error?a.message:String(a);await e({conversation_uuid:s,type:"tool_result",tool_use_id:n,content:[{type:"text",text:t}]})}},[t,e])}let w=(e,t)=>{let s=(0,l.wc)(),{value:a}=(0,i.N)(null!=e?e:{}),n=(0,d.p9)(),r=(0,c.Pb)(t);return(0,o.useCallback)(()=>{let t=(0,g._b)(n,e),i=null==s?void 0:s[l.U3];return i&&t.push({type:(null==s?void 0:s[l.$6])||"",name:i}),t.push({type:"artifacts_v0",name:"artifacts"}),a&&t.push({type:"repl_v0",name:"repl"}),r&&t.push({type:"project_knowledge_search",name:"project_knowledge_search"}),t},[e,a,s,r,n])}},72253:(e,t,s)=>{s.d(t,{a:()=>i});var a=s(7620),n=s(20804);let i=(e,t,s)=>{let i=(0,a.useRef)(!1),l=(0,a.useRef)(null),r=(0,a.useRef)(null),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!e),{expandedItemKey:m,setExpandedItemKey:p}=(0,n.D8)(),f=t&&p&&!s,h=(0,a.useCallback)(e=>{f&&p(e?t:void 0),d(e)},[f,p,d,t]),g=!!s||(f?m===t:o);return(0,a.useEffect)(()=>(l.current&&(clearTimeout(l.current),l.current=null),r.current&&(clearTimeout(r.current),r.current=null),e?(i.current=!0,h(!0),u(!1)):i.current&&!s&&(l.current=setTimeout(()=>{h(!1),r.current=setTimeout(()=>{u(!0),i.current=!1},600)},2e3)),()=>{l.current&&(clearTimeout(l.current),l.current=null),r.current&&(clearTimeout(r.current),r.current=null)}),[e,h,s]),{isExpanded:g,setIsExpanded:h,snappyTransition:c}}},73648:(e,t,s)=>{s.d(t,{p:()=>a});function a(e){let t;try{t=JSON.parse(e)}catch(e){}return t}},74700:(e,t,s)=>{s.d(t,{c:()=>tA});var a=s(54568),n=s(64328),i=s(7620),l=s(24423),r=s(61295),o=s(2348),d=s(32049),c=s(59922),u=s(23812),m=s(68067),p=s(18868),f=s(21114),h=s(85524),g=s(10369),x=s(59666),v=s(16685);function j(){let e=(0,o._)(["\n  flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100\n"]);return j=function(){return e},e}function b(){let e=(0,o._)(["\n  bg-bg-300/80 text-text-300 outline-bg-400/80\n"]);return b=function(){return e},e}function y(){let e=(0,o._)(["\n  bg-accent-secondary-200/20 outline-accent-secondary-200/30\n"]);return y=function(){return e},e}function w(){let e=(0,o._)(["\n  cursor-pointer items-center bg-danger-900/50 hover:bg-danger-900/75 transition group/banner outline-danger-000/25 hover:outline-danger-000/50\n"]);return w=function(){return e},e}let _=c.J.div(j()),C=(0,c.J)(_)(b()),k=(0,c.J)(_)(y()),M=(0,c.J)(_)(w()),N=(0,i.memo)(function(e){var t;let{message:s,messageWarningPropsFromParent:n,hasLink:l,hasCode:r,hasDriveDocWithImages:o,onRetry:c,onSendContinue:j,conversationSettings:b,isLastMessage:y}=e,w=(0,g.A)(),{value:_}=(0,d.N)(null!=b?b:{}),N=null==b?void 0:b.enabled_web_search,{value:S}=(0,m.fS)("claudeai_web_search"),A=(0,i.useMemo)(()=>({a:e=>{let{node:t,...s}=e;return(0,a.jsx)("a",{...s,className:"underline"})}}),[]);if((null==n?void 0:n.style)==="prominent")return(0,a.jsxs)(k,{"data-testid":"message-warning",children:[(0,a.jsx)(p.N,{className:"shrink-0",size:16}),(0,a.jsx)(v.o,{components:A,children:n.contentMarkdown})]});let E="human"===s.sender;if(!E&&"error"===s.stop_reason&&c)return(0,a.jsxs)(M,{"data-testid":"message-warning",onClick:()=>c(s.parent_message_uuid),children:[(0,a.jsxs)("div",{className:"relative h-4 w-4 shrink-0 text-danger-000",children:[(0,a.jsx)(p.N,{className:"absolute inset-0 group-hover/banner:opacity-0 group-hover/banner:scale-75  opacity-50 transition",size:16}),(0,a.jsx)(f.o,{className:"absolute inset-0 group-hover/banner:opacity-75 group-hover/banner:rotate-0 rotate-[20deg] opacity-0 transition",size:16})]}),(0,a.jsx)("div",{className:"flex flex-grow text-danger-000",children:(0,a.jsx)(x.A,{defaultMessage:"This response didn’t load. Try again by chatting to Claude.",id:"g0FIIo0clM"})})]});if(!E&&y&&"max_tokens"===s.stop_reason&&j)return(0,a.jsx)(C,{"data-testid":"message-warning",children:(0,a.jsxs)("div",{className:"flex max-sm:flex-col gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(h.R,{className:"shrink-0",size:16}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(x.A,{defaultMessage:"This response paused because Claude reached its max length for a message. Hit continue to nudge Claude along.",id:"oje9UAHUmL"})})]}),(0,a.jsx)("div",{className:"ml-6",children:(0,a.jsx)(u.$,{variant:"secondary",size:"sm",className:"block flex-shrink-0",onClick:()=>null==j?void 0:j(),"aria-label":w.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"}),children:(0,a.jsx)(x.A,{defaultMessage:"Continue",id:"acrOozm08x"})})})]})});if(!E&&y&&(null==(t=s.metadata)?void 0:t.is_resume_completion_placeholder_message))return(0,a.jsx)("div",{className:"m-2 w-full",children:(0,a.jsx)(C,{"data-testid":"message-warning",children:(0,a.jsx)("div",{className:"p-1",children:(0,a.jsx)(x.A,{defaultMessage:"Claude is still creating a response in the background. Once it’s complete, you’ll see it here.",id:"PBOdLw2o4Z"})})})});let z=[];return(E?(l&&!N&&(S?z.push(w.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search to get up to date info from web links.",id:"fPI2JySdII"})):z.push(w.formatMessage({defaultMessage:"Claude does not have internet access and cannot get up to date info from web links.",id:"SXpasVsDUZ"}))),o&&z.push(w.formatMessage({defaultMessage:"Claude cannot yet access images from Google Docs.",id:"8Wb1yCJBBv"}))):(l&&!N&&(S?z.push(w.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search for up to date and accurate links.",id:"sN35Yf2Rzl"})):z.push(w.formatMessage({defaultMessage:"Claude does not have internet access. Links provided may not be accurate or up to date.",id:"c8NyKXBwfo"}))),!r||_||(null==b?void 0:b.enabled_monkeys_in_a_barrel)||z.push(w.formatMessage({defaultMessage:"Claude does not have the ability to run the code it generates yet.",id:"dSVZQBKb/U"})),s.stop_reason,"conversation_length_limit"===s.stop_reason&&z.push(w.formatMessage({defaultMessage:"Claude hit the maximum length for this conversation. Please start a new conversation to continue chatting with Claude.",id:"jujWu4WTLz"})),n&&z.push(n.contentMarkdown)),0===z.length)?null:(0,a.jsxs)(C,{"data-testid":"message-warning",children:[(0,a.jsx)(h.R,{className:"shrink-0",size:16}),(0,a.jsx)(v.o,{components:A,children:z.reverse().join(" ")})]})});var S=s(88769);let A=e=>{let{message:t,isLastMessage:s,conversationSettings:n,messageWarningPropsFromParent:i,hasDriveDocWithImages:l,onRetry:r,onSendContinue:o}=e,d=(0,S.LR)(t.uuid),c=(0,S.Kc)(t.uuid);return(0,a.jsx)(N,{message:t,hasLink:d,hasCode:c,isLastMessage:s,hasDriveDocWithImages:l,conversationSettings:n,messageWarningPropsFromParent:i,onRetry:r,onSendContinue:o})};function E(){let e=(0,o._)(["\n  group\n  relative\n  inline-flex\n  gap-2\n  bg-bg-300\n  rounded-xl\n  pl-2.5\n  py-2.5\n  break-words\n  text-text-100\n  transition-all\n  max-w-[75ch]\n  flex-col\n"]);return E=function(){return e},e}function z(){let e=(0,o._)(["\n  group\n  relative\n"]);return z=function(){return e},e}function T(){let e=(0,o._)(["\n  font-claude-response\n  relative\n  leading-[1.65rem]\n  [&_pre>div]:bg-bg-000/50\n  [&_pre>div]:border-0.5\n  [&_pre>div]:border-border-400\n  [&_.ignore-pre-bg>div]:bg-transparent\n  [&_.standard-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2\n  [&_.standard-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8\n  [&_.progressive-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2\n  [&_.progressive-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8\n"]);return T=function(){return e},e}let I={initial:!1,animate:{y:0,opacity:1}},U={initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{type:"spring",damping:10,stiffness:100}},L={initial:{scale:1.02,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"}},R={initial:{height:"0px",opacity:0},animate:{height:"auto",opacity:1},transition:{ease:"linear",duration:.1}},O=(0,c.J)(r.P.div)(E()),F=(0,c.J)(r.P.div)(z()),D=c.J.div(T());var P=s(86545),B=s(14691),G=s(64371),W=s(57291),J=s(41473),V=s(72902),H=s(39109),q=s(24407),Y=s(13644),K=s(10665),X=s(1613),$=s(57820),Z=s(96614),Q=s(98944),ee=s(87483),et=s(1720),es=s(3075),ea=s(29820),en=s(88775),ei=s(69351);function el(e){let{isOpen:t,onClose:s,conversationUuid:n,messageUuid:i}=e;return(0,a.jsx)(es.aF,{isOpen:t,onClose:s,modalSize:"xl",hasCloseButton:!0,title:(0,a.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,a.jsx)(x.A,{defaultMessage:"Debug information",id:"NqgO+Si31g"}),(0,a.jsx)("span",{className:"ml-2 mt-px pb-px text-sm font-medium text-always-white bg-always-black px-2 rounded",children:(0,a.jsx)(x.A,{defaultMessage:"Internal use only",id:"xg5Va4c/VJ"})})]}),children:(0,a.jsx)(er,{conversationUuid:n,messageUuid:i})})}function er(e){let{conversationUuid:t,messageUuid:s}=e,{data:l,isPending:r,mutateAsync:o}=((e,t)=>{let{activeOrganization:s}=(0,n.YL)(),a=null==s?void 0:s.uuid;return(0,X.L2)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"/chat_messages/").concat(t,"/debug"),"POST")})(t,s),d=(0,en.Tc)(e=>e.model,"ChatMessageDebugModal"),c=(0,K.v)("paprika_mode"),m=(0,Q.B)(),p=(0,ei.n)(null==m?void 0:m.enabled_mcp_tools),{codeStyle:f}=(0,$.V)(),h=l?JSON.stringify(function(e){for(let[t,s]of Object.entries(e.logs.api_usage))if("string"==typeof s)try{let a=JSON.parse(s);e.logs.api_usage[t]=a}catch(e){}return e}(l),null,2):"",g=(0,Z.Z3)(t);(0,i.useEffect)(()=>{(async()=>{await o({prompt:"",model:d||g,tools:p(),personalized_styles:[],paprika_mode:c})})()},[o,d,p,c,g]);let{didCopy:v,copyToClipboard:j}=(0,G.C)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"absolute top-6 bg-bg-100 right-16 flex items-center space-x-2",children:[(0,a.jsx)(u.$,{variant:"ghost",size:"icon_sm",onClick:()=>{j(h)},prepend:(0,a.jsx)(G.u,{didCopy:v}),tooltip:(0,a.jsx)(x.A,{defaultMessage:"Copy debug information",id:"XVVZO6tEau"}),className:"ml-auto"}),(0,a.jsx)(eo,{messageUuid:s})]}),r?(0,a.jsx)("div",{className:"my-2 flex w-full items-center justify-center h-[32rem]",children:(0,a.jsx)(et.Loading,{})}):(0,a.jsx)(ea.A,{customStyle:{maxHeight:"32rem",fontSize:".875rem"},language:"json",PreTag:"div",style:f,children:h})]})}let eo=e=>{let{messageUuid:t}=e,{copyToClipboard:s}=(0,G.C)(),n=(0,g.A)(),r=(0,i.useCallback)(async()=>{let e=l.oz.getState().messageByUuid[t];if(!e)return;let a=(0,J.C)(e);await s(a)},[t,s]);return(0,a.jsx)(ee.ms,{onCloseAutoFocus:e=>{e.preventDefault()},trigger:(0,a.jsx)(u.$,{variant:"ghost",size:"icon_sm","aria-label":n.formatMessage({defaultMessage:"More options",id:"IzCVhGdYVc"}),children:(0,a.jsx)(B.FO,{})}),children:(0,a.jsxs)(ee.tJ,{onSelect:r,children:[(0,a.jsx)(B.B0,{}),(0,a.jsx)(x.A,{defaultMessage:"Copy unmodified message",id:"+yNntDpG9W"})]})})};var ed=s(95617),ec=s(69524);function eu(e){var t,s;let{conversationUuid:n,message:l}=e,[r,o]=(0,i.useState)(void 0),[d,c]=(0,i.useState)(!1),m=e=>{"flag"===e?(null==r?void 0:r.startsWith("flag"))||o(ed.kj.FLAG):r!==ed.kj.UPVOTE&&o(ed.kj.UPVOTE),c(!0)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.$,{variant:"ghost",size:"icon_sm",className:(null==(t=l.chat_feedback)?void 0:t.type.includes("upvote"))?"bg-bg-200 !text-accent-secondary-100":"",tooltip:(0,a.jsx)(x.A,{defaultMessage:"Give positive feedback",id:"FGCv00cdfW"}),onClick:()=>m("upvote"),prepend:(0,a.jsx)(B.tw,{size:16})}),(0,a.jsx)(u.$,{variant:"ghost",size:"icon_sm",className:(0,V.A)((null==(s=l.chat_feedback)?void 0:s.type.includes("flag"))&&"bg-bg-200 !text-danger-100"),tooltip:(0,a.jsx)(x.A,{defaultMessage:"Give negative feedback",id:"ngzzQUJCXB"}),onClick:()=>m("flag"),prepend:(0,a.jsx)(B.Su,{size:16})}),(0,a.jsx)(ec.B,{conversationUuid:n,message:l,requestedFeedbackType:r,setRequestedFeedbackType:o,isOpen:d,onClose:()=>c(!1)})]})}var em=s(67453);function ep(e){let{children:t,onClick:s,tooltipContent:n,Icon:i,disabled:l,"data-testid":r}=e,o=(0,a.jsx)(u.$,{variant:"ghost",size:"sm",className:"!font-base !px-2 !h-7 !min-w-0",onClick:s,disabled:l,"data-testid":r,children:i||t});return n?(0,a.jsx)(em.Tooltip,{tooltipContent:n,children:o}):o}var ef=s(21266),eh=s(47147);function eg(e){let{paprikaMode:t,supportedPaprikaModes:s,onRetry:n,parentMessageUuid:l,setPaprikaModeState:r}=e,[o,d]=(0,i.useState)(!1),c=(0,eh.Wi)().filter(e=>e.paprika_mode_value&&e.paprika_mode_value!==t&&s.includes(e.paprika_mode_value)),m=(0,i.useCallback)((e,t)=>{n(e,t),r(t)},[n,r]);return(0,a.jsxs)(ee.ms,{align:"start",unstyledTrigger:!0,onCloseAutoFocus:e=>e.preventDefault(),open:o,onOpenChange:d,trigger:(0,a.jsx)(u.$,{variant:"ghost",size:"sm",className:"!font-base select-none !pl-2 !pr-1",append:(0,a.jsx)(B.bi,{className:"text-text-500"}),children:(0,a.jsx)(x.A,{defaultMessage:"Retry",id:"62nsdyMyIO"})}),children:[(0,a.jsx)(ee.tJ,{className:"text-sm",onClick:()=>n(l),children:(0,a.jsx)(x.A,{defaultMessage:"With no changes",id:"h3WdKJh51e"})}),c.map(e=>(0,a.jsx)(ee.tJ,{className:"text-sm",onClick:()=>m(l,e.paprika_mode_value),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex flex-col",children:"extended"===e.id?(0,a.jsx)(x.A,{defaultMessage:"With extended thinking",id:"/zFAxhC9JS",description:"Lets the user try again using a different thinking mode"}):"With ".concat(e.title.toLowerCase()," thinking")}),(0,a.jsx)("div",{className:"text-text-500 text-xs",children:e.description_key?(0,a.jsx)(ef.X5,{id:e.description_key}):e.description})]})},e.id))]})}var ex=s(87017);let ev={default:{allowed:"never"}},ej=q.z.record(q.z.object({allowed:q.z.enum(["never","first_turn","always"])})),eb=e=>{let{isStreaming:t,isLastMessage:s,isInteractive:n,isAssistant:i,children:l}=e;return(0,a.jsx)(H.N,{children:!t&&(0,a.jsx)(r.P.div,{className:"absolute bottom-0 right-2 pointer-events-none",initial:{scale:.95},animate:{scale:1},transition:{type:"spring",damping:30,stiffness:400},children:(0,a.jsx)("div",{className:(0,V.A)("rounded-lg transition min-w-max pointer-events-auto",i?"translate-x-2":"translate-y-4 bg-bg-100/80 backdrop-blur-sm translate-x-1 group-hover:translate-x-0.5 border-0.5 border-border-300 p-0.5 shadow-sm",s?"translate-y-full pt-2":"opacity-0 group-hover:opacity-100"),children:l})})})},ey=(0,i.memo)(function(e){var t,s,n,r,o,d;let{message:c,previousMessage:p,conversationUuid:f,isStreaming:h,isTemporary:g=!1,onRetry:v,isLastMessage:j,isLastHumanMessage:b=!1,isInteractive:y=!0,changeDisplayedConversationPath:w,editMessage:_,editable:C=!1,isFirstAssistantMessage:k,isResearchPending:M,model:N,extendedThinkingSetting:S,showArtifacts:A=!1,chatFeedbackEnabled:E}=e,[z,T]=(0,i.useState)(!1),I="human"===c.sender,U="assistant"===c.sender,L=h&&j,{value:R}=(0,m.fS)("anthropic_internal_only_expose_chat_debug"),O=!h&&(null!=(r=c.nOptions)?r:0)>1&&w,F=!h&&!M&&C&&_&&c.parent_message_uuid&&y,D=null==c||null==(t=c.content)?void 0:t.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),V=!h&&!M&&y&&!D,{didCopy:H,copyToClipboard:q}=(0,G.C)(),X=(0,i.useCallback)(async()=>{let e=l.oz.getState().messageByUuid[c.uuid],t=(0,J.C)(e),s=(A?(0,W.it)(t):t).trim();try{let e=(0,ex.u)(s);await q({text:s,html:e})}catch(e){await q(s)}},[A,c.uuid,q]),$=(0,Y.QY)(),{toggleConversationSetting:Z}=(0,K.r)(),Q=(0,i.useCallback)(e=>{Z("paprika_mode",null!=e?e:null)},[Z]),{allModelOptions:ee}=(0,P.A9)(),et=(0,m.iW)("claude_ai_paprika_retry",ev,ej),es=null!=(d=null!=(o=N&&(null==(s=et[N])?void 0:s.allowed))?o:null==(n=et.default)?void 0:n.allowed)?d:"never";if(I&&!F&&!O)return null;let ea=ee.find(e=>e.model===N),en=null==ea?void 0:ea.paprika_modes,ei=en&&en.length>0&&!S&&("always"===es||"first_turn"===es&&k);return(0,a.jsx)(eb,{isStreaming:L,isLastMessage:j||b,isInteractive:y,isAssistant:U,children:(0,a.jsxs)("div",{className:"text-text-300 flex items-stretch justify-between",children:[U&&R&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.$,{variant:"ghost",size:"icon_sm",tooltip:(0,a.jsx)(x.A,{defaultMessage:"Debug",id:"z3UjXRZwzQ"}),onClick:()=>T(!0),prepend:(0,a.jsx)(B.IF,{})}),(0,a.jsx)(el,{isOpen:z,onClose:()=>T(!1),messageUuid:c.uuid,conversationUuid:f})]}),I&&F&&(0,a.jsx)(ep,{onClick:()=>_(c,"test edit message"),children:(0,a.jsx)(x.A,{defaultMessage:"Edit",id:"wEQDC6Wv3/"})}),U&&(0,a.jsx)(u.$,{variant:"ghost",size:"icon_sm",onClick:X,"data-testid":"action-bar-copy",tooltip:(0,a.jsx)(x.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),prepend:(0,a.jsx)(G.u,{didCopy:H})}),U&&!L&&!M&&y&&"error"!==c.stop_reason&&(void 0!==E?E:$)&&!g&&(0,a.jsx)(eu,{conversationUuid:f,message:c}),(0,a.jsxs)("div",{className:"flex items-center",children:[O&&(0,a.jsx)(ew,{message:c,changeDisplayedConversationPath:w}),U&&V&&(ei?(0,a.jsx)(eg,{paprikaMode:S,supportedPaprikaModes:en,onRetry:v,parentMessageUuid:c.parent_message_uuid,setPaprikaModeState:Q}):(0,a.jsx)(ep,{onClick:()=>v(c.parent_message_uuid),children:(0,a.jsx)(x.A,{defaultMessage:"Retry",id:"62nsdyMyIO"})}))]})]})})});function ew(e){var t;let{message:s,changeDisplayedConversationPath:n}=e,i=(null!=(t=s.selectedOption)?t:0)+1,l=i===s.nOptions;return(0,a.jsxs)("div",{className:"inline-flex items-center gap-1",children:[(0,a.jsx)(u.$,{variant:"ghost",size:"icon_xs",disabled:1===i,onClick:()=>n(s,-1),children:(0,a.jsx)(B.ZK,{})}),(0,a.jsx)("span",{className:"self-center shrink-0 select-none font-small text-text-300",children:(0,a.jsx)(x.A,{defaultMessage:"{selectedOption} / {totalOptions}",id:"0zCqdBEnn7",values:{selectedOption:i,totalOptions:s.nOptions}})}),(0,a.jsx)(u.$,{variant:"ghost",size:"icon_xs",disabled:l,onClick:()=>n(s,1),children:(0,a.jsx)(B.K3,{})})]})}var e_=s(74813),eC=s(9398),ek=s(26752),eM=s(66365),eN=s(79052);let eS=()=>{let e=(0,e_.st)(),{initDriveAuth:t}=(0,eN.cI)({});return(0,i.useEffect)(()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.displayed"})},[e]),(0,a.jsx)(eA,{title:(0,a.jsx)(x.A,{defaultMessage:"Add context from all your docs more easily",id:"gHPka72Ai9"}),icon:(0,a.jsx)(ek.g,{size:18}),cta:(0,a.jsxs)(u.$,{className:"bg-bg-100 border-border-300",size:"sm",variant:"outline",onClick:()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.start"}),t()},children:[(0,a.jsx)(eC.ft,{size:16,className:"mr-1"}),(0,a.jsx)(x.A,{defaultMessage:"Connect Drive",id:"XzTB2bvNw1"})]})})},eA=e=>{let{title:t,icon:s,cta:n}=e;return(0,a.jsx)(r.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-3",children:(0,a.jsx)("div",{className:"overflow-hidden rounded-lg border-0.5 border-border-300 bg-bg-100 shadow-sm",children:(0,a.jsx)("div",{className:"px-2.5 py-2.5",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"rounded-lg bg-primary-100 p-1",children:s}),(0,a.jsx)("h3",{className:"text-sm text-text-100",children:t})]}),n]})})})})},eE=e=>{let{previousMessage:t}=e,s=(0,eN.LP)(),{isDriveAuthenticated:n}=(0,eN.cI)({}),l=(0,i.useMemo)(()=>!!t&&t.attachments.some(e=>"docx"===e.file_type),[t]),{value:r}=(0,m.fS)("pumpernickel_enabled"),o=(0,eM.useLayer)("trials_freemium").get("free_integrations",!1);return(r||o)&&s&&!n&&l?(0,a.jsx)(eS,{}):null},ez=e=>{let{title:t,text:s}=e,n=(0,g.A)();t=t||n.formatMessage({defaultMessage:"Untitled note",id:"fkEfiUjl/t"}),s=s||"";let{didCopy:i,copyToClipboard:l}=(0,G.C)(),r=async()=>{let e=t+"\n"+s;try{let t=(0,ex.u)(e);await l({text:e,html:t})}catch(t){await l(e)}};return(0,a.jsxs)("div",{className:"group relative mt-4 mb-1 rounded-2xl border-border-300/25 border font-claude-response-body",children:[(0,a.jsxs)("div",{className:"pt-1 pb-1 px-3 border-b-0.5 border-border-300/25 font-semibold flex justify-between items-center",children:[(0,a.jsx)("span",{className:"flex-1",children:t}),(0,a.jsx)(u.$,{variant:"ghost",size:"icon_sm",onClick:r,children:(0,a.jsx)(G.u,{didCopy:i})})]}),(0,a.jsx)(v.o,{className:"px-4 pt-2 pb-4",children:s})]})};var eT=s(787),eI=s(20804),eU=s(39510),eL=s(79383),eR=s(72062),eO=s(7881),eF=s(44007),eD=s(96547),eP=s(50571),eB=s(73648),eG=s(35580);let eW=(0,i.memo)(e=>{var t,s,n;let{conversationUuid:l,block:r,message:o,updatedMessage:d,index:c,shareType:u,isStreaming:m,isLastMessage:p,publishedArtifacts:f,isFirstBlockOfMessage:h,isLastBlockOfMessage:g,renderMode:x,isFirstItemInGroup:v,isLastItemInGroup:j}=e,{renderToolUseCell:b}=(0,eO.Q)(),y=(0,eR.Y)(r),w=r.name,_=r.id,C=r.context,k=null==(t=d.content)?void 0:t[c+1],M=(null==k?void 0:k.type)==="tool_result"?k:void 0,N=function(e,t,s,a,n,l){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=null!=l?l:"{}",d=(0,ei.M)(),{track:c}=(0,e_.st)(),u=(0,eF.p9)(),m=(0,eP.HJ)(),{mutate:p}=(0,eD.p4)(e),{toggleMcpToolAlwaysApproved:f}=(0,eP.es)(),[h,g]=(0,i.useState)(r),x=(0,eG.pK)(t),v=(null==x?void 0:x.tool)||null,j=(null==x?void 0:x.server)||null,b=u&&(null==j?void 0:j.type)==="remote",{getApprovalSetting:y}=(0,eP.BN)(),w=y(null==j?void 0:j.name,v),_=a?a.includes("always"):"ask"===w,C=m&&!!s,k=C&&!!v&&(u?!!a&&!!n:"never"!==w),M=(0,i.useCallback)(a=>{if(C&&v&&!h){if("always"!==a||n||f(v.alwaysApprovedKey,!0),"deny"===a)if(b)p({tool_use_id:s,is_approved:!1,approval_key:n});else{var i;d(e,t,s,o,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),c({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!=(i=(0,eB.p)(o))?i:{}).length})}else b?p({tool_use_id:s,is_approved:!0,approval_key:n,approval_option:a}):d(e,t,s,o);g(!0)}},[C,h,v,n,f,b,p,d,e,t,s,o,c,g]);return!C||k||h||b||!l||(d(e,t,s,o),g(!0)),(0,i.useMemo)(()=>({approvalRequired:k&&!h,disabled:!l,submitToolApproval:M,showAlwaysAllowed:_}),[k,l,h,M,_])}(l,r.name,r.id,r.approval_options,r.approval_key,r.buffered_input,!!M),S=!!d.content&&d.content.length<=c+1&&m,A=((e,t,s)=>{var a,n,i,l;let r,o,d,c=(null==t?void 0:t.type)==="tool_use"&&(null==t?void 0:t.name)==="artifacts",u=(null==e?void 0:e.type)==="tool_use"&&(null==e?void 0:e.name)==="artifacts";s.partial_json?s.partial_json.includes('"command":"create"')&&(r=(e=>{let t=e.match(/"id"\s*:\s*"([^"]*)"/);return t?t[1]:void 0})(s.partial_json)):r=null==(n=s.input)?void 0:n.id,u&&(o=null==e||null==(i=e.input)?void 0:i.id),!c||(null==t?void 0:t.partial_json)||(d=null==t||null==(l=t.input)?void 0:l.id);let m=r===o,p=r===d,f="individual_cell_create",h=null==(a=s.input)?void 0:a.command;if(h&&(f=({create:"individual_cell_create",update:"individual_cell_update",rewrite:"individual_cell_rewrite"})[h]),!c&&!u)return f;if(c&&u)if(!m&&!p)return f;else if(m&&!p)return"multi_edit_last";else return"multi_edit_not_last";if(c&&!u)if(!p)return f;else return"multi_edit_not_last";if(!c&&u&&m)return"multi_edit_last";return f})(null==(s=d.content)?void 0:s[c-2],null==(n=d.content)?void 0:n[c+2],r);if(!b)throw Error("renderToolUseCell() is not provided, missing ChatMessageContext?");let E=(0,i.useMemo)(()=>b({toolUseId:_,input:y,isLastMessage:p,message:o,publishedArtifacts:f,isStreaming:S,toolName:w,toolResult:M,displayData:{integrationName:r.integration_name,integrationIcon:r.integration_icon_url,message:(null==M?void 0:M.message)||r.message,input:r.display_content,result:null==M?void 0:M.display_content},approvalData:N,artifactCellType:A,isFirstBlockOfMessage:h,isLastBlockOfMessage:g,shareType:u,context:C,renderMode:x,groupItemKey:String(c),isFirstItemInGroup:v,isLastItemInGroup:j}),[N,A,r.display_content,r.integration_icon_url,r.integration_name,r.message,C,c,y,h,v,g,j,p,o,f,x,b,u,S,w,M,_]);return(0,a.jsx)(i.Fragment,{children:E})});eW.displayName="ToolUse";var eJ=s(20680),eV=s(26434),eH=s(53270),eq=s(96091);function eY(e){let{text:t,conversationUuid:s,onOpen:n,onDownloadAll:l,shareType:r}=e,o=(0,i.useMemo)(()=>(0,eq.n)(t).filter(e=>(0,eV.m)(e,r)),[t,r]);return 0===o.length?null:(0,a.jsxs)("div",{className:"flex flex-col gap-2 py-2",children:[o.map(e=>{let t=e.split("/").pop()||e;return(0,a.jsx)(eH._,{conversationUuid:s,file:{name:t,path:e},onOpen:()=>{n(e)},isShared:!!r},e)}),o.length>1&&(0,a.jsx)("div",{children:(0,a.jsx)(u.$,{variant:"outline",prepend:(0,a.jsx)(eJ.e,{size:"1.1rem"}),onClick:()=>{l(o)},children:(0,a.jsx)(x.A,{defaultMessage:"Download all",id:"V1UrPNM96z"})})})]})}var eK=s(48321),eX=s(18849),e$=s(58841),eZ=s(37380),eQ=s(84656),e0=s(54130);let e1=["year","month","day","hour","minute","second","millisecond"],e2=e=>{let{value:t,...s}=e;return function(e,t){let{listStyle:s,...a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e0.dw.fromDurationLike(t);return e.formatList(e1.filter(e=>0!==n["".concat(e,"s")]).map(t=>e.formatNumber(n["".concat(t,"s")],{...a,style:"unit",unit:t})),{...a,style:s})}((0,g.A)(),t,s)};var e3=s(45312),e4=s(19664),e6=s.n(e4),e5=s(99411),e8=s(72253);function e7(){let e=(0,o._)(["\nbg-bg-100 text-text-300 border-0.5 border-border-300 flex flex-row gap-1.5 rounded-md p-2 mx-4 mb-4 font-small"]);return e7=function(){return e},e}function e9(e,t){if(!e)return;let s=(t?e3.c9.fromISO(t):e3.c9.now()).diff(e3.c9.fromISO(e),["hours","minutes","seconds"]);return 0>s.toMillis()?e3.dw.fromMillis(0):s}let te=c.J.div(e7()),tt=()=>(0,a.jsxs)(te,{"data-testid":"message-warning",children:[(0,a.jsx)(B.R2,{className:"shrink-0",size:16}),(0,a.jsx)(x.A,{defaultMessage:"The rest of the <link>thought process</link> is not available for this response.",id:"G/67Pe5XhQ",values:{link:e=>(0,a.jsx)(e6(),{href:"https://support.anthropic.com/en/articles/10574485-using-extended-thinking-on-claude-3-7-sonnet",className:"underline",target:"_blank",children:e})}})]}),ts=e=>{let{text:t,cutOff:s}=e;return(0,a.jsxs)("div",{className:"text-text-300 text-sm font-normal gap-0.5 relative font-claude-response",children:[(0,a.jsx)(eL.fP,{className:"p-3 pt-0 pr-8",text:t}),!0!==s?null:(0,a.jsx)(tt,{})]})},ta=(0,i.memo)(e=>{let t,{index:s,text:n,cutOff:l=!1,startTimestamp:o,stopTimestamp:d,isStreaming:c,mostRecentSummary:u,onToggle:m,messageUuid:p,isFirstBlockOfMessage:f,isLastBlockOfMessage:h,renderMode:x=eT.l.Standard,isFirstItemInGroup:v,isLastItemInGroup:j}=e,b=(0,eM.useDynamicConfig)("claudeai_isp_thinking_ux"),y=b.get("enabled",!1),w=(0,g.A)(),_=w.formatMessage({defaultMessage:"Thinking",id:"AHQWDTo4+e"}),C=w.formatMessage({defaultMessage:"Thinking...",id:"QrZMdiKa7h"}),k=w.formatMessage({defaultMessage:"Thought process",id:"zl6fNbo7RW"}),{isExpanded:M,setIsExpanded:N,snappyTransition:S}=(0,e8.a)(!y&&c,String(s)),A=(0,e_.st)(),[E,z]=(0,i.useState)(()=>e9(o,d)),T=(0,i.useRef)(void 0),I=(0,i.useRef)(!1),[U,L]=(0,i.useState)(null),R=(0,i.useRef)([]);(0,i.useEffect)(()=>{(0,eZ.GN)(p)&&R.current.length>0&&(R.current.forEach(e=>{A.track({event_key:"claudeai.thinking_cell.clicked",is_opening:e.isOpening,is_streaming:e.wasStreamingWhenClicked,chat_message_uuid:p,timestamp:e.timestamp})}),R.current=[])},[p,A]),(0,i.useEffect)(()=>{c&&(I.current=!0)},[c]);let O=c||I.current?b.get("fallback_summary_debounce_ms",2e3):0;(0,eQ.W)(()=>{!c&&n.length>0&&L(tn(n,b))},[n,c],O),(0,i.useEffect)(()=>{let e=()=>{let e=e9(o,void 0);T.current=e,z(e)};if(c){e();let t=setInterval(e,1e3);return()=>clearInterval(t)}!T.current&&d&&z(e9(o,d))},[o,d,c]);let F=null==u?void 0:u.summary;if(y)if(c)t=null!=F?F:C;else{var D;t=null!=(D=null!=F?F:U)?D:C}else t=null!=F?F:c?_:k;return(0,a.jsx)(e5.sH,{isStreaming:c,isExpanded:M,setIsExpanded:()=>{let e=new Date().toISOString();(0,eZ.GN)(p)?A.track({event_key:"claudeai.thinking_cell.clicked",is_opening:!M,is_streaming:c,chat_message_uuid:p,timestamp:e}):R.current.push({isOpening:!M,wasStreamingWhenClicked:c,timestamp:e}),N(!M)},isFirstBlockOfMessage:f,isLastBlockOfMessage:h,text:M?k:c||T.current?(0,a.jsx)(H.N,{mode:"wait",children:(0,a.jsx)(r.P.span,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.3,ease:"easeIn"},className:y?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t},t)}):(0,a.jsx)("span",{className:y?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t}),secondaryText:E&&E.as("seconds")>=10?(0,a.jsxs)("span",{className:"flex items-center gap-1 transition-opacity",children:[(0,a.jsx)(B.Sw,{className:(0,V.A)("text-text-300 transition-all duration-300 ease-in-out opacity-50",c?"!opacity-0 scale-50":"scale-100 opacity-100"),size:12}),(0,a.jsx)("span",{className:"tabular-nums",children:(0,a.jsx)(e2,{value:E,listStyle:"narrow",unitDisplay:"narrow",maximumFractionDigits:0})})]}):void 0,renderMode:x,isFirstItemInGroup:v,isLastItemInGroup:j,children:(0,a.jsx)(e5.NG,{isExpanded:M,snappyTransition:S,onTransitionEnd:m,isScrollable:!0,children:(0,a.jsx)(ts,{text:n,cutOff:l})})})});ta.displayName="ThinkingCell";let tn=(e,t)=>{let s=t.get("fallback_summary_min_len",50),a=t.get("fallback_summary_max_len",100),n=new RegExp(t.get("fallback_summary_regex",".*(\\n|\\.(\\s|$)|。)")),i=e.substring(0,a),l=n.exec(i);if(l)return l[0];for(let e=i.length-1;e>=s;e--)if(/\s/.test(i[e]))return i.substring(0,e+1);return i},ti=(0,i.memo)(e=>{var t;let s,{block:n,index:i,isThisMessageStreaming:l,blocksCount:r}=e,{value:o}=(0,m.fS)("empty_your_cup");if(!o||"text"!==n.type&&"thinking"!==n.type&&"tool_use"!==n.type||!(!l||i<r-1))return null;let d=new Set(null!=(t=n.flags)?t:[]);return(d.has("a2")?s=(0,a.jsx)(ef.YX,{id:"curvature_propulsion_drive"}):d.has("a1")&&(s=(0,a.jsx)(ef.YX,{id:"bubble_universe_portal"})),s)?(0,a.jsx)("div",{className:"px-1.5 py-0.5 mx-2 my-1 opacity-80 text-xs font-ui bg-danger-900 text-danger-000 rounded border-0.5 border-danger-200 select-none",children:s},"flag-".concat(i)):null});ti.displayName="FlagMessage";let tl=(0,i.memo)(e=>{let{block:t,index:s,blocks:l,isStreaming:r,isThisMessageStreaming:o,isLastMessage:d,updatedMessage:c,message:u,onResize:m,conversationUuid:p,shareType:f,publishedArtifacts:h,onOpenArtifact:g,onOpenWiggleFile:x,...v}=e,{renderMode:j,isFirstItemInGroup:b,isLastItemInGroup:y}=v,w=(0,e_.st)(),{setMessageFeatures:_}=(0,S.Bk)(),C=l[s+1],k=l.length,M=(null==C?void 0:C.type)==="tool_result",N=0===s,A=!!k&&s===k-1-!!M,E=(0,i.useCallback)(e=>null==g?void 0:g(e,c.uuid),[g,c.uuid]),z=(0,i.useCallback)(()=>{_(u.uuid,{hasLink:!0})},[_,u.uuid]),T=(0,i.useCallback)(()=>{_(u.uuid,{hasCode:!0})},[_,u.uuid]),{activeOrganization:I}=(0,n.YL)(),{dispatchChatResource:U}=(0,e$.i)(),{setIsDrawerExpanded:L}=(0,eX.x)(),R=(0,i.useCallback)((e,t)=>{t.startsWith("computer://")&&(null==I?void 0:I.uuid)&&(e.preventDefault(),U({type:"SELECT_FILE",path:t.replace("computer://",""),toolType:"create_file",messageId:c.uuid}),L(!0))},[null==I?void 0:I.uuid,U,L,c.uuid]),O=(0,i.useCallback)(e=>{(null==I?void 0:I.uuid)&&(0,eK.y)(f?{filepaths:e,orgUuid:null==I?void 0:I.uuid,snapshotUuid:p,isShared:!0,source:"wiggle_file_card_download_all"}:{filepaths:e,orgUuid:null==I?void 0:I.uuid,conversationUuid:p,isShared:!1,source:"wiggle_file_card_download_all"},w)},[null==I?void 0:I.uuid,f,p,w]),F=(0,i.useCallback)(()=>{null==m||m()},[m]),D=(0,i.useCallback)(e=>{null==x||x(e,u.uuid)},[x,u.uuid]),P=(0,i.useCallback)(e=>{null==O||O(e)},[O]),B=(0,i.useMemo)(()=>{switch(t.type){case"thinking":var e;return(0,a.jsx)(ta,{index:s,text:t.thinking,cutOff:t.cut_off,startTimestamp:t.start_timestamp,stopTimestamp:t.stop_timestamp,isStreaming:o&&!t.stop_timestamp,mostRecentSummary:null==(e=t.summaries)?void 0:e.at(-1),messageUuid:c.uuid,onToggle:F,isFirstBlockOfMessage:N,isLastBlockOfMessage:A,renderMode:j,isFirstItemInGroup:b,isLastItemInGroup:y},s);case"tool_use":return(0,a.jsx)(eW,{conversationUuid:p,block:t,message:u,updatedMessage:c,index:s,shareType:f,isStreaming:r,isLastMessage:d,publishedArtifacts:h,isFirstBlockOfMessage:N,isLastBlockOfMessage:A,renderMode:j||eT.l.Standard,isFirstItemInGroup:b,isLastItemInGroup:y},s);case"text":if(0===s&&""===t.text)return;return(0,a.jsxs)(i.Fragment,{children:[o?(0,a.jsx)(eU.qO,{text:t.text,blockCitations:t.citations,onLinkDetected:z,onCodeDetected:T,className:"progressive-markdown",isStreaming:r,onOpenArtifact:E,isLastMessage:d,publishedArtifacts:void 0,onLinkClick:R}):(0,a.jsx)(eL.fP,{text:t.text,blockCitations:t.citations,onLinkDetected:z,onCodeDetected:T,className:"standard-markdown",isStreaming:r,onOpenArtifact:E,isLastMessage:d,publishedArtifacts:h,onLinkClick:R}),(0,a.jsx)(eY,{text:t.text,onOpen:D,conversationUuid:p,onDownloadAll:P,shareType:f})]},"".concat(s,"-").concat(o?"streaming":"static"));default:return null}},[t,p,s,N,b,A,y,d,r,o,u,T,P,R,z,E,D,F,h,j,f,c]);return(0,a.jsxs)(a.Fragment,{children:[B,(0,a.jsx)(ti,{block:t,blocksCount:l.length,index:s,isThisMessageStreaming:o})]})});tl.displayName="Block";let tr=(0,i.memo)(e=>{let{blocks:t,isStreaming:s,isThisMessageStreaming:n,isLastMessage:l,updatedMessage:r,message:o,onResize:d,conversationUuid:c,shareType:u,publishedArtifacts:p,onOpenArtifact:f,onOpenWiggleFile:h}=e,g=(0,eM.useDynamicConfig)("claudeai_isp_thinking_ux"),{value:x}=(0,m.fS)("claudeai_collapse_timeline_groups"),v=(0,i.useMemo)(()=>{let e=[],s=new Set;return t.forEach((a,n)=>{if(!s.has(n))if((0,eI.Ih)(a,g)){let i={items:[{block:a,index:n,renderable:(0,eI.h4)(a)}],startIndex:n,isLastBlockOfMessage:!1};for(let e=n+1;e<t.length;e++){let a=t[e];if(!(0,eI.Ih)(a,g))break;i.items.push({block:a,index:e,renderable:(0,eI.h4)(a)}),s.add(e),e===t.length-1&&(i.isLastBlockOfMessage=!0)}let l=i.items.findLastIndex(e=>"tool_use"===e.block.type&&"artifacts"===e.block.name);l>=0&&(i.items=i.items.slice(0,l),i.items.forEach(e=>{"tool_use"===e.block.type&&"artifacts"===e.block.name&&(e.renderable=!1)})),0===i.items.filter(e=>e.renderable).length?e.push({type:"single",content:a,index:n}):e.push({type:"group",content:i,index:n})}else e.push({type:"single",content:a,index:n})}),e},[t,g]);return(0,a.jsx)(a.Fragment,{children:v.map(e=>{if("group"===e.type){let i=e.content,m=i.items.filter(e=>e.renderable);if(m.length<=1){let m=i.items[0];return m?(0,a.jsx)(tl,{block:m.block,index:m.index,blocks:t,isLastMessage:l,isStreaming:s,isThisMessageStreaming:n,updatedMessage:r,message:o,onResize:d,conversationUuid:c,shareType:u,publishedArtifacts:p,onOpenArtifact:f,onOpenWiggleFile:h},"block-".concat(e.type,"-").concat(e.index)):null}return(0,a.jsx)(eI.DT,{isFirstBlockOfMessage:0===i.startIndex,isLastBlockOfMessage:i.isLastBlockOfMessage,isStreaming:s,children:m.map((e,g)=>{let v=x&&i.items.length>2;return(0,a.jsx)(tl,{block:e.block,index:e.index,blocks:t,renderMode:eT.l.TimelineGroup,isFirstItemInGroup:0===g&&!v,isLastItemInGroup:g===m.length-1,isLastMessage:l,isStreaming:s,isThisMessageStreaming:n,updatedMessage:r,message:o,onResize:d,conversationUuid:c,shareType:u,publishedArtifacts:p,onOpenArtifact:f,onOpenWiggleFile:h},e.index)})},"block-".concat(e.type,"-").concat(e.index))}return(0,a.jsx)(tl,{block:e.content,index:e.index,blocks:t,onResize:d,conversationUuid:c,shareType:u,publishedArtifacts:p,onOpenArtifact:f,onOpenWiggleFile:h,isThisMessageStreaming:n,isLastMessage:l,updatedMessage:r,message:o,isStreaming:s},"block-".concat(e.type,"-").concat(e.index))})})});tr.displayName="MessageBlocksRenderer";let to=(0,i.memo)(e=>{var t,s,n;let{isStreaming:i,isThisMessageStreaming:l,isLastMessage:o,updatedMessage:d,onResize:c,previousMessage:u,message:m,isInteractive:p,isFirstAssistantMessage:f,onRetry:h,isResearchPending:g,isTemporary:x,conversationSettings:v,messageWarningPropsFromParent:j,onSendContinue:b,onOpenArtifact:y,shareType:w,publishedArtifacts:_,onOpenWiggleFile:C,...k}=e;if((!d.content||!d.content[0])&&!(null==(t=d.metadata)?void 0:t.is_resume_completion_placeholder_message))return null;let M=k.conversationUuid.startsWith("session_");return(0,a.jsx)(r.P.div,{style:{height:"auto"},...i?R:I,children:(0,a.jsxs)(F,{"data-is-streaming":l,...i?U:I,className:o?"pb-3":"pb-8",children:[(0,a.jsx)(D,{children:(0,a.jsx)(tr,{blocks:d.content||[],isStreaming:i,isThisMessageStreaming:l,isLastMessage:o,updatedMessage:d,message:m,onResize:c,conversationUuid:k.conversationUuid,shareType:w,onOpenWiggleFile:C,publishedArtifacts:_,onOpenArtifact:y})}),null==(s=d.content)?void 0:s.map((e,t)=>{if("bell"===e.type||"voice_note"===e.type)return(0,a.jsx)(ez,{text:e.text,title:e.title},t)}),!i&&o&&(0,a.jsx)(eE,{previousMessage:u}),!M&&(0,a.jsx)(ey,{message:m,previousMessage:u,isLastMessage:o,isInteractive:p,isFirstAssistantMessage:f,onRetry:h,isResearchPending:g,isTemporary:x,showArtifacts:null!=(n=null==v?void 0:v.preview_feature_uses_artifacts)&&n,isStreaming:i,...k}),(0,a.jsx)(A,{message:m,isLastMessage:o,messageWarningPropsFromParent:j,conversationSettings:v,onRetry:h,onSendContinue:b})]})})});to.displayName="AssistantMessage";var td=s(83158),tc=s(45533),tu=s(13750),tm=s(18800);let tp=(0,i.memo)(e=>{var t,s,n;let{isStreaming:l,currentEdit:r,setCurrentEdit:o,finishEdit:d,cancelEdit:c,author:m,loggedInAccount:p,message:f,selectAttachment:g,showSharedImageMissing:v=!1,showSharedFileMissing:j=!1}=e,b=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=e=>{if("Enter"!==e.key||e.shiftKey||(e.preventDefault(),d()),"Escape"===e.key&&(e.preventDefault(),c()),"a"===e.key&&(e.metaKey||e.ctrlKey)&&document.activeElement===b.current){var t;null==(t=b.current)||t.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d,c,b]);let y=null!=(n=f.files_v2)?n:f.files,w=v||j||f.attachments.length+y.length+((null==f||null==(t=f.sync_sources)?void 0:t.length)||0)>0;return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d()},children:[w&&(0,a.jsxs)("div",{className:"mx-0.5 mb-3 flex flex-wrap gap-0.5",children:[y.map((e,t)=>(0,a.jsx)(td.NM,{size:"lg",file:e},t)),f.attachments.map((e,t)=>(0,a.jsx)(td.NM,{size:"lg",file:e,onClick:()=>null==g?void 0:g(e)},t)),null==f||null==(s=f.sync_sources)?void 0:s.map(e=>(0,a.jsx)(tm.V,{uuid:e.uuid,syncSource:e},e.uuid)),v&&(0,a.jsx)(td.sv,{}),j&&!v&&(0,a.jsx)(td.lD,{})]}),(0,a.jsx)(O,{...l?L:I,className:"w-full",children:(0,a.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,a.jsx)("div",{className:"flex shrink-0 items-center",children:(0,a.jsx)(tc.e,{name:m||(null==p?void 0:p.full_name)||"",size:"sm"})}),(0,a.jsxs)("div",{className:"font-ui mr-3 grid w-full grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6",children:[(0,a.jsx)(tu.fs,{value:r,onChange:e=>o(e.target.value),autoFocus:!0,className:"w-full",ref:b}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"text-text-300 flex flex-row items-center gap-2 text-xs",children:[(0,a.jsx)(h.R,{"aria-hidden":"true",className:"shrink-0"}),(0,a.jsx)("div",{children:(0,a.jsx)(x.A,{defaultMessage:"Editing this message will create a new conversation branch. You can switch between branches using the arrow navigation buttons.",id:"zqkUZeVH+L"})})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(u.$,{onClick:c,variant:"secondary",children:(0,a.jsx)(x.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsx)(u.$,{type:"submit",disabled:0===r.length,children:(0,a.jsx)(x.A,{defaultMessage:"Save",id:"jvo0vs3nF0"})})]})]})]})]})})]})});tp.displayName="EditingMessage";var tf=s(70448),th=s(96608);th.A.blockRegex;let tg=th.A.defaultRules,tx=th.A.parserFor;th.A.defaultBlockParse;let tv=th.A.outputFor,tj=e=>{if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(tj);if(i.isValidElement(e)){if(e.props&&"object"==typeof e.props&&"children"in e.props){let t=e.props.children,s=tj(t);if(s!==t)return i.cloneElement(e,void 0,s)}return e}if((e=>"object"==typeof e&&null!==e&&"$$typeof"in e&&"type"in e&&"props"in e)(e)){let{type:t,props:s,key:a}=e,n={};return s&&"object"==typeof s&&(Object.assign(n,s),"children"in s&&(n.children=tj(s.children))),null!=a&&(n.key=a),i.createElement(t,n)}return e};var tb=s(11727);let ty={...{fence:{...tg.fence,parse:(e,t,s)=>({lang:e[2]||void 0,content:e[3]}),react:e=>(0,a.jsx)(tb.I.pre,{flagShowCodeHeader:!1,children:e.content})},blockQuote:{...tg.blockQuote,react:(e,t,s)=>(0,a.jsx)(tb.I.blockQuote,{children:t(e.content,s)})},list:{...tg.list,react:(e,t,s)=>{let n=e.ordered?tb.I.ol:tb.I.ul;return(0,a.jsx)(n,{children:e.items.map((e,n)=>(0,a.jsx)(tb.I.li,{children:t(e,s)},n))},s.key)}},newline:tg.newline,paragraph:{...tg.paragraph,react:(e,t,s)=>(0,a.jsx)(tb.I.p,{children:t(e.content,s)},s.key)},u:tg.u,del:tg.del,inlineCode:{...tg.inlineCode,react:e=>{let t=e.content;if(t&&tf.yT.test(t)){var s;if((null==(s=t.match(tf.yT))?void 0:s[0])===t)return(0,a.jsxs)(tb.I.code,{children:[(0,a.jsx)("span",{style:{display:"inline-block",verticalAlign:"middle",position:"relative",top:"-0.15em"},children:(0,a.jsx)(tf.qU,{color:t})}),t]})}return(0,a.jsx)(tb.I.code,{children:t})}},text:{...tg.text,react:e=>(0,tf.fz)(e.content)}},url:tg.url,link:{...tg.link,match:(e,t)=>null,react:e=>{let t=e.target;return(0,a.jsx)("a",{href:t,target:"_blank",className:"underline",children:t})}},em:tg.em,strong:tg.strong},tw=(0,i.memo)(e=>{let{text:t}=e,s=tx(ty)(t,{inline:!1});return((e,t,s)=>{let a=tv(e,t,s),n=(e,t)=>tj(a(e,t));return n.displayName="OutputFor_".concat(String(t)),n})(ty,"react")(s)});tw.displayName="AnthropicMarkDown";var t_=s(2e3),tC=s(40258);let tk=(0,i.memo)(e=>{var t,s,n,l,r;let{files:o,updatedMessage:d,message:c,isLastMessage:u,isInteractive:m,editable:p,startEdit:f,onRetry:h,isResearchPending:g,isTemporary:x,author:v,shareType:j,conversationSettings:b,messageWarningPropsFromParent:y,previousMessage:w,isStreaming:_,selectAttachment:C,showSharedImageMissing:k,showSharedFileMissing:M,...N}=e,S=k||M||d.attachments.length+o.length+((null==d||null==(t=d.sync_sources)?void 0:t.length)||0)>0,E=null==(s=d.content)?void 0:s.some(e=>"text"===e.type&&""!==e.text),z="voice"===d.input_mode||"speech_input"===d.input_mode,T=(0,i.useMemo)(()=>{var e,t;return null!=(t=null==(e=c.sync_sources)?void 0:e.filter(e=>e.type===t_.v8.GDRIVE).map(e=>e.config.uri))?t:[]},[c.sync_sources]),U=(0,eN.qL)(T),R=(0,i.useMemo)(()=>U.some(e=>{let{data:t}=e;return t&&/\[image\d*\]/.test(t.text)}),[U]);return(0,a.jsxs)("div",{className:"mb-1 mt-1",children:[S&&(0,a.jsxs)("div",{className:"gap-2 mx-0.5 mb-3 flex flex-wrap",children:[o.map((e,t)=>(0,a.jsx)(td.NM,{size:"lg",file:e},t)),d.attachments.map((e,t)=>(0,a.jsx)(td.NM,{size:"lg",file:e,onClick:()=>null==C?void 0:C(e)},t)),null==d||null==(n=d.sync_sources)?void 0:n.map(e=>(0,a.jsx)(tm.V,{uuid:e.uuid,syncSource:e},e.uuid)),k&&(0,a.jsx)(td.sv,{}),M&&!k&&(0,a.jsx)(td.lD,{})]}),(0,a.jsxs)(O,{className:E?"pr-6":"pr-[2.5px]",..._?L:I,children:[(0,a.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,a.jsx)("div",{className:"shrink-0",children:j?(0,a.jsx)(tc.e,{name:v||null,size:"sm"}):(0,a.jsx)(tC.J,{size:"sm"})}),(0,a.jsx)("div",{"data-testid":"user-message",className:(0,V.A)("font-large !font-user-message grid grid-cols-1 gap-2 py-0.5",{italic:z}),children:null==(l=d.content)?void 0:l.map((e,t)=>"text"!==e.type?null:(0,a.jsx)(tw,{text:e.text},t))})]}),(0,a.jsx)(A,{message:c,isLastMessage:u,hasDriveDocWithImages:R,conversationSettings:b,messageWarningPropsFromParent:y}),(0,a.jsx)(ey,{message:c,isStreaming:_,previousMessage:w,isLastMessage:u,isInteractive:m,editMessage:f,editable:p,onRetry:h,isResearchPending:g,isTemporary:x,showArtifacts:null!=(r=null==b?void 0:b.preview_feature_uses_artifacts)&&r,...N})]})]})});tk.displayName="HumanMessage";var tM=s(69604),tN=s(49982);let tS=[],tA=(0,i.memo)(function(e){var t,s;let{lastHumanMessageRef:r,lastAssistantMessageRef:o,isLastMessage:d,isLastHumanMessage:c,selectAttachment:u,author:m,isInteractive:p=!0,onOpenArtifact:f,onOpenWiggleFile:h,onResize:x,editable:v,conversationSettings:j,publishedArtifacts:b=tS,messageWarningProps:y,showSharedImageMissing:w=!1,showSharedFileMissing:_=!1,isFirstAssistantMessage:C,shareType:k=null,isTemporary:M=!1,actionEmitter:N,onSendContinue:S,isResearchPending:A=!1,...E}=e,{account:z}=(0,n.YL)(),{messageUuid:T="",message:I,previousMessageUuid:U="",previousMessage:L,isStreaming:R}=E,O=(0,l.JX)(T),F=(0,l.JX)(U),D=I||O,P=L||(U?F:void 0),B=(e=>{let t=(0,i.useRef)(1);return(0,i.useEffect)(()=>{e||(t.current+=1)},[e]),t.current})(d),G=(e=>{let{message:t,onOpenArtifact:s,shareType:a}=e,n=(0,tN.n)(),l=(0,g.A)();return(0,i.useMemo)(()=>{let e=(e=>{var t;let s=e.content,a=null==(t=e.content)?void 0:t[0];return(null==a?void 0:a.type)==="text"&&""===a.text.trim()&&(s=null==s?void 0:s.slice(1)),s})(t),i=(null==e?void 0:e.map(e=>(e=>{let{block:t,citationsEnabled:s,shareType:a,onOpenArtifact:n,intl:i}=e;if("text"!==t.type)return t;let l=t.text;if(s&&t.citations&&t.citations.length>0&&(l=(0,tM.k0)(t.citations,l)),l=n?(0,W.Tm)(l):(0,W.it)(l),a){for(let e of(0,eq.n)(l))if(!(0,eV.m)(e,a)){let t="public"===a?"[".concat(i.formatMessage({defaultMessage:"Files hidden in shared chats",id:"ANRUB+TiTq"}),"]"):"[".concat(i.formatMessage({defaultMessage:"Working file hidden in shared chat",id:"oqkUomHXYH"}),"]"),s=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=RegExp("\\[[^\\]]*\\]\\(".concat(s,"\\)"),"g");l=l.replace(n,t)}}return{...t,text:l}})({block:e,citationsEnabled:n,shareType:a,onOpenArtifact:s,intl:l})))||[];return{...t,content:i}},[n,l,t,s,a])})({message:D,onOpenArtifact:f,shareType:k}),J=(0,i.useCallback)((e,t)=>{null==N||N.emit("retry",{parent_message_uuid:e,paprika_mode:t})},[N]),V=null!=(s=D.files_v2)?s:D.files,H="human"===G.sender,q="assistant"===G.sender,Y=d&&R,{isUserEditing:K,currentEdit:X,setCurrentEdit:$,startEdit:Z,finishEdit:Q,cancelEdit:ee}=(e=>{var t;let{editable:s,updatedMessage:a,actionEmitter:n}=e,[l,r]=(0,i.useState)(!1),[o,d]=(0,i.useState)(""),c="",u=null==(t=a.content)?void 0:t.find(e=>"text"===e.type);u&&"text"in u&&(c=u.text);let m=(0,i.useCallback)(()=>{s&&(d(c),r(!0))},[s,c]),p=(0,i.useCallback)(()=>{0!==o.length&&n&&(n.emit("edit",{message:a,text:o}),r(!1),d(""))},[o,n,a]),f=(0,i.useCallback)(()=>{r(!1),d("")},[]);return{isUserEditing:l,currentEdit:o,setCurrentEdit:d,startEdit:m,finishEdit:p,cancelEdit:f}})({editable:v,actionEmitter:N,updatedMessage:G});return K?(0,a.jsx)(tp,{isStreaming:R,currentEdit:X,setCurrentEdit:$,finishEdit:Q,cancelEdit:ee,author:m,loggedInAccount:z,message:G,selectAttachment:u,showSharedImageMissing:w,showSharedFileMissing:_}):(0,a.jsxs)("div",{ref:c?r:d?o:null,"data-test-render-count":B,children:[H&&(0,a.jsx)(tk,{files:V,updatedMessage:G,message:D,isLastMessage:d,isInteractive:p,editable:v,startEdit:Z,onRetry:J,isResearchPending:A,isTemporary:M,author:m,shareType:k,conversationSettings:j,messageWarningPropsFromParent:y,previousMessage:P,selectAttachment:u,showSharedImageMissing:w,showSharedFileMissing:_,...E}),q&&(G.content&&G.content[0]||(null==(t=G.metadata)?void 0:t.is_resume_completion_placeholder_message))&&(0,a.jsx)(to,{isThisMessageStreaming:Y,isLastMessage:d,updatedMessage:G,onResize:x,previousMessage:P,message:D,isInteractive:p,isFirstAssistantMessage:C,onRetry:J,isResearchPending:A,isTemporary:M,conversationSettings:j,messageWarningPropsFromParent:y,onSendContinue:S,onOpenArtifact:f,publishedArtifacts:b,onOpenWiggleFile:h,...E})]})})},75103:(e,t,s)=>{s.d(t,{t:()=>r});var a=s(54568),n=s(64328),i=s(59666),l=s(45538);function r(e){let t,{project:s,className:r}=e,{account:o}=(0,n.YL)();if(s.is_starter_project||s.type===l.gM.Haystack)t=(0,a.jsx)(i.A,{defaultMessage:"Created by Anthropic",id:"qWDgsCW3nw"});else{var d;t=(null==(d=s.creator)?void 0:d.full_name)?s.creator.uuid===(null==o?void 0:o.uuid)?(0,a.jsx)(i.A,{defaultMessage:"Created by you",id:"WEhuQZAqE6"}):(0,a.jsx)(i.A,{defaultMessage:"Created by {author}",id:"7POMfMfi+y",values:{author:s.creator.full_name}}):(0,a.jsx)(i.A,{defaultMessage:"Created by unknown",id:"QEI1plMxfE"})}return(0,a.jsx)("span",{className:r,children:t})}},78418:(e,t,s)=>{s.d(t,{M:()=>c});var a=s(54568),n=s(9398),i=s(23812),l=s(67453),r=s(59666),o=s(82342),d=s(85239);function c(e){let{file:t,conversationUuid:s,source:c,variant:u="ghost",size:m="icon_lg",className:p}=e,{handleOpenInGoogleDrive:f,showConnectionModal:h,setShowConnectionModal:g,connectionError:x,isExporting:v}=(0,d.N)({conversationUuid:s,source:c});return(0,d.z)(t.path)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Tooltip,{tooltipContent:(0,a.jsx)(r.A,{defaultMessage:"Open in Drive",id:"r80/2fFyeU"}),side:"bottom",children:(0,a.jsx)(i.$,{variant:v?"secondary":u,size:m,loading:v,onClick:e=>{e.preventDefault(),e.stopPropagation(),f(t.path)},className:p,children:!v&&(0,a.jsx)(n.ft,{size:"icon_sm"===m?16:"icon"===m?20:24})})}),(0,a.jsx)(o.h,{isOpen:h,onClose:()=>{g(!1)},errorType:x,callerIdentifier:"google-drive-export-button"})]}):null}},78458:(e,t,s)=>{s.d(t,{k:()=>n});var a=s(57291);function n(e){let{filePath:t,isShared:s,conversationUuid:n,snapshotUuid:i,source:l}=e,r=t.replace("computer://",""),o=t.split(".").pop()||"";return{file_id:function(e){let t=e.replace("computer://",""),s=5381;for(let e=0;e<t.length;e++)s=(s<<5)+s+t.charCodeAt(e);return Math.abs(s).toString(16)}(t),file_extension:o,is_snapshot:s,is_viewable_file:(0,a.IO)(t),is_output_file:r.startsWith("/mnt/user-data/outputs/"),conversation_uuid:s?null:n||null,snapshot_uuid:s&&i||null,source:l}}},78671:(e,t,s)=>{s.d(t,{M9:()=>i,NX:()=>l});var a=s(57291);async function n(e){let{title:t,element:s}=e;return new Promise((e,a)=>{try{var n;let i=document.head.innerHTML,l=document.createElement("iframe");l.style.position="fixed",l.style.right="0",l.style.bottom="0",l.style.width="0",l.style.height="0",l.style.border="0",l.setAttribute("sandbox","allow-same-origin allow-modals"),l.setAttribute("csp",""),document.body.appendChild(l);let r=l.contentDocument||(null==(n=l.contentWindow)?void 0:n.document);if(!r){document.body.removeChild(l),a(Error("Could not access iframe document"));return}r.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>".concat(t,"</title>\n            ").concat(i,"\n            <style>\n              /* Remove browser-added headers and footers */\n              @page {\n                size: auto;\n                margin: 0; /* Keep at 0 to remove datetime, page count, website, etc */\n                padding: 25px 0; /* top and bottom page padding */\n              }\n              @media print {\n                html, body, pre, code {\n                  -webkit-print-color-adjust: exact !important;\n                  color-adjust: exact !important;\n                  print-color-adjust: exact !important;\n                }\n              \n                /* Smart page breaks */\n                h1, h2, h3 {\n                  page-break-after: avoid !important;\n                }\n                img, pre, table {\n                  page-break-inside: avoid !important;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            ").concat(s.outerHTML,"\n          </body>\n        </html>\n      ")),r.close();let o=document.title,d=()=>{try{document.title=o,document.body.removeChild(l)}catch(e){}};l.onload=()=>{try{var s,n;document.title=t;try{null==(s=l.contentWindow)||s.print()}catch(e){null==(n=l.contentDocument)||n.execCommand("print")}setTimeout(()=>{d(),e()},100)}catch(e){d(),a(e)}},l.onerror=e=>{d(),a(e)}}catch(e){a(e)}})}async function i(e){if(e.type!==a.vU.Markdown)throw Error("Only markdown artifacts can be saved as PDF");let t=document.getElementById("markdown-artifact");if(!t)throw Error("Markdown artifact element not found");return n({title:(null==e?void 0:e.title)||"Artifact",element:t})}async function l(e){let t=document.getElementById("wiggle-file-content");if(!t)throw Error("File content element not found");return n({title:e.path.split("/").pop()||e.path,element:t})}},79901:(e,t,s)=>{s.d(t,{S:()=>T,o:()=>I});var a=s(54568),n=s(38080),i=s(25391),l=s(81783),r=s(65607),o=s(4694),d=s(9412),c=s(34863),u=s(19148),m=s(29586),p=s(69911),f=s(34191),h=s(92774),g=s(80817),x=s(29780),v=s(9010),j=s(49275),b=s(4226),y=s(28591),w=s(46491),_=s(76432),C=s(47471),k=s(23044),M=s(17055),N=s(90449),S=s(69841),A=s(45184);let E={html:"html",htm:"html",xhtml:"html",css:"css",scss:"scss",sass:"sass",less:"less",js:"javascript",jsx:"jsx",ts:"typescript",tsx:"tsx",json:"json",yaml:"yaml",yml:"yaml",xml:"xml",svg:"svg",py:"python",rb:"ruby",php:"php",java:"java",c:"c",h:"c",cpp:"cpp",cc:"cpp",cxx:"cpp",hpp:"cpp",cs:"csharp",go:"go",rs:"rust",swift:"swift",kt:"kotlin",scala:"scala",dart:"dart",lua:"lua",pl:"perl",r:"r",sh:"bash",bash:"bash",zsh:"bash",fish:"fish",bat:"batch",cmd:"batch",ps1:"powershell",md:"markdown",markdown:"markdown",mermaid:"mermaid",mmd:"mermaid",tex:"latex",rst:"restructuredtext",asciidoc:"asciidoc",adoc:"asciidoc",csv:"csv",tsv:"tsv",toml:"toml",ini:"ini",conf:"ini",cfg:"ini",sql:"sql",graphql:"graphql",gql:"graphql",dockerfile:"dockerfile",dockerignore:"docker",gitignore:"git",gitattributes:"git",editorconfig:"editorconfig",diff:"diff",patch:"diff",nginx:"nginx",htaccess:"apacheconf"};function z(e){var t;return(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""}function T(e){return E[z(e).toLowerCase()]||"plaintext"}function I(e){let{path:t,size:s=16}=e;switch(z(t)){case"pdf":return(0,a.jsx)(n.T,{size:s});case"c":return(0,a.jsx)(i.s,{size:s});case"cs":return(0,a.jsx)(l.e,{size:s});case"cpp":return(0,a.jsx)(A.y,{size:s});case"css":return(0,a.jsx)(r.y,{size:s});case"csv":return(0,a.jsx)(o.F,{size:s});case"doc":case"docx":return(0,a.jsx)(d.j,{size:s});case"html":case"htm":case"xhtml":return(0,a.jsx)(c._,{size:s});case"jpg":case"jpeg":return(0,a.jsx)(u.a,{size:s});case"js":return(0,a.jsx)(m.u,{size:s});case"jsx":return(0,a.jsx)(p.m,{size:s});case"md":return(0,a.jsx)(f.C,{size:s});case"png":return(0,a.jsx)(h.K,{size:s});case"ppt":case"pptx":return(0,a.jsx)(g.z,{size:s});case"py":return(0,a.jsx)(x.I,{size:s});case"rs":return(0,a.jsx)(v.q,{size:s});case"sql":return(0,a.jsx)(j.b,{size:s});case"svg":return(0,a.jsx)(b.V,{size:s});case"ts":return(0,a.jsx)(y.G,{size:s});case"tsx":return(0,a.jsx)(w.M,{size:s});case"txt":return(0,a.jsx)(_.r,{size:s});case"vue":return(0,a.jsx)(C.x,{size:s});case"xls":case"xlsx":return(0,a.jsx)(k.K,{size:s});case"zip":return(0,a.jsx)(M.g,{size:s});case"gif":case"bmp":case"webp":case"ico":return(0,a.jsx)(N.C,{size:s});default:return(0,a.jsx)(S.i,{size:s})}}},82342:(e,t,s)=>{s.d(t,{K:()=>h,h:()=>g});var a=s(54568),n=s(74813),i=s(64328),l=s(14691),r=s(9398),o=s(94470),d=s(23812),c=s(3075),u=s(2e3),m=s(7620),p=s(59666),f=s(79052),h=function(e){return e.NOT_CONNECTED="not_connected",e.MISSING_SCOPE="missing_scope",e.UNKNOWN="unknown",e}({});let g=e=>{let{isOpen:t,onClose:s,errorType:h,onConnectionSuccess:g,callerIdentifier:x}=e,v=(0,n.st)(),{activeOrganization:j}=(0,i.YL)(),[b,y]=(0,m.useState)(!1),{initDriveAuth:w}=(0,f.cI)({callerIdentifier:x||"gdrive-export-modal",handleAuthSuccess:()=>{y(!1),v.track({event_key:"wiggle.gdrive.connection.success",organization_id:null==j?void 0:j.uuid,error_type:h,caller_identifier:x}),s(),setTimeout(()=>{null==g||g()},100)}});if((0,m.useEffect)(()=>{t&&v.track({event_key:"wiggle.gdrive.connection.modal_shown",organization_id:null==j?void 0:j.uuid,error_type:h,caller_identifier:x})},[t,h,x,null==j?void 0:j.uuid,v]),"unknown"===h)return null;let{title:_,description:C,buttonText:k}=(()=>{switch(h){case"not_connected":return{title:"Connect Claude to Google Drive",description:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{children:(0,a.jsx)(p.A,{defaultMessage:"This will allow Claude to:",id:"Fh77iGv4CM"})}),(0,a.jsxs)("ul",{className:"list-disc pl-5 text-sm text-text-300 space-y-1",children:[(0,a.jsx)("li",{children:(0,a.jsx)(p.A,{defaultMessage:"Add DOCX, XLSX, and PPTX files that it creates directly to Google Drive",id:"H4PCn1IJGu"})}),(0,a.jsx)("li",{children:(0,a.jsx)(p.A,{defaultMessage:"Search and summarize Google Drive files",id:"o+UM/Lfa+u"})})]})]}),buttonText:"Connect"};case"missing_scope":return{title:"Reconnect Claude to Google Drive",description:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{children:(0,a.jsx)(p.A,{defaultMessage:"This will give Claude permission to see, edit, create, and delete files that it creates in Google Drive.",id:"vHppAPeTNV"})}),(0,a.jsx)(o.l,{variant:"secondary",icon:l.R2,message:(0,a.jsx)(p.A,{defaultMessage:"You’ll only need to do this once. Any existing Google Drive capabilities in Claude will still work.",id:"v8YR2us4Y6"})})]}),buttonText:"Reconnect"}}})();return(0,a.jsx)(c.aF,{modalSize:"lg",isOpen:t,onClose:s,hasCloseButton:!0,title:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(r.A9,{type:u.v8.GDRIVE,size:20}),(0,a.jsx)("span",{children:_})]}),children:(0,a.jsxs)("div",{className:"mt-5 space-y-6",children:[C,(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(d.$,{onClick:s,variant:"secondary",children:(0,a.jsx)(p.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsx)(d.$,{onClick:()=>{y(!0),v.track({event_key:"wiggle.gdrive.connection.initiated",organization_id:null==j?void 0:j.uuid,error_type:h,caller_identifier:x}),w()},loading:b,disabled:b,children:k})]})]})})}},82508:(e,t,s)=>{s.d(t,{w:()=>o,y:()=>d});var a=s(1613),n=s(71462),i=s(7620);function l(e,t){let s=new Map;return t.forEach(e=>{var t;let a=null!=(t=s.get(e.file_name))?t:[];a.push(e),s.set(e.file_name,a)}),s.get(e)}function r(e,t){let s=l(e,t);if(!s||0===s.length)return null;let a=s.filter(e=>e.file_kind===n.M.Blob);return 0===a.length?null:a[a.length-1]}function o(){let e=function(){let e=(0,a.mn)();return(0,i.useCallback)(async(t,s,a,n,i)=>{let l=r(t,s);if(!l&&n){let s=await e("/api/organizations/".concat(a,"/projects/").concat(n,"/docs")),i=(await s.json()).find(e=>e.file_name===t);if(i)return new TextEncoder().encode(i.content);let o=await e("/api/organizations/".concat(a,"/projects/").concat(n,"/files"));l=r(t,await o.json())}if(!l)return null;try{let e=i?"/api/organizations/".concat(a,"/shared_artifact/").concat(i,"/files/").concat(l.file_uuid,"/contents"):"/api/organizations/".concat(a,"/files/").concat(l.file_uuid,"/contents"),t=await fetch(e);if(!t.ok)return null;let s=await t.arrayBuffer();if(s.byteLength>0x80000000-1)return null;return new Uint8Array(s)}catch(e){return null}},[e])}();return(0,i.useCallback)(async(t,s,a,n,i,r)=>{if(!n)return null;let o=function(e,t){let s=l(e,t);if(!s||0===s.length)return null;let a=s[s.length-1];if(a){let e=a.extracted_content;return new TextEncoder().encode(e)}return null}(t,s);return o||await e(t,a,n,i,r)},[e])}function d(e,t,s,a,n){let l=o();return(0,i.useCallback)(async i=>l(i,e,t,s,a,n),[e,t,s,a,l,n])}},84656:(e,t,s)=>{s.d(t,{W:()=>n});var a=s(7620);function n(e,t,s){let n=(0,a.useRef)(void 0),i=(0,a.useCallback)(e,t),l=(0,a.useCallback)(()=>{n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(i,s)},[i,s]);return(0,a.useEffect)(()=>(l(),()=>{n.current&&window.clearTimeout(n.current)}),[...t,i,s]),l}},85239:(e,t,s)=>{s.d(t,{N:()=>u,z:()=>m});var a=s(74813),n=s(1613),i=s(64328),l=s(45054),r=s(16178),o=s(7620),d=s(82342),c=s(78458);function u(e){let{conversationUuid:t,source:s}=e,{activeOrganization:u}=(0,i.YL)(),{addError:m}=(0,l.Y)(),p=(0,a.st)(),[f,h]=(0,o.useState)(!1),[g,x]=(0,o.useState)(d.K.NOT_CONNECTED),v=null==u?void 0:u.uuid,j=(0,n.L2)("/api/organizations/".concat(v,"/conversations/").concat(t,"/wiggle/export-to-google-drive"),"POST",{enabled:!!v&&!!t,meta:{noToast:!0}});return{handleOpenInGoogleDrive:(0,o.useCallback)(async e=>{if(!v||!t)return;let a=e.replace("computer://",""),n=(0,c.k)({filePath:e,isShared:!1,conversationUuid:t,source:s});p.track({event_key:"wiggle.file.gdrive_export.attempted",...n});try{let e=await j.mutateAsync({file_path:a});e.drive_url&&(window.open(e.drive_url,"_blank"),p.track({event_key:"wiggle.file.gdrive_export.success",...n}))}catch(a){let e,t;if(a instanceof r.LG){var i,l;(e=null!=(l=a.errorCode)?l:void 0)||null==(i=a.extra)||!i.details||(e=a.extra.details.error_code),t=a.message}else t="Export failed. Please try again.";let s=(e=>{switch(e){case"google_drive_not_connected":return d.K.NOT_CONNECTED;case"google_drive_insufficient_scopes":return d.K.MISSING_SCOPE;default:return d.K.UNKNOWN}})(e);if(p.track({event_key:"wiggle.file.gdrive_export.failed",error_code:e,error_type:s,error_message:t,...n}),s===d.K.NOT_CONNECTED||s===d.K.MISSING_SCOPE){x(s),h(!0);return}m(t,{error:a})}},[v,t,s,p,j,m]),showConnectionModal:f,setShowConnectionModal:h,connectionError:g,isExporting:j.isPending}}function m(e){let t=/\.docx$/i.test(e),s=/\.xlsx$/i.test(e),a=/\.pptx$/i.test(e);return t||s||a}},87017:(e,t,s)=>{s.d(t,{u:()=>l});var a=s(93734),n=s(3444),i=s(48060);function l(e){let t=e.trim();return(0,a.yt)(t,{extensions:[(0,n.x)()],htmlExtensions:[(0,i.k)()]})}},88769:(e,t,s)=>{s.d(t,{Bk:()=>i,Kc:()=>r,LR:()=>l});var a=s(4211),n=s(50848);let i=(0,a.v)()((0,n.eh)((e,t)=>({features:{},setMessageFeatures:(t,s)=>e(e=>({features:{...e.features,[t]:{...e.features[t],...s}}})),clearAllFeatures:()=>e({features:{}}),getMessageFeatures:e=>t().features[e],hasLink:e=>{var s,a;return null!=(a=null==(s=t().features[e])?void 0:s.hasLink)&&a},hasCode:e=>{var s,a;return null!=(a=null==(s=t().features[e])?void 0:s.hasCode)&&a}}))),l=e=>i(t=>{var s,a;return null!=(a=null==(s=t.features[e])?void 0:s.hasLink)&&a}),r=e=>i(t=>{var s,a;return null!=(a=null==(s=t.features[e])?void 0:s.hasCode)&&a})},91786:(e,t,s)=>{s.d(t,{NotificationListener:()=>E,hG:()=>A,Wo:()=>N});var a=s(74813),n=s(64328),i=s(28044),l=s(5655),r=s(69287),o=s(20861),d=s(847),c=s(7620),u=s(60516),m=s(40297),p=s(48938),f=s(78979);let h=(0,m.w)("CiRhbnRocm9waWMvY2xhdWRlL3B1c2gvZW52ZWxvcGUucHJvdG8SFWFudGhyb3BpYy5jbGF1ZGUucHVzaCJfChVQdXNoT3BlcmF0aW9uRW52ZWxvcGUSDwoHc2VydmljZRgBIAEoCRIOCgZtZXRob2QYAiABKAkSJQoHcmVxdWVzdBgDIAEoCzIULmdvb2dsZS5wcm90b2J1Zi5BbnlC4wEKGWNvbS5hbnRocm9waWMuY2xhdWRlLnB1c2hCDUVudmVsb3BlUHJvdG9QAVpBZ2l0aHViLmNvbS9hbnRocm9waWNzL21vYmlsZS1hcHBzL2dvL3Byb3Rvcy9hbnRocm9waWMvY2xhdWRlL3B1c2iiAgNBQ1CqAhVBbnRocm9waWMuQ2xhdWRlLlB1c2jKAhVBbnRocm9waWNcQ2xhdWRlXFB1c2jiAiFBbnRocm9waWNcQ2xhdWRlXFB1c2hcR1BCTWV0YWRhdGHqAhdBbnRocm9waWM6OkNsYXVkZTo6UHVzaGIGcHJvdG8z",[f.f]),g=(0,p.Z)(h,0);var x=s(34734);let v=(0,m.w)("CiZhbnRocm9waWMvY2xhdWRlL3B1c2gvb3BlcmF0aW9ucy5wcm90bxIVYW50aHJvcGljLmNsYXVkZS5wdXNoIpEBCg9PcGVuQ2hhdFJlcXVlc3QSIgoMYWNjb3VudF91dWlkGAEgASgJUgxhY2NvdW50X3V1aWQSLAoRb3JnYW5pemF0aW9uX3V1aWQYAiABKAlSEW9yZ2FuaXphdGlvbl91dWlkEiwKEWNvbnZlcnNhdGlvbl91dWlkGAMgASgJUhFjb252ZXJzYXRpb25fdXVpZDJrCh1Mb2dnZWRJblB1c2hPcGVyYXRpb25zU2VydmljZRJKCghPcGVuQ2hhdBImLmFudGhyb3BpYy5jbGF1ZGUucHVzaC5PcGVuQ2hhdFJlcXVlc3QaFi5nb29nbGUucHJvdG9idWYuRW1wdHlC5QEKGWNvbS5hbnRocm9waWMuY2xhdWRlLnB1c2hCD09wZXJhdGlvbnNQcm90b1ABWkFnaXRodWIuY29tL2FudGhyb3BpY3MvbW9iaWxlLWFwcHMvZ28vcHJvdG9zL2FudGhyb3BpYy9jbGF1ZGUvcHVzaKICA0FDUKoCFUFudGhyb3BpYy5DbGF1ZGUuUHVzaMoCFUFudGhyb3BpY1xDbGF1ZGVcUHVzaOICIUFudGhyb3BpY1xDbGF1ZGVcUHVzaFxHUEJNZXRhZGF0YeoCF0FudGhyb3BpYzo6Q2xhdWRlOjpQdXNoYgZwcm90bzM",[x.t]),j=(0,p.Z)(v,0);var b=s(44259),y=s(48615),w=s(24429);let _=(0,b.Iq)(v);var C=s(40459);let k={apiKey:"AIzaSyDu88493oN_Xq4PNVr_x8GUZPZhe-byS4U",authDomain:"proj-scandium-production-5zhm.firebaseapp.com",projectId:"proj-scandium-production-5zhm",storageBucket:C.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"",messagingSenderId:"365066964946",appId:"1:365066964946:web:920eb01ec340c52cb8420b",measurementId:C.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||""},M="BBn_zDr7ckBwzQe6Tdc1k6E0tSdrG64L2ddLR36jUkdaleKmAdfgt3ao93t-nib3n3oBaAtbd9KyoxHaUGJLEzU",N=()=>{let[e,t]=(0,c.useState)(()=>"Notification"in window?Notification.permission:"default");return(0,c.useEffect)(()=>{"Notification"in window&&t(Notification.permission)},[]),(0,l.M)("focus",()=>{"Notification"in window&&t(Notification.permission)}),e},S=async e=>{let{isClaudeElectronApp:t,onTokenReceived:s,track:a}=e;if(!("Notification"in window))return!1;try{let e=await Notification.requestPermission();if(a&&a({event_key:"claudeai.notification.permission.result",permission:e}),"granted"!==e)return a&&a({event_key:"claudeai.notification.permission.result",permission:e}),!1;{let e,a;if(t||(e=0===(0,o.Dk)().length?(0,o.Wp)(k):(0,o.Sx)(),!await (0,d.TT)()))return!1;try{a=(0,d.dG)(e)}catch(e){return!1}let n=(await navigator.serviceWorker.getRegistrations()).find(e=>{var t;return null==(t=e.active)?void 0:t.scriptURL.includes("firebase-messaging-sw.js")});if(!n&&1)try{n=await navigator.serviceWorker.register("/firebase-messaging-sw.js"),await navigator.serviceWorker.ready}catch(e){(0,r.Cp)(e,{tags:{action:"registerServiceWorker"}})}try{let e=await (0,d.gf)(a,{vapidKey:M,serviceWorkerRegistration:n});if(e)s(e);else throw(0,r.Cp)(Error("FCM token is null"),{tags:{action:"getToken"}}),Error("FCM token is null")}catch(e){throw(0,r.Cp)(e,{tags:{action:"getToken"}}),e}}return"granted"===e}catch(e){return(0,r.Cp)(e,{tags:{action:"requestPermission"}}),!1}},A=()=>{let{track:e}=(0,a.st)(),{mutate:t}=(0,u.E)(),s=(0,i.V)();return(0,c.useCallback)(async()=>(e({event_key:"claudeai.notification.permission.request_started"}),await S({isClaudeElectronApp:s,onTokenReceived:e=>{t({channel_type:u.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},track:e})),[t,s,e])},E=()=>{let e=(0,c.useRef)(null),{account:t}=(0,n.YL)(),{mutate:s}=(0,u.E)(),a=(0,i.V)(),l=async()=>{let t;if(t=0===(0,o.Dk)().length?(0,o.Wp)(k):(0,o.Sx)(),!await (0,d.TT)())return{app:null,messaging:null};if(e.current)return{app:t,messaging:e.current};let s=(0,d.dG)(t);return e.current=s,{app:t,messaging:s}},m=async e=>{try{return await (0,d.gf)(e,{vapidKey:M})}catch(e){return(0,r.Cp)(e,{tags:{action:"getFCMToken"}}),null}},p=(0,c.useCallback)(e=>{s({channel_type:u.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},[s]);return(0,c.useEffect)(()=>{var e;let t=!0,s=null;(async()=>{if(!a&&"Notification"in window&&"granted"===Notification.permission)try{let{messaging:e}=await l();if(!e||!t)return;let a=await m(e);a&&t&&p(a),s=(0,d.xD)(e,e=>{var t,s;let a=(null==(t=e.data)?void 0:t.title)||"Claude",n={body:null==(s=e.data)?void 0:s.body,icon:"/favicon.svg",badge:"/favicon.svg",data:e.data},i=new Notification(a,n);i.onclick=()=>{var t;if(window.focus(),i.close(),null==(t=e.data)?void 0:t.payload){let t=function(e){if(!e)return null;try{let t=(0,y.Rf)(g,JSON.parse(e),{registry:_});if(!t.request||!t.method)return null;if("OpenChat"===t.method){let e=(0,w.rW)(t.request,j);if(null==e?void 0:e.conversationUuid){let t=e.conversationUuid;if(t.startsWith("/code/"))return{method:"OpenChat",targetUrl:t};return{method:"OpenChat",targetUrl:"/chat/".concat(t)}}}return null}catch(e){return null}}(e.data.payload);if(t){window.location.href=t.targetUrl;return}}window.location.href="/"}})}catch(e){(0,r.Cp)(e,{tags:{action:"setupNotifications"}})}})();let n=e=>{let t=e.data;(null==t?void 0:t.type)==="NOTIFICATION_CLICK_NAVIGATE"&&(null==t?void 0:t.targetUrl)&&(window.location.href=t.targetUrl)};return null==(e=navigator.serviceWorker)||e.addEventListener("message",n),()=>{var e;t=!1,s&&s(),null==(e=navigator.serviceWorker)||e.removeEventListener("message",n)}},[t,a,p]),null}},96091:(e,t,s)=>{s.d(t,{n:()=>a});let a=e=>{let t,s=[],a=/\[[^\]]*\]\((computer:\/\/\/[^)]+)\)/g;for(;null!==(t=a.exec(e));)s.push(t[1]);let n=RegExp("(?<!\\]\\()computer:\\/\\/\\/[^\\s)\\].,;!?]+(?![^[]*\\])","g");return s.push(...e.match(n)||[]),[...new Set(s.map(e=>e.replace(/[.,;!?)]+$/,"")))]}},98324:(e,t,s)=>{s.d(t,{g:()=>t7,v:()=>t8});var a=s(2348),n=s(54568),i=s(19736),l=s(6542),r=s(65018),o=s(40925),d=s(79412),c=s(45607),u=s(37380),m=s(96614),p=s(86545),f=s(55146),h=s(34003),g=s(64328),x=s(98944),v=s(60687),j=s(59922),b=s(41284),y=s(67453),w=s(68067),_=s(95617),C=s(11583),k=s(72902),M=s(45312),N=s(16689),S=s(19664),A=s.n(S),E=s(27541),z=s(7620),T=s(59666),I=s(10369),U=s(24407),L=s(24443),R=s(13644),O=s(45538),F=s(72581),D=s(47831),P=s(22624),B=s(38695),G=s(74700);let W=()=>(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"animate-pulse flex flex-col gap-8 fade-out-bottom",children:[(0,n.jsx)("div",{className:"group relative inline-flex gap-2 bg-bg-300 rounded-xl pl-2.5 py-2.5 break-words text-text-100 transition-all max-w-[75ch] flex-col",children:(0,n.jsx)("div",{className:(0,k.A)("rounded-full h-7 w-7 bg-text-200 opacity-40")})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-9/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]})]})});var J=s(37080),V=s(91786),H=s(29493),q=s(24423),Y=s(26761),K=s(90458),X=s(82508),$=s(15393),Z=s(78540),Q=s(4869),ee=s(85028),et=s(32027),es=s(8564),ea=s(58841),en=s(71700),ei=s(23812),el=s(48252),er=s(64371),eo=s(16256),ed=s(35262),ec=s(37467),eu=s(98304),em=s(19820),ep=s(785),ef=s(23132),eh=s(61295),eg=s(39109),ex=s(99969),ev=s.n(ex),ej=s(99411),eb=s(9317);let ey=e=>{let{onClose:t,onBack:s,onDebug:a,title:i,isHidden:l,className:r}=e;return(0,n.jsxs)("div",{className:"shrink-0 flex items-center justify-between gap-4 w-full min-w-0 px-5 h-[3.25rem]",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[!!s&&(0,n.jsx)(ei.$,{variant:"ghost",size:"icon_sm",onClick:s,className:"-ml-1",disabled:l,children:(0,n.jsx)(ed.Z,{size:16})}),(0,n.jsx)("h2",{className:(0,k.A)("text-text-200 truncate text-sm min-w-0 text-ellipsis break-words text-nowrap",r),children:i}),!!a&&(0,n.jsx)(ei.$,{variant:"ghost",size:"icon_sm",onClick:a,disabled:l,children:(0,n.jsx)(ec.z,{size:16})})]}),(0,n.jsx)(ei.$,{variant:"ghost",size:"icon_sm",onClick:t,className:"-mr-1",disabled:l,children:(0,n.jsx)(eu.X,{size:16})})]})};function ew(e){let{compassStatus:t,onOpenSources:s}=e;if(!t.total_sources)return null;let a=(e=>{let t=new Map,s=new Map;for(let a of e)for(let e of a.annotated_snippets)for(let a of e.tool_calls)if("web_search"===a.tool_name||"web_fetch"===a.tool_name){let e=[];if("web_search"===a.tool_name){if(!a.output||"rich_content"!==a.output.type||!a.output.content)continue;e=a.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean)}if("web_fetch"===a.tool_name){if(!a.output||"rich_link"!==a.output.type||!a.output.link.url)continue;e=[a.output.link.url]}for(let t of e)if("string"==typeof t)try{let e=new URL(t),a="https://".concat(e.hostname),i=e.hostname.replace(/^www\./,""),l=s.get(i);s.set(i,{count:((null==l?void 0:l.count)||0)+1,icon:(null==l?void 0:l.icon)||(0,n.jsx)(en.d,{url:a,size:14})})}catch(e){}}else if(a.output){let e=a.integration_name||a.tool_name,s="rich_content"===a.output.type?a.output.content.length:1,i=t.get(e);t.set(e,{count:((null==i?void 0:i.count)||0)+s,icon:(null==i?void 0:i.icon)||(0,n.jsx)(eb.r,{canShowLetterIcon:!0,size:14,iconUrl:a.server_icon_url||void 0,integrationName:a.integration_name||void 0,toolName:a.tool_name})})}let a=Array.from(t.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4),i=Array.from(s.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4);return a.concat(i).slice(0,4-a.length)})(t.agents),i=a.length>0?a[0][1].count:0,l=t.total_sources-a.reduce((e,t)=>t[1].count+e,0);return 0===a.length?null:(0,n.jsx)("button",{className:"transition-all w-full flex flex-col gap-3 px-4 py-3.5 border-0.5 border-border-300 rounded-xl hover:border-border-100  max-w-[456px]",onClick:s,children:(0,n.jsxs)("div",{className:"flex flex-col gap-2.5 my-1 w-full",children:[a.map((e,t)=>{let[s,{count:a,icon:l}]=e;return(0,n.jsxs)("div",{className:"flex items-center text-xs",children:[(0,n.jsx)("div",{className:"h-4 w-4 flex items-center justify-center mr-2",children:l}),(0,n.jsx)("p",{className:"text-left font-medium w-32 truncate text-text-100 pr-2",title:s,children:s}),(0,n.jsx)("p",{className:"w-24 text-right text-xs text-text-300 pr-2",children:(0,n.jsx)(T.A,{id:"WrpI57Uej/",defaultMessage:"{count, plural, one {# source} other {# sources}}",values:{count:a}})}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(eh.P.div,{className:"h-2 rounded-full bg-bg-400",initial:{width:0},animate:{width:"".concat(a/i*100,"%")},transition:{delay:.1*t,duration:.5}})})]},s)}),l>0&&(0,n.jsxs)("div",{className:"flex items-center text-xs text-text-300",children:[(0,n.jsx)(em.H,{size:16,className:"text-text-300 mr-2"}),(0,n.jsx)("p",{children:(0,n.jsx)(T.A,{id:"QX3cxMJ9Tc",defaultMessage:"{totalSources, plural, one {# other source} other {# other sources}}",values:{totalSources:l}})})]})]})})}let e_=e=>{let{title:t,complete:s,className:a}=e;return(0,n.jsx)(eh.P.h3,{className:(0,k.A)("text-base text-text-100 font-claude-response",a),initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:s?t:(0,n.jsx)(el.N,{children:t})},t)};function eC(e){let{title:t,description:s,numSources:a,onClick:i,complete:l}=e;return(0,n.jsxs)(eh.P.button,{variants:{initial:{opacity:0},animate:{opacity:1}},className:"text-left flex flex-col gap-1.5 transition-all duration-500 group/snippet cursor-pointer",onClick:i,children:[(0,n.jsx)(e_,{title:null!=s?s:t,complete:l}),(0,n.jsx)("div",{className:"transition-all flex flex-row items-center gap-1 text-xs text-text-500 group-hover/snippet:text-text-200",children:0===a?(0,n.jsx)(T.A,{id:"NmCRHK7Fm4",defaultMessage:"No sources yet"}):(0,n.jsx)(T.A,{id:"8NMeuJNj8z",defaultMessage:"{totalSources, plural, one {# source} other {# sources}}",values:{totalSources:a}})})]})}function ek(e){let{status:t,allSnippets:s,onOpenSources:a}=e,[i,l]=(0,z.useState)([]);return(0,z.useEffect)(()=>{!(t.agents.length<1)&&(i.length>=3||l((0,J.mk)({agents:t.agents,n:3})))},[null==t?void 0:t.agents,i.length,l]),(0,n.jsxs)("div",{className:"flex flex-col pt-4 pb-6 gap-4 w-full h-full text-sm text-text-200",children:[(0,n.jsx)(ew,{compassStatus:t,onOpenSources:()=>a(!0)}),s&&s.length>0&&(0,n.jsx)("div",{className:"flex flex-col gap-3",children:(0,n.jsx)(eh.P.div,{variants:{initial:{},animate:{transition:{staggerChildren:.08,delayChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col gap-4 w-full",children:s.map((e,t)=>(0,n.jsx)(eC,{...e,onClick:()=>a(!0,e.globalAgentIndex)},t))})})]})}function eM(e){let{data:t,onClose:s}=e,[a,i]=(0,z.useState)(!1),[l,r]=(0,z.useState)({sourcesOpen:!1}),{conversationUuid:o,organizationUuid:d,isShared:c,taskId:u}=t,{compassStatus:m}=(0,J.CH)({organizationUuid:d,conversationUuid:o,taskId:u,isShared:c});if(!m)return null;let p=(e,t)=>{r({sourcesOpen:e,index:t})},f=void 0,h=l.sourcesOpen||a;return(0,n.jsxs)("div",{className:"relative h-full w-full bg-bg-000",children:[(0,n.jsx)(eh.P.div,{className:"w-full h-full",animate:h?"minimized":"full",variants:{minimized:{scale:.95},full:{scale:1}},children:(0,n.jsx)(eN,{compassStatus:m,onClose:s,onDebug:f,handleOpenSources:p})}),(0,n.jsx)("div",{className:(0,k.A)("absolute top-0 left-0 right-0 bottom-0 h-full w-full pointer-events-none bg-always-black/[5%]",h?"opacity-100":"opacity-0")}),(0,n.jsx)(eh.P.div,{animate:h?"visible":"hidden",variants:{visible:{opacity:1,translateX:0},hidden:{opacity:0,translateX:"100%"}},transition:{ease:eo.A.snappyOut},className:(0,k.A)("absolute top-0 left-0 right-0 bottom-0"),children:(0,n.jsx)(eE,{isHidden:!h,compassStatus:m,onBack:a?()=>i(!1):()=>p(!1),onClose:s,onDebug:f,isDebug:a,agentIndex:l.index})})]})}function eN(e){let{compassStatus:t,onClose:s,onDebug:a,handleOpenSources:i}=e,l=(0,I.A)(),r=(0,J.OQ)(t),o=t.status,d=(0,J.Nw)(t),c=t.total_sources||0,u=t.agents.slice(1).flatMap((e,t)=>e.annotated_snippets.flat().filter(e=>e.tool_calls.length>0).map(s=>({...s,total_sources:e.total_sources,description:e.description||e.name,complete:!!(s.complete||e.completed_at),globalAgentIndex:t+1,numSources:e.total_sources}))),m=_.P5.indexOf(o),p=[{title:o===_.zu.Starting||o===_.zu.Planning?l.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"}):l.formatMessage({defaultMessage:"Research plan created",id:"MIzjwRDSc0"}),children:d?(0,n.jsx)(J.GT,{thought:d,className:"pt-4 pb-6"}):void 0,shown:!0,expandable:!!d},{title:o===_.zu.InitiatingAgents||o===_.zu.Searching?0===c?l.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):l.formatMessage({defaultMessage:"Gathering {count, plural, one {# source} other {# sources}} and counting...",id:"kQHn/iXQmy"},{count:c}):l.formatMessage({defaultMessage:"Gathered {count, plural, one {# source} other {# sources}}",id:"DU/dbPu5mV"},{count:c}),titleIcons:(0,n.jsx)(J.mq,{hrefs:(0,J.mk)({agents:t.agents,n:3})}),children:(0,n.jsx)(ek,{allSnippets:u,status:t,onOpenSources:i}),shown:m>=2||t.agents.length>1,expandable:u.length>0},{title:o===_.zu.Completed?l.formatMessage({defaultMessage:"Boom! Research report is ready",id:"8CCPGtuLnt"}):l.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"}),shown:m>=4,expandable:!1}],f=p.filter(e=>e.expandable).length,h=p.findLastIndex(e=>!!e.expandable),g=(0,z.useRef)(h),[x,v]=(0,z.useState)(h),[j,b]=(0,z.useState)(!0),y=(0,z.useCallback)((e,t,s)=>{b(s),t?v(e):v(+(0===e))},[b,v]);(0,z.useEffect)(()=>{h!==g.current&&y(h,!0,!1)},[y,h]);let w=[_.zu.Cancelled,_.zu.Failed,_.zu.TimedOut].includes(t.status),C=p.filter(e=>e.shown).length;return(0,n.jsxs)("div",{className:"flex flex-col h-full bg-bg-000 overflow-hidden",children:[(0,n.jsx)(ey,{onClose:s,onDebug:a,title:r,className:"font-medium"}),(0,n.jsxs)("div",{className:"flex flex-col overflow-y-auto px-5 pb-5 pt-1 -mt-1",children:[p.map((e,s)=>{let{expandable:a,shown:i,title:l,titleIcons:r,children:o}=e,d=w||s<C-1||t.status===_.zu.Completed;return(0,n.jsx)(eS,{title:l,titleIcons:r,noShimmer:d||w,complete:d,isExpanded:a&&x===s,snappyTransition:j,showLine:s<C-1||w||x===s,handleExpand:e=>y(s,e,!0),expandable:a,collapsible:f>1,shown:i,children:o},s)}),w&&(0,n.jsx)(eS,{title:t.status===_.zu.Cancelled?l.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"}):l.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),snappyTransition:!0,noShimmer:!0,isError:!0,handleExpand:ev(),shown:w})]})]})}function eS(e){let{title:t,titleIcons:s,complete:a,expandable:i,collapsible:l,shown:r,isExpanded:o,handleExpand:d,snappyTransition:c,noShimmer:u,isError:m,showLine:p,children:f}=e;return!!r&&(0,n.jsxs)("div",{className:"flex flex-row gap-3 min-h-[2.125rem] shrink-0",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center mt-[5px]",children:[(0,n.jsx)("div",{className:(0,k.A)("transition-all w-2.5 h-2.5 rounded-full shrink-0",m?"bg-danger-200":a?"bg-text-500":"bg-accent-main-200")}),p&&(0,n.jsx)("div",{className:(0,k.A)("transition-all h-full -mb-1 w-[1px]",a?"bg-border-300":"bg-gradient-to-b from-accent-main-200/50 to-accent-main-200/0")})]}),(0,n.jsxs)("div",{className:"w-full flex flex-col",children:[(0,n.jsx)("button",{className:"inline-flex items-center gap-1",onClick:()=>d(!o),disabled:!i||o&&!l,children:(0,n.jsxs)("h4",{className:(0,k.A)("flex flex-row items-center gap-2 transition-colors text-start text-text-100 hover:text-text-000 text-sm h-5 user-select-none",m&&"!text-danger-200"),children:[u?t:(0,n.jsx)(el.N,{children:t}),(0,n.jsx)(eg.N,{children:!!s&&!o&&(0,n.jsx)(eh.P.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},children:s})}),!!i&&l&&(0,n.jsx)(ep.a,{className:(0,k.A)("bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",o?"rotate-0":"-rotate-90"),size:12})]})}),(0,n.jsx)(ej.NG,{isExpanded:!!i&&!!o,isScrollable:!1,snappyTransition:c,className:"!max-h-none w-full",setIsExpanded:d,children:f})]})]})}function eA(e){var t,s;let{toolCall:a,isHidden:i}=e;if("web_fetch"===a.tool_name&&(null==(t=a.output)?void 0:t.type)==="rich_link"&&a.output.link.url){let{url:e,icon_url:t,title:s,subtitles:l}=a.output.link;return(0,n.jsx)(ej.aX,{isDisabled:i,isStreaming:!1,icon:(0,n.jsx)(en.d,{fadeInOnLoad:!0,url:t,size:16}),text:(0,n.jsx)(T.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:s,b:e=>(0,n.jsx)("span",{className:"text-text-400",children:e})}}),handleClick:()=>{window.open(e,"_blank")},secondaryText:null==l?void 0:l[0],secondaryIcon:(0,n.jsx)(ef.B,{size:16,className:"text-text-300"}),isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0"})}return a.output?(0,n.jsx)(eb.K,{integrationName:a.integration_name||void 0,integrationIcon:a.server_icon_url||void 0,message:a.message,isExpandingDisabled:i,result:a.output,isStreaming:!1,isError:a.is_error,isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0",contentClassName:(null==(s=a.output)?void 0:s.type)==="json_block"?"":"!max-h-none",defaultExpanded:!0}):null}function eE(e){var t;let{isHidden:s,compassStatus:a,onClose:i,onDebug:l,onBack:r,isDebug:o,agentIndex:d}=e,c=(0,z.useRef)(null),u=(0,I.A)(),m=d?!!(null==(t=a.agents[d])?void 0:t.completed_at):a.status===_.zu.Completed,p=void 0===d?null:a.agents[d].description||a.agents[d].name,f=function(e,t){let s=[];for(let a of t?[e.agents[t]]:e.agents)for(let e of a.annotated_snippets)for(let t of e.tool_calls)t.output&&s.push({toolCall:t,timestamp:e.complete&&a.completed_at||a.started_at});return s.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),s.map(e=>{let{toolCall:t}=e;return t})}(a,d),h=void 0===d?a.total_sources:a.agents[d].total_sources;return(0,n.jsxs)("div",{className:(0,k.A)("text-sm bg-bg-000 h-full overflow-hidden flex flex-col",s&&"pointer-events-none user-select-none"),children:[(0,n.jsx)(ey,{onDebug:o?void 0:l,isHidden:s,title:o?"Ant only debug panel":u.formatMessage({defaultMessage:"{totalSources, plural, one {# source} other {# sources}} {status}",id:"8cAP0ZJRie"},{totalSources:h,status:m?"":(0,n.jsx)(T.A,{id:"um9oac7M9y",defaultMessage:"and counting..."})}),onClose:i,onBack:()=>{setTimeout(()=>{c.current&&(c.current.scrollTop=0)},500),r()}}),(0,n.jsxs)("div",{ref:c,className:"relative flex-1 overflow-auto px-5 pt-1 pb-5",children:[!!p&&(0,n.jsx)(e_,{title:p,complete:m,className:"pt-1 pb-5"}),f.length>0?(0,n.jsx)("div",{className:"flex flex-col gap-4",children:f.map((e,t)=>(0,n.jsx)(eA,{toolCall:e,isHidden:s},t))}):(0,n.jsx)("div",{className:"text-text-500 text-center px-8 py-16",children:(0,n.jsx)(T.A,{id:"yWSiuEkfbY",defaultMessage:"No sources found"})})]})]})}var ez=s(26786),eT=s(71462),eI=s(34385);let eU=e=>{let{docUuid:t,projectUuid:s,goBack:a,onClose:i}=e,{data:l}=(0,eI.Rn)({projectUuid:s,docUuid:t});if(!l)return null;let r={file_name:l.file_name,file_size:l.content.length,file_type:"text/plain",extracted_content:l.content,origin:eT.R.UserUpload};return(0,n.jsx)(ez.f,{attachment:r,goBack:a,onClose:i})};var eL=s(41005);let eR=(0,z.memo)(function(e){var t;let{conversationUuid:s,onClose:a,isStreaming:i,projectUuid:l,sendMessage:r,isOpen:o,isTemporary:d=!1}=e,c=(0,q.so)(s),{activeOrganization:u}=(0,g.YL)(),{chatResourceState:{selectedItem:m,activeMessageUuid:p,attachments:f,files:h,streamingFiles:x},dispatchChatResource:v}=(0,ea.i)(),j=null==u?void 0:u.uuid,b=(0,q.HF)(),y=null==(t=(0,et.f)({conversationUuid:s,source:"w"}).data)?void 0:t.artifact_versions,w=(0,z.useMemo)(()=>{if(!m||"artifact"!==m.type||!y)return;let e=y.find(e=>e.uuid===(null==m?void 0:m.versionUuid));if(e)return{id:e.artifact_uuid,title:e.title,language:e.code_language,type:e.artifact_type,version_uuid:e.uuid,versions:[{command:"create",uuid:e.uuid,resultState:e.result_state,content:e.result_state,message:e.message_uuid,created_at:e.created_at,source:e.source,isClosed:!0}]}},[y,m]),_=(null==m?void 0:m.type)==="artifact"&&m.versionUuid?{uuid:m.versionUuid,type:"artifact_version"}:void 0,C=(0,$.f)({artifactContext:_}),k=(0,Q.useQueryClient)(),M=(0,Z.j)({artifactContext:_,chatConversationUuid:s,onStorageChange:()=>{k.invalidateQueries({queryKey:[ee.r$]})}}),N=(0,X.y)(f,h,j,l),S=(0,z.useMemo)(()=>({claudeComplete:C,getFile:N,storage:M}),[C,N,M]),A=(0,z.useCallback)(e=>{(null==m?void 0:m.type)==="artifact"&&v({type:"SELECT_ARTIFACT",id:m.id,versionUuid:e})},[m,v]),E=(0,z.useCallback)(e=>v({type:"SELECT_DOC",id:e}),[v]),T=(0,z.useCallback)(()=>v({type:"CLEAR_SELECTED"}),[v]),I=(null==m?void 0:m.type)==="artifact"&&b[m.id]?b[m.id]:w;return(0,n.jsx)(n.Fragment,{children:(null==m?void 0:m.type)==="artifact"&&I?(0,n.jsx)("div",{className:"relative h-full",children:(0,n.jsx)(es.CV,{isStreaming:i,artifact:I,selectedArtifactMessageUuid:p,selectedArtifactVersionUuid:m.versionUuid,setSelectedArtifactVersionUuid:A,onClose:a,projectUuid:l,selectDoc:E,sendMessage:r,richSandboxCapabilities:S,isOpen:o,isTemporary:d})}):(null==m?void 0:m.type)!=="artifact"||b[m.id]?(null==m?void 0:m.type)==="attachment"?(0,n.jsx)(ez.f,{goBack:()=>v({type:"CLEAR_SELECTED"}),attachment:m.attachment,onClose:a}):(null==m?void 0:m.type)==="compass"?(0,n.jsx)(eM,{data:m.data,onClose:a,goBack:T}):l&&(null==m?void 0:m.type)==="doc"?(0,n.jsx)(eU,{docUuid:m.id,projectUuid:l,onClose:a,goBack:()=>v({type:"CLEAR_SELECTED"})}):(null==m?void 0:m.type)==="file"?(0,n.jsx)(eL.yL,{file:{path:m.path,name:m.path.split("/").pop()||m.path},showBackButton:m.path.startsWith("/mnt/user-data/outputs/"),goBack:()=>v({type:"CLEAR_SELECTED"}),onClose:a,conversationUuid:s,projectUuid:l,isTemporary:d,isShared:!1,isStreaming:i,streamingFile:x.get(m.path),artifactVersions:null!=y?y:[],cacheBuster:c},m.path):null:(0,n.jsx)(es.CV,{isStreaming:i,artifact:void 0,selectedArtifactMessageUuid:p,selectedArtifactVersionUuid:(null==m?void 0:m.type)==="artifact"?m.versionUuid:void 0,setSelectedArtifactVersionUuid:A,onClose:a,projectUuid:l,selectDoc:E,sendMessage:r,richSandboxCapabilities:S,isOpen:o,isTemporary:d})})});var eO=s(47479),eF=s(74813),eD=s(44995),eP=s(14691),eB=s(87483),eG=s(31779),eW=s(28044),eJ=s(20680),eV=s(85524),eH=s(19977),eq=s(41135),eY=s(96442),eK=s(19150),eX=s(48321),e$=s(18849),eZ=s(79901),eQ=s(53270),e0=s(46868),e1=s(34793),e2=s(61987),e3=s(75103);let e4=e=>{let{projectUuid:t}=e,{data:s}=(0,O.fo)(t);return s?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,n.jsx)(T.A,{defaultMessage:"Project content",id:"/IJPT7JRFn"})}),(0,n.jsxs)("div",{className:"border-border-400 rounded-lg border px-3 py-4",children:[(0,n.jsxs)(A(),{href:"/project/".concat(t),className:"hover:text-text-000 flex items-center gap-1.5 hover:underline",children:[(0,n.jsx)(e1.D,{size:16,className:"text-text-300 shrink-0"}),(0,n.jsx)("div",{className:"font-claude-response text-text-200 leading-tight",children:s.name})]}),(0,n.jsx)("div",{children:(0,n.jsx)(e3.t,{project:s,className:"text-text-400 text-xs"})}),(0,n.jsx)("ul",{className:"mt-2 flex flex-col",children:(0,n.jsx)(e2.b,{isEditable:!1,project:s,maxItems:3,onViewAll:()=>{window.location.href="/project/".concat(t)}})})]})]})}):null};var e6=s(10304),e5=s(72352);async function e8(e,t,s){try{let a=new URL("/api/organizations/".concat(e,"/conversations/").concat(t,"/wiggle/list-files"),window.location.origin);void 0!==s&&a.searchParams.append("prefix",s);let n=await fetch(a.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)return[];let i=await n.json();if(i.files_metadata)return i.files_metadata;if(i.files)return i.files.map(e=>({path:e,size:0,content_type:"application/octet-stream"}));return[]}catch(e){return[]}}let e7=(0,eY.default)(()=>Promise.all([s.e(9883),s.e(3510),s.e(8059),s.e(4484)]).then(s.bind(s,44484)).then(e=>e.ShareModal),{loadableGenerated:{webpack:()=>[44484]},ssr:!1}),e9=(0,eY.default)(()=>s.e(5457).then(s.bind(s,55457)).then(e=>e.WiggleSharingModals),{loadableGenerated:{webpack:()=>[55457]},ssr:!1});function te(e){let{conversationUuid:t,projectUuid:s,isStreaming:a,isTemporary:i=!1,messagesLength:l=0}=e,r=(0,h.u9)(),{refetchAll:o,selectWiggleFile:d,wiggleFiles:c,wiggleSharedArtifacts:u}=function(e){let{conversationUuid:t,messagesLength:s=0,isStreaming:a}=e,n=(0,q.so)(t),i=(0,h.Yl)(),{isDrawerExpanded:l}=(0,e$.x)(),{chatResourceState:{selectedItem:r},dispatchChatResource:o}=(0,ea.i)(),d=(0,et.f)({conversationUuid:t,source:"w"}),c=(0,z.useMemo)(()=>{var e,t;return null!=(t=null==(e=d.data)?void 0:e.artifact_versions)?t:[]},[d.data]),u=i&&l&&!r,m=function(e,t,s){let[a,n]=(0,z.useState)([]),[i,l]=(0,z.useState)(!1),[r,o]=(0,z.useState)(null),{activeOrganization:d}=(0,g.YL)(),c=(0,h.u9)(),u=(0,z.useCallback)(async()=>{if(c&&t&&(null==d?void 0:d.uuid)){l(!0),o(null);try{let e=(await e8(d.uuid,t,"")).map(e=>{let t=e.path.split("/").pop()||e.path;return{path:e.path,name:t,content_type:e.content_type||"application/octet-stream"}});n(e)}catch(e){o("Failed to load files")}finally{l(!1)}}},[c,t,null==d?void 0:d.uuid,""]);return(0,z.useEffect)(()=>{c&&s&&u()},[c,s,u]),{files:a,isLoading:i,error:r,refetch:u}}("",t,u),p=(0,z.useMemo)(()=>{var e;let t=[],s=[];return null==(e=m.files)||e.forEach(e=>{"/mnt/user-data/README.md"!==e.path&&(e.path.startsWith("/mnt/user-data/uploads/")||(e.path.startsWith("/mnt/user-data/outputs/")?t.push(e):s.push(e)))}),{output:t,scratchpad:s}},[m.files]),f=p.output.length+p.scratchpad.length,x=(0,z.useCallback)((e,t)=>{o({type:"SELECT_FILE",path:e.replace("computer://",""),toolType:"create_file",messageId:t})},[o]),v=(0,z.useCallback)(async()=>{i&&await Promise.all([m.refetch(),d.refetch()])},[i,m,d]),j=(0,z.useCallback)(async()=>{i&&await m.refetch()},[i,m]),b=(0,e5.Y)(v,{leading:!1,delay:eL.XO});(0,z.useEffect)(()=>{r||b()},[l,n]);let y=(0,z.useRef)(!1);return(0,z.useEffect)(()=>{if(s){if(y.current&&!a){let e=q.oz.getState(),s=e.pathUuidsByConversation[t]||[],a=s[s.length-1],n=a?e.messageByUuid[a]:void 0;if(n&&"assistant"===n.sender&&Array.isArray(n.content)&&n.content.some(e=>(null==e?void 0:e.type)==="tool_use"&&(e.input?JSON.stringify(e.input):"").includes("outputs"))){let e=setTimeout(()=>{j()},2e3);return()=>clearTimeout(e)}}y.current=a}},[a,t,j,s]),{wiggleGate:i,showWiggleControls:u,refetchAll:v,refetchWiggleRoot:j,selectWiggleFile:x,wiggleFiles:p,wiggleFilesCount:f,wiggleSharedArtifacts:c}}({conversationUuid:t,messagesLength:l,isStreaming:a}),{isDrawerExpanded:m}=(0,e$.x)(),{chatResourceState:{selectedItem:p,activeMessageUuid:f,files:x,syncSources:v},dispatchChatResource:j}=(0,ea.i)(),{activeOrganization:b}=(0,g.YL)(),w=(0,eF.st)(),[_,C]=(0,z.useState)(null),M=(0,I.A)(),N=(0,eK._)({conversationUuid:t,isStreaming:a}),[S,A]=(0,z.useState)(!1),E=0===c.output.length&&0===u.length&&0===c.scratchpad.length&&0===x.length&&0===v.length&&!s,U=(0,eW.V)();return!r||(0,K.O)(t)?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,k.A)("flex flex-col relative","max-md:absolute max-md:inset-x-0 max-md:top-0",p&&"max-md:hidden",!p&&m&&"max-md:z-header",p&&m&&"md:z-0",!m&&"max-md:pointer-events-none max-md:absolute max-md:inset-0"),inert:!!p&&!!m||void 0,children:[(0,n.jsx)(tt,{wiggleFiles:c,isTemporary:i,shareState:N}),!E&&(0,n.jsx)("div",{className:(0,k.A)("overflow-x-hidden overflow-y-auto md:h-[calc(100%-56px)]","max-md:h-screen max-md:border-t max-md:border-border-300 max-md:bg-bg-100","md:transition-[width] md:duration-300 md:ease-in-out",m?"w-full md:mt-12 md:m-2 md:w-[384px] p-5 border-0.5 border-border-300 md:rounded-2xl max-md:border-0":"w-0 p-0 m-0 border-0 overflow-hidden",p&&"md:absolute",U&&m&&"md:mt-[62px]",i&&m&&"md:mt-14"),children:(0,n.jsx)("div",{className:(0,k.A)(m?"md:w-[342px]":"w-0"),children:(0,n.jsxs)("div",{className:(0,k.A)("flex flex-col gap-5 md:transition-opacity md:duration-300",m?"md:animate-[fade_0.3s_ease-in-out_0.1s_forwards]":"opacity-0 pointer-events-none"),children:[c.output.length?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"font-medium text-sm",children:(0,n.jsx)(T.A,{defaultMessage:"Artifacts",id:"eW5eoWkxy3"})}),(0,n.jsx)(ei.$,{variant:"ghost",prepend:(0,n.jsx)(eJ.e,{size:14}),className:(0,k.A)("text-sm font-medium opacity-0",c.output.length>1&&"opacity-100"),size:"sm",onClick:()=>{(null==b?void 0:b.uuid)&&(0,eX.y)({filepaths:c.output.map(e=>e.path),orgUuid:b.uuid,conversationUuid:t,isShared:!1,source:"chat_controls_download_all_button"},w)},children:(0,n.jsx)(T.A,{defaultMessage:"Download all",id:"V1UrPNM96z"})})]}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:c.output.map(e=>(0,n.jsx)(y.Tooltip,{align:"end",tooltipContent:e.name,side:"bottom",children:(0,n.jsx)("div",{children:(0,n.jsx)(eQ._,{file:e,conversationUuid:t,onOpen:()=>d(e.path,f||""),isInSidebar:!0,isShared:!1},e.path)})},e.path))})]}):null,u.length?(0,n.jsx)(ts,{artifactVersions:u,onSelectArtifactVersion:e=>{j({type:"SELECT_ARTIFACT",id:"",versionUuid:e})},onComplete:e=>C(e)}):null,c.scratchpad.length?(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsxs)("button",{className:"flex font-medium items-center justify-between p-1 hover:bg-bg-300 rounded-md",onClick:()=>A(e=>!e),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(T.A,{defaultMessage:"Scratchpad",id:"Qb4YubxAW2"}),(0,n.jsx)(y.Tooltip,{tooltipContent:M.formatMessage({defaultMessage:"Files used to create artifacts",id:"T2w69cOLhV"}),side:"right",children:(0,n.jsx)(eV.m,{})})]}),(0,n.jsx)(eH.J,{className:(0,k.A)("transition",S?"rotate-90":"")})]}),(0,n.jsx)(ta,{isExpanded:S,children:(0,n.jsx)("div",{className:"flex flex-col gap-2",children:c.scratchpad.map(e=>(0,n.jsx)(ei.$,{variant:"ghost",prepend:(0,n.jsx)(eZ.o,{path:e.path}),className:"!justify-start",onClick:()=>{d(e.path,f||"")},children:e.name},e.path))})})]}):null,s&&(0,n.jsx)(e4,{projectUuid:s}),(0,n.jsx)(tn,{})]})})})]}),_&&(0,n.jsx)(e9,{artifactVersion:_,onClose:()=>C(null),onUpdate:async()=>{await o(),C(null)},projectUuid:s}),N.showShareFlow&&(0,n.jsx)(e7,{...N})]})}function tt(e){var t;let{wiggleFiles:s,isTemporary:a,shareState:i}=e,l=(0,I.A)(),r=(0,eW.V)(),{isDrawerExpanded:o,setIsDrawerExpanded:d}=(0,e$.x)(),{chatResourceState:{selectedItem:c,files:u,syncSources:m},dispatchChatResource:p}=(0,ea.i)(),f=u.length+m.length,h=s.output.length+s.scratchpad.length+f,g=(0,z.useMemo)(()=>o?l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}):l.formatMessage({defaultMessage:"Open sidebar",id:"+G35mRWa75"}),[l,o]);return(0,n.jsxs)("div",{className:(0,k.A)("md:absolute md:right-0 md:top-0 z-20","max-md:w-fit max-md:self-end max-md:pointer-events-auto","flex justify-end shrink-0 min-w-0 pr-3 items-center gap-1",r?"!h-[52px] draggable":"!h-12","transition-opacity duration-150 ease-in-out",c&&o?"md:opacity-0 md:pointer-events-none":"md:opacity-100 delay-300",r&&o&&!c&&["md:shadow-[0px_1px_0px_0px_theme(colors.border-300)]","w-full"],a&&"pt-3"),"data-testid":"wiggle-controls-actions",children:[h>0&&(0,n.jsx)(ei.$,{"aria-label":g,tooltip:g,variant:"ghost",size:"icon_sm",onClick:()=>{p({type:"CLEAR_SELECTED"}),d(!o)},state:o?"active":void 0,"data-testid":"wiggle-controls-actions-toggle",children:(0,n.jsx)(eP.ZH,{})}),i.showShareFlow&&!a&&(0,n.jsx)(ei.$,{tooltip:null!=(t=i.disabled_reason)?t:r&&(0,n.jsx)(T.A,{defaultMessage:"Share chat",id:"bXa+lJhlYV"}),variant:r?"ghost":"secondary",size:r?"icon_sm":"sm",onClick:i.openShareModal,disabled:i.disabled,prepend:r&&(0,n.jsx)(eP.SY,{}),"data-testid":"wiggle-controls-actions-share",children:!r&&(0,n.jsx)(T.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})]})}function ts(e){let{artifactVersions:t,onSelectArtifactVersion:s,onComplete:a}=e,{publishedArtifactsBaseUrl:i}=(0,eD._r)(),{copyToClipboard:l}=(0,er.C)();return(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h3",{className:"text-text-500 text-xs",children:(0,n.jsx)(T.A,{defaultMessage:"Shared",id:"kWI6zXRaHY"})})}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:t.map(e=>{let t=e.published_artifact_uuid?"publish":"share",r=e.published_artifact_uuid?e.published_artifact_deleted_at?(0,n.jsx)(T.A,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"}):(0,eG.d)(e.created_at):"shared"===e.visibility?(0,eG.d)(e.created_at):"private"===e.visibility?(0,n.jsx)(T.A,{defaultMessage:"Unshared",id:"0r/9ANkloS"}):null;return(0,n.jsxs)("div",{className:"flex-1 flex items-center",children:[(0,n.jsxs)(ei.$,{variant:"ghost",className:"flex-1 !justify-start !px-2 text-sm gap-1.5",onClick:()=>{s(e.uuid)},children:[(0,n.jsx)(eP.Xq,{size:20,className:"shrink-0"}),(0,n.jsxs)("span",{className:"flex items-center min-w-0 overflow-hidden",children:[(0,n.jsx)("span",{className:"truncate",children:e.title}),(0,n.jsx)(eq.c,{size:16,className:"shrink-0"}),(0,n.jsx)("span",{className:"text-xs text-text-500",children:r})]})]}),(0,n.jsxs)(eB.ms,{align:"end",trigger:(0,n.jsx)(ei.$,{variant:"ghost",size:"icon_sm",children:(0,n.jsx)(eP.qw,{size:20})}),children:[(0,n.jsx)(eB.tJ,{onClick:()=>{l((0,e6.x)(t,{artifact_uuid:e.artifact_uuid,artifact_version_uuid:e.uuid,message_uuid:e.message_uuid,published_artifact_uuid:e.published_artifact_uuid},i))},children:(0,n.jsx)(T.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})}),e.published_artifact_deleted_at?null:(0,n.jsx)(eB.tJ,{onClick:()=>a(e),children:"publish"===t?(0,n.jsx)(T.A,{defaultMessage:"Unpublish",id:"VjZ6FKc+ZZ"}):"shared"===e.visibility?(0,n.jsx)(T.A,{defaultMessage:"Unshare",id:"bEq+NWNIXF"}):(0,n.jsx)(T.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})]})]},e.uuid)})})]})}function ta(e){let{children:t,isExpanded:s}=e;return(0,n.jsx)(eh.P.div,{className:"overflow-hidden shrink-0",tabIndex:-1,initial:{opacity:0,height:s?"auto":0},animate:s?"expanded":"collapsed",transition:{ease:"easeInOut",duration:.4},variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:t})}function tn(){let{chatResourceState:{files:e,attachments:t,syncSources:s},dispatchChatResource:a}=(0,ea.i)();return e.length+s.length>0?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h3",{className:"font-medium text-sm",children:(0,n.jsx)(T.A,{defaultMessage:"Content",id:"Jq3FDzj0/T"})})}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:(0,n.jsxs)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))] gap-3",children:[e.map((e,t)=>(0,n.jsx)(eO.NM,{size:"stretch",file:e},"".concat(e.file_kind,"-").concat(t))),t.map((e,t)=>(0,n.jsx)(eO.NM,{size:"stretch",file:e,handleClick:()=>a({type:"SELECT_ATTACHMENT",attachment:e})},"attachment-".concat(t))),s.map(e=>(0,n.jsx)(e0.br,{size:"stretch",syncSource:e,isEditable:!1,location:"chat"},e.uuid))]})})]}):null}var ti=s(45054),tl=s(69524);function tr(e){let{conversationUuid:t}=e,s=(0,E.useRouter)(),a=(0,ti.Y)(),[i,l]=(0,z.useState)(!1),r=(0,q.xJ)(t);return(0,n.jsxs)("div",{className:" flex flex-col gap-1.5 border-0.5 border-border-300 bg-bg-100 rounded-t-xl text-text-300 font-ui z-10 p-6 ",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row items-center sm:justify-between font-medium",children:[(0,n.jsx)("div",{className:"text-lg",children:(0,n.jsx)(T.A,{defaultMessage:"Chat ended by Claude",id:"dHdfbAOK+j"})}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(ei.$,{onClick:()=>s.push("/new"),children:(0,n.jsx)(T.A,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),(0,n.jsx)(ei.$,{variant:"secondary",onClick:()=>l(!0),children:(0,n.jsx)(T.A,{defaultMessage:"Give feedback",id:"bCmvTYWKoj"})})]})]}),(0,n.jsx)(tl.B,{conversationUuid:t,requestedFeedbackType:_.kj.CHAT_ENDED,setRequestedFeedbackType:()=>{},message:r,isOpen:i,onClose:()=>{l(!1)},onSuccess:()=>a.addSuccess("Feedback submitted successfully"),showOptions:!1})]})}var to=s(42605),td=s(28483),tc=s(1613),tu=s(41473),tm=s(14493),tp=s(7881),tf=s(84617),th=s(39613);function tg(){let e=(0,a._)(["\n  w-full\n  flex\n  gap-2\n  bg-warning-orange\n  px-3\n  py-2\n  ","\n"]);return tg=function(){return e},e}let tx=["consumer_restricted_mode","consumer_second_warning","consumer_first_warning","recent_election_discussion"],tv=e=>{let{long:t}=e;return(0,n.jsx)(tf.Y,{href:th.Z1,target:"_blank",rel:"noreferrer",children:t?(0,n.jsx)(T.A,{defaultMessage:"Learn more about the types of prompts to avoid {arrow}",id:"6DZ92vAY0j",values:{arrow:"\xbb"}}):(0,n.jsx)(T.A,{defaultMessage:"Learn more {arrow}",id:"ZeACTbo6DM",values:{arrow:"\xbb"}})})},tj={consumer_restricted_mode:[{isDismissible:!1,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.A,{defaultMessage:"Because a large number of your prompts have violated our Acceptable Use Policy, we have temporarily applied enhanced safety filters to your chats.",id:"PzePYdPNe4"})," ",(0,n.jsx)(tv,{})]})}],consumer_second_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.A,{defaultMessage:"It appears your recent prompts continue to violate our Acceptable Use Policy. If we continue seeing this pattern, we’ll apply enhanced safety filters to your chats.",id:"BjivfV2YY6"})," ",(0,n.jsx)(tv,{})]})}],consumer_first_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.A,{defaultMessage:"It looks like a few of your recent prompts don’t meet our Usage Policy.",id:"Aup/Kzn3Eq"})," ",(0,n.jsx)(tv,{long:!0})]})}],recent_election_discussion:[{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(T.A,{defaultMessage:"Claude may not be able to provide accurate, real time information on elections. Please visit <link>TurboVote</link> or check the Secretary of State site for your state to get reliable, up-to-date, non partisan guidance on how and where to vote in elections across the US.",id:"X4J/f3yO08",values:{link:e=>(0,n.jsx)(tf.Y,{href:"http://claude.turbovote.org",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"US"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(T.A,{defaultMessage:"The United Kingdom’s general elections will be held on 4 July, 2024. Please visit the <link>UK Election Commission’s website</link> to get reliable, up-to-date, impartial guidance on how and where to vote in the United Kingdom’s general elections.",id:"VUvO/yD1Iw",values:{link:e=>(0,n.jsx)(tf.Y,{href:"https://www.electoralcommission.org.uk/",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"GB"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(T.A,{defaultMessage:"The French legislative elections will be held in two rounds of voting on June 30 and July 7, 2024. Please consult <link>the French Public Administration website</link> for reliable and up-to-date guidance on where and how to vote in the legislative elections in France.",id:"ZzEMOJWfNz",values:{link:e=>(0,n.jsx)(tf.Y,{href:"https://www.service-public.fr/particuliers/vosdroits/N47",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"FR"}]};function tb(e){let{isClaudeDot:t,content:s,isDismissible:a,handleDismiss:i}=e;return(0,n.jsx)("div",{className:t?"fixed top-8 z-10 p-4":"",children:(0,n.jsx)(tw,{$isFloating:t,children:(0,n.jsxs)("div",{className:"items-top flex justify-between",children:[(0,n.jsx)("p",{className:"text-sm font-medium",children:s}),a&&i&&(0,n.jsx)("button",{className:"h-5 cursor-pointer",onClick:()=>void i(),children:(0,n.jsx)(eu.X,{size:24})})]})})})}function ty(e){let{conversationUuid:t}=e,s=(0,eF.st)(),a=(0,eD.fZ)(),{account:i,activeOrganization:l}=(0,g.YL)(),r=null==i?void 0:i.uuid,o=null==l?void 0:l.uuid,{mutateAsync:d}=(0,R.iD)(),{data:c}=(0,R.Nj)(null==l?void 0:l.uuid),u=(0,eD._r)().ipCountry,m=(null==c?void 0:c.active_flags)&&(null==c?void 0:c.active_flags.map(e=>e.type)),{shownFlagType:p,shownFlagDetails:f}=function(e,t){let s=tx.findIndex(e=>null==t?void 0:t.includes(e)),a=tx[s];if(!a)return{shownFlagType:null,shownFlagDetails:null};let n=tj[a].filter(t=>!t.applicable_country||t.applicable_country===e);return 0===n.length?{shownFlagType:null,shownFlagDetails:null}:{shownFlagType:a,shownFlagDetails:n[0]}}(u,m);if((0,z.useEffect)(()=>{r&&o&&p&&s.track({event_key:"ts.banner.shown",flag_type:p,conversation_uuid:t,account_uuid:r,organization_uuid:o,ipCountry:null!=u?u:"unknown"})},[s,p,t,r,o,u]),!p||!f)return;let{isDismissible:h,content:x}=f,v=async()=>{if(!h)return;let e=[p];"consumer_second_warning"===p&&(null==m?void 0:m.includes("consumer_first_warning"))&&e.push("consumer_first_warning"),await Promise.all(e.map(e=>d({flagType:e})))};return(0,n.jsx)(tb,{isClaudeDot:a,content:x,isDismissible:h,handleDismiss:v})}let tw=j.J.div(tg(),e=>e.$isFloating&&"max-w-3xl\n    mx-auto\n    rounded-md\n    shadow-element\n    z-toast");var t_=s(53095),tC=s(69841),tk=s(49734),tM=s(62640),tN=s(72424),tS=s(78434),tA=s(60368);let tE=["apps_and_websites","documents_and_templates","games","productivity_tools","creative_projects","quiz_or_survey","start_from_scratch"],tz=e=>{var t;let{selectedLabel:s,disabled:a}=e,l=(0,I.A)(),{track:r}=(0,eF.st)(),o=new Map([["apps_and_websites",l.formatMessage({defaultMessage:"Apps and websites",id:"HC16Tj5QBT"})],["documents_and_templates",l.formatMessage({defaultMessage:"Documents and templates",id:"mLy6zrc3XL"})],["games",l.formatMessage({defaultMessage:"Games",id:"DUyJmj7sj9"})],["productivity_tools",l.formatMessage({defaultMessage:"Productivity tools",id:"t/RMra2cqp"})],["creative_projects",l.formatMessage({defaultMessage:"Creative projects",id:"gZSnjM59XP"})],["quiz_or_survey",l.formatMessage({defaultMessage:"Quiz or survey",id:"yyPDfhkUT7"})],["start_from_scratch",l.formatMessage({defaultMessage:"Start from scratch",id:"fGhwMpK3XG"})]]),d=new Map(Array.from(o,e=>e.reverse())),c=new Map([["apps_and_websites",t_.E],["documents_and_templates",tC.i],["games",tk.H],["productivity_tools",tM.l],["creative_projects",tN.e],["quiz_or_survey",tS.S],["start_from_scratch",tA.f]]),{sendTransparentMessage:u,conversation:m}=(0,to.o)(),{mutate:p}=(0,i.HF)(null==m?void 0:m.id),f=null!=(t=d.get(null!=s?s:""))?t:"default",h=async e=>{o.has(e)&&(r({event_key:"artifact.studio.create_mode_selected",create_mode:e}),(null==m?void 0:m.id)&&p({settings:{enabled_monkeys_in_a_barrel:!1}}),await u(o.get(e)))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"font-claude-response-body pl-2 mt-1",children:(0,n.jsx)(T.A,{defaultMessage:"Let’s get cooking! Pick an artifact category or start building your idea from scratch.",id:"HKJSK13xqN"})}),(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 max-w-xl justify-center items-stretch w-full",children:tE.map(e=>{let t=c.get(e);return(0,n.jsx)("div",{className:(0,k.A)("relative w-full h-full min-h-[3.5rem] sm:h-28 p-3 sm:p-3.5 font-base bg-bg-000 rounded-lg transition-colors group",f===e&&"border-0.5 text-text-100 bg-bg-000 shadow-sm",("default"!==f&&f!==e||"default"===f&&a)&&"text-text-500 bg-bg-000/50 border-0.5 border-border-300","default"===f&&!a&&"border-0.5 border-border-300 text-text-300 hover:border-text-200 hover:bg-bg-000 hover:text-text-100 cursor-pointer shadow-sm"),onClick:async()=>{"default"!==f||a||await h(e)},children:(0,n.jsxs)("div",{className:"flex flex-row sm:flex-col items-center sm:items-start justify-center sm:justify-start h-full w-full gap-3 sm:gap-0",children:[t&&(0,n.jsx)(t,{size:20,weight:"light",className:(0,k.A)("transition-transform duration-300 ease-out shrink-0 sm:absolute sm:bottom-4 sm:right-4","default"===f&&!a&&"group-hover:-rotate-2 sm:group-hover:rotate-2 group-hover:scale-105")}),(0,n.jsx)("span",{className:"flex-1 text-left",children:o.get(e)})]})},e)})})]})},tT=e=>{var t,s,a,i;let{scrollRefs:l,newMessageSent:r,setNewMessageSent:o,scrollContainerRef:d,invalidator:c}=e,[u,m]=(0,z.useState)(0),p=(0,z.useCallback)(()=>{var e,t,s,a;let n=(null==(e=l.lastAssistantMessage.current)?void 0:e.clientHeight)||0,i=(null==(t=l.lastHumanMessage.current)?void 0:t.clientHeight)||0,r=(null==(s=l.chatInput.current)?void 0:s.clientHeight)||0,o=(null==(a=l.extras.current)?void 0:a.clientHeight)||0,d=Math.max(window.innerHeight-i-n-o-r-122,0);d!==u&&m(d)},[l,u]);return(0,z.useLayoutEffect)(()=>{p()},[c,p,null==(t=l.lastAssistantMessage.current)?void 0:t.clientHeight,null==(s=l.lastHumanMessage.current)?void 0:s.clientHeight,null==(a=l.extras.current)?void 0:a.clientHeight,null==(i=l.chatInput.current)?void 0:i.clientHeight]),(0,z.useLayoutEffect)(()=>(window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)),[p]),(0,z.useLayoutEffect)(()=>{r&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{var e;null==(e=d.current)||e.scrollToBottomIfPinned("smooth"),o(!1)})})},[r,o,d]),(0,z.useEffect)(()=>{var e;null==(e=d.current)||e.scrollToBottomIfPinned("instant")},[d]),(0,n.jsx)("div",{ref:l.extraSpace,style:{height:"".concat(u,"px")},"aria-hidden":"true"})};function tI(){return(0,n.jsx)(eh.P.figure,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-text-100 absolute inset-0 grid h-full place-content-center gap-8 text-center","data-testid":"empty-chat-screen",children:(0,n.jsxs)("h2",{className:"font-title flex flex-col items-center justify-center gap-2 sm:flex-row",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(b.a,{state:"waiting"})}),(0,n.jsx)(T.A,{defaultMessage:"What can I help you with today?",id:"1PnN/uP0zv"})]})})}var tU=s(22047);let tL="/Spark/",tR=[19,17,16,15,14,13,12,11,1,11,12,13,14,15,16,17,19],tO="".concat(tL,"/Check.svg"),tF=U.z.object({changeTitle:U.z.boolean().optional(),titleDelayMs:U.z.number().optional(),changeFavicon:U.z.boolean().optional(),faviconDelayMs:U.z.number().optional(),playSound:U.z.boolean().optional()}),tD={};var tP=s(34898);let tB=(0,z.forwardRef)((e,t)=>(0,n.jsx)("div",{ref:t,"aria-hidden":"true",className:"h-px w-full pointer-events-none"}));tB.displayName="LastMessageSentinel";var tG=s(56782);function tW(e){let{autoscrollRef:t,sentinelElement:s,isStreaming:a=!1,setAutoscrollDisabled:i,avatarState:l="static"}=e,r=(0,I.A)(),[o,d]=(0,z.useState)(!1),c=(0,z.useCallback)(()=>{let e=t.current;e&&(e.reset(),e.scrollToBottomIfPinned("smooth"),a&&i(!1))},[t,a,i]);return(0,z.useEffect)(()=>{var e;if(!s)return;let a=null==(e=t.current)?void 0:e.getScrollContainer();if(!a)return;let n=new IntersectionObserver(e=>{let[t]=e;d(!t.isIntersecting)},{root:a,threshold:.01,rootMargin:"0px 0px ".concat(150,"px 0px")});return n.observe(s),()=>{n.disconnect()}},[s,t]),(0,n.jsxs)("button",{onClick:c,"aria-label":r.formatMessage({defaultMessage:"Scroll to bottom",id:"p4l9m92DsT"}),className:(0,k.A)("z-[1] size-9 inline-flex items-center justify-center","absolute -top-8 left-1/2 -translate-x-1/2","border-0.5 overflow-hidden !rounded-full p-1","shadow-md hover:shadow-lg","bg-bg-000/80 hover:bg-bg-000","backdrop-blur transition-opacity duration-200",a?"border-accent-brand/30":"border-border-300",o?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:[(0,n.jsx)(b.a,{state:l,className:(0,k.A)("absolute blur-md transition duration-300 pointer-events-none",a?"opacity-50":"opacity-0")}),(0,n.jsx)(tG.y,{className:"mix-blend-luminosity"})]})}var tJ=s(57291);s(72062);let tV=new Set(["md","markdown","mdown","mkdn","mkd","mdwn","mdtxt","mdtext"]),tH=new Set(["py","pyx","pxd","pxi","pyi","js","jsx","ts","tsx","mjs","cjs","java","scala","kt","kts","groovy","gradle","c","h","cpp","cc","cxx","hpp","hxx","cs","csx","go","rs","rb","rbw","rake","gemspec","php","phtml","php4","php5","php7","phps","swift","kt","kts","ktm","dart","lua","pl","pm","t","pod","r","R","Rmd","Rnw","sh","bash","zsh","fish","bat","cmd","ps1","sql","graphql","gql","json","xml","yaml","yml","toml","ini","cfg","conf"]),tq=[{pattern:/^#{1,6}\s+/gm,weight:.15,name:"headers"},{pattern:/\[([^\]]+)\]\(([^)]+)\)/g,weight:.1,name:"links"},{pattern:/!\[([^\]]*)\]\(([^)]+)\)/g,weight:.1,name:"images"},{pattern:/^```[\s\S]*?```$/gm,weight:.1,name:"fenced-code"},{pattern:/^(?: {4}|\t)[^\n]+$/gm,weight:.05,name:"indented-code"},{pattern:/`[^`]+`/g,weight:.05,name:"inline-code"},{pattern:/^[\s]*[-*+]\s+/gm,weight:.08,name:"unordered-list"},{pattern:/^[\s]*\d+\.\s+/gm,weight:.08,name:"ordered-list"},{pattern:/\*\*[^*]+\*\*/g,weight:.04,name:"bold"},{pattern:/\*[^*\n]+\*/g,weight:.03,name:"italic"},{pattern:/__[^_]+__/g,weight:.04,name:"bold-underscore"},{pattern:/_[^_\n]+_/g,weight:.03,name:"italic-underscore"},{pattern:/^>\s+/gm,weight:.07,name:"blockquote"},{pattern:/^---+$|^===+$/gm,weight:.05,name:"horizontal-rule"},{pattern:/^\|[^\n]+\|$/gm,weight:.08,name:"table"}];function tY(e,t){var s;let a=e?null==(s=e.split(".").pop())?void 0:s.toLowerCase():void 0;if(a&&tV.has(a))return{isMarkdown:!0,confidence:1,method:"extension"};if(a&&tH.has(a))return{isMarkdown:!1,confidence:0,method:"extension"};if(t){let e=function(e){if(!e||e.length<10)return 0;let t=0,s=[],a={};for(let{pattern:n,weight:i,name:l}of tq){let r=e.match(n);if(r&&r.length>0){let e=r.length,n=i*(.7+.3*(["headers","fenced-code","links","images"].includes(l)?Math.min(e,1):Math.min(e/5,1)));t+=n,s.push(l),a[l]=n}}return Math.min(t+.1*(s.length/tq.length),1)}(t),s=e>=.15;return{isMarkdown:s,confidence:e,method:s?"content":"none"}}return{isMarkdown:!1,confidence:0,method:"none"}}class tK{update(e){if(this.hasLatched)return this.lastResult;let t=tY(this.filename,e);return t.isMarkdown&&(this.hasLatched=!0),this.lastResult=t,t}reset(){this.hasLatched=!1,this.lastResult=tY(this.filename),this.hasLatched=this.lastResult.isMarkdown}isLatched(){return this.hasLatched}constructor(e){this.hasLatched=!1,this.filename=e,this.lastResult=tY(e),this.hasLatched=this.lastResult.isMarkdown}}var tX=s(57965),t$=s.n(tX),tZ=s(96091),tQ=s(78458);function t0(e){var t;let s=new Set;return null==(t=e.content)||t.filter(e=>"text"===e.type).forEach(e=>{(0,tZ.n)(e.text).forEach(e=>s.add(e))}),s}let t1=(0,z.memo)(e=>{let{isStreaming:t,conversationUuid:s,dispatchChatResource:a,openControlsSidebar:n,isDrawerExpanded:i,maxTrackedFiles:l,selectComputerFile:r,lastMessageUuid:o}=e,d=(0,q.xJ)(s),c=(0,q.ot)(s),m=(0,C.l)(),p=(0,eF.st)(),f=(0,z.useRef)({lastOpenedId:null});!function(e){let{isStreaming:t,lastMessage:s,conversationUuid:a,dispatchChatResource:n,openControlsSidebar:i,isDrawerExpanded:l,maxTrackedFiles:r}=e,o=(0,z.useRef)(new Map),d=(0,z.useRef)(void 0),c=(0,z.useMemo)(()=>{if(!t||!s||!s.content)return d.current;let e=s.content[s.content.length-1];return d.current=e,e},[t,s]),u=(0,z.useMemo)(()=>null,[c,r]),{detectMarkdown:m,clearDetectors:p}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=(0,z.useRef)(new Map),s=(0,z.useCallback)(s=>{if(t.current.has(s))return t.current.get(s);if(t.current.size>=e){let e=t.current.keys().next().value;e&&t.current.delete(e)}let a=new tK(s);return t.current.set(s,a),a},[e]),a=(0,z.useCallback)(e=>{if(!e||!e.path)return null;if(e.path.includes(".")){let s=e.path,a=[];t.current.forEach((e,t)=>{s.startsWith(t)&&t!==s&&!t.includes(".")&&a.push(t)}),a.forEach(e=>{t.current.delete(e)})}let a=s(e.path);return{isMarkdown:a.update(e.content).isMarkdown,isLatched:a.isLatched(),detector:a}},[s]),n=(0,z.useCallback)(()=>{t.current.clear()},[]);return{detectMarkdown:a,clearDetectors:n,removeDetector:(0,z.useCallback)(e=>{t.current.delete(e)},[]),getDetectorsMap:(0,z.useCallback)(()=>t.current,[]),getOrCreateDetector:s}}(r),{handleMarkdownFileDetected:f,updateStreamingContent:h,clearOpenedFiles:g}=function(e){let{dispatchChatResource:t,openControlsSidebar:s,isDrawerExpanded:a,maxTrackedFiles:n=100,throttleMs:i=100}=e,l=(0,z.useRef)(new Set),r=(0,z.useCallback)(e=>{let t=l.current,s=!t.has(e);if(t.has(e))t.delete(e);else if(t.size>=n){let e=t.values().next().value;e&&t.delete(e)}return t.add(e),s},[n]),o=(0,z.useCallback)(e=>l.current.has(e),[]),d=(0,z.useCallback)(function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"create_file";r(e)&&(a||s(),t({type:"SELECT_FILE",path:e,toolType:i,messageId:n}))},[t,s,a,r]),c=(0,z.useCallback)(e=>{},[]),u=(0,z.useCallback)(e=>{let{path:s,content:a,renderAs:n,showingInRightPane:i}=e;t({type:"UPDATE_STREAMING_FILE",path:s,content:a,renderAs:n,showingInRightPane:i})},[t]),m=(0,z.useMemo)(()=>t$()(e=>{u(e)},i,{leading:!0,trailing:!0}),[u,i]);(0,z.useEffect)(()=>()=>{m.cancel()},[m]);let p=(0,z.useCallback)(e=>{m(e)},[m]),f=(0,z.useCallback)(e=>{m.cancel(),u(e)},[u,m]),h=(0,z.useCallback)((e,t,s)=>{d(e,s),p({path:e,content:t,renderAs:tJ.vU.Markdown,showingInRightPane:!0})},[d,p]);return{trackOpenedFile:r,hasBeenOpened:o,openFileInRightPane:d,registerMarkdownFile:c,updateStreamingContent:p,updateStreamingContentImmediate:f,handleMarkdownFileDetected:h,clearOpenedFiles:(0,z.useCallback)(()=>{l.current.clear()},[]),getOpenedFilesSet:(0,z.useCallback)(()=>l.current,[])}}({dispatchChatResource:n,openControlsSidebar:i,isDrawerExpanded:l,maxTrackedFiles:r});(0,z.useEffect)(()=>{if(!u)return;let{path:e,content:t}=u,a=m(u);if(!a)return;let{isMarkdown:n,isLatched:i}=a,l=(null==s?void 0:s.uuid)||"";n?f(e,t,l):i&&h({path:e,content:t,renderAs:tJ.vU.Markdown})},[u,m,f,h,null==s?void 0:s.uuid]);let x=(0,z.useCallback)(()=>{o.current.clear()},[]);(0,z.useEffect)(()=>()=>{a&&(p(),g(),x(),d.current=void 0)},[a,p,g,x])}({isStreaming:t,lastMessage:d,conversationUuid:s,dispatchChatResource:a,openControlsSidebar:n,isDrawerExpanded:i,maxTrackedFiles:l});let h=(0,z.useRef)(!1),g=(0,z.useRef)(!1);return(0,z.useEffect)(()=>{if(!d)return;if(t){h.current=!1,g.current=!0;return}if(h.current||!g.current||!o||!(0,u.GN)(o))return;let e=c.slice(0,-1),a=new Set;e.forEach(e=>{t0(e).forEach(e=>a.add(e))}),Array.from(t0(d)).filter(e=>!a.has(e)).forEach(e=>{p.track({event_key:"wiggle.file.created",chat_message_uuid:o,...(0,tQ.k)({filePath:e,isShared:!1,conversationUuid:s,source:"completion"})})}),h.current=!0},[t,d,o,p,s,c]),(0,z.useEffect)(()=>{if(!(m.width<H.g)&&d&&!t){let e=function(e){var t;for(let s of null!=(t=e.content)?t:[])if("text"===s.type){for(let e of(0,tZ.n)(s.text))if((0,tJ.IO)(e))return e}return null}(d),t=f.current.lastOpenedId===e;e&&!t&&o&&(f.current.lastOpenedId=e,r(e,o))}},[t,d,r,o,m.width]),null});t1.displayName="StreamingFileManager";var t2=s(48730);let t3=e=>{let{conversationUuid:t,retryCount:s}=e,[a,i]=(0,z.useState)(""),l=(0,I.A)(),r=(0,q.uO)(t),o=(0,z.useMemo)(()=>[l.formatMessage({defaultMessage:"Gathering my thoughts, be right there...",id:"C6UYRcZHCt"}),l.formatMessage({defaultMessage:"Contemplating, stand by...",id:"r6P7kLapjf"}),l.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"}),l.formatMessage({defaultMessage:"Ruminating on it, stand by...",id:"wt2OTGsj0k"}),l.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"})],[l]),d=(0,z.useMemo)(()=>l.formatMessage({defaultMessage:"Still working on it, stand by...",id:"R9hnARYgER"}),[l]),c=(0,z.useMemo)(()=>l.formatMessage({defaultMessage:"A bit longer, thanks for your patience...",id:"MCt5e8xpx8"}),[l]);(0,z.useEffect)(()=>{if(r||s&&s>0)return;let e=[];return e.push(setTimeout(()=>{i(o[Math.floor(Math.random()*o.length)])},5e3)),e.push(setTimeout(()=>{i(d)},15e3)),e.push(setTimeout(()=>{i(c)},3e4)),()=>{e.forEach(e=>clearTimeout(e))}},[o,d,c,r,s]);let u=(0,z.useMemo)(()=>s&&s>0?l.formatMessage({defaultMessage:"Taking longer than usual. Trying again shortly (attempt {attemptNumber} of 10)",id:"1OhR91Iznh"},{attemptNumber:s+1}):a,[s,a,l]);return(!r||s&&0!==s)&&u?(0,n.jsx)(eh.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"font-claude-response text-text-300 ml-2 pb-1.5 text-sm italic",children:u}):null};function t4(){let e=(0,a._)(["\n  flex-1\n  flex\n  flex-col\n  gap-3\n  px-4\n  max-w-3xl\n  mx-auto\n  w-full\n"]);return t4=function(){return e},e}function t6(e){let{isStreaming:t,hasWebSearchResponse:s,retryCount:a,conversationUuid:i,shouldShowWaitingText:l,currentAvatarState:r,isTemporary:o,scrollRef:d,incognitoString:c,isResearchPending:u,enableNotificationsUI:m,tooltipContent:p,notificationPermission:f,enableNotifications:h}=e;return(0,n.jsx)("div",{ref:d,children:(0,n.jsxs)("div",{className:(0,k.A)("ml-1 mt-0.5 flex items-center transition-transform duration-300 ease-out",t&&"-translate-y-2.5"),children:[(0,n.jsx)("div",{className:"p-1 -translate-x-px",children:(0,n.jsx)(b.a,{state:r})}),l?(0,n.jsx)(t3,{conversationUuid:i,retryCount:a}):null,(0,n.jsx)("div",{className:(0,k.A)("text-text-500 px-2 mt-6 flex-1 text-right text-[0.65rem] leading-[0.85rem] sm:text-[0.75rem]",t&&"pointer-events-none"),children:o?(0,n.jsx)("div",{className:(0,k.A)("inline-block select-none transition-opacity mt-1",!t&&"opacity-90 delay-300 duration-700",t&&"opacity-0 duration-0"),children:c}):u&&m?(0,n.jsx)("div",{className:"inline-block select-none",children:"default"===f?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:(0,n.jsx)(T.A,{defaultMessage:"Research takes time. Claude can let you know when it’s done.",id:"sPgKzf0LZ9"})}),(0,n.jsx)("button",{onClick:h,className:"text-text-300 hover:text-text-200 underline",children:(0,n.jsx)(T.A,{defaultMessage:"Enable notifications",id:"AIUVfaT9og"})})]}):(0,n.jsx)(T.A,{defaultMessage:"Claude is off doing its research. Check back in later or start a new chat while you wait.",id:"Q/VRaHS8PD"})}):(0,n.jsx)(y.Tooltip,{tooltipContent:p,side:"bottom",disableHoverableContent:!0,className:"max-w-full",delayDuration:50,children:(0,n.jsx)(A(),{href:"https://support.anthropic.com/en/articles/8525154-claude-is-providing-incorrect-or-misleading-responses-what-s-going-on",target:"_blank",className:(0,k.A)("inline-block select-none",!t&&"opacity-90 delay-300 duration-700",t&&"opacity-0 duration-0"),children:(0,n.jsx)("span",{className:"hover:text-text-300 transition",children:s?(0,n.jsx)(T.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check cited sources.",id:"Al7GtlU74g",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}}):(0,n.jsx)(T.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check responses.",id:"EY1nHGV6e9",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}})})})})})]})})}let t5=o.XA.maxFilesPerConversation;function t8(e){var t,s,a,o,j,b,y,k;let{changeDisplayedConversationPath:S,chatInputDefaultMessage:A,conversationTitle:T,conversationUuid:X,editMessage:$,isStreaming:Z,isTemporary:Q=!1,isLoading:ee,messageUuids:et,name:es,onRetry:en,onSend:ei,projectUuid:el,setPersonalizedStyleCallback:er,onToolAllow:eo,retryCount:ed,onStopSampling:ec}=e,eu=(0,K.O)(X),{isCmdKOpen:em}=(0,F.l)(),ep=(0,q.n5)(X),ef=(0,q.U4)(X),eh=(0,q.Ci)(X,Z),eg=(0,q.zg)(X),ex=et[et.length-1]||null,{account:ev,activeOrganization:ej}=(0,g.YL)(),{selectedTier:eb}=(0,v.t)(),ey=(0,x.B)(),ew=(0,I.A)(),e_=(0,L.P2)(),eC=(0,z.useRef)(null),[ek,eM]=(0,z.useState)(null),[eN,eS]=(0,z.useState)(!0),eA=(0,z.useRef)(null);eA.current=et[et.length-1]||null;let{chatResourceState:eE,dispatchChatResource:ez}=(0,ea.i)(),{serverLastChatMessageWarningProps:eT,updateServerLastChatMessageWarningPropsForNewMessage:eI}=function(e){let[t,s]=(0,z.useState)(null),a=function(e){let{activeOrganization:t}=(0,g.YL)(),s="/api/organizations/".concat((null==t?void 0:t.uuid)||"","/chat_conversations/").concat(e,"/chat_message_warning"),{mutateAsync:a}=(0,tc.L2)(s,"POST",{meta:{noToast:!0}});return(0,z.useCallback)(async e=>{let t=await a(e);return t.warning_props?{contentMarkdown:t.warning_props.content_markdown,style:t.warning_props.style}:null},[a])}(e),n=(0,z.useCallback)(t=>{async function n(){if(!(0,K.O)(e))try{s(await a(t))}catch(e){}}s(null),n()},[a,e]),i=(0,z.useCallback)(e=>{let{messageText:t,parentMessageUuid:s}=e;n({message_text:t,analytics_data:{type:"message_send",prev_message_uuid:s&&s!==u.gF?s:null}})},[n]);return function(e){let{onLastMessageLoaded:t,conversationUuid:s}=e,a=(0,q.Q3)(s),n=(0,z.useRef)(a);(0,z.useEffect)(()=>{if(!n.current)return;let e=(0,tu.C)(n.current);e&&t({uuid:n.current.uuid,messageText:e})},[t])}({onLastMessageLoaded:(0,z.useCallback)(e=>{let{uuid:t,messageText:s}=e;n({message_text:s,analytics_data:{type:"conversation_load",message_uuid:t}})},[n]),conversationUuid:e}),{serverLastChatMessageWarningProps:t,updateServerLastChatMessageWarningPropsForNewMessage:i}}(X),{setSandboxState:eU}=(0,r.q)(),eL=(0,E.useSearchParams)(),[eO,eF]=(0,z.useState)(!1),[eD,eP]=(0,z.useState)(null),eB={lastAssistantMessage:(0,z.useRef)(null),lastHumanMessage:(0,z.useRef)(null),chatInput:(0,z.useRef)(null),extras:(0,z.useRef)(null),extraSpace:(0,z.useRef)(null)},eG=(0,z.useRef)(et.length);(0,z.useEffect)(()=>{et.length>eG.current&&eO&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{eC.current&&(eC.current.scrollToBottomIfPinned("smooth"),eF(!1))})}),eG.current=et.length},[et.length,eO,eF]);let eW=(0,z.useCallback)(()=>{let e=eB.lastAssistantMessage.current;if(!e)return!0;let t=e.getBoundingClientRect(),s=window.innerHeight;return t.bottom<s+50},[eB.lastAssistantMessage]);(0,z.useEffect)(()=>(Z?c.Z.setVisibilityCheck(eW):c.Z.clearVisibilityCheck(),()=>{c.Z.clearVisibilityCheck()}),[Z,eW]);let eJ=(0,z.useRef)(null),eV=(0,z.useCallback)(async e=>{let{prompt:t,attachments:s,files:a,syncSources:n,personalized_style:i,compass_mode:l}=e;if(Z)return;ez({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eI({messageText:t,parentMessageUuid:eA.current}),eF(!0),eU(X,{conversationFiles:[...eE.files,...a],allAttachments:[...eE.attachments,...s],projectUuid:el});let r={prompt:t,attachments:s,files:a,syncSources:n,rethrowErrors:!0,parent_message_uuid:eA.current||u.gF,personalized_style:i,org_type_override:null!=eb?eb:void 0,compass_mode:l};await ei(r)},[Z,ez,eI,eU,X,eE.files,eE.attachments,ei,el,eb]),eH=(0,z.useCallback)((e,t)=>{ez({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eU(X,{conversationFiles:eE.files,allAttachments:eE.attachments,projectUuid:el}),en(e,t)},[ez,eU,X,eE.files,eE.attachments,en,el]),eq=(0,z.useCallback)(async()=>{if(Z)return;let e=ew.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"});await ei({prompt:e,attachments:[],files:[],syncSources:[],rethrowErrors:!0,parent_message_uuid:eA.current||u.gF})},[ew,Z,eA,ei]),eY=(0,z.useCallback)((e,t)=>{if($){var s;ez({type:"CLEAR_SELECTED"}),$(e,t),eI({messageText:t,parentMessageUuid:null!=(s=e.parent_message_uuid)?s:null})}},[ez,$,eI]),eK=(0,z.useMemo)(()=>(0,N.A)(),[]);(0,z.useEffect)(()=>(eK.on("retry",e=>{let{parent_message_uuid:t,paprika_mode:s}=e;eH(t,s)}),eK.on("edit",e=>{let{message:t,text:s}=e;eY(t,s)}),()=>{eK.off("retry"),eK.off("edit")}),[eK,eH,eY]);let{files:eX,attachments:eZ,selectedItem:eQ}=eE,{isDrawerExpanded:e0,setIsDrawerExpanded:e1}=(0,e$.x)(),e2=(0,z.useCallback)(()=>{ez({type:"CLEAR_SELECTED"}),e1(!0)},[ez,e1]),e3=(0,z.useCallback)(()=>{e1(!1)},[e1]),e4=(0,q.QS)(),e6=(0,q.P8)(),e5=(0,q.w0)();(0,z.useEffect)(()=>{ez({type:"UPDATE_FILES",files:e4})},[e4,ez]),(0,z.useEffect)(()=>{ez({type:"UPDATE_ATTACHMENTS",attachments:e6})},[ez,e6]),(0,z.useEffect)(()=>{ez({type:"UPDATE_SYNC_SOURCES",syncSources:e5})},[ez,e5]);let e8=(0,z.useCallback)(e=>{e2(),ez({type:"SELECT_ATTACHMENT",attachment:e})},[ez,e2]),e7=(0,z.useMemo)(()=>!!((null==ey?void 0:ey.preview_feature_uses_artifacts)||eg),[ey,eg]),e9=(0,R.QY)(),tt=(0,z.useCallback)((e,t,s)=>{e2(),ez({type:"SELECT_ARTIFACT",id:e,versionUuid:s}),ez({type:"SET_ACTIVE_MESSAGE_UUID",uuid:t||""})},[ez,e2]),ts=(0,z.useCallback)((e,t)=>{e2(),ez({type:"SELECT_FILE",path:e.replace("computer://",""),toolType:"create_file",messageId:t})},[ez,e2]),ta=(0,q.SY)(),tn=(0,z.useRef)({lastOpenedId:null}),ti=(0,C.l)();(0,z.useEffect)(()=>{if(ti.width<H.g)return;let e=tn.current.lastOpenedId===ta;Z&&ta&&!e&&(tn.current.lastOpenedId=ta,tt(ta))},[Z,ta,tt,ti.width]),(0,z.useEffect)(()=>{let e=eL.get("artifactId"),t=eL.get("versionUuid");e&&(e2(),ez({type:"SELECT_ARTIFACT",id:e,versionUuid:t||void 0}))},[]);let tl=(0,z.useMemo)(()=>{if(Z&&eh&&eh.content)return eh.content[eh.content.length-1]},[Z,eh]),tf=Z&&(!eh||!(null==(t=eh.content)?void 0:t[0])&&0===eh.attachments.length&&0===eh.files.length&&0===eh.files_v2.length),th=tl&&("tool_use"===tl.type||"tool_result"===tl.type),tg=(0,z.useMemo)(()=>{if(eh&&!Z)return(0,Y.eb)(eh)},[Z,eh]),tx=!Z&&void 0!==tg,{compassStatus:tv}=(0,J.CH)({organizationUuid:null==ej?void 0:ej.uuid,conversationUuid:X,taskId:tg,isShared:!1,enabled:tx}),tj=(0,z.useMemo)(()=>{if(!eh||Z)return!1;let e=(0,Y.nb)(eh);return!!(e&&!e.is_error&&(0,_.i3)(null==tv?void 0:tv.status))&&!(0,Y.OC)(eh)},[Z,tv,eh]),tb=(0,V.Wo)(),tw=(0,V.hG)(),{value:t_}=(0,w.fS)("compass_enable_notifications_web"),tC=(0,z.useMemo)(()=>tf?"thinking":th||tj?"shimmer":Z?"writing":"static",[tf,th,tj,Z]);((e,t,s)=>{let a=(0,w.T9)("claude_ai_tabbed_out_notifications","features",tD,tF),n="visible"===(0,tU.f)(),{setThinkingTitle:i,setReceivedTitle:l,resetTitle:r}=((e,t,s)=>{let a=(0,z.useRef)(null),n=(0,z.useCallback)(()=>{a.current&&(clearInterval(a.current),a.current=null),document.title="Working on it..."},[]),i=(0,z.useCallback)(()=>{if(a.current)return;let t=0;a.current=setInterval(()=>{document.title=e[t],t=(t+1)%e.length},s)},[s,e]),l=(0,z.useCallback)(()=>{a.current&&(clearInterval(a.current),a.current=null),document.title=t},[t]);return(0,z.useMemo)(()=>({setThinkingTitle:n,setReceivedTitle:i,resetTitle:l}),[n,i,l])})(["Ready to chat",e],e,a.titleDelayMs||1600),{setWritingFavicon:o,setCompleteFavicon:d,resetFavicon:c}=(e=>{let t=(0,z.useRef)(null),s=(0,z.useCallback)(e=>{let t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.rel="icon",t.href=e,document.head.appendChild(t)},[]),a=(0,z.useCallback)(()=>{t.current&&clearInterval(t.current),t.current=null,s("/favicon.ico")},[s]),n=(0,z.useCallback)(()=>{if(t.current)return;let a=0;t.current=setInterval(()=>{s("".concat(tL,"/").concat(tR[a],".svg")),a=(a+1)%tR.length},e)},[e,s]),i=(0,z.useCallback)(()=>{a(),s(tO)},[s,a]);return(0,z.useMemo)(()=>({setWritingFavicon:n,setCompleteFavicon:i,resetFavicon:a}),[n,i,a])})(a.faviconDelayMs||100),{playSound:u,resetSound:m}=(()=>{let e=(0,z.useRef)(null),t=(0,z.useRef)(!1);(0,z.useEffect)(()=>{try{e.current=new Audio("/click.mp3")}catch(e){}},[]);let s=(0,z.useCallback)(()=>{if(!t.current){t.current=!0;try{e.current||(e.current=new Audio("/click.mp3"))}finally{var s;null==(s=e.current)||s.play()}}},[]),a=(0,z.useCallback)(()=>{t.current=!1},[]);return(0,z.useMemo)(()=>({playSound:s,resetSound:a}),[s,a])})(),p=(0,z.useRef)(!1);(0,z.useEffect)(()=>{let e=t&&s,f=!t&&s,h=!t&&!s;e&&!p.current&&(p.current=!0);let g=h&&p.current;if(g&&(p.current=!1),n){a.changeTitle&&r(),a.changeFavicon&&c();return}a.changeTitle&&(e||f?i():g&&l()),a.changeFavicon&&(f?o():g&&(d(),p.current=!1)),a.playSound&&(e?m():g&&u())},[a,t,s,n,i,l,r,o,d,c,u,m])})(T,tf,Z);let{getCreateParamsForConvo:tk}=(0,f.I)();(0,z.useEffect)(()=>{if(ee)return;let e=tk(X);e&&void 0!==e.prompt&&(e.prompt.length>0||e.files.length>0||e.attachments.length>0||e.syncSources.length>0)&&eV(e)},[X,eV,tk,ee]);let{data:tM}=(0,O.fo)(el),tN=(0,P.K)(),tS=(0,D.ED)(el),{publishedArtifactsByMessageUuid:tA}=(0,l.rC)({includeDeletedArtifacts:!0}),{mutate:tE,isPending:tG}=(0,i.aC)(X),tJ=(0,f.E)(),tV=(0,z.useCallback)((e,t)=>{ez({type:"CLEAR_SELECTED"}),null==S||S(e,t)},[S,ez]),tH=(0,m.Z3)(X);(0,td.hq)(X);let tq=(0,z.useMemo)(()=>!!eh&&!Z&&!!eh.content&&eh.content.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),[eh,Z]),{activeModelOptions:tY}=(0,p.A9)(),tK=U.z.array(U.z.string()),tX=(0,w.T9)("invite_contest_name","model_prefixes",[],tK),{data:t$}=(0,i.Fn)();(0,z.useEffect)(()=>{if(!Z&&2===et.length&&(null==ep?void 0:ep.sender)==="human"&&"assistant"===ef&&tX.some(e=>null==tH?void 0:tH.startsWith(e))&&t$&&t$.count>=2){let e=new CustomEvent("firstClaudeMessage",{detail:{conversationUuid:X,model:tH}});window.dispatchEvent(e)}},[Z,et.length,ep,ef,tH,X,tX,t$]);let tZ=(0,z.useMemo)(()=>{let e=ew.formatMessage({defaultMessage:"Learn about Claude’s responses ↗",id:"dD0oo8Rjtz"}),t=tY.find(e=>e.model===tH);if(!t||!t.knowledgeCutoff)return e;let s=M.c9.fromFormat(t.knowledgeCutoff,"LLLL yyyy",{locale:"en-US"});if(!s.isValid)return ew.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:t.knowledgeCutoff});{let e=s.toLocaleString({year:"numeric",month:"long"},{locale:ew.locale});return ew.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:e})}},[tH,tY,ew]),tQ=(0,z.useMemo)(()=>e0&&eE.selectedItem?eE.selectedItem:void 0,[e0,eE.selectedItem]),t0=(0,z.useCallback)(e=>(0,n.jsx)(t2.A,{...e,conversationUuid:X,onOpenArtifact:e7?tt:void 0,onAllow:e.isLastMessage&&!e.toolResult?eo:void 0,selectedDrawerItem:tQ,autoscrollRef:eC}),[X,e7,tt,eo,tQ]),t3=(0,z.useCallback)(()=>{eP({})},[]),t4=(0,z.useMemo)(()=>({id:X,messagesSoFar:et.length,files:eX,attachmentsSoFar:eZ.length,isSampling:Z,isStoppingSampling:tG,model:tH,projectKnowledgebaseTokens:null!=tS?tS:0,conversationSettings:ey}),[eZ.length,ey,X,eX,tG,Z,et.length,tH,tS]),t8=(0,z.useMemo)(()=>!!eh&&!Z&&"assistant"===eh.sender&&eh.content&&eh.content.some(e=>"tool_result"===e.type&&"web_search"===e.name),[eh,Z]),t9=(0,z.useCallback)(()=>{(0,d.OZ)(),tE(),ec&&ec()},[tE,ec]),se=(0,z.useCallback)(async e=>{await eV({prompt:e.prompt,attachments:[],files:e.files,syncSources:[]})},[eV]),st=(0,h.u9)();if(!ev)return null;let ss=Z&&(ed||2===et.length);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t1,{isStreaming:Z,conversationUuid:X,dispatchChatResource:ez,openControlsSidebar:e2,isDrawerExpanded:e0,maxTrackedFiles:t5,selectComputerFile:ts,lastMessageUuid:ex||void 0}),(0,n.jsx)(tm.b,{autoscrollDisabled:eN,autoscrollRef:eC,rightSidebarElement:st&&!eu?(0,n.jsx)(te,{conversationUuid:X,projectUuid:el,isStreaming:Z,isTemporary:Q,messagesLength:et.length}):void 0,mainElement:(0,n.jsxs)(to._,{conversation:t4,projectUuid:el,onSend:eV,onCreate:tJ,onStopSampling:t9,setPersonalizedStyleCallback:er,children:[(0,n.jsx)(tP.Q,{chatId:X,chatName:es,onSend:se,hasFirstMessage:!!ep&&!ee}),(0,n.jsxs)("div",{className:"relative mx-auto flex h-full w-full max-w-3xl flex-1 flex-col md:px-2",children:[(0,n.jsx)(ty,{conversationUuid:X}),ee?(0,n.jsx)(t7,{className:"pt-2",children:(0,n.jsx)(W,{})}):0===et.length?(0,n.jsx)(n.Fragment,{children:(null==t4||null==(s=t4.conversationSettings)?void 0:s.create_mode)?(0,n.jsx)(t7,{className:"pt-1",children:(0,n.jsx)(tz,{})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tI,{}),(0,n.jsx)(t7,{})]})}):(0,n.jsxs)(t7,{className:"pt-1",children:[(null==t4||null==(a=t4.conversationSettings)?void 0:a.create_mode)&&(0,n.jsx)(tz,{selectedLabel:(null==ep||null==(j=ep.content)||null==(o=j[0])?void 0:o.type)==="text"?null==ep||null==(y=ep.content)||null==(b=y[0])?void 0:b.text:void 0,disabled:et.length>0}),(0,n.jsx)(tp.$,{renderToolUseCell:t0,children:et.map((e,t)=>{var s;return(0,n.jsx)(G.c,{lastHumanMessageRef:eB.lastHumanMessage,lastAssistantMessageRef:eB.lastAssistantMessage,previousMessageUuid:t>0?et[t-1]:void 0,messageUuid:e,conversationUuid:X,conversationSettings:ey,isStreaming:Z,isLastMessage:t===et.length-1,isLastHumanMessage:t===et.length-2,isFirstAssistantMessage:1===t&&"assistant"===ef,messageWarningProps:t===et.length-1&&eT||void 0,onOpenArtifact:e7?tt:void 0,onOpenWiggleFile:ts,selectAttachment:e8,changeDisplayedConversationPath:tV,editable:!0,publishedArtifacts:null==tA?void 0:tA[e],onResize:t3,actionEmitter:eK,onSendContinue:eq,isResearchPending:tj,isTemporary:Q,model:tH,extendedThinkingSetting:null!=(s=null==ey?void 0:ey.paprika_mode)?s:null,showArtifacts:e7,chatFeedbackEnabled:e9,isInteractive:!0,shareType:null,showSharedImageMissing:!1,showSharedFileMissing:!1},t)})}),(0,n.jsx)(tB,{ref:eM}),!eu&&(0,n.jsx)(t6,{isStreaming:Z,hasWebSearchResponse:!!t8,shouldShowWaitingText:!!ss,retryCount:ed,conversationUuid:X,currentAvatarState:tC,scrollRef:eB.extras,isTemporary:Q,incognitoString:e_,isResearchPending:tj,enableNotificationsUI:t_,tooltipContent:tZ,notificationPermission:tb,enableNotifications:tw}),(0,n.jsx)(tT,{newMessageSent:eO,setNewMessageSent:eF,scrollRefs:eB,scrollContainerRef:eC,invalidator:eD})]}),(null==t4||null==(k=t4.conversationSettings)?void 0:k.create_mode)&&0===et.length?null:tq?(0,n.jsx)("div",{ref:eB.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,n.jsx)(tr,{conversationUuid:X})}):(0,n.jsxs)("div",{ref:eB.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5] relative",children:[(0,n.jsx)(tW,{setAutoscrollDisabled:eS,autoscrollRef:eC,sentinelElement:ek,isStreaming:Z,avatarState:tC}),(0,n.jsx)(B.V,{ref:eJ,placement:"bottom",disabled:ee||!!(eA.current&&!(0,u.GN)(eA.current)),onRetry:(e,t)=>en(e,void 0,void 0,t),disableDropZone:em,enableScreenDrop:!0})]})]})]}),drawerElement:(0,n.jsx)(eR,{conversationUuid:X,isOpen:e0,onClose:e3,isStreaming:Z,projectUuid:el,sendMessage:eV,isTemporary:Q}),isDrawerOpen:!!(e0&&eQ),headerProps:{conversationUuid:X,name:es,project:tN?tM:void 0,controlsSidebarIsOpen:e0,closeControlsSidebar:e3,openControlsSidebar:e2,isStreaming:Z,isLoading:ee}})]})}let t7=j.J.div(t4())},99411:(e,t,s)=>{s.d(t,{NG:()=>f,aX:()=>h,sH:()=>g});var a=s(54568),n=s(14691),i=s(66716),l=s(48252),r=s(67453),o=s(16256),d=s(72902),c=s(61295),u=s(7620),m=s(787),p=s(20804);let f=e=>{let{isExpanded:t,isScrollable:s,snappyTransition:n,children:l,className:r,onTransitionEnd:m,onAnimationComplete:p,collapsesHalfway:f,setIsExpanded:h,footer:g}=e,x=(0,u.useRef)(t),v=!!(f&&!t&&h),j=f&&!t;return(0,a.jsxs)(c.P.div,{className:(0,d.A)("overflow-hidden shrink-0",!t&&v&&"cursor-pointer"),tabIndex:-1,initial:{opacity:0,height:x.current?"auto":0},animate:t?"expanded":"collapsed",variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:.6*!!f,height:72*!!f}},whileHover:{opacity:1},transition:n?{ease:o.A.snappyOut,duration:.4}:{ease:"easeInOut",duration:.4},onTransitionEnd:m,onAnimationComplete:p,onClick:v?()=>h(!0):void 0,children:[(0,a.jsx)(i.r,{gradientHeight:16,tabIndex:-1,style:{scrollbarGutter:"stable"},className:(0,d.A)("h-full",s&&"!max-h-[238px]",r,j&&"[mask-image:linear-gradient(to_bottom,_hsl(var(--always-black)/100%)_0%,_hsl(var(--always-black)/0%)_100%)]",!t&&"pointer-events-none"),children:l}),g]})},h=e=>{let{handleClick:t,isDisabled:s,isExpanded:i,isStreaming:o,isError:u,errorMessage:f,icon:h,text:g,secondaryIcon:x,secondaryText:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,className:y,wrapperClassName:w,children:_,renderMode:C=m.l.Standard,isFirstItemInGroup:k,isLastItemInGroup:M}=e,N=s||!t,S=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:t,className:(0,d.A)("group/row flex flex-row items-center justify-between gap-4 rounded-lg text-text-300 h-[2.625rem] py-2 px-3",N?"cursor-default":"cursor-pointer transition-colors duration-200 hover:text-text-200 hover:text-text-000",y),disabled:N,children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2 min-w-0",children:[h&&C!==m.l.TimelineGroup&&(0,a.jsx)("div",{className:"w-5 h-5 flex items-center justify-center text-text-100",children:h}),(0,a.jsx)("div",{className:"relative bottom-[0.5px] font-base text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300",children:o?(0,a.jsx)(l.N,{children:g}):g})]}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1.5 min-w-0 shrink-0",children:u?(0,a.jsx)(r.Tooltip,{tooltipContent:f,align:"center",children:(0,a.jsx)("span",{className:"inline-flex",children:(0,a.jsx)(n.N5,{size:16,className:"text-danger-000"})})}):(0,a.jsxs)(a.Fragment,{children:[!!v&&(0,a.jsx)("p",{className:"relative bottom-[0.5px] pl-1 text-text-500 font-small leading-tight shrink-0 whitespace-nowrap",children:v}),x]})})]},o?"streaming":"non-streaming"),_]});return C===m.l.TimelineGroup?(0,a.jsx)(p.i1,{icon:h,isExpanded:i,isFirstItem:!!k,isLastItem:!!M,isActive:o&&b&&M,children:S}):(0,a.jsx)(c.P.div,{initial:{opacity:+!o},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,d.A)("ease-out rounded-lg border-0.5 flex flex-col font-ui leading-normal my-3 border-border-300 min-h-[2.625rem]",!s&&!i&&"hover:bg-bg-200",j?"mt-2":"mt-3",b?"mb-2":"mb-3",i&&"bg-bg-000 shadow-sm",w),children:S})},g=e=>{let{isExpandingDisabled:t,setIsExpanded:s,...i}=e,{isExpanded:l,isError:r,secondaryIcon:o}=i,c=t||r;return(0,a.jsx)(h,{...i,isError:r,isDisabled:c,handleClick:()=>s(!l),secondaryIcon:(0,a.jsxs)(a.Fragment,{children:[o,!c&&(0,a.jsx)("span",{className:(0,d.A)("inline-flex transition-transform duration-400 ease-snappy-out",l?"rotate-180":"rotate-0"),children:(0,a.jsx)(n.bi,{className:(0,d.A)("relative bottom-[0.5px] text-text-300",c&&"opacity-15"),size:16})})]})})}},99427:(e,t,s)=>{s.d(t,{bl:()=>r});var a=s(44894),n=s(3194),i=s(2327);function l(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"quick_entry_image",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=atob(e),l=new Uint8Array(i.length);for(let e=0;e<i.length;e++)l[e]=i.charCodeAt(e);let r=n||a._F[t]||"png";return new File([l],"".concat(s,".").concat(r),{type:t})}async function r(e,t,s,r,o){let d=o?o.split(".")[0]:o,c=o?o.split(".")[1]:o;if(d&&c){let r=l(e,t,d,c),o={orgUuid:s,projectUuid:void 0,conversationUuid:i.T.current,modelConfig:{image_in:!0,pdf_in:!0},featureGates:{janus_claude_ai:!0,ooc_attachments:!0,use_canvas_resize:!0,wiggleEnabled:!0},limits:a.XA};return[await (0,n.gs)(r,o)]}let u=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"quick_entry_image",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=l(e,t,s,a),i=new FormData;return i.append("file",n),i}(e,t,d,c),m=await r("/api/".concat(s,"/upload"),{method:"POST",body:u});if(m.ok)return[await m.json()];throw Error("Failed to upload image: ".concat(m.status," ").concat(m.statusText))}}}]);